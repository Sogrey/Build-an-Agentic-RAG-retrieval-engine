![Image](pdf_images\page1_img1.png)

## ä»é›¶åˆ°ä¸€MCPå¿«é€Ÿå…¥é—¨å®æˆ˜

# Anthropic MCPå‘å¸ƒé€šå‘Šï¼šhttps://www.anthropic.com/news/model-context-protocol

# MCP GitHubä¸»é¡µï¼šhttps://github.com/modelcontextprotocol

# ä¸€ã€MCPæŠ€æœ¯ä½“ç³»ä»‹ç»

1. MCPå…¥é—¨ä»‹ç»

# MCPï¼Œå…¨ç§°æ˜¯Model Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼Œç”±Claudeæ¯å…¬å¸Anthropicäºå»å¹´11æœˆæ­£å¼

# æå‡ºã€‚

# MCPåˆšå‘å¸ƒçš„æ—¶å€™ä¸æ¸©ä¸ç«ï¼Œç›´åˆ°ä»Šå¹´Agentå¤§çˆ†å‘æ‰è¢«å¹¿æ³›å…³æ³¨ã€‚è€Œåœ¨ä»Šå¹´2æœˆï¼ŒCursoræ­£å¼å®£å¸ƒåŠ å…¥

# MCPåŠŸèƒ½æ”¯æŒï¼Œä¸€ä¸¾å°†MCPæ¨åˆ°äº†å…¨ä½“å¼€å‘äººå‘˜é¢å‰ã€‚ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒMCPæ˜¯ä¸€ç§æŠ€æœ¯åè®®ï¼Œä¸€ç§æ™ºèƒ½

# ä½“Agentå¼€å‘è¿‡ç¨‹ä¸­å…±åŒçº¦å®šçš„ä¸€ç§è§„èŒƒã€‚è¿™å°±å¥½æ¯”ç§¦å§‹çš‡çš„â€œä¹¦åŒæ–‡ã€è½¦åŒè½¨â€ï¼Œåœ¨ç»Ÿä¸€çš„è§„èŒƒä¸‹ï¼Œå¤§å®¶ çš„åä½œæ•ˆç‡å°±èƒ½å¤§å¹…æé«˜ï¼Œæœ€ç»ˆæå‡æ™ºèƒ½ä½“Agentçš„å¼€å‘æ•ˆç‡ã€‚æˆªæ­¢ç›®å‰ï¼Œå·²ä¸Šåƒç§MCPå·¥å…·è¯ç”Ÿï¼Œåœ¨

# å¼ºæ‚çš„MCPç”Ÿæ€åŠ æŒä¸‹ï¼Œ äººäººæ‰‹æ“Manusçš„æ—¶ä»£å³å°†åˆ°æ¥ã€‚

# 7åˆ†é’Ÿè®²æ¸…æ¥šMCPæ˜¯ä»€ä¹ˆï¼Ÿhttps://www.bilibili.com/video/BV1uXQzYaEpJ/

![Image](pdf_images\page2_img1.png)

![Image](pdf_images\page2_img2.png)

# æ€»çš„æ¥è¯´ï¼ŒMCPè§£å†³çš„æœ€å¤§ç—›ç‚¹ï¼Œå°±æ˜¯Agentå¼€å‘ä¸­è°ƒç”¨å¤–éƒ¨å·¥å…·çš„æŠ€æœ¯é—¨æ§›è¿‡é«˜çš„é—®é¢˜ã€‚

# æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œèƒ½è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œæ˜¯å¤§æ¨¡å‹è¿›åŒ–ä¸ºæ™ºèƒ½ä½“Agentçš„å…³é”®ï¼Œå¦‚æœä¸èƒ½ä½¿ç”¨å¤–éƒ¨å·¥å…·ï¼Œå¤§æ¨¡å‹å°±

# åªèƒ½æ˜¯ä¸ªç®€å•çš„èŠå¤©æœºå™¨äººï¼Œç”šè‡³è¿æŸ¥è¯¢å¤©æ°”éƒ½åšä¸åˆ°ã€‚ç”±äºåº•å±‚æŠ€æœ¯é™åˆ¶å•Šï¼Œå¤§æ¨¡å‹æœ¬èº«æ˜¯æ— æ³•å’Œå¤–

# éƒ¨å·¥å…·ç›´æ¥é€šä¿¡çš„ï¼Œå› æ­¤Function callingçš„æ€è·¯ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼ˆfunctionï¼‰ä½œä¸ºä¸­ä»‹ï¼Œä¸€è¾¹

# ä¼ é€’å¤§æ¨¡å‹çš„è¯·æ±‚ï¼Œå¦ä¸€è¾¹è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œæœ€ç»ˆè®©å¤§æ¨¡å‹èƒ½å¤Ÿé—´æ¥çš„è°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚

# ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è¦æŸ¥è¯¢å½“å‰å¤©æ°”æ—¶ï¼Œè®©å¤§æ¨¡å‹è°ƒç”¨å¤–éƒ¨å·¥å…·çš„function callingçš„è¿‡ç¨‹å°±å¦‚å›¾æ‰€ç¤ºï¼š

![Image](pdf_images\page3_img1.png)

# Function callingæ˜¯ä¸ªéå¸¸ä¸é”™çš„æŠ€æœ¯è®¾è®¡ï¼Œè‡ªè¯ç”Ÿä»¥æ¥ï¼Œä¸€ç›´è¢«ä¸šå†…å¥‰ä¸ºåœ­è‡¬ã€‚ä½†å”¯ä¸€çš„é—®é¢˜å°±æ˜¯ï¼Œç¼–

# å†™è¿™ä¸ªå¤–éƒ¨å‡½æ•°çš„å·¥ä½œé‡å¤ªå¤§äº†ï¼Œä¸€ä¸ªç®€å•çš„å¤–éƒ¨å‡½æ•°å¾€å¾€å°±å¾—ä¸Šç™¾è¡Œä»£ç ï¼Œè€Œä¸”ï¼Œä¸ºäº†è®©å¤§æ¨¡å‹â€œè®¤è¯†â€

# è¿™äº›å¤–éƒ¨å‡½æ•°ï¼Œæˆ‘ä»¬è¿˜è¦é¢å¤–ä¸ºæ¯ä¸ªå¤–éƒ¨å‡½æ•°ç¼–å†™ä¸€ä¸ªJSON Schemaæ ¼å¼çš„åŠŸèƒ½è¯´æ˜ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€

# è¦ç²¾å¿ƒè®¾è®¡ä¸€ä¸ªæç¤ºè¯æ¨¡ç‰ˆï¼Œæ‰èƒ½æé«˜Function callingå“åº”çš„å‡†ç¡®ç‡ã€‚

# è€ŒMCPçš„ç›®æ ‡ï¼Œå°±æ˜¯èƒ½åœ¨Agentå¼€å‘è¿‡ç¨‹ä¸­ï¼Œè®©å¤§æ¨¡å‹æ›´åŠ ä¾¿æ·çš„è°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚ä¸ºæ­¤ï¼ŒMCPæå‡ºäº†ä¸¤

# ä¸ªæ–¹æ¡ˆï¼Œå…¶ä¸€ï¼Œâ€œè½¦åŒè½¨ã€ä¹¦åŒæ–‡â€ï¼Œç»Ÿä¸€Function callingçš„è¿è¡Œè§„èŒƒã€‚

# é¦–å…ˆæ˜¯å…ˆç»Ÿä¸€åç§°ï¼ŒMCPæŠŠå¤§æ¨¡å‹è¿è¡Œç¯å¢ƒç§°ä½œ MCP Clientï¼Œä¹Ÿå°±æ˜¯MCPå®¢æˆ·ç«¯ï¼ŒåŒæ—¶ï¼ŒæŠŠå¤–éƒ¨å‡½æ•°è¿

# è¡Œç¯å¢ƒç§°ä½œMCP Serverï¼Œä¹Ÿå°±æ˜¯MCPæœåŠ¡å™¨ï¼Œ

![Image](pdf_images\page4_img1.png)

# ç„¶åï¼Œç»Ÿä¸€MCPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„è¿è¡Œè§„èŒƒï¼Œå¹¶ä¸”è¦æ±‚MCPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œä¹Ÿç»Ÿä¸€æŒ‰ç…§æŸä¸ªæ—¢å®š

# çš„æç¤ºè¯æ¨¡æ¿è¿›è¡Œé€šä¿¡ã€‚

â€œè½¦åŒè½¨ã€ä¹¦åŒæ–‡â€æœ€å¤§çš„å¥½å¤„å°±åœ¨äºï¼Œå¯ä»¥é¿å…MCPæœåŠ¡å™¨çš„é‡å¤å¼€å‘ï¼Œä¹Ÿå°±æ˜¯é¿å…å¤–éƒ¨å‡½æ•°é‡å¤ç¼–å†™ã€‚

# ä¾‹å¦‚ï¼ŒåƒæŸ¥è¯¢å¤©æ°”ã€ç½‘é¡µçˆ¬å–ã€æŸ¥è¯¢æœ¬åœ°MySQLæ•°æ®åº“è¿™ç§é€šç”¨çš„éœ€æ±‚ï¼Œå¤§å®¶æœ‰ä¸€ä¸ªäººå¼€å‘äº†ä¸€ä¸ªæœåŠ¡

# å™¨å°±å¥½ï¼Œå¼€å‘å®Œå¤§å®¶éƒ½èƒ½å¤åˆ¶åˆ°è‡ªå·±çš„é¡¹ç›®é‡Œæ¥ä½¿ç”¨ï¼Œä¸ç”¨æ¯ä¸ªäººæ¯æ¬¡éƒ½å•ç‹¬å†™ä¸€å¥—ã€‚

# è¿™å¯æ˜¯ä¿ƒè¿›å…¨çƒAIå¼€å‘è€…å…±åŒåä½œçš„å¥½äº‹å„¿ï¼Œå¾ˆå¿«ï¼ŒGitHubä¸Šå°±å‡ºç°äº†æµ·é‡çš„å·²ç»å¼€å‘å¥½çš„MCP æœåŠ¡

å™¨ï¼Œä»SQLæ•°æ®åº“æ£€ç´¢ã€åˆ°ç½‘é¡µæµè§ˆä¿¡æ¯çˆ¬å–ï¼Œä»å‘½ä»¤è¡Œæ“ä½œç”µè„‘ã€åˆ°æ•°æ®åˆ†ææœºå™¨å­¦ä¹ å»ºæ¨¡ï¼Œç­‰ç­‰ç­‰ ç­‰ï¼Œä¸ä¸€è€Œè¶³ã€‚

![Image](pdf_images\page7_img1.png)

# ç°åœ¨ï¼Œåªè¦ä½ æœ¬åœ°è¿è¡Œçš„å¤§æ¨¡å‹æ”¯æŒMCPåè®®ï¼Œä¹Ÿå°±æ˜¯åªè¦å®‰è£…äº†ç›¸å…³çš„åº“ï¼Œä»…éœ€å‡ è¡Œä»£ç å³å¯æ¥å…¥è¿™

# äº›æµ·é‡çš„å¤–éƒ¨å·¥å…·ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰Agentå¼€å‘é—¨æ§›ç¬é—´é™ä½äº†å‘¢ã€‚

# è¿™ç§â€œè½¦åŒè½¨ã€ä¹¦åŒæ–‡â€çš„è§„èŒƒï¼Œåœ¨æŠ€æœ¯é¢†åŸŸå°±è¢«ç§°ä½œåè®®ï¼Œä¾‹å¦‚httpå°±æ˜¯ç½‘ç»œä¿¡æ¯äº¤æ¢çš„æŠ€æœ¯åè®®ã€‚å„ç±»

# æŠ€æœ¯åè®®çš„ç›®æ ‡ï¼Œéƒ½æ˜¯å¸Œæœ›é€šè¿‡æé«˜åä½œæ•ˆç‡æ¥æå‡å¼€å‘æ•ˆç‡ï¼Œè€ŒMCPï¼ŒModel Context Protocolï¼Œå°±

# æ˜¯ä¸€ç§æ—¨åœ¨æé«˜å¤§æ¨¡å‹Agentå¼€å‘æ•ˆç‡çš„æŠ€æœ¯åè®®ã€‚

![Image](pdf_images\page8_img1.png)

![Image](pdf_images\page8_img2.png)

## é‚£æ—¢ç„¶æ˜¯åè®®ï¼Œå¿…ç„¶æ˜¯ä½¿ç”¨çš„äººè¶Šå¤šæ‰è¶Šæœ‰ç”¨ã€‚å› æ­¤ï¼Œä¸ºäº†è¿›ä¸€æ™®åŠMCPåè®®ï¼ŒAnthropicè¿˜æä¾›äº†ä¸€æ•´

## å¥—MCPå®¢æˆ·ç«¯ã€æœåŠ¡å™¨å¼€å‘çš„SDKï¼Œä¹Ÿå°±æ˜¯å¼€å‘å·¥å…·ï¼Œå¹¶ä¸”æ”¯æŒPythonã€TSå’ŒJavaç­‰å¤šç§è¯­è¨€ï¼Œå€ŸåŠ©

SDKï¼Œä»…éœ€å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥å¿«é€Ÿå¼€å‘ä¸€ä¸ªMCPæœåŠ¡å™¨ã€‚

ç„¶åï¼Œä½ å°±å¯ä»¥æŠŠå®ƒæ¥å…¥ä»»æ„ä¸€ä¸ªMCPå®¢æˆ·ç«¯æ¥æ„å»ºæ™ºèƒ½ä½“ï¼Œå¦‚æœæ„¿æ„ï¼Œè¿˜å¯ä»¥æŠŠMCPæœåŠ¡å™¨åˆ†äº«åˆ°ç¤¾ åŒºï¼Œç»™æœ‰éœ€æ±‚çš„å¼€å‘è€…ä½¿ç”¨ï¼Œç”šè‡³ä½ è¿˜å¯ä»¥æŠŠä½ çš„MCPæœåŠ¡å™¨æ”¾åˆ°çº¿ä¸Šè¿è¡Œï¼Œè®©ç”¨æˆ·ä»˜è´¹ä½¿ç”¨ã€‚

# è€ŒMCPçš„å®¢æˆ·ç«¯ï¼Œä¸ä»…æ”¯æŒClaudeæ¨¡å‹ï¼Œä¹Ÿæ”¯æŒä»»æ„æœ¬åœ°æ¨¡å‹æˆ–è€…åœ¨çº¿å¤§æ¨¡å‹ï¼Œæˆ–è€…æ˜¯ä¸€äº›IDEã€‚ä¾‹ å¦‚ï¼Œç°åœ¨Cursoræ­£å¼æ¥å…¥MCPï¼Œä»£è¡¨ç€Cursoræ­£å¼æˆä¸ºMCPå®¢æˆ·ç«¯ï¼Œåœ¨Cursorä¸­ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½å¿«é€Ÿç¼–å†™

# MCPæœåŠ¡å™¨ï¼ˆå¤–éƒ¨å‡½æ•°ï¼‰ï¼Œæ›´èƒ½å€ŸåŠ©Cursorä¸€é”®è¿æ¥ä¸Šæˆç™¾ä¸Šåƒçš„å¼€æºMCPæœåŠ¡å™¨ï¼Œè®©å¤§æ¨¡å‹å¿«é€Ÿæ¥å…¥

# æµ·é‡å·¥å…·ï¼Œä»è€Œå¤§å¹…åŠ å¿«Agentå¼€å‘è¿›åº¦ã€‚

![Image](pdf_images\page9_img1.png)

## 2. Function callingæŠ€æœ¯å›é¡¾

3. å¤§æ¨¡å‹Agentå¼€å‘æŠ€æœ¯ä½“ç³»å›é¡¾

# å‚è€ƒå…¬å¼€è¯¾ã€Šé›¶åŸºç¡€Agentæ™ºèƒ½ä½“å¼€å‘åŸºç¡€ç†è®ºè¯¦è§£ï¼ã€‹ï¼šhttps://www.bilibili.com/video/BV1Cc

# BJYtEne/

![Image](pdf_images\page12_img1.png)

![Image](pdf_images\page12_img2.png)

![Image](pdf_images\page12_img3.png)

# æ›´å¤šMCPç¤ºæ„å›¾

## äºŒã€MCPå®¢æˆ·ç«¯Clientå¼€å‘æµç¨‹

1. uvå·¥å…·å…¥é—¨ä½¿ç”¨æŒ‡å—

# 1.1 uvå…¥é—¨ä»‹ç»

# MCPå¼€å‘è¦æ±‚å€ŸåŠ©uvè¿›è¡Œè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–ç®¡ç†ã€‚ uv æ˜¯ä¸€ä¸ªPython ä¾èµ–ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼äº

pip å’Œ conda ï¼Œä½†å®ƒæ›´å¿«ã€æ›´é«˜æ•ˆï¼Œå¹¶ä¸”å¯ä»¥æ›´å¥½åœ°ç®¡ç† Python è™šæ‹Ÿç¯å¢ƒå’Œä¾èµ–é¡¹ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯ æ›¿ä»£ pip ã€ venv å’Œ pip-tools ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œæ›´ä½çš„ç®¡ç†å¼€é”€ã€‚

# uv çš„ç‰¹ç‚¹ï¼š

1. é€Ÿåº¦æ›´å¿«ï¼šç›¸æ¯” pip ï¼Œ uv é‡‡ç”¨ Rust ç¼–å†™ï¼Œæ€§èƒ½æ›´ä¼˜ã€‚

2. æ”¯æŒ PEP 582ï¼šæ— éœ€ virtualenv ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ __pypackages__ è¿›è¡Œç®¡ç†ã€‚

3. å…¼å®¹ pip ï¼šæ”¯æŒ requirements.txt å’Œ pyproject.toml ä¾èµ–ç®¡ç†ã€‚

4. æ›¿ä»£ venv ï¼šæä¾› uv venv è¿›è¡Œè™šæ‹Ÿç¯å¢ƒç®¡ç†ï¼Œæ¯” venv æ›´è½»é‡ã€‚

5. è·¨å¹³å°ï¼šæ”¯æŒ Windowsã€macOS å’Œ Linuxã€‚

# 1.2 uvå®‰è£…æµç¨‹

# æ–¹æ³• 1ï¼šä½¿ç”¨ pip å®‰è£…ï¼ˆé€‚ç”¨äºå·²å®‰è£… pip çš„ç³»ç»Ÿï¼‰

# pip install uv

# æ–¹æ³• 2ï¼šä½¿ç”¨ curl ç›´æ¥å®‰è£…

# å¦‚æœä½ çš„ç³»ç»Ÿæ²¡æœ‰ pip ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œï¼š

# curl -LsSf https://astral.sh/uv/install.sh | sh

# è¿™ä¼šè‡ªåŠ¨ä¸‹è½½ uv å¹¶å®‰è£…åˆ° /usr/local/bin ã€‚

# 1.3 uvçš„åŸºæœ¬ç”¨æ³•ä»‹ç»

# å®‰è£… uv åï¼Œä½ å¯ä»¥åƒ pip ä¸€æ ·ä½¿ç”¨å®ƒï¼Œä½†å®ƒçš„è¯­æ³•æ›´ç®€æ´ï¼Œé€Ÿåº¦ä¹Ÿæ›´å¿«ã€‚æ³¨æ„ï¼Œä»¥ä¸‹ä¸ºä½¿ç”¨è¯­æ³•

# ç¤ºä¾‹ï¼Œä¸ç”¨å®é™…è¿è¡Œã€‚

# å®‰è£… Python ä¾èµ–

# uv pip install requests

ä¸ pip install requests ç±»ä¼¼ï¼Œä½†æ›´å¿«ã€‚

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

# uv venv myenv

# ç­‰æ•ˆäº python -m venv myenv ï¼Œä½†æ›´é«˜æ•ˆã€‚

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

![Image](pdf_images\page15_img1.png)

## source myenv/bin/activate # Linux/macOS

## myenv\Scripts\activate # Windows

# å®‰è£… requirements.txt

# uv pip install -r requirements.txt

# ç›´æ¥è¿è¡Œ Python é¡¹ç›®

# å¦‚æœé¡¹ç›®ä¸­åŒ…å« pyproject.toml ï¼Œä½ å¯ä»¥ç›´æ¥è¿è¡Œï¼š

# uv run python script.py

# è¿™ç­‰æ•ˆäºï¼š

# pip install -r requirements.txt

# python script.py

# ä½† uv é€Ÿåº¦æ›´å¿«ï¼Œç®¡ç†æ›´é«˜æ•ˆã€‚

# ä¸ºä»€ä¹ˆMCPæ›´æ¨èä½¿ç”¨uvè¿›è¡Œç¯å¢ƒç®¡ç†ï¼Ÿ

# MCP ä¾èµ–çš„ Python ç¯å¢ƒå¯èƒ½åŒ…å«å¤šä¸ªæ¨¡å—ï¼Œ uv é€šè¿‡ pyproject.toml æä¾›æ›´é«˜æ•ˆçš„ç®¡ç†æ–¹

# å¼ï¼Œå¹¶ä¸”å¯ä»¥é¿å… pip çš„ä¸€äº›ä¾èµ–å†²çªé—®é¢˜ã€‚æ­¤å¤–ï¼Œ uv çš„åŒ…ç®¡ç†é€Ÿåº¦è¿œè¶… pip ï¼Œè¿™å¯¹äº MCP

# è¿™æ ·é¢‘ç¹ç®¡ç†ä¾èµ–çš„é¡¹ç›®æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•å…ˆæ„å»ºä¸€ä¸ª MCP å®¢æˆ·ç«¯ï¼Œç¡®ä¿åŸºæœ¬é€»è¾‘å¯ç”¨ï¼Œç„¶åå†é€æ­¥æ­å»º MCP æœåŠ¡å™¨è¿›è¡Œè”è°ƒï¼Œ è¿™æ ·å¯ä»¥åˆ†é˜¶æ®µæ’æŸ¥é—®é¢˜ï¼Œé¿å…ä¸€ä¸Šæ¥å°±æ¶‰åŠå¤ªå¤šå¤æ‚æ€§ã€‚

# 2.MCPæç®€å®¢æˆ·ç«¯æ­å»ºæµç¨‹

# 2.1 åˆ›å»º MCP å®¢æˆ·ç«¯é¡¹ç›®

# # åˆ›å»ºé¡¹ç›®ç›®å½•

# uv init mcp-client

# cd mcp-client

![Image](pdf_images\page16_img1.png)

![Image](pdf_images\page16_img2.png)

![Image](pdf_images\page16_img3.png)

# 2.2 åˆ›å»ºMCPå®¢æˆ·ç«¯è™šæ‹Ÿç¯å¢ƒ

# # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

# uv venv

# # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

# source .venv/bin/activate

# è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›¸æ¯”pipï¼Œuvä¼šè‡ªåŠ¨è¯†åˆ«å½“å‰é¡¹ç›®ä¸»ç›®å½•å¹¶åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚

# ç„¶åå³å¯é€šè¿‡addæ–¹æ³•åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…ç›¸å…³çš„åº“ã€‚

# # å®‰è£… MCP SDK

# uv add mcp

![Image](pdf_images\page17_img1.png)

## 2.3 ç¼–å†™åŸºç¡€ MCP å®¢æˆ·ç«¯

# ç„¶ååœ¨å½“å‰é¡¹ç›®ä¸»ç›®å½•ä¸­åˆ›å»º client.py

# å¹¶å†™å…¥ä»¥ä¸‹ä»£ç 

# import asyncio

# from mcp import ClientSession

# from contextlib import AsyncExitStack

# class MCPClient:

# def __init__(self):

"""åˆå§‹åŒ– MCP å®¢æˆ·ç«¯"""

# self.session = None

# self.exit_stack = AsyncExitStack()

# async def connect_to_mock_server(self):

# """æ¨¡æ‹Ÿ MCP æœåŠ¡å™¨çš„è¿æ¥ï¼ˆæš‚ä¸è¿æ¥çœŸå®æœåŠ¡å™¨ï¼‰""" print("âœ… MCP å®¢æˆ·ç«¯å·²åˆå§‹åŒ–ï¼Œä½†æœªè¿æ¥åˆ°æœåŠ¡å™¨")

# async def chat_loop(self): """è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯"""

# print("\nMCP å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€å‡º")

# while True:

# try:

# query = input("\nQuery: ").strip()

if query.lower() == 'quit':

break print(f"\nğŸ¤– [Mock Response] ä½ è¯´çš„æ˜¯ï¼š{query}")

# except Exception as e: print(f"\nâš  å‘ç”Ÿé”™è¯¯: {str(e)}")

# async def cleanup(self):

"""æ¸…ç†èµ„æº"""

# await self.exit_stack.aclose()

async def main():

client = MCPClient()

![Image](pdf_images\page18_img1.png)

## try:

## await client.connect_to_mock_server()

# await client.chat_loop()

# finally:

# await client.cleanup()

if __name__ == "__main__":

# asyncio.run(main())

# è¿™æ®µä»£ç èƒ½å¤Ÿåˆå§‹åŒ– MCP å®¢æˆ·ç«¯ï¼ˆä½†ä¸è¿æ¥æœåŠ¡å™¨ï¼‰ï¼Œå¹¶æä¾›ä¸€ä¸ª äº¤äº’å¼ CLIï¼Œå¯ä»¥è¾“å…¥æŸ¥è¯¢ï¼ˆä½†åªè¿” å›æ¨¡æ‹Ÿå›å¤ï¼‰ï¼Œé€šè¿‡è¾“å…¥ quit é€€å‡ºç¨‹åºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯æ²¡æœ‰å…³è”ä»»ä½•å¤§æ¨¡å‹ï¼Œå› æ­¤åªä¼š é‡å¤ç”¨æˆ·çš„è¾“å…¥ã€‚

# 2.4 MCPå®¢æˆ·ç«¯åŸºæœ¬ä»£ç ç»“æ„

# ä»¥ä¸‹æ˜¯ client.py ä»£ç è¯¦è§£ï¼Œä»£ç æ ¸å¿ƒåŠŸèƒ½ï¼š

# åˆå§‹åŒ– MCP å®¢æˆ·ç«¯

æä¾›ä¸€ä¸ªå‘½ä»¤è¡Œäº¤äº’ç•Œé¢

# æ¨¡æ‹Ÿ MCP æœåŠ¡å™¨è¿æ¥

# æ”¯æŒç”¨æˆ·è¾“å…¥æŸ¥è¯¢å¹¶è¿”å›ã€Œæ¨¡æ‹Ÿå›å¤ã€

# æ”¯æŒå®‰å…¨é€€å‡º

ä»£ç å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼šé¦–å…ˆæ˜¯å¯¼å…¥å¿…è¦çš„åº“

## import asyncio # è®©ä»£ç æ”¯æŒå¼‚æ­¥æ“ä½œ

from mcp import ClientSession # MCP å®¢æˆ·ç«¯ä¼šè¯ç®¡ç† from contextlib import AsyncExitStack # èµ„æºç®¡ç†ï¼ˆç¡®ä¿å®¢æˆ·ç«¯å…³é—­æ—¶é‡Šæ”¾èµ„æºï¼‰

# ğŸ“Œ è§£é‡Šï¼š

# asyncio ï¼šPython å†…ç½®çš„å¼‚æ­¥ç¼–ç¨‹åº“ï¼Œè®© MCP å¯ä»¥éé˜»å¡åœ°æ‰§è¡Œä»»åŠ¡ï¼ˆæ¯”å¦‚èŠå¤©ã€æŸ¥è¯¢ï¼‰ã€‚

# mcp.ClientSession ï¼šç”¨äºç®¡ç† MCP å®¢æˆ·ç«¯ä¼šè¯ï¼ˆä½†ç›®å‰æˆ‘ä»¬å…ˆä¸è¿æ¥ MCP æœåŠ¡å™¨ï¼‰ã€‚

# AsyncExitStack ï¼šè‡ªåŠ¨ç®¡ç†èµ„æºï¼Œç¡®ä¿ç¨‹åºé€€å‡ºæ—¶æ­£ç¡®å…³é—­ MCP è¿æ¥ã€‚

# ç„¶ååˆ›å»º MCPClient ç±»

# class MCPClient:

# def __init__(self):

"""åˆå§‹åŒ– MCP å®¢æˆ·ç«¯"""

# self.session = None # å…ˆä¸è¿æ¥ MCP æœåŠ¡å™¨ self.exit_stack = AsyncExitStack() # åˆ›å»ºèµ„æºç®¡ç†å™¨

# ğŸ“Œ è§£é‡Šï¼š

# self.session = None ï¼šæš‚æ—¶ä¸è¿æ¥ MCP æœåŠ¡å™¨ï¼Œåç»­å¯ä»¥ä¿®æ”¹æ¥çœŸæ­£è¿æ¥ã€‚

self.exit_stack = AsyncExitStack() ï¼šç®¡ç† MCP å®¢æˆ·ç«¯çš„èµ„æºï¼Œç¡®ä¿ç¨‹åºé€€å‡ºæ—¶å¯ä»¥æ­£ç¡®

# é‡Šæ”¾èµ„æºã€‚

# ç´§æ¥ç€æ¨¡æ‹Ÿ MCP æœåŠ¡å™¨è¿æ¥

# async def connect_to_mock_server(self):

# """æ¨¡æ‹Ÿ MCP æœåŠ¡å™¨çš„è¿æ¥ï¼ˆæš‚ä¸è¿æ¥çœŸå®æœåŠ¡å™¨ï¼‰""" print("âœ… MCP å®¢æˆ·ç«¯å·²åˆå§‹åŒ–ï¼Œä½†æœªè¿æ¥åˆ°æœåŠ¡å™¨")

# ğŸ“Œ è§£é‡Šï¼š

è¿™ä¸ªå‡½æ•°ä¸ä¼šçœŸçš„è¿æ¥ MCP æœåŠ¡å™¨ï¼Œåªæ˜¯æ‰“å°ä¸€æ¡ä¿¡æ¯ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯å·²ç»åˆå§‹åŒ–ã€‚

# async def ï¼šå› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯ å¼‚æ­¥ç¼–ç¨‹ï¼Œæ‰€ä»¥éœ€è¦ç”¨ async å…³é”®å­—ã€‚

# ç„¶ååˆ›å»ºäº¤äº’å¼èŠå¤©å¾ªç¯

# async def chat_loop(self):

# """è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯""" print("\nMCP å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€å‡º")

# while True: # æ— é™å¾ªç¯ï¼Œç›´åˆ°ç”¨æˆ·è¾“å…¥ 'quit'

# try:

# query = input("\nQuery: ").strip() # è®©ç”¨æˆ·è¾“å…¥é—®é¢˜

if query.lower() == 'quit': # å¦‚æœç”¨æˆ·è¾“å…¥ quitï¼Œé€€å‡ºå¾ªç¯

break print(f"\nğŸ¤– [Mock Response] ä½ è¯´çš„æ˜¯ï¼š{query}") # è¿”å›æ¨¡æ‹Ÿå›å¤ except Exception as e: # å‘ç”Ÿé”™è¯¯æ—¶æ•è·å¼‚å¸¸ print(f"\nâš  å‘ç”Ÿé”™è¯¯: {str(e)}")

# ğŸ“Œ è§£é‡Šï¼š

1. while True ï¼šæ— é™å¾ªç¯ï¼Œè®©ç”¨æˆ·å¯ä»¥ä¸æ–­è¾“å…¥æŸ¥è¯¢ã€‚

## 2. query = input("\nQuery: ").strip() ï¼šè·å–ç”¨æˆ·è¾“å…¥çš„æŸ¥è¯¢ã€‚

## 3. if query.lower() == 'quit' ï¼šå¦‚æœç”¨æˆ·è¾“å…¥ quit ï¼Œé€€å‡ºå¾ªç¯ã€‚

4. print(f"\nğŸ¤– [Mock Response] ä½ è¯´çš„æ˜¯ï¼š{query}") ï¼šæ¨¡æ‹Ÿ MCP æœåŠ¡å™¨çš„å“åº”ï¼Œæš‚æ—¶åªæ˜¯å›

# æ˜¾ç”¨æˆ·è¾“å…¥çš„å†…å®¹ã€‚

# ğŸ”¹ ç¤ºä¾‹è¿è¡Œ

# MCP å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€å‡º

# Query: ä½ å¥½ ğŸ¤– [Mock Response] ä½ è¯´çš„æ˜¯ï¼šä½ å¥½

# Query: è¿™æ˜¯ä»€ä¹ˆï¼Ÿ ğŸ¤– [Mock Response] ä½ è¯´çš„æ˜¯ï¼šè¿™æ˜¯ä»€ä¹ˆï¼Ÿ

# Query: quit # é€€å‡ºç¨‹åº

# æœ€åç™½é‚£äº›é‡Šæ”¾èµ„æºä»£ç 

# async def cleanup(self):

"""æ¸…ç†èµ„æº"""

# await self.exit_stack.aclose() # å…³é—­èµ„æºç®¡ç†å™¨

# ğŸ“Œ è§£é‡Šï¼š

aclose() ç¡®ä¿ç¨‹åºé€€å‡ºæ—¶æ­£ç¡®å…³é—­ MCP è¿æ¥ï¼ˆå°½ç®¡ç›®å‰æ²¡æœ‰çœŸæ­£çš„è¿æ¥ï¼‰ã€‚

# å¹¶å®šä¹‰ main() ä¸»å‡½æ•°

# async def main(): client = MCPClient() # åˆ›å»º MCP å®¢æˆ·ç«¯

# try:

# await client.connect_to_mock_server() # è¿æ¥ï¼ˆæ¨¡æ‹Ÿï¼‰æœåŠ¡å™¨ await client.chat_loop() # è¿›å…¥èŠå¤©å¾ªç¯

# finally:

# await client.cleanup() # ç¡®ä¿é€€å‡ºæ—¶æ¸…ç†èµ„æº

# ğŸ“Œ è§£é‡Šï¼š

client = MCPClient() ï¼šåˆ›å»ºä¸€ä¸ª MCP å®¢æˆ·ç«¯å®ä¾‹ã€‚

await client.connect_to_mock_server() ï¼šåˆå§‹åŒ– MCP å®¢æˆ·ç«¯ï¼ˆæš‚ä¸è¿æ¥æœåŠ¡å™¨ï¼‰ã€‚

# await client.chat_loop() ï¼šå¯åŠ¨äº¤äº’å¼èŠå¤©ã€‚

# finally: ç¡®ä¿ ä¸ç®¡ç¨‹åºæ˜¯å¦å¼‚å¸¸é€€å‡ºï¼Œéƒ½ä¼šæ­£ç¡®é‡Šæ”¾èµ„æºã€‚

# ä»¥åŠè¿è¡Œä»£ç 

if __name__ == "__main__":

# asyncio.run(main())

# ğŸ“Œ è§£é‡Šï¼š

![Image](pdf_images\page21_img1.png)

## if __name__ == "__main__": ï¼šç¡®ä¿ä»£ç åªèƒ½åœ¨ Python ç›´æ¥è¿è¡Œæ—¶æ‰§è¡Œï¼ˆè€Œä¸æ˜¯ä½œä¸ºåº“å¯¼å…¥

## æ—¶ï¼‰ã€‚

asyncio.run(main()) ï¼šå¯åŠ¨ main() ï¼Œè¿è¡Œ MCP å®¢æˆ·ç«¯ã€‚

MCPä¸­ä¸€ä¸ªåŸºç¡€çš„å®¢æˆ·ç«¯ä»£ç ç»“æ„æ€»ç»“å¦‚ä¸‹ï¼š

# ä»£ç éƒ¨åˆ†

# ä½œç”¨

# MCPClient.__init__()

# åˆå§‹åŒ– MCP å®¢æˆ·ç«¯

# connect_to_mock_server()

# æ¨¡æ‹Ÿ MCP æœåŠ¡å™¨è¿æ¥

# chat_loop()

# æä¾›äº¤äº’å¼èŠå¤©ç•Œé¢

# cleanup()

# é‡Šæ”¾èµ„æº

# main()

# å¯åŠ¨å®¢æˆ·ç«¯

# asyncio.run(main())

# è¿è¡Œç¨‹åº

# 2.5 è¿è¡Œ MCP å®¢æˆ·ç«¯

ç„¶åå°è¯•è¿è¡Œè¿™ä¸ªæç®€çš„MCPå®¢æˆ·ç«¯ï¼š

# uv run client.py

# è¿è¡Œæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š

![Image](pdf_images\page22_img1.png)

# 2.6 Jupyterä¸­ä»£ç è¿è¡Œæ•ˆæœ

# æ­¤å¤–ï¼ŒMCPå®¢æˆ·ç«¯ä¹Ÿæ˜¯å¯ä»¥åœ¨Jupyterä¸­è¿è¡Œçš„ï¼Œæ­¤æ—¶è¿è¡Œä»£ç å¦‚ä¸‹ï¼š

# !pip install mcp

# import asyncio

# import nest_asyncio

# from mcp import ClientSession

# from contextlib import AsyncExitStack

# # è§£å†³ Jupyter Notebook çš„ asyncio äº‹ä»¶å¾ªç¯å†²çª

# nest_asyncio.apply()

# class MCPClient:

# def __init__(self): """åˆå§‹åŒ– MCP å®¢æˆ·ç«¯"""

# self.session = None

# self.exit_stack = AsyncExitStack()

# async def connect_to_mock_server(self):

# """æ¨¡æ‹Ÿ MCP æœåŠ¡å™¨çš„è¿æ¥ï¼ˆæš‚ä¸è¿æ¥çœŸå®æœåŠ¡å™¨ï¼‰""" print("âœ… MCP å®¢æˆ·ç«¯å·²åˆå§‹åŒ–ï¼Œä½†æœªè¿æ¥åˆ°æœåŠ¡å™¨")

# async def chat_loop(self):

# """è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯""" print("\nğŸ“¢ MCP å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€å‡º\n")

# while True:

try: # ç›´æ¥ä½¿ç”¨ input() è·å–ç”¨æˆ·è¾“å…¥ query = input("ğŸ“ è¯·è¾“å…¥æ‚¨çš„é—®é¢˜: ").strip()

## if query.lower() == 'quit': print("\nğŸ‘‹ é€€å‡ºèŠå¤©...") break

# # æ¨¡æ‹ŸæœåŠ¡å™¨è¿”å›å“åº” response = f"ğŸ¤– [Mock Response] ä½ è¯´çš„æ˜¯ï¼š{query}" print(response)

# except Exception as e: print(f"\nâš  å‘ç”Ÿé”™è¯¯: {str(e)}")

# async def cleanup(self):

"""æ¸…ç†èµ„æº"""

# await self.exit_stack.aclose()

# async def main():

# client = MCPClient()

# try:

# await client.connect_to_mock_server()

# await client.chat_loop()

# finally:

# await client.cleanup()

# ç„¶åå³å¯è¾“å…¥å¦‚ä¸‹ä»£ç å¼€å¯å¯¹è¯ï¼š

# # åœ¨ Jupyter Notebook ä¸­è¿è¡Œ

# await main()

![Image](pdf_images\page25_img1.png)

![Image](pdf_images\page25_img2.png)

![Image](pdf_images\page25_img3.png)

3. MCPå®¢æˆ·ç«¯æ¥å…¥OpenAIã€DeepSeekåœ¨çº¿æ¨¡å‹æµç¨‹

# æ¥ä¸‹æ¥å°è¯•åœ¨å®¢æˆ·ç«¯ä¸­æ¥å…¥OpenAIå’ŒDeepSeekç­‰åœ¨çº¿æ¨¡å‹è¿›è¡Œå¯¹è¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºOpenAI

# å’ŒDeepSeekè°ƒç”¨æ–¹æ³•å‡ ä¹å®Œå…¨ä¸€æ ·ï¼Œå› æ­¤è¿™å¥—æœåŠ¡å™¨clientä»£ç å¯ä»¥åŒæ—¶é€‚ç”¨äºGPTæ¨¡å‹å’ŒDeepSeekå“¦ è¡Œã€‚

# 3.1 æ–°å¢ä¾èµ–

# ä¸ºäº†æ”¯æŒè°ƒç”¨OpenAIæ¨¡å‹ï¼Œä»¥åŠåœ¨ç¯å¢ƒå˜é‡ä¸­è¯»å–API-KEYç­‰ä¿¡æ¯ï¼Œéœ€è¦å…ˆå®‰è£…å¦‚ä¸‹ä¾èµ–ï¼š

uv add mcp openai python-dotenv

# 3.2 åˆ›å»º.envæ–‡ä»¶

# æ¥ä¸‹æ¥åˆ›å»º.envæ–‡ä»¶ï¼Œå¹¶å†™å…¥OpenAIçš„API-Keyï¼Œä»¥åŠåå‘ä»£ç†åœ°å€ã€‚å€ŸåŠ©åå‘ä»£ç†ï¼Œå›½å†…å¯ä»¥æ— 

# é—¨æ§›ç›´è¿OpenAIå®˜æ–¹æœåŠ¡å™¨ï¼Œå¹¶è°ƒç”¨å®˜æ–¹APIã€‚

# å†™å…¥å¦‚ä¸‹å†…å®¹

![Image](pdf_images\page26_img1.png)

![Image](pdf_images\page26_img2.png)

![Image](pdf_images\page26_img3.png)

## BASE_URL="åå‘ä»£ç†åœ°å€"

## MODEL=gpt-4o

# OPENAI_API_KEY="OpenAI-API-Key"

# OpenAIæ³¨å†ŒæŒ‡å—ä¸å›½å†…åå‘ä»£ç†é¢†å–åœ°å€ï¼š

# è€Œå¦‚æœæ˜¯ä½¿ç”¨DeepSeekæ¨¡å‹ï¼Œåˆ™éœ€è¦åœ¨.envä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š

# BASE_URL=https://api.deepseek.com

MODEL=deepseek-chat

OPENAI_API_KEY="DeepSeek API-Key"

## å¦‚æœè¦è°ƒç”¨deepseek-chatä¸ºDeepSeek V3æ¨¡å‹ï¼Œè‹¥è¦è°ƒç”¨DeepSeek R1ï¼Œåˆ™éœ€è¦å°†å…¶ä¿®æ”¹ä¸º

## deepseek-reasonerï¼›

# DeepSeekå¿«é€Ÿå…¥é—¨ï¼šhttps://www.bilibili.com/video/BV1JuwVewELc/

# 3.3 ä¿®æ”¹client.pyä»£ç 

# æ¥ä¸‹æ¥ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç ï¼š

# import asyncio

# import os

# from openai import OpenAI

# from dotenv import load_dotenv

# from contextlib import AsyncExitStack

# # åŠ è½½ .env æ–‡ä»¶ï¼Œç¡®ä¿ API Key å—åˆ°ä¿æŠ¤

# load_dotenv()

# class MCPClient:

# def __init__(self):

"""åˆå§‹åŒ– MCP å®¢æˆ·ç«¯"""

# self.exit_stack = AsyncExitStack() self.openai_api_key = os.getenv("OPENAI_API_KEY") # è¯»å– OpenAI API Key

# self.base_url = os.getenv("BASE_URL") # è¯»å– BASE YRL

# self.model = os.getenv("MODEL") # è¯»å– model

# if not self.openai_api_key: raise ValueError("âŒ æœªæ‰¾åˆ° OpenAI API Keyï¼Œè¯·åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½®

OPENAI_API_KEY")

# self.client = OpenAI(api_key=self.openai_api_key, base_url=self.base_url)

# async def process_query(self, query: str) -> str:

# """è°ƒç”¨ OpenAI API å¤„ç†ç”¨æˆ·æŸ¥è¯¢"""

messages = [{"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·å›ç­”é—® é¢˜ã€‚"},

# {"role": "user", "content": query}]

# try: # è°ƒç”¨ OpenAI API

# response = await asyncio.get_event_loop().run_in_executor(

None,

# lambda: self.client.chat.completions.create(

model=self.model,

# messages=messages

)

)

return response.choices[0].message.content

# except Exception as e: return f"âš  è°ƒç”¨ OpenAI API æ—¶å‡ºé”™: {str(e)}"

# async def chat_loop(self):

"""è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯""" print("\nğŸ¤– MCP å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€å‡º")

![Image](pdf_images\page28_img1.png)

## while True:

# try:

# query = input("\nä½ : ").strip()

if query.lower() == 'quit':

# break

# response = await self.process_query(query) # å‘é€ç”¨æˆ·è¾“å…¥åˆ° OpenAI

# API print(f"\nğŸ¤– OpenAI: {response}")

# except Exception as e: print(f"\nâš  å‘ç”Ÿé”™è¯¯: {str(e)}")

# async def cleanup(self):

"""æ¸…ç†èµ„æº"""

# await self.exit_stack.aclose()

# async def main():

# client = MCPClient()

# try:

# await client.chat_loop()

# finally:

# await client.cleanup()

if __name__ == "__main__":

# asyncio.run(main())

# 3.4 è¿è¡Œclient.py

# ç„¶åå³å¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤å¼€å§‹è¿è¡Œå¯¹è¯å®¢æˆ·ç«¯ï¼š

# uv run client.py

# è¿è¡Œæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š

# 3.5 clint.pyä»£ç è§£é‡Š

# åŠ è½½ OpenAI API Key

## from dotenv import load_dotenv

## import os

# # åŠ è½½ .env æ–‡ä»¶ï¼Œç¡®ä¿ API Key å—åˆ°ä¿æŠ¤

# load_dotenv()

# self.openai_api_key = os.getenv("OPENAI_API_KEY") # è¯»å– API Key

# if not self.openai_api_key: raise ValueError("âŒ æœªæ‰¾åˆ° OpenAI API Keyï¼Œè¯·åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½® OPENAI_API_KEY")

# ğŸ“Œ è§£é‡Š

# load_dotenv() ï¼šè‡ªåŠ¨åŠ è½½ .env æ–‡ä»¶ï¼Œé¿å…åœ¨ä»£ç ä¸­ç›´æ¥æš´éœ² API Keyã€‚

# os.getenv("OPENAI_API_KEY") ï¼šä»ç¯å¢ƒå˜é‡ä¸­è¯»å– OPENAI_API_KEY ã€‚

# raise ValueError(...) ï¼šå¦‚æœ API Key ä¸ºç©ºï¼Œåˆ™æŠ›å‡ºé”™è¯¯ï¼Œæé†’ç”¨æˆ·å¿…é¡»é…ç½® API Keyã€‚

# ğŸ“Œ åˆ›å»º .env æ–‡ä»¶ï¼ˆå¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼‰

# touch .env

# ğŸ“Œ åœ¨ .env æ–‡ä»¶ä¸­æ·»åŠ  API Key

# OPENAI_API_KEY=ä½ çš„OpenAI API Key

# å‘é€ç”¨æˆ·è¾“å…¥åˆ° OpenAI API

# async def process_query(self, query: str) -> str: """è°ƒç”¨ OpenAI API å¤„ç†ç”¨æˆ·æŸ¥è¯¢"""

messages = [

{"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·å›ç­”é—®é¢˜ã€‚"},

# {"role": "user", "content": query}

]

# try: # è°ƒç”¨ OpenAI GPT-4 API

# response = await asyncio.get_event_loop().run_in_executor(

None,

# lambda: openai.ChatCompletion.create(

model="gpt-4",

messages=messages,

max_tokens=1000,

# temperature=0.7

)

)

return response["choices"][0]["message"]["content"].strip()

# except Exception as e: return f"âš  è°ƒç”¨ OpenAI API æ—¶å‡ºé”™: {str(e)}"

# ğŸ“Œ è§£é‡Š

messages ï¼šåˆ›å»ºå¯¹è¯ä¸Šä¸‹æ–‡ï¼Œè®© OpenAI çŸ¥é“å¦‚ä½•å›ç­”é—®é¢˜ï¼š

## system è§’è‰²ï¼šè®¾å®š AI è§’è‰²ï¼ˆå¦‚â€œä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹â€ï¼‰ã€‚

## user è§’è‰²ï¼šå­˜å‚¨ç”¨æˆ·è¾“å…¥ã€‚

# openai.ChatCompletion.create(...)

# model="gpt-4" ï¼šä½¿ç”¨ OpenAI çš„ GPT-4 è¿›è¡Œå¯¹è¯ã€‚

# messages=messages ï¼šæä¾›èŠå¤©è®°å½•ï¼Œè®© AI ç”Ÿæˆå›ç­”ã€‚

# max_tokens=1000 ï¼šé™åˆ¶ AI ç”Ÿæˆçš„æœ€å¤§å­—æ•°ã€‚

# temperature=0.7 ï¼šæ§åˆ¶ AI å›ç­”çš„éšæœºæ€§ï¼ˆè¶Šé«˜è¶Šéšæœºï¼‰ã€‚

# run_in_executor(...) ï¼š

# å› ä¸º OpenAI API æ˜¯åŒæ­¥çš„ï¼Œä½†æˆ‘ä»¬ç”¨çš„æ˜¯å¼‚æ­¥ä»£ç 

è¿™é‡Œç”¨ asyncio.get_event_loop().run_in_executor(...) å°† OpenAI API å˜æˆå¼‚æ­¥ ä»»åŠ¡ï¼Œé˜²æ­¢ç¨‹åºå¡é¡¿ã€‚

# äº¤äº’å¼èŠå¤©

# async def chat_loop(self):

# """è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯""" print("\nğŸ¤– MCP å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€å‡º")

# while True:

# try:

# query = input("\nä½ : ").strip()

if query.lower() == 'quit':

# break

# response = await self.process_query(query) # å‘é€ç”¨æˆ·è¾“å…¥åˆ° OpenAI API print(f"\nğŸ¤– OpenAI: {response}")

# except Exception as e: print(f"\nâš  å‘ç”Ÿé”™è¯¯: {str(e)}")

# ğŸ“Œ è§£é‡Š

# è¾“å…¥æŸ¥è¯¢ query = input("\nä½ : ").strip() ï¼Œæ”¯æŒå¤šè½®å¯¹è¯ã€‚

è°ƒç”¨ process_query() ï¼Œå°†ç”¨æˆ·è¾“å…¥å‘é€åˆ° OpenAI API å¹¶è·å–å›å¤ã€‚

# æ˜¾ç¤º OpenAI ç”Ÿæˆçš„å›å¤ï¼š print(f"\nğŸ¤– OpenAI: {response}")

# ç”¨æˆ·è¾“å…¥ quit é€€å‡ºã€‚

# éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºMCPçš„client SDKä¸»è¦è§„å®šäº†clientå’Œserverä¹‹é—´çš„é€šä¿¡æ–¹æ³•ï¼Œå› æ­¤åœ¨æ²¡æœ‰åˆ›å»º

# serverä¹‹å‰ï¼Œä¸€ä¸ªå•çº¯å¯¹è¯çš„clientç”šè‡³ä¸éœ€è¦ç”¨åˆ°mcpåŠŸèƒ½ã€‚ä½†æœ¬æ®µä»£ç çš„å­¦ä¹ ä»æ˜¯æœ‰å¿…è¦çš„ï¼Œ

# ä¸ºäº†ç†Ÿæ‚‰å„ç±»å¤§æ¨¡å‹æœ¬åœ°è°ƒç”¨å¯¹è¯æµç¨‹ã€‚è€Œåæˆ‘ä»¬åªéœ€è¦å›´ç»•ä¸Šè¿°ä»£ç ç¨ä½œä¿®æ”¹ï¼Œå³å¯è°ƒç”¨å¤–éƒ¨çš„

# serverã€‚

4. MCPå®¢æˆ·ç«¯æ¥å…¥æœ¬åœ°ollamaã€vLLMæ¨¡å‹æµç¨‹

# æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­å°è¯•å°†ollamaã€vLLMç­‰æ¨¡å‹è°ƒåº¦æ¡†æ¶æ¥å…¥MCPçš„clientã€‚ç”±äºollamaå’ŒvLLMå‡

# æ”¯æŒOpenAI APIé£æ ¼è°ƒç”¨æ–¹æ³•ï¼Œå› æ­¤ä¸Šè¿°client.pyå¹¶ä¸éœ€è¦è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œæˆ‘ä»¬åªéœ€è¦å¯åŠ¨å“åº”çš„è°ƒåº¦

# æ¡†æ¶æœåŠ¡ï¼Œç„¶åä¿®æ”¹.envæ–‡ä»¶å³å¯ã€‚

vLLM&ollamaè°ƒç”¨æœ¬åœ°æ¨¡å‹æ•™ç¨‹ï¼šhttps://www.bilibili.com/video/BV1hZRTYUEtR/

![Image](pdf_images\page31_img1.png)

![Image](pdf_images\page31_img2.png)

# 4.1 MCPå®¢æˆ·ç«¯æ¥å…¥æœ¬åœ°ollama

# è¿™é‡Œä»¥QwQ-32Bä¸ºä¾‹ï¼Œå°è¯•å€ŸåŠ©ollamaæ¥å…¥MCPå®¢æˆ·ç«¯ã€‚

# å¯åŠ¨ollama

# é¦–å…ˆéœ€è¦å¯åŠ¨ollama

# ollama start

# æµ‹è¯•æ¨¡å‹èƒ½å¦è°ƒç”¨

# ollama list

ollama run qwq

![Image](pdf_images\page32_img1.png)

![Image](pdf_images\page32_img2.png)

![Image](pdf_images\page32_img3.png)

# ä¿®æ”¹é…ç½®æ–‡ä»¶

# ç„¶åä¿®æ”¹ .env é…ç½®æ–‡ä»¶

# BASE_URL=http://localhost:11434/v1/

# MODEL=qwq

# OPENAI_API_KEY=ollama

# è¿è¡Œclient

# ç„¶åå³å¯è¿è¡ŒMCP clientå®¢æˆ·ç«¯äº†

# uv run client.py

# æ­¤æ—¶æ˜¯æ¨ç†æ¨¡å‹ï¼Œå› æ­¤å‡ºç°æ ‡å¿—ï¼š

# 4.2 MCPå®¢æˆ·ç«¯æ¥å…¥vLLM

# ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠvLLMæ¥å…¥MCPå®¢æˆ·ç«¯ä¸­ã€‚

# å¯åŠ¨vLLMæœåŠ¡

![Image](pdf_images\page33_img1.png)

![Image](pdf_images\page33_img2.png)

## cd /root/autodl-tmp

## CUDA_VISIBLE_DEVICES=0,1 vllm serve ./QwQ-32B --tensor-parallel-size 2

# ä¿®æ”¹é…ç½®æ–‡ä»¶

# BASE_URL=http://localhost:8000/v1

# MODEL=./QwQ-32B

# OPENAI_API_KEY=EMPTY

# è¿è¡Œclient

# ç„¶åå³å¯è¿è¡ŒMCP clientå®¢æˆ·ç«¯äº†

# uv run client.py

# æ­¤æ—¶æ˜¯æ¨ç†æ¨¡å‹ï¼Œå› æ­¤å‡ºç°æ ‡å¿—ï¼š

# æ­¤æ—¶vLLMåç«¯å“åº”å¦‚ä¸‹ï¼š

![Image](pdf_images\page34_img1.png)

# ä¸‰ã€MCPå¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨serverä¸ä½¿ç”¨

1. MCPæœåŠ¡å™¨æ¦‚å¿µä»‹ç»

# æ ¹æ®MCPåè®®å®šä¹‰ï¼ŒServerå¯ä»¥æä¾›ä¸‰ç§ç±»å‹çš„æ ‡å‡†èƒ½åŠ›ï¼ŒResourcesã€Toolsã€Promptsï¼Œæ¯ä¸ª

# Serverå¯åŒæ—¶æä¾›è€…ä¸‰ç§ç±»å‹èƒ½åŠ›æˆ–å…¶ä¸­ä¸€ç§ã€‚

# Resourcesï¼šèµ„æºï¼Œç±»ä¼¼äºæ–‡ä»¶æ•°æ®è¯»å–ï¼Œå¯ä»¥æ˜¯æ–‡ä»¶èµ„æºæˆ–æ˜¯APIå“åº”è¿”å›çš„å†…å®¹ã€‚

# Toolsï¼šå·¥å…·ï¼Œç¬¬ä¸‰æ–¹æœåŠ¡ã€åŠŸèƒ½å‡½æ•°ï¼Œé€šè¿‡æ­¤å¯æ§åˆ¶LLMå¯è°ƒç”¨å“ªäº›å‡½æ•°ã€‚

# Promptsï¼šæç¤ºè¯ï¼Œä¸ºç”¨æˆ·é¢„å…ˆå®šä¹‰å¥½çš„å®Œæˆç‰¹å®šä»»åŠ¡çš„æ¨¡æ¿ã€‚

2. MCPæœåŠ¡å™¨é€šè®¯æœºåˆ¶

# Model Context Protocolï¼ˆMCPï¼‰æ˜¯ä¸€ç§ç”± Anthropic å¼€æºçš„åè®®ï¼Œæ—¨åœ¨å°†å¤§å‹è¯­è¨€æ¨¡å‹ç›´æ¥è¿æ¥

# è‡³æ•°æ®æºï¼Œå®ç°æ— ç¼é›†æˆã€‚æ ¹æ® MCP çš„è§„èŒƒï¼Œå½“å‰æ”¯æŒä¸¤ç§ä¼ è¾“æ–¹å¼ï¼šæ ‡å‡†è¾“å…¥è¾“å‡ºï¼ˆstdioï¼‰å’ŒåŸºäº HTTP çš„æœåŠ¡å™¨æ¨é€äº‹ä»¶ï¼ˆSSEï¼‰ã€‚è€Œè¿‘æœŸï¼Œå¼€å‘è€…åœ¨ MCP çš„ GitHub ä»“åº“ä¸­æäº¤äº†ä¸€é¡¹ææ¡ˆï¼Œå»ºè®®é‡‡ç”¨

# â€œå¯æµå¼ä¼ è¾“çš„ HTTPâ€æ¥æ›¿ä»£ç°æœ‰çš„ HTTP+SSE æ–¹æ¡ˆã€‚æ­¤ä¸¾æ—¨åœ¨è§£å†³å½“å‰è¿œç¨‹ MCP ä¼ è¾“æ–¹å¼çš„å…³é”®é™

åˆ¶ï¼ŒåŒæ—¶ä¿ç•™å…¶ä¼˜åŠ¿ã€‚ HTTP å’Œ SSEï¼ˆæœåŠ¡å™¨æ¨é€äº‹ä»¶ï¼‰åœ¨æ•°æ®ä¼ è¾“æ–¹å¼ä¸Šå­˜åœ¨æ˜æ˜¾åŒºåˆ«ï¼š

# é€šä¿¡æ–¹å¼ï¼š

HTTPï¼šé‡‡ç”¨è¯·æ±‚-å“åº”æ¨¡å¼ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›å“åº”ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚

SSEï¼šå…è®¸æœåŠ¡å™¨é€šè¿‡å•ä¸ªæŒä¹…çš„ HTTP è¿æ¥ï¼ŒæŒç»­å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œå®ç°å®æ—¶æ›´æ–°ã€‚

# è¿æ¥ç‰¹æ€§ï¼š

# HTTPï¼šæ¯æ¬¡è¯·æ±‚é€šå¸¸å»ºç«‹æ–°çš„è¿æ¥ï¼Œè™½ç„¶åœ¨ HTTP/1.1 ä¸­å¼•å…¥äº†æŒä¹…è¿æ¥ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹ä»

# æ˜¯çŸ­è¿æ¥ã€‚

SSEï¼šåŸºäºé•¿è¿æ¥ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ä¿æŒæŒç»­çš„è¿æ¥ï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨ä»»æ„æ—¶é—´æ¨é€æ•°æ®ã€‚

# é€‚ç”¨åœºæ™¯ï¼š

HTTPï¼šé€‚ç”¨äºä¼ ç»Ÿçš„è¯·æ±‚-å“åº”åœºæ™¯ï¼Œå¦‚ç½‘é¡µåŠ è½½ã€è¡¨å•æäº¤ç­‰ã€‚

SSEï¼šé€‚ç”¨äºéœ€è¦æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®çš„åœºæ™¯ï¼Œå¦‚å®æ—¶é€šçŸ¥ã€è‚¡ç¥¨è¡Œæƒ…æ›´æ–°ç­‰ã€‚

# éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSSE ä»…æ”¯æŒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯çš„å•å‘é€šä¿¡ï¼Œè€Œ WebSocket åˆ™æ”¯æŒåŒå‘é€šä¿¡ã€‚

![Image](pdf_images\page35_img1.png)

![Image](pdf_images\page35_img2.png)

# åœ¨ Model Context Protocolï¼ˆMCPï¼‰ä¸­ï¼Œæ ‡å‡†è¾“å…¥è¾“å‡ºï¼ˆstdioï¼‰æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºæœ¬åœ°é€šä¿¡çš„ä¼ è¾“

# æ–¹å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒMCP å®¢æˆ·ç«¯ä¼šå°†æœåŠ¡å™¨ç¨‹åºä½œä¸ºå­è¿›ç¨‹å¯åŠ¨ï¼ŒåŒæ–¹é€šè¿‡æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰ å’Œæ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰è¿›è¡Œæ•°æ®äº¤æ¢ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œçš„åœº

# æ™¯ï¼Œç¡®ä¿äº†é«˜æ•ˆã€ä½å»¶è¿Ÿçš„é€šä¿¡ã€‚

# å…·ä½“è€Œè¨€ï¼Œå®¢æˆ·ç«¯é€šè¿‡æ ‡å‡†è¾“å…¥å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡æ ‡å‡†è¾“å‡ºè¿”å›å“åº”ã€‚è¿™ç§ç›´æ¥çš„æ•°æ®ä¼ è¾“æ–¹

# å¼å‡å°‘äº†ç½‘ç»œå»¶è¿Ÿå’Œä¼ è¾“å¼€é”€ï¼Œé€‚åˆéœ€è¦å¿«é€Ÿå“åº”çš„æœ¬åœ°åº”ç”¨ã€‚

# ç›¸æ¯”ä¹‹ä¸‹ï¼ŒMCP è¿˜æ”¯æŒåŸºäº HTTP å’ŒæœåŠ¡å™¨æ¨é€äº‹ä»¶ï¼ˆSSEï¼‰çš„ä¼ è¾“æ–¹å¼ï¼Œé€‚ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨

# ä½äºä¸åŒç‰©ç†ä½ç½®çš„åœºæ™¯ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡ HTTP åè®®è¿›è¡Œé€šä¿¡ï¼Œåˆ©ç”¨ SSE å®

# ç°æœåŠ¡å™¨å‘å®¢æˆ·ç«¯çš„å®æ—¶æ•°æ®æ¨é€ã€‚

# æ€»çš„æ¥è¯´ï¼Œstdio æ¨¡å¼æä¾›äº†ä¸€ç§ç®€å•ã€é«˜æ•ˆçš„æœ¬åœ°é€šä¿¡æ–¹å¼ï¼Œé€‚ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨åŒä¸€ç¯å¢ƒ

ä¸‹è¿è¡Œçš„æƒ…å†µã€‚è€Œå¯¹äºåˆ†å¸ƒå¼æˆ–è¿œç¨‹éƒ¨ç½²çš„åœºæ™¯ï¼ŒåŸºäº HTTP å’Œ SSE çš„ä¼ è¾“æ–¹å¼åˆ™æ›´ä¸ºåˆé€‚ã€‚

# å¯æµå¼ä¼ è¾“çš„ HTTP PRï¼šhttps://github.com/modelcontextprotocol/specification/pull/206

# å…·ä½“æ¥è¯´ï¼ŒMCPå®šä¹‰äº†Clientä¸Serverè¿›è¡Œé€šè®¯çš„åè®®ä¸æ¶ˆæ¯æ ¼å¼ï¼Œå…¶æ”¯æŒä¸¤ç§ç±»å‹é€šè®¯æœºåˆ¶ï¼šæ ‡å‡†è¾“å…¥

# è¾“å‡ºé€šè®¯ã€åŸºäºSSEçš„HTTPé€šè®¯ï¼Œåˆ†åˆ«å¯¹åº”ç€æœ¬åœ°ä¸è¿œç¨‹é€šè®¯ã€‚Clientä¸Serveré—´ä½¿ç”¨JSON-RPC 2.0æ ¼ å¼è¿›è¡Œæ¶ˆæ¯ä¼ è¾“ã€‚

# æœ¬åœ°é€šè®¯ï¼šä½¿ç”¨äº†stdioä¼ è¾“æ•°æ®ï¼Œå…·ä½“æµç¨‹Clientå¯åŠ¨Serverç¨‹åºä½œä¸ºå­è¿›ç¨‹ï¼Œå…¶æ¶ˆæ¯é€šè®¯æ˜¯é€šè¿‡ stdin/stdoutè¿›è¡Œçš„ï¼Œæ¶ˆæ¯æ ¼å¼ä¸ºJSON-RPC 2.0ã€‚

# è¿œç¨‹é€šè®¯ï¼šClientä¸Serverå¯ä»¥éƒ¨ç½²åœ¨ä»»ä½•åœ°æ–¹ï¼ŒClientä½¿ç”¨SSEä¸Serverè¿›è¡Œé€šè®¯ï¼Œæ¶ˆæ¯çš„æ ¼å¼ä¸º JSON-RPC 2.0ï¼ŒServerå®šä¹‰äº†/seeä¸/messagesæ¥å£ç”¨äºæ¨é€ä¸æ¥æ”¶æ•°æ®ã€‚

# è¿™é‡Œæˆ‘ä»¬å°è¯•ä¸€ä¸ªå…¥é—¨çº§çš„ç¤ºä¾‹ï¼Œé‚£å°±æ˜¯åˆ›å»ºä¸€ä¸ªå¤©æ°”æŸ¥è¯¢çš„æœåŠ¡å™¨ã€‚é€šè¿‡ä½¿ç”¨OpenWeather APIï¼Œåˆ› å»ºä¸€ä¸ªèƒ½å¤Ÿå®æ—¶æŸ¥è¯¢å¤©æ°”çš„æœåŠ¡å™¨ï¼ˆserverï¼‰ï¼Œå¹¶ä½¿ç”¨stdioæ–¹å¼è¿›è¡Œé€šä¿¡ã€‚

![Image](pdf_images\page36_img1.png)

![Image](pdf_images\page36_img2.png)

![Image](pdf_images\page36_img3.png)

# OpenWeatherå®˜ç½‘ï¼šhttps://openweathermap.org/ï¼Œæ›´å¤šAPIè·å–æ–¹æ³•

# æµ‹è¯•æŸ¥è¯¢æ•ˆæœ

curl -s "https://api.openweathermap.org/data/2.5/weather?

# q=Beijing&appid='YOUR_API_KEY'&units=metric&lang=zh_cn"

# æµ‹è¯•æ— è¯¯åï¼Œæ¥ä¸‹æ¥å³å¯è¿›å…¥åˆ°åˆ›å»ºserverçš„ç¯èŠ‚ä¸­ã€‚

3. å¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨Serveråˆ›å»ºæµç¨‹

# 3.1 æœåŠ¡å™¨ä¾èµ–å®‰è£…

# ç”±äºæˆ‘ä»¬éœ€è¦ä½¿ç”¨httpè¯·æ±‚æ¥æŸ¥è¯¢å¤©æ°”ï¼Œå› æ­¤éœ€è¦åœ¨å½“å‰è™šæ‹Ÿç¯å¢ƒä¸­æ·»åŠ å¦‚ä¸‹ä¾èµ–

uv add mcp httpx

![Image](pdf_images\page37_img1.png)

## 3.2 æœåŠ¡å™¨ä»£ç ç¼–å†™

æ¥ä¸‹æ¥å°è¯•åˆ›å»ºæœåŠ¡å™¨ä»£ç ï¼Œæ­¤æ—¶MCPåŸºæœ¬æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š

# å¯¹åº”serveræœåŠ¡å™¨ä»£ç å¦‚ä¸‹ï¼š

# import json

# import httpx

from typing import Any

# from mcp.server.fastmcp import FastMCP

# # åˆå§‹åŒ– MCP æœåŠ¡å™¨

# mcp = FastMCP("WeatherServer")

# # OpenWeather API é…ç½®

# OPENWEATHER_API_BASE = "https://api.openweathermap.org/data/2.5/weather"

# API_KEY = "YOUR_API_KEY" # è¯·æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ OpenWeather API Key

# USER_AGENT = "weather-app/1.0"

# async def fetch_weather(city: str) -> dict[str, Any] | None:

""" ä» OpenWeather API è·å–å¤©æ°”ä¿¡æ¯ã€‚

# :param city: åŸå¸‚åç§°ï¼ˆéœ€ä½¿ç”¨è‹±æ–‡ï¼Œå¦‚ Beijingï¼‰

# :return: å¤©æ°”æ•°æ®å­—å…¸ï¼›è‹¥å‡ºé”™è¿”å›åŒ…å« error ä¿¡æ¯çš„å­—å…¸

"""

params = {

"q": city,

"appid": API_KEY,

"units": "metric",

# "lang": "zh_cn"

}

headers = {"User-Agent": USER_AGENT}

async with httpx.AsyncClient() as client:

## try:

## response = await client.get(OPENWEATHER_API_BASE, params=params,

# headers=headers, timeout=30.0)

# response.raise_for_status()

# return response.json() # è¿”å›å­—å…¸ç±»å‹

# except httpx.HTTPStatusError as e: return {"error": f"HTTP é”™è¯¯: {e.response.status_code}"}

# except Exception as e:

return {"error": f"è¯·æ±‚å¤±è´¥: {str(e)}"}

# def format_weather(data: dict[str, Any] | str) -> str:

"""

# å°†å¤©æ°”æ•°æ®æ ¼å¼åŒ–ä¸ºæ˜“è¯»æ–‡æœ¬ã€‚ :param data: å¤©æ°”æ•°æ®ï¼ˆå¯ä»¥æ˜¯å­—å…¸æˆ– JSON å­—ç¬¦ä¸²ï¼‰

# :return: æ ¼å¼åŒ–åçš„å¤©æ°”ä¿¡æ¯å­—ç¬¦ä¸²

"""

# # å¦‚æœä¼ å…¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™å…ˆè½¬æ¢ä¸ºå­—å…¸

# if isinstance(data, str):

# try:

# data = json.loads(data)

# except Exception as e:

return f"æ— æ³•è§£æå¤©æ°”æ•°æ®: {e}"

# # å¦‚æœæ•°æ®ä¸­åŒ…å«é”™è¯¯ä¿¡æ¯ï¼Œç›´æ¥è¿”å›é”™è¯¯æç¤º

# if "error" in data: return f"âš  {data['error']}"

# # æå–æ•°æ®æ—¶åšå®¹é”™å¤„ç†

# city = data.get("name", "æœªçŸ¥")

country = data.get("sys", {}).get("country", "æœªçŸ¥")

# temp = data.get("main", {}).get("temp", "N/A")

# humidity = data.get("main", {}).get("humidity", "N/A")

wind_speed = data.get("wind", {}).get("speed", "N/A")

# weather å¯èƒ½ä¸ºç©ºåˆ—è¡¨ï¼Œå› æ­¤ç”¨ [0] å‰å…ˆæä¾›é»˜è®¤å­—å…¸

# weather_list = data.get("weather", [{}])

description = weather_list[0].get("description", "æœªçŸ¥")

return ( f"ğŸŒ {city}, {country}\n" f"ğŸŒ¡ æ¸©åº¦: {temp}Â°C\n" f"ğŸ’§ æ¹¿åº¦: {humidity}%\n" f"ğŸŒ¬ é£é€Ÿ: {wind_speed} m/s\n" f"â›… å¤©æ°”: {description}\n"

)

# @mcp.tool()

# async def query_weather(city: str) -> str:

"""

# è¾“å…¥æŒ‡å®šåŸå¸‚çš„è‹±æ–‡åç§°ï¼Œè¿”å›ä»Šæ—¥å¤©æ°”æŸ¥è¯¢ç»“æœã€‚ :param city: åŸå¸‚åç§°ï¼ˆéœ€ä½¿ç”¨è‹±æ–‡ï¼‰

# :return: æ ¼å¼åŒ–åçš„å¤©æ°”ä¿¡æ¯

"""

data = await fetch_weather(city)

# return format_weather(data)

if __name__ == "__main__":

![Image](pdf_images\page39_img1.png)

## # ä»¥æ ‡å‡† I/O æ–¹å¼è¿è¡Œ MCP æœåŠ¡å™¨

## mcp.run(transport='stdio')

# ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

# Part 1. å¼‚æ­¥è·å–å¤©æ°”æ•°æ®

# å‡½æ•° fetch_weather(city: str)

ä½¿ç”¨ httpx.AsyncClient() å‘é€å¼‚æ­¥ GET è¯·æ±‚åˆ° OpenWeather APIã€‚

# å¦‚æœè¯·æ±‚æˆåŠŸï¼Œåˆ™è°ƒç”¨ response.json() è¿”å›ä¸€ä¸ªå­—å…¸ã€‚

# å‡ºç°å¼‚å¸¸æ—¶ï¼Œè¿”å›åŒ…å«é”™è¯¯ä¿¡æ¯çš„å­—å…¸ã€‚

# Part 2. æ ¼å¼åŒ–å¤©æ°”æ•°æ®

# å‡½æ•° format_weather(data: dict | str)

# é¦–å…ˆæ£€æŸ¥ä¼ å…¥çš„æ•°æ®æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä½¿ç”¨ json.loads å°†å…¶è½¬æ¢ä¸ºå­—å…¸ã€‚

# æ£€æŸ¥æ•°æ®ä¸­æ˜¯å¦åŒ…å« "error" å­—æ®µï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥è¿”å›é”™è¯¯æç¤ºã€‚

ä½¿ç”¨ .get() æ–¹æ³•æå– name ã€ sys.country ã€ main.temp ã€ main.humidity ã€

wind.speed å’Œ weather[0].description ç­‰æ•°æ®ï¼Œå¹¶ä¸ºå¯èƒ½ç¼ºå¤±çš„å­—æ®µæä¾›é»˜è®¤å€¼ã€‚

# å°†æå–çš„ä¿¡æ¯æ‹¼æ¥æˆä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿é˜…è¯»ã€‚

# Part 3. MCP å·¥å…· query_weather(city: str)

# å‡½æ•° query_weather

é€šè¿‡ @mcp.tool() è£…é¥°å™¨æ³¨å†Œä¸º MCP æœåŠ¡å™¨çš„å·¥å…·ï¼Œä½¿å…¶èƒ½å¤Ÿè¢«å®¢æˆ·ç«¯è°ƒç”¨ã€‚

è°ƒç”¨ fetch_weather(city) è·å–å¤©æ°”æ•°æ®ï¼Œç„¶åç”¨ format_weather(data) å°†æ•°æ®æ ¼å¼åŒ–

# ä¸ºæ˜“è¯»æ–‡æœ¬ï¼Œæœ€åè¿”å›è¯¥å­—ç¬¦ä¸²ã€‚

Part 4. è¿è¡ŒæœåŠ¡å™¨

## if __name__ == "__main__": å—

## è°ƒç”¨ mcp.run(transport='stdio') å¯åŠ¨ MCP æœåŠ¡å™¨ï¼Œé‡‡ç”¨æ ‡å‡† I/O é€šä¿¡æ–¹å¼ï¼Œç­‰å¾…å®¢æˆ·

# ç«¯è°ƒç”¨ã€‚

# æ­¤å¤–ï¼Œä¸Šè¿°ä»£ç æœ‰ä¸¤ä¸ªæ³¨æ„äº‹é¡¹ï¼Œ

1. query_weatherå‡½æ•°çš„å‡½æ•°è¯´æ˜è‡³å…³é‡è¦ï¼Œç›¸å½“äºæ˜¯æ­¤åå®¢æˆ·ç«¯å¯¹å‡½æ•°è¿›è¡Œè¯†åˆ«çš„åŸºæœ¬ä¾æ®ï¼Œå› æ­¤

# éœ€è¦è°¨æ…ç¼–å†™ï¼›

2. å½“æŒ‡å®š transport='stdio' è¿è¡Œ MCP æœåŠ¡å™¨æ—¶ï¼Œå®¢æˆ·ç«¯å¿…é¡»åœ¨å¯åŠ¨æ—¶åŒæ—¶å¯åŠ¨å½“å‰è¿™ä¸ªè„šæœ¬ï¼Œ

# å¦åˆ™æ— æ³•é¡ºåˆ©é€šä¿¡ã€‚è¿™æ˜¯å› ä¸º stdio æ¨¡å¼æ˜¯ä¸€ç§æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼ŒInter-Process

# Communicationï¼‰æ–¹å¼ï¼Œå®ƒéœ€è¦æœåŠ¡å™¨ä½œä¸ºå­è¿›ç¨‹è¿è¡Œï¼Œå¹¶é€šè¿‡æ ‡å‡†è¾“å…¥è¾“å‡º

# ï¼ˆ stdin / stdout ï¼‰è¿›è¡Œæ•°æ®äº¤æ¢ã€‚

# å› æ­¤ï¼Œå½“æˆ‘ä»¬ç¼–å†™å®ŒæœåŠ¡å™¨åï¼Œå¹¶ä¸èƒ½ç›´æ¥è°ƒç”¨è¿™ä¸ªæœåŠ¡å™¨ï¼Œè€Œæ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„èƒ½å¤Ÿè¿›è¡Œstdioçš„

# å®¢æˆ·ç«¯ï¼Œæ‰èƒ½é¡ºåˆ©è¿›è¡Œé€šä¿¡ã€‚

4. å¤©æ°”æŸ¥è¯¢å®¢æˆ·ç«¯clientåˆ›å»ºæµç¨‹

# 4.1 ä»£ç ç¼–å†™

# import asyncio

# import os

# import json

from typing import Optional

# from contextlib import AsyncExitStack

# from openai import OpenAI

# from dotenv import load_dotenv

# from mcp import ClientSession, StdioServerParameters

# from mcp.client.stdio import stdio_client

# # åŠ è½½ .env æ–‡ä»¶ï¼Œç¡®ä¿ API Key å—åˆ°ä¿æŠ¤

# load_dotenv()

# class MCPClient:

# def __init__(self):

"""åˆå§‹åŒ– MCP å®¢æˆ·ç«¯"""

# self.exit_stack = AsyncExitStack()

self.openai_api_key = os.getenv("OPENAI_API_KEY") # è¯»å– OpenAI API Key self.base_url = os.getenv("BASE_URL") # è¯»å– BASE YRL

# self.model = os.getenv("MODEL") # è¯»å– model

# if not self.openai_api_key: raise ValueError("âŒ æœªæ‰¾åˆ° OpenAI API Keyï¼Œè¯·åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½® OPENAI_API_KEY")

# self.client = OpenAI(api_key=self.openai_api_key, base_url=self.base_url)

# # åˆ›å»ºOpenAI client

# self.session: Optional[ClientSession] = None

# self.exit_stack = AsyncExitStack()

# async def connect_to_server(self, server_script_path: str): """è¿æ¥åˆ° MCP æœåŠ¡å™¨å¹¶åˆ—å‡ºå¯ç”¨å·¥å…·"""

# is_python = server_script_path.endswith('.py')

is_js = server_script_path.endswith('.js')

## if not (is_python or is_js):

## raise ValueError("æœåŠ¡å™¨è„šæœ¬å¿…é¡»æ˜¯ .py æˆ– .js æ–‡ä»¶")

command = "python" if is_python else "node"

server_params = StdioServerParameters(

command=command,

args=[server_script_path],

# env=None

)

# # å¯åŠ¨ MCP æœåŠ¡å™¨å¹¶å»ºç«‹é€šä¿¡

# stdio_transport = await

# self.exit_stack.enter_async_context(stdio_client(server_params))

# self.stdio, self.write = stdio_transport

# self.session = await

# self.exit_stack.enter_async_context(ClientSession(self.stdio, self.write))

# await self.session.initialize()

# # åˆ—å‡º MCP æœåŠ¡å™¨ä¸Šçš„å·¥å…·

# response = await self.session.list_tools()

tools = response.tools

# print("\nå·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ”¯æŒä»¥ä¸‹å·¥å…·:", [tool.name for tool in tools])

# async def process_query(self, query: str) -> str:

"""

# ä½¿ç”¨å¤§æ¨¡å‹å¤„ç†æŸ¥è¯¢å¹¶è°ƒç”¨å¯ç”¨çš„ MCP å·¥å…· (Function Calling)

"""

messages = [{"role": "user", "content": query}]

# response = await self.session.list_tools()

# available_tools = [{

"type": "function",

# "function": {

"name": tool.name,

"description": tool.description,

# "input_schema": tool.inputSchema

}

} for tool in response.tools]

# # print(available_tools)

# response = self.client.chat.completions.create(

model=self.model,

messages=messages,

# tools=available_tools

)

# # å¤„ç†è¿”å›çš„å†…å®¹

content = response.choices[0]

if content.finish_reason == "tool_calls":

# # å¦‚ä½•æ˜¯éœ€è¦ä½¿ç”¨å·¥å…·ï¼Œå°±è§£æå·¥å…·

# tool_call = content.message.tool_calls[0]

# tool_name = tool_call.function.name

tool_args = json.loads(tool_call.function.arguments)

## # æ‰§è¡Œå·¥å…·

## result = await self.session.call_tool(tool_name, tool_args)

# print(f"\n\n[Calling tool {tool_name} with args {tool_args}]\n\n")

# # å°†æ¨¡å‹è¿”å›çš„è°ƒç”¨å“ªä¸ªå·¥å…·æ•°æ®å’Œå·¥å…·æ‰§è¡Œå®Œæˆåçš„æ•°æ®éƒ½å­˜å…¥messagesä¸­

# messages.append(content.message.model_dump())

# messages.append({

"role": "tool",

"content": result.content[0].text,

"tool_call_id": tool_call.id,

})

# # å°†ä¸Šé¢çš„ç»“æœå†è¿”å›ç»™å¤§æ¨¡å‹ç”¨äºç”Ÿäº§æœ€ç»ˆçš„ç»“æœ

# response = self.client.chat.completions.create(

model=self.model,

messages=messages,

)

return response.choices[0].message.content

# return content.message.content

# async def chat_loop(self):

# """è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯""" print("\nğŸ¤– MCP å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€å‡º")

# while True:

# try: query = input("\nä½ : ").strip()

if query.lower() == 'quit':

# break

# response = await self.process_query(query) # å‘é€ç”¨æˆ·è¾“å…¥åˆ° OpenAI

# API print(f"\nğŸ¤– OpenAI: {response}")

# except Exception as e: print(f"\nâš  å‘ç”Ÿé”™è¯¯: {str(e)}")

# async def cleanup(self):

"""æ¸…ç†èµ„æº"""

# await self.exit_stack.aclose()

# async def main():

if len(sys.argv) < 2:

# print("Usage: python client.py <path_to_server_script>")

# sys.exit(1)

# client = MCPClient()

# try:

# await client.connect_to_server(sys.argv[1])

# await client.chat_loop()

# finally:

# await client.cleanup()

if __name__ == "__main__":

import sys

![Image](pdf_images\page43_img1.png)

![Image](pdf_images\page43_img2.png)

## asyncio.run(main())

# 4.2 æµ‹è¯•è¿è¡Œ

# # ç¡®è®¤è¿›å…¥åˆ°é¡¹ç›®ç›®å½•

# cd /root/autodl-tmp/MCP/mcp-client

# # ç¡®è®¤æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

# source .venv/bin/activate

# uv run client.py server.py

# ç›´æ¥æé—® è¯·é—®åŒ—äº¬ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

![Image](pdf_images\page44_img1.png)

![Image](pdf_images\page44_img2.png)

![Image](pdf_images\page44_img3.png)

# QwQ-32Bæ¨ç†ç±»æ¨¡å‹é—®ç­”æ•ˆæœå¦‚ä¸‹ï¼š

## 4.3 ä»£ç è§£é‡Š

# clientä»£ç æ•´ä¸ªMCPæœåŠ¡çš„æ ¸å¿ƒï¼Œä»¥ä¸‹æ˜¯è¿™æ®µä»£ç çš„è¯¦ç»†è§£é‡Šã€‚

# å¯¼å…¥åŸºæœ¬ç±»

# import asyncio

# import os

# import json

from typing import Optional

# from contextlib import AsyncExitStack

# from openai import OpenAI

# from dotenv import load_dotenv

# from mcp import ClientSession, StdioServerParameters

# from mcp.client.stdio import stdio_client

1. å¯¼å…¥å¿…è¦åº“

# asyncio ï¼šæ”¯æŒå¼‚æ­¥ç¼–ç¨‹

# os / json ï¼šè¯»å–ç¯å¢ƒå˜é‡ã€è§£æ JSON

# typing.Optional ï¼šç±»å‹æç¤º

# contextlib.AsyncExitStack ï¼šç”¨äºå®‰å…¨ç®¡ç†å¼‚æ­¥èµ„æºï¼ˆå¦‚ MCP è¿æ¥ï¼‰

# openai.OpenAI ï¼šä½ çš„è‡ªå®šä¹‰ OpenAI Client ç±»

# dotenv.load_dotenv ï¼šä» .env æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡ï¼ˆå¦‚ API Keyï¼‰

# MCP ç›¸å…³ï¼š mcp.ClientSession , mcp.client.stdio , StdioServerParameters

# load_dotenv()

ä» .env æ–‡ä»¶ä¸­åŠ è½½ç¯å¢ƒå˜é‡,

# OPENAI_API_KEY=sk-xxxxxx

BASE_URL=...

MODEL=...

# ** MCPClient ç±»åˆ›å»ºè¿‡ç¨‹**

## class MCPClient:

# def __init__(self): """åˆå§‹åŒ– MCP å®¢æˆ·ç«¯"""

# self.exit_stack = AsyncExitStack()

# self.openai_api_key = os.getenv("OPENAI_API_KEY") # è¯»å– OpenAI API Key

self.base_url = os.getenv("BASE_URL") # è¯»å– BASE YRL self.model = os.getenv("MODEL") # è¯»å– model

# if not self.openai_api_key: raise ValueError("âŒ æœªæ‰¾åˆ° OpenAI API Keyï¼Œè¯·åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½® OPENAI_API_KEY")

# self.client = OpenAI(api_key=self.openai_api_key, base_url=self.base_url)

# # åˆ›å»ºOpenAI client

# self.session: Optional[ClientSession] = None

# self.exit_stack = AsyncExitStack()

1. self.exit_stack = AsyncExitStack()

ç”¨äº ç»Ÿä¸€ç®¡ç†å¼‚æ­¥ä¸Šä¸‹æ–‡ï¼ˆå¦‚ MCP è¿æ¥ï¼‰çš„ç”Ÿå‘½å‘¨æœŸã€‚

# å¯ä»¥åœ¨é€€å‡ºï¼ˆ cleanup ï¼‰æ—¶è‡ªåŠ¨å…³é—­ã€‚

2. è¯»å–ç¯å¢ƒå˜é‡

# openai_api_key ï¼šOpenAI API Key

# base_url ï¼šæ¨¡å‹è¯·æ±‚çš„ Base URLï¼ˆå¦‚ä½ è‡ªå»ºçš„åä»£åœ°å€ï¼‰

# model ï¼šOpenAI æ¨¡å‹åç§°

3. åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯

# OpenAI(api_key=self.openai_api_key, base_url=self.base_url)

# ä½ è‡ªå®šä¹‰çš„ OpenAI å®¢æˆ·ç«¯ï¼Œç”¨æ¥ä¸ OpenAI Chat Completion API é€šä¿¡ã€‚

4. self.session

# ç”¨äºä¿å­˜ MCP çš„å®¢æˆ·ç«¯ä¼šè¯ï¼Œé»˜è®¤æ˜¯ None ï¼Œç¨åé€šè¿‡ connect_to_server è¿›è¡Œè¿æ¥ã€‚

5. å†æ¬¡å£°æ˜ self.exit_stack = AsyncExitStack()

# è¿™é‡Œä¸¤æ¬¡èµ‹å€¼å…¶å®æœ‰ç‚¹å†—ä½™ï¼ˆå‰é¢å·²èµ‹å€¼è¿‡ä¸€æ¬¡ï¼‰ã€‚ä¸è¿‡å¹¶ä¸å½±å“åŠŸèƒ½ï¼Œç­‰åŒäºè¦†ç›–æ‰å‰é¢çš„

# å¯¹è±¡ã€‚å¯èƒ½æ˜¯æ‰‹è¯¯æˆ–è°ƒè¯•æ—¶å¤šå†™äº†ä¸€æ¬¡ã€‚

# connect_to_server(self, server_script_path: str)

# async def connect_to_server(self, server_script_path: str):

...

è´Ÿè´£å¯åŠ¨å¹¶è¿æ¥åˆ° MCP æœåŠ¡å™¨ï¼Œå¹¶åˆ—å‡ºå¯ç”¨å·¥å…·ã€‚

# is_python = server_script_path.endswith('.py')

# is_js = server_script_path.endswith('.js')

# if not (is_python or is_js): raise ValueError("æœåŠ¡å™¨è„šæœ¬å¿…é¡»æ˜¯ .py æˆ– .js æ–‡ä»¶")

command = "python" if is_python else "node"

# åˆ¤æ–­æœåŠ¡å™¨è„šæœ¬æ˜¯ Python è¿˜æ˜¯ Node.jsï¼Œé€‰æ‹©å¯¹åº”çš„è¿è¡Œå‘½ä»¤ã€‚

## server_params = StdioServerParameters(

## command=command,

args=[server_script_path],

# env=None

)

StdioServerParameters ï¼šå‘Šè¯‰ MCP å®¢æˆ·ç«¯å¦‚ä½•å¯åŠ¨æœåŠ¡å™¨ã€‚

command=command ï¼šå¦‚ "python"

# args=[server_script_path] ï¼šå¦‚ ["weather_server.py"]

# stdio_transport = await

# self.exit_stack.enter_async_context(stdio_client(server_params))

# self.stdio, self.write = stdio_transport

# self.session = await

# self.exit_stack.enter_async_context(ClientSession(self.stdio, self.write))

# await self.session.initialize()

1. stdio_client(server_params) ï¼šå¯åŠ¨æœåŠ¡å™¨è¿›ç¨‹ï¼Œå¹¶å»ºç«‹ æ ‡å‡† I/O é€šä¿¡ç®¡é“ã€‚

2. self.stdio, self.write = stdio_transport ï¼šæ‹¿åˆ°è¯»å†™æµã€‚

3. ClientSession(...) ï¼šåˆ›å»º MCP å®¢æˆ·ç«¯ä¼šè¯ï¼Œä¸æœåŠ¡å™¨äº¤äº’ã€‚

4. await self.session.initialize() ï¼šå‘é€åˆå§‹åŒ–æ¶ˆæ¯ç»™æœåŠ¡å™¨ï¼Œç­‰å¾…æœåŠ¡å™¨å°±ç»ªã€‚

# # åˆ—å‡º MCP æœåŠ¡å™¨ä¸Šçš„å·¥å…·

# response = await self.session.list_tools()

tools = response.tools print("\nå·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ”¯æŒä»¥ä¸‹å·¥å…·:", [tool.name for tool in tools])

# list_tools() ï¼šå‘ MCP æœåŠ¡å™¨è¯·æ±‚æ‰€æœ‰å·²æ³¨å†Œçš„å·¥å…·ï¼ˆç”¨ @mcp.tool() æ ‡è®°ï¼‰ã€‚

# æ‰“å°å·¥å…·åˆ—è¡¨ï¼Œä¾‹å¦‚ ["get_forecast", "query_db", ...] ã€‚

# process_query(self, query: str) -> str

# async def process_query(self, query: str) -> str:

"""

# ä½¿ç”¨å¤§æ¨¡å‹å¤„ç†æŸ¥è¯¢å¹¶è°ƒç”¨å¯ç”¨çš„ MCP å·¥å…· (Function Calling)

"""

messages = [{"role": "user", "content": query}]

æ”¶åˆ°ç”¨æˆ·è¾“å…¥åï¼Œå…ˆæŠŠå®ƒç»„è£…è¿›ä¸€ä¸ª messages åˆ—è¡¨ï¼Œç›®å‰åªåŒ…å«ç”¨æˆ·ä¿¡æ¯ï¼ˆ {"role": "user", "content": query} ï¼‰ã€‚

## response = await self.session.list_tools()

## available_tools = [{

"type": "function",

# "function": {

"name": tool.name,

"description": tool.description,

# "input_schema": tool.inputSchema

}

} for tool in response.tools]

# print(available_tools)

# è·å–æœåŠ¡å™¨ä¸Šçš„å·¥å…·ï¼Œå†è½¬æ¢æˆ available_tools çš„æ ¼å¼ã€‚

# è¿™é‡Œä½ è‡ªå®šä¹‰äº†ä¸€ä¸ªç»“æ„ï¼šæ¯ä¸ªå·¥å…·å¯¹åº”ä¸€ä¸ª {"type": "function", "function": {...}} çš„

# å­—å…¸ã€‚

# æ–¹ä¾¿åé¢å‘ç»™ OpenAIï¼Œå‘Šè¯‰å®ƒï¼šå¯ä»¥è°ƒç”¨è¿™äº›å·¥å…·ã€‚

# response = self.client.chat.completions.create(

model=self.model,

messages=messages,

# tools=available_tools

)

# ä½¿ç”¨ OpenAI å®¢æˆ·ç«¯çš„

# chat.completions.create

# æ–¹æ³•å‘é€è¯·æ±‚ï¼š

model=self.model ï¼šæ¯”å¦‚ "gpt-4o" æˆ– "deepseek-chat"

# messages=messages ï¼šèŠå¤©ä¸Šä¸‹æ–‡

# tools=available_tools ï¼šè®©æ¨¡å‹çŸ¥é“æœ‰å“ªäº›å¯è°ƒç”¨çš„ã€Œå‡½æ•°ã€ã€‚è¿™æ˜¯ä½ è‡ªå®šä¹‰çš„

# â€œFunction Callingâ€åè®®ï¼ˆéå®˜æ–¹ JSON schemaï¼‰ã€‚

content = response.choices[0]

if content.finish_reason == "tool_calls":

# # å¦‚æœæ¨¡å‹æƒ³è°ƒç”¨å·¥å…·

# tool_call = content.message.tool_calls[0]

# tool_name = tool_call.function.name

# tool_args = json.loads(tool_call.function.arguments)

# # æ‰§è¡Œå·¥å…·

# result = await self.session.call_tool(tool_name, tool_args)

# print(f"\n\n[Calling tool {tool_name} with args {tool_args}]\n\n")

# # å°†æ¨¡å‹è¿”å›çš„è°ƒç”¨å“ªä¸ªå·¥å…·æ•°æ®å’Œå·¥å…·æ‰§è¡Œå®Œæˆåçš„æ•°æ®éƒ½å­˜å…¥messagesä¸­

# messages.append(content.message.model_dump())

# messages.append({

"role": "tool",

"content": result.content[0].text,

"tool_call_id": tool_call.id,

})

## # å°†ä¸Šé¢çš„ç»“æœå†è¿”å›ç»™å¤§æ¨¡å‹ç”¨äºç”Ÿäº§æœ€ç»ˆçš„ç»“æœ

## response = self.client.chat.completions.create(

model=self.model,

messages=messages,

)

return response.choices[0].message.content

# return content.message.content

1. if content.finish_reason == "tool_calls":

å¦‚æœæ¨¡å‹çš„è¾“å‡ºè¡¨ç¤ºã€Œæƒ³è°ƒç”¨å·¥å…·ã€ï¼Œå®ƒä¼šåœ¨ content.message.tool_calls åˆ—è¡¨ä¸­å£°æ˜è¦

# ç”¨å“ªä¸ªå‡½æ•°ã€å‚æ•°æ˜¯ä»€ä¹ˆã€‚

# è¿™æ˜¯ä½ è‡ªå®šä¹‰çš„ä¸€ç§å‡½æ•°è°ƒç”¨æœºåˆ¶ï¼Œå’Œå®˜æ–¹ function_call æ ¼å¼ç•¥æœ‰ä¸åŒï¼Œä½†é€»è¾‘ç›¸ä¼¼ã€‚

2. å–å‡ºå·¥å…·å tool_name å’Œå‚æ•° tool_args ï¼Œå†è°ƒç”¨ self.session.call_tool(tool_name,

tool_args) æ‰§è¡Œ MCP å·¥å…·ã€‚

3. æŠŠå·¥å…·è°ƒç”¨ç»“æœä»¥ã€Œrole=toolã€çš„å½¢å¼å†™å…¥ messages ã€‚è¿™æ ·ç›¸å½“äºæŠŠâ€œå‡½æ•°è°ƒç”¨ç»“æœâ€å†å–‚ç»™æ¨¡

# å‹ã€‚

4. å†æ¬¡è°ƒç”¨ OpenAIï¼Œè®©æ¨¡å‹é˜…è¯»åˆ°è¿™ä¸ªæ–°ä¸Šä¸‹æ–‡ï¼Œäº§å‡ºæœ€ç»ˆå›ç­”ã€‚

5. å¦‚æœæ²¡æœ‰è¦è°ƒç”¨å·¥å…·ï¼Œç›´æ¥è¿”å› content.message.content ï¼ˆæ¨¡å‹çš„æ–‡æœ¬å›ç­”ï¼‰ã€‚

# chat_loop(self)

# async def chat_loop(self):

# """è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯""" print("\nğŸ¤– MCP å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€å‡º")

# while True:

# try:

# query = input("\nä½ : ").strip()

if query.lower() == 'quit':

# break

# response = await self.process_query(query) # å‘é€ç”¨æˆ·è¾“å…¥åˆ° OpenAI API print(f"\nğŸ¤– OpenAI: {response}")

# except Exception as e: print(f"\nâš  å‘ç”Ÿé”™è¯¯: {str(e)}")

# ä½œç”¨ï¼š

# æä¾›ä¸€ä¸ªç®€å•çš„ å‘½ä»¤è¡Œç•Œé¢ï¼Œåå¤è®©ç”¨æˆ·è¾“å…¥é—®é¢˜ã€‚

# æ¯ä¸ªé—®é¢˜äº¤ç»™ process_query ï¼ŒæŠŠç»“æœæ‰“å°å‡ºæ¥ã€‚

# è¾“å…¥ 'quit' é€€å‡ºå¾ªç¯ã€‚

# cleanup(self) ä¸ main()

# async def cleanup(self): """æ¸…ç†èµ„æº"""

# await self.exit_stack.aclose()

## self.exit_stack.aclose() ï¼šå¼‚æ­¥åœ°å…³é—­æ‰€æœ‰åœ¨ exit_stack ä¸­æ³¨å†Œçš„èµ„æºï¼ˆåŒ…æ‹¬ MCP ä¼š

## è¯ï¼‰ã€‚

# async def main():

if len(sys.argv) < 2:

# print("Usage: python client.py <path_to_server_script>")

# sys.exit(1)

# client = MCPClient()

# try:

# await client.connect_to_server(sys.argv[1])

# await client.chat_loop()

# finally:

# await client.cleanup()

if __name__ == "__main__":

# import sys

# asyncio.run(main())

1. è¯»å–å‘½ä»¤è¡Œå‚æ•°ï¼Œè·å–æœåŠ¡å™¨è„šæœ¬è·¯å¾„ï¼ˆå¦‚ weather_server.py ï¼‰ã€‚

2. åˆ›å»º MCPClient å®ä¾‹ã€‚

3. è°ƒç”¨ connect_to_server ï¼Œå¯åŠ¨å¹¶è¿æ¥æœåŠ¡å™¨ã€‚

4. è¿›å…¥ chat_loop è®©ç”¨æˆ·è¾“å…¥å¤šè½®å¯¹è¯ã€‚

5. é€€å‡ºæ—¶è°ƒç”¨ client.cleanup() é‡Šæ”¾èµ„æºã€‚

# ä»£ç æ€»ç»“å¦‚ä¸‹ï¼š

1. MCPClient çš„ä¸»è¦èŒè´£ï¼š

å¯åŠ¨ MCP æœåŠ¡å™¨ï¼ˆé€šè¿‡ StdioServerParameters ï¼‰

# å»ºç«‹ MCP ä¼šè¯ï¼Œåˆ—å‡ºå¯ç”¨å·¥å…·

# å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œå°†å…¶å‘é€ç»™ OpenAI æ¨¡å‹

# å¦‚æœæ¨¡å‹æƒ³è°ƒç”¨ MCP å·¥å…·ï¼ˆFunction Callingï¼‰ï¼Œå°±æ‰§è¡Œ call_tool

# å°†ç»“æœé‡æ–°å‘ç»™æ¨¡å‹ï¼Œå¹¶è¿”å›æœ€ç»ˆå›ç­”

2. Function Calling é€»è¾‘ï¼ˆä½ çš„è‡ªå®šä¹‰ç‰ˆï¼‰ï¼š

# tools=available_tools ï¼šåœ¨ completions.create æ—¶å‘Šè¯‰æ¨¡å‹æœ‰å“ªäº›å·¥å…·å¯ç”¨ã€‚

æ¨¡å‹è¿”å› finish_reason=="tool_calls" â†’ è¯´æ˜å®ƒæƒ³ç”¨å·¥å…·ã€‚

è§£æ tool_calls[0] ï¼Œæ‰§è¡Œ MCP å·¥å…· â†’ å†æ¬¡å‘ç»™æ¨¡å‹ â†’ è¿”å›æœ€ç»ˆç­”æ¡ˆã€‚

3. ä¸ºä»€ä¹ˆè¦ä¸¤æ¬¡è¯·æ±‚ï¼Ÿ

# ç¬¬ä¸€æ¬¡ï¼šæ¨¡å‹æ ¹æ®ä½ çš„æŒ‡ä»¤ï¼Œå†³å®šè¦ä¸è¦ç”¨å·¥å…·

# å¦‚æœéœ€è¦ç”¨å·¥å…· â†’ è¿”å›å·¥å…·åç§°å’Œå‚æ•° â†’ æ‰§è¡Œå·¥å…· â†’ æŠŠç»“æœä½œä¸ºæ–°çš„ä¸Šä¸‹æ–‡å‘ç»™æ¨¡å‹

# ç¬¬äºŒæ¬¡ï¼šæ¨¡å‹åŸºäºå·¥å…·ç»“æœç»™å‡ºæœ€ç»ˆå›ç­”

4. å¦‚ä½•è¿è¡Œï¼š

# python client.py weather_server.py

è¿™ä¼šè‡ªåŠ¨å¯åŠ¨ weather_server.py ï¼ˆMCP æœåŠ¡å™¨ï¼‰å¹¶è¿›è¡Œ stdio é€šè®¯ã€‚

![Image](pdf_images\page51_img1.png)

![Image](pdf_images\page51_img2.png)

![Image](pdf_images\page51_img3.png)

## 5. å¯èƒ½éœ€è¦çš„æ”¹è¿›ï¼š

## å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ï¼šæŠŠæ‰€æœ‰æ¶ˆæ¯éƒ½å­˜è¿› messages ï¼Œè®©æ¨¡å‹èƒ½è®°ä½ä»¥å‰çš„å¯¹è¯ã€‚

# é”™è¯¯å¤„ç†ï¼šå½“å·¥å…·è°ƒç”¨å¤±è´¥æ—¶ï¼Œç»™ç”¨æˆ·æç¤ºã€‚

# 5.MCP InspectoråŠŸèƒ½ä»‹ç»

# åœ¨å®é™…å¼€å‘MCPæœåŠ¡å™¨çš„è¿‡ç¨‹ä¸­ï¼ŒAnthropicæä¾›äº†ä¸€ä¸ªéå¸¸ä¾¿æ·çš„debugå·¥å…·ï¼šInspectorã€‚å€ŸåŠ©

# Inspectorï¼Œæˆ‘ä»¬èƒ½å¤Ÿéå¸¸å¿«æ·çš„è°ƒç”¨å„ç±»serverï¼Œå¹¶æµ‹è¯•å…¶åŠŸèƒ½ã€‚Inspectorå…·ä½“åŠŸèƒ½å®ç°æµç¨‹å¦‚ä¸‹ã€‚

# å®‰è£…nodejs

# curl -fsSL https://deb.nodesource.com/setup_20.x | sudo bash -

# sudo apt install -y nodejs

npx -v

# è¿è¡ŒInspector

# npx -y @modelcontextprotocol/inspector uv run server.py

![Image](pdf_images\page52_img1.png)

![Image](pdf_images\page52_img2.png)

# ç„¶åå³å¯åœ¨æœ¬åœ°æµè§ˆå™¨æŸ¥çœ‹å½“å‰å·¥å…·è¿è¡Œæƒ…å†µï¼šhttp://127.0.0.1:5173/#resources

# æ³¨ï¼Œè‹¥æ˜¯ä½¿ç”¨AutoDLè¿›è¡Œæœ¬åœ°æ˜ å°„ï¼Œåˆ™éœ€è¦å°†5173å’Œ3000ä¸¤ä¸ªç«¯å£æ˜ å°„åˆ°æœ¬åœ°

![Image](pdf_images\page53_img1.png)

![Image](pdf_images\page53_img2.png)

# æ­¤æ—¶æµè§ˆå™¨å†…å®¹å¦‚ä¸‹ï¼š

# ç„¶åå³å¯æŸ¥çœ‹å½“å‰æœåŠ¡å™¨è¿è¡ŒçŠ¶å†µï¼š

![Image](pdf_images\page54_img1.png)

![Image](pdf_images\page54_img2.png)

# å››ã€MCPæ›´å¤šè¿›é˜¶ä½¿ç”¨

åŸºäºæˆ‘ä»¬å½“å‰ä»‹ç»çš„MCPå¼€å‘å…¥é—¨ï¼ŒMCPè¿˜æœ‰è¯¸å¤šå¾…æ¢ç´¢çš„è¿›é˜¶åŠŸèƒ½ã€‚

1. MCPæœåŠ¡å™¨Serverè¿›é˜¶åŠŸèƒ½

# åŸºäºSSEä¼ è¾“çš„MCPæœåŠ¡å™¨åŠŸèƒ½å®ç°

# é™¤äº†stdioè¿æ¥æ¨¡å¼å¤–ï¼ŒMCPè¿˜æä¾›äº†å¯ä»¥æœåŠ¡å™¨ã€å®¢æˆ·ç«¯å¼‚åœ°è¿è¡Œçš„SSEä¼ è¾“æ¨¡å¼ï¼Œä»¥é€‚ç”¨äº

æ›´åŠ é€šç”¨çš„å¼€å‘æƒ…å†µã€‚è‹¥è¦å®ç°SSEçš„MCPæœåŠ¡å™¨é€šä¿¡ï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»£ç ã€‚

# Resourcesã€Promptç±»åŠŸèƒ½MCPæœåŠ¡å™¨

# é™¤äº†ToolsåŠŸèƒ½çš„æœåŠ¡å™¨å¤–ï¼ŒMCPè¿˜æ”¯æŒResourcesç±»æœåŠ¡å™¨å’ŒPromptç±»æœåŠ¡å™¨ï¼Œå…¶ä¸­

# ResourcesæœåŠ¡å™¨ä¸»è¦è´Ÿè´£æä¾›æ›´å¤šçš„èµ„æºæ¥å£ï¼Œå¦‚è°ƒç”¨æœ¬åœ°æ–‡ä»¶ã€æ•°æ®ç­‰ï¼Œè€ŒPromptç±»æœåŠ¡å™¨åˆ™

# æ˜¯ç”¨äºè®¾ç½®Agentå¼€å‘è¿‡ç¨‹ä¸­å„ç¯èŠ‚çš„æç¤ºè¯æ¨¡æ¿ã€‚

# æ›´å¤šé€šç”¨å…¬å¼€&åœ¨çº¿æœåŠ¡å™¨è°ƒç”¨æŒ‡å—

# MCPæ ‡å‡†é€šä¿¡åè®®å¸¦æ¥çš„æœ€å¤§ä»·å€¼ä¹‹ä¸€ï¼Œå°±æ˜¯è®©å¹¿å¤§Agentå¼€å‘è€…èƒ½å¤ŸåŸºäºæ­¤è¿›è¡Œåä½œã€‚åœ¨ MCPæ¨å‡ºåçš„è‹¥å¹²æ—¶é—´ï¼Œå·²ç»è¯ç”Ÿäº†æ•°ä»¥åƒè®¡çš„MCPæœåŠ¡å™¨ï¼Œå…è®¸ç”¨æˆ·ç›´æ¥ä¸‹è½½å¹¶è¿›è¡Œè°ƒç”¨ã€‚å‡ ä¸ª

æœ‰åçš„MCPæœåŠ¡å™¨åˆé›†(å¯¼èˆªç«™)åœ°å€ï¼š

# MCPå®˜æ–¹æœåŠ¡å™¨åˆé›†ï¼šhttps://github.com/modelcontextprotocol/servers

![Image](pdf_images\page55_img1.png)

![Image](pdf_images\page55_img2.png)

![Image](pdf_images\page55_img3.png)

## MCP Githubçƒ­é—¨å¯¼èˆªï¼šhttps://github.com/punkpeye/awesome-mcp-servers

# MCPé›†åˆï¼šhttps://github.com/ahujasid/blender-mcp

# MCPå¯¼èˆªï¼šhttps://mcp.so/

![Image](pdf_images\page56_img1.png)

2. MCPå®¢æˆ·ç«¯Clientè¿›é˜¶åŠŸèƒ½

# æ­¤å¤–ï¼Œé™¤äº†èƒ½åœ¨å‘½ä»¤è¡Œä¸­åˆ›å»ºMCPå®¢æˆ·ç«¯å¤–ï¼Œè¿˜æ”¯æŒå„ç±»å®¢æˆ·ç«¯çš„è°ƒç”¨ï¼šhttps://modelcontextprotoco

# l.io/clients

# å…¶ä¸­å€ŸåŠ©å¯¹è¯ç±»å®¢æˆ·ç«¯ï¼Œå¦‚Claude Destopï¼Œæˆ‘ä»¬èƒ½å¤Ÿè½»æ˜“çš„å°†å„ç±»æœåŠ¡å™¨è¿›è¡Œé›†æˆï¼Œä»è€Œæ‹“å±•Claude Destopçš„æ€§èƒ½ï¼š

![Image](pdf_images\page57_img1.png)

![Image](pdf_images\page57_img2.png)

# è€Œåœ¨ä¸€äº›IDEå®¢æˆ·ç«¯é‡Œï¼Œå¦‚clineæˆ–è€…Cursorï¼Œæˆ‘ä»¬èƒ½å¤Ÿç›´æ¥è°ƒç”¨æœåŠ¡å™¨è¿›è¡Œå¼€å‘ï¼š

![Image](pdf_images\page58_img1.png)

![Image](pdf_images\page58_img2.png)

# æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¸ºMCPé‡èº«å®šåˆ¶çš„Agentå¼€å‘æ¡†æ¶ï¼Œé€šè¿‡é›†æˆMCPæ¥æé«˜Agentå¼€å‘è¿›åº¦ï¼š

# https://github.com/lastmile-ai/mcp-agent

![Image](pdf_images\page59_img1.png)

# MCPå¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨æŒ‡å—

# ä¸€ã€MCPåŸºç¡€æŠ€æœ¯å›é¡¾

1. MCPå…¥é—¨ä»‹ç»

# MCPï¼Œå…¨ç§°æ˜¯Model Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼Œç”±Claudeæ¯å…¬å¸Anthropicäºå»å¹´11æœˆæ­£å¼ æå‡ºã€‚

![Image](pdf_images\page60_img1.png)

![Image](pdf_images\page60_img2.png)

## MCPåˆšå‘å¸ƒçš„æ—¶å€™ä¸æ¸©ä¸ç«ï¼Œç›´åˆ°ä»Šå¹´Agentå¤§çˆ†å‘æ‰è¢«å¹¿æ³›å…³æ³¨ã€‚è€Œåœ¨ä»Šå¹´2æœˆï¼ŒCursoræ­£å¼å®£å¸ƒåŠ å…¥

## MCPåŠŸèƒ½æ”¯æŒï¼Œä¸€ä¸¾å°†MCPæ¨åˆ°äº†å…¨ä½“å¼€å‘äººå‘˜é¢å‰ã€‚ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒMCPæ˜¯ä¸€ç§æŠ€æœ¯åè®®ï¼Œä¸€ç§æ™ºèƒ½

# ä½“Agentå¼€å‘è¿‡ç¨‹ä¸­å…±åŒçº¦å®šçš„ä¸€ç§è§„èŒƒã€‚è¿™å°±å¥½æ¯”ç§¦å§‹çš‡çš„â€œä¹¦åŒæ–‡ã€è½¦åŒè½¨â€ï¼Œåœ¨ç»Ÿä¸€çš„è§„èŒƒä¸‹ï¼Œå¤§å®¶ çš„åä½œæ•ˆç‡å°±èƒ½å¤§å¹…æé«˜ï¼Œæœ€ç»ˆæå‡æ™ºèƒ½ä½“Agentçš„å¼€å‘æ•ˆç‡ã€‚æˆªæ­¢ç›®å‰ï¼Œå·²ä¸Šåƒç§MCPå·¥å…·è¯ç”Ÿï¼Œåœ¨

# å¼ºæ‚çš„MCPç”Ÿæ€åŠ æŒä¸‹ï¼Œ äººäººæ‰‹æ“Manusçš„æ—¶ä»£å³å°†åˆ°æ¥ã€‚

# 7åˆ†é’Ÿè®²æ¸…æ¥šMCPæ˜¯ä»€ä¹ˆï¼Ÿhttps://www.bilibili.com/video/BV1uXQzYaEpJ/

# æ€»çš„æ¥è¯´ï¼ŒMCPè§£å†³çš„æœ€å¤§ç—›ç‚¹ï¼Œå°±æ˜¯Agentå¼€å‘ä¸­è°ƒç”¨å¤–éƒ¨å·¥å…·çš„æŠ€æœ¯é—¨æ§›è¿‡é«˜çš„é—®é¢˜ã€‚

# æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œèƒ½è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œæ˜¯å¤§æ¨¡å‹è¿›åŒ–ä¸ºæ™ºèƒ½ä½“Agentçš„å…³é”®ï¼Œå¦‚æœä¸èƒ½ä½¿ç”¨å¤–éƒ¨å·¥å…·ï¼Œå¤§æ¨¡å‹å°±

# åªèƒ½æ˜¯ä¸ªç®€å•çš„èŠå¤©æœºå™¨äººï¼Œç”šè‡³è¿æŸ¥è¯¢å¤©æ°”éƒ½åšä¸åˆ°ã€‚ç”±äºåº•å±‚æŠ€æœ¯é™åˆ¶å•Šï¼Œå¤§æ¨¡å‹æœ¬èº«æ˜¯æ— æ³•å’Œå¤–

# éƒ¨å·¥å…·ç›´æ¥é€šä¿¡çš„ï¼Œå› æ­¤Function callingçš„æ€è·¯ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼ˆfunctionï¼‰ä½œä¸ºä¸­ä»‹ï¼Œä¸€è¾¹ ä¼ é€’å¤§æ¨¡å‹çš„è¯·æ±‚ï¼Œå¦ä¸€è¾¹è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œæœ€ç»ˆè®©å¤§æ¨¡å‹èƒ½å¤Ÿé—´æ¥çš„è°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚

# ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è¦æŸ¥è¯¢å½“å‰å¤©æ°”æ—¶ï¼Œè®©å¤§æ¨¡å‹è°ƒç”¨å¤–éƒ¨å·¥å…·çš„function callingçš„è¿‡ç¨‹å°±å¦‚å›¾æ‰€ç¤ºï¼š

![Image](pdf_images\page61_img1.png)

# Function callingæ˜¯ä¸ªéå¸¸ä¸é”™çš„æŠ€æœ¯è®¾è®¡ï¼Œè‡ªè¯ç”Ÿä»¥æ¥ï¼Œä¸€ç›´è¢«ä¸šå†…å¥‰ä¸ºåœ­è‡¬ã€‚ä½†å”¯ä¸€çš„é—®é¢˜å°±æ˜¯ï¼Œç¼–

# å†™è¿™ä¸ªå¤–éƒ¨å‡½æ•°çš„å·¥ä½œé‡å¤ªå¤§äº†ï¼Œä¸€ä¸ªç®€å•çš„å¤–éƒ¨å‡½æ•°å¾€å¾€å°±å¾—ä¸Šç™¾è¡Œä»£ç ï¼Œè€Œä¸”ï¼Œä¸ºäº†è®©å¤§æ¨¡å‹â€œè®¤è¯†â€

# è¿™äº›å¤–éƒ¨å‡½æ•°ï¼Œæˆ‘ä»¬è¿˜è¦é¢å¤–ä¸ºæ¯ä¸ªå¤–éƒ¨å‡½æ•°ç¼–å†™ä¸€ä¸ªJSON Schemaæ ¼å¼çš„åŠŸèƒ½è¯´æ˜ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€

# è¦ç²¾å¿ƒè®¾è®¡ä¸€ä¸ªæç¤ºè¯æ¨¡ç‰ˆï¼Œæ‰èƒ½æé«˜Function callingå“åº”çš„å‡†ç¡®ç‡ã€‚

# è€ŒMCPçš„ç›®æ ‡ï¼Œå°±æ˜¯èƒ½åœ¨Agentå¼€å‘è¿‡ç¨‹ä¸­ï¼Œè®©å¤§æ¨¡å‹æ›´åŠ ä¾¿æ·çš„è°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚ä¸ºæ­¤ï¼ŒMCPæå‡ºäº†ä¸¤

# ä¸ªæ–¹æ¡ˆï¼Œå…¶ä¸€ï¼Œâ€œè½¦åŒè½¨ã€ä¹¦åŒæ–‡â€ï¼Œç»Ÿä¸€Function callingçš„è¿è¡Œè§„èŒƒã€‚

# é¦–å…ˆæ˜¯å…ˆç»Ÿä¸€åç§°ï¼ŒMCPæŠŠå¤§æ¨¡å‹è¿è¡Œç¯å¢ƒç§°ä½œ MCP Clientï¼Œä¹Ÿå°±æ˜¯MCPå®¢æˆ·ç«¯ï¼ŒåŒæ—¶ï¼ŒæŠŠå¤–éƒ¨å‡½æ•°è¿

# è¡Œç¯å¢ƒç§°ä½œMCP Serverï¼Œä¹Ÿå°±æ˜¯MCPæœåŠ¡å™¨ï¼Œ

![Image](pdf_images\page62_img1.png)

![Image](pdf_images\page62_img2.png)

# ç„¶åï¼Œç»Ÿä¸€MCPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„è¿è¡Œè§„èŒƒï¼Œå¹¶ä¸”è¦æ±‚MCPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œä¹Ÿç»Ÿä¸€æŒ‰ç…§æŸä¸ªæ—¢å®š

# çš„æç¤ºè¯æ¨¡æ¿è¿›è¡Œé€šä¿¡ã€‚

# ç°åœ¨ï¼Œåªè¦ä½ æœ¬åœ°è¿è¡Œçš„å¤§æ¨¡å‹æ”¯æŒMCPåè®®ï¼Œä¹Ÿå°±æ˜¯åªè¦å®‰è£…äº†ç›¸å…³çš„åº“ï¼Œä»…éœ€å‡ è¡Œä»£ç å³å¯æ¥å…¥è¿™

# äº›æµ·é‡çš„å¤–éƒ¨å·¥å…·ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰Agentå¼€å‘é—¨æ§›ç¬é—´é™ä½äº†å‘¢ã€‚

# è¿™ç§â€œè½¦åŒè½¨ã€ä¹¦åŒæ–‡â€çš„è§„èŒƒï¼Œåœ¨æŠ€æœ¯é¢†åŸŸå°±è¢«ç§°ä½œåè®®ï¼Œä¾‹å¦‚httpå°±æ˜¯ç½‘ç»œä¿¡æ¯äº¤æ¢çš„æŠ€æœ¯åè®®ã€‚å„ç±»

# æŠ€æœ¯åè®®çš„ç›®æ ‡ï¼Œéƒ½æ˜¯å¸Œæœ›é€šè¿‡æé«˜åä½œæ•ˆç‡æ¥æå‡å¼€å‘æ•ˆç‡ï¼Œè€ŒMCPï¼ŒModel Context Protocolï¼Œå°±

# æ˜¯ä¸€ç§æ—¨åœ¨æé«˜å¤§æ¨¡å‹Agentå¼€å‘æ•ˆç‡çš„æŠ€æœ¯åè®®ã€‚

# é‚£æ—¢ç„¶æ˜¯åè®®ï¼Œå¿…ç„¶æ˜¯ä½¿ç”¨çš„äººè¶Šå¤šæ‰è¶Šæœ‰ç”¨ã€‚å› æ­¤ï¼Œä¸ºäº†è¿›ä¸€æ™®åŠMCPåè®®ï¼ŒAnthropicè¿˜æä¾›äº†ä¸€æ•´ å¥—MCPå®¢æˆ·ç«¯ã€æœåŠ¡å™¨å¼€å‘çš„SDKï¼Œä¹Ÿå°±æ˜¯å¼€å‘å·¥å…·ï¼Œå¹¶ä¸”æ”¯æŒPythonã€TSå’ŒJavaç­‰å¤šç§è¯­è¨€ï¼Œå€ŸåŠ©

SDKï¼Œä»…éœ€å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥å¿«é€Ÿå¼€å‘ä¸€ä¸ªMCPæœåŠ¡å™¨ã€‚

# ç„¶åï¼Œä½ å°±å¯ä»¥æŠŠå®ƒæ¥å…¥ä»»æ„ä¸€ä¸ªMCPå®¢æˆ·ç«¯æ¥æ„å»ºæ™ºèƒ½ä½“ï¼Œå¦‚æœæ„¿æ„ï¼Œè¿˜å¯ä»¥æŠŠMCPæœåŠ¡å™¨åˆ†äº«åˆ°ç¤¾

åŒºï¼Œç»™æœ‰éœ€æ±‚çš„å¼€å‘è€…ä½¿ç”¨ï¼Œç”šè‡³ä½ è¿˜å¯ä»¥æŠŠä½ çš„MCPæœåŠ¡å™¨æ”¾åˆ°çº¿ä¸Šè¿è¡Œï¼Œè®©ç”¨æˆ·ä»˜è´¹ä½¿ç”¨ã€‚

![Image](pdf_images\page63_img1.png)

![Image](pdf_images\page63_img2.png)

## è€ŒMCPçš„å®¢æˆ·ç«¯ï¼Œä¸ä»…æ”¯æŒClaudeæ¨¡å‹ï¼Œä¹Ÿæ”¯æŒä»»æ„æœ¬åœ°æ¨¡å‹æˆ–è€…åœ¨çº¿å¤§æ¨¡å‹ï¼Œæˆ–è€…æ˜¯ä¸€äº›IDEã€‚ä¾‹

## å¦‚ï¼Œç°åœ¨Cursoræ­£å¼æ¥å…¥MCPï¼Œä»£è¡¨ç€Cursoræ­£å¼æˆä¸ºMCPå®¢æˆ·ç«¯ï¼Œåœ¨Cursorä¸­ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½å¿«é€Ÿç¼–å†™

# MCPæœåŠ¡å™¨ï¼ˆå¤–éƒ¨å‡½æ•°ï¼‰ï¼Œæ›´èƒ½å€ŸåŠ©Cursorä¸€é”®è¿æ¥ä¸Šæˆç™¾ä¸Šåƒçš„å¼€æºMCPæœåŠ¡å™¨ï¼Œè®©å¤§æ¨¡å‹å¿«é€Ÿæ¥å…¥ æµ·é‡å·¥å…·ï¼Œä»è€Œå¤§å¹…åŠ å¿«Agentå¼€å‘è¿›åº¦ã€‚

![Image](pdf_images\page64_img1.png)

![Image](pdf_images\page64_img2.png)

# 7åˆ†é’Ÿè®²æ¸…æ¥šMCPæ˜¯ä»€ä¹ˆï¼Ÿhttps://www.bilibili.com/video/BV1uXQzYaEpJ/

![Image](pdf_images\page65_img1.png)

![Image](pdf_images\page65_img2.png)

![Image](pdf_images\page65_img3.png)

# MCPæŠ€æœ¯å¼€å‘å…¥é—¨å®æˆ˜ï¼https://www.bilibili.com/video/BV1NLXCYTEbj/

# MCPä¼ä¸šçº§æ™ºèƒ½ä½“å¼€å‘å®æˆ˜ï¼https://www.bilibili.com/video/BV1n1ZuYjEzf

![Image](pdf_images\page66_img1.png)

![Image](pdf_images\page66_img2.png)

## 2.MCPæœåŠ¡å™¨Serveråˆé›†

# MCPå®˜æ–¹æœåŠ¡å™¨åˆé›†ï¼šhttps://github.com/modelcontextprotocol/servers

# MCP Githubçƒ­é—¨å¯¼èˆªï¼šhttps://github.com/punkpeye/awesome-mcp-servers

# Smitheryï¼šhttps://smithery.ai/

![Image](pdf_images\page67_img1.png)

![Image](pdf_images\page67_img2.png)

![Image](pdf_images\page67_img3.png)

# MCPå¯¼èˆªï¼šhttps://mcp.so/

# é˜¿é‡Œäº‘ç™¾ç‚¼ï¼šhttps://bailian.console.aliyun.com/?tab=mcp

![Image](pdf_images\page68_img1.png)

## 3. MCPçƒ­é—¨å®¢æˆ·ç«¯Client

# é™¤äº†èƒ½åœ¨å‘½ä»¤è¡Œä¸­åˆ›å»ºMCPå®¢æˆ·ç«¯å¤–ï¼Œè¿˜æ”¯æŒå„ç±»å®¢æˆ·ç«¯çš„è°ƒç”¨ï¼šhttps://modelcontextprotocol.i

# o/clients

# è¯¾ä»¶é¢†å–ï¼š

![Image](pdf_images\page69_img1.png)

![Image](pdf_images\page69_img2.png)

# äºŒã€Cursoræ¥å…¥MCPå·¥å…·æµç¨‹

# Cursoræ˜¯ä¸€æ¬¾é›†æˆäº†äººå·¥æ™ºèƒ½åŠŸèƒ½çš„ç°ä»£åŒ–ä»£ç ç¼–è¾‘å™¨ï¼Œæ—¨åœ¨æå‡å¼€å‘è€…çš„ç¼–ç æ•ˆç‡å’Œä½“éªŒã€‚é€šè¿‡

# å†…ç½®çš„AIåŠ©æ‰‹ï¼ŒCursorèƒ½å¤Ÿæä¾›ä»£ç è¡¥å…¨ã€é”™è¯¯æ£€æµ‹ã€ä¼˜åŒ–å»ºè®®ç­‰æ™ºèƒ½è¾…åŠ©åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¿«é€Ÿåœ° ç¼–å†™é«˜è´¨é‡ä»£ç ã€‚

# å½“Cursoræ¥å…¥MCPï¼ˆModel Context Protocolï¼‰åï¼Œå…¶åŠŸèƒ½å¾—åˆ°äº†è¿›ä¸€æ­¥æ‰©å±•ã€‚MCPæ˜¯ç”±

# Anthropicäº2024å¹´11æœˆæ¨å‡ºçš„å¼€æ”¾æ ‡å‡†åè®®ï¼Œæ—¨åœ¨ä¸ºAIæ¨¡å‹ä¸å¤–éƒ¨å·¥å…·æˆ–æ•°æ®æºä¹‹é—´å»ºç«‹æ ‡å‡†åŒ–çš„æ¥

# å£ã€‚é€šè¿‡MCPï¼ŒCursorå¯ä»¥ä¸å„ç§å¤–éƒ¨å·¥å…·å’ŒæœåŠ¡è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿã€æµè§ˆå™¨ç­‰ï¼Œä»è€Œ

ä½¿AIåŠ©æ‰‹å…·å¤‡æ›´å¼ºçš„ç¯å¢ƒæ„ŸçŸ¥å’Œæ“ä½œèƒ½åŠ›ã€‚

# ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯ä»¥åœ¨Cursorä¸­é€šè¿‡è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼Œç›´æ¥è®©AIåŠ©æ‰‹è®¿é—®æ•°æ®åº“æŸ¥è¯¢æ•°æ®ã€è°ƒç”¨æµè§ˆå™¨

# è¿›è¡Œç½‘é¡µæœç´¢ï¼Œç”šè‡³æ§åˆ¶Blenderç­‰ä¸“ä¸šè½¯ä»¶è¿›è¡Œ3Då»ºæ¨¡æ“ä½œã€‚è¿™ç§æ·±åº¦é›†æˆä½¿å¾—å¼€å‘è€…æ— éœ€ç¦»å¼€

# Cursorç¼–è¾‘å™¨ï¼Œå°±èƒ½å®Œæˆä»¥å¾€éœ€è¦åœ¨å¤šä¸ªå·¥å…·ä¹‹é—´åˆ‡æ¢æ‰èƒ½å®Œæˆçš„ä»»åŠ¡ï¼Œå¤§å¤§æå‡äº†å¼€å‘æ•ˆç‡å’Œå·¥ä½œæµ

# çš„è¿è´¯æ€§ã€‚

# æ€»ä¹‹ï¼ŒCursorç»“åˆMCPåè®®ï¼Œä¸ºå¼€å‘è€…æ‰“é€ äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”é«˜åº¦å¯æ‰©å±•çš„æ™ºèƒ½ç¼–ç ç¯å¢ƒï¼Œä½¿AIåŠ©

# æ‰‹ä¸ä»…èƒ½ç†è§£å’Œç”Ÿæˆä»£ç ï¼Œè¿˜èƒ½ä¸å¹¿æ³›çš„å¤–éƒ¨å·¥å…·å’ŒæœåŠ¡ååŒå·¥ä½œï¼ŒçœŸæ­£å®ç°äº†æ™ºèƒ½åŒ–çš„å¼€å‘ä½“éªŒã€‚

# cursorä¸­å›½åŒºå®˜ç½‘ï¼šhttps://www.cursor.com/cn

![Image](pdf_images\page70_img1.png)

![Image](pdf_images\page70_img2.png)

![Image](pdf_images\page70_img3.png)

# cursor 0219åŠ å…¥MCPåŠŸèƒ½æ›´æ–°å…¬å‘Šï¼šhttps://www.cursor.com/cn/changelog/agent-is-ready-an

# d-ui-refresh?utm_source=chatgpt.com

# 1.Cursorå®‰è£…ä¸Agentæ¨¡å¼å¼€å¯

# 1.1 Cursorå®‰è£…æµç¨‹

![Image](pdf_images\page72_img1.png)

![Image](pdf_images\page72_img2.png)

# 1.2 Cursor Agentè°ƒç”¨æ¨¡å¼

# Cursorçš„AgentåŠŸèƒ½æ˜¯å…¶ç¼–è¾‘å™¨ä¸­çš„ä¸€é¡¹æ ¸å¿ƒç‰¹æ€§ï¼Œæ—¨åœ¨é€šè¿‡æ·±åº¦é›†æˆäººå·¥æ™ºèƒ½æŠ€æœ¯ï¼Œä¸»åŠ¨ä¸å¼€å‘

# è€…çš„ä»£ç åº“äº¤äº’ï¼Œæä¾›ä¸Šä¸‹æ–‡ç›¸å…³çš„å»ºè®®ã€ä»£ç ç”Ÿæˆå’Œæ“ä½œæ”¯æŒã€‚Agentæ¨¡å¼çš„è®¾è®¡ç›®æ ‡æ˜¯æˆä¸ºå¼€å‘è€…çš„

# â€œæ™ºèƒ½ç¼–ç¨‹ä¼™ä¼´â€ï¼Œå¸®åŠ©å®Œæˆå¤æ‚ä»»åŠ¡å¹¶æå‡å¼€å‘æ•ˆç‡ã€‚

# Agentæ¨¡å¼çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

è‡ªåŠ¨ä¸Šä¸‹æ–‡æå–ï¼šAgentä¼šè‡ªåŠ¨ä»ä»£ç åº“ä¸­æå–ç›¸å…³ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½é—®é¢˜æˆ–ç”Ÿæˆ ä»£ç ã€‚ (cid:0)cite(cid:0)turn0search0(cid:0)(cid:0)

![Image](pdf_images\page73_img1.png)

![Image](pdf_images\page73_img2.png)

## è¿è¡Œç»ˆç«¯å‘½ä»¤ï¼šæ— éœ€ç¦»å¼€ç¼–è¾‘å™¨ï¼Œå³å¯ç›´æ¥è¿è¡Œå‘½ä»¤è¡Œæ“ä½œã€‚

## æ–‡ä»¶æ“ä½œï¼šæ”¯æŒæ–‡ä»¶åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ç­‰æ“ä½œï¼Œç®€åŒ–å¼€å‘æµç¨‹ã€‚

# è¯­ä¹‰æœç´¢ï¼šé€šè¿‡ä»£ç è¯­ä¹‰æœç´¢åŠŸèƒ½ï¼Œå¿«é€Ÿæ‰¾åˆ°å…³é”®ä»£ç ç‰‡æ®µã€‚

# å¯ç”¨Agentæ¨¡å¼éå¸¸ç®€å•ï¼Œåªéœ€ä½¿ç”¨å¿«æ·é”® âŒ˜. ï¼ˆMacï¼‰æˆ– Ctrl + . ï¼ˆWindows/Linuxï¼‰ï¼Œå³å¯æ¿€æ´»

# AgentåŠŸèƒ½ã€‚åœ¨Agentæ¨¡å¼ä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæˆ–å¿«æ·é”®æ‰§è¡Œä¸Šä¸‹æ–‡ç®¡ç†ã€ç»ˆç«¯æ“ä½œå’Œæ–‡ä»¶äº¤äº’ç­‰æ“ ä½œã€‚

# ä¾‹å¦‚ï¼Œåœ¨ä»£ç é‡æ„åœºæ™¯ä¸­ï¼ŒAgentä¼šæ ¹æ®ä»£ç åº“ä¸Šä¸‹æ–‡æä¾›ä¼˜åŒ–å»ºè®®ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆæ›¿ä»£ä»£ç ã€‚å½“ä»£ç å‡ºç°

# é”™è¯¯æ—¶ï¼ŒAgentä¸ä»…ä¼šæ ‡æ³¨é—®é¢˜ï¼Œè¿˜ä¼šæä¾›è¯¦ç»†çš„ä¿®å¤å»ºè®®ï¼Œå¹¶è‡ªåŠ¨ä¿®å¤ã€‚é€šè¿‡Agentæ¨¡å¼ï¼ŒCursoræ—¨åœ¨

# ä¸ºå¼€å‘è€…æä¾›ä¸€ä¸ªæ™ºèƒ½ã€é«˜æ•ˆçš„ç¼–ç¨‹ç¯å¢ƒï¼Œå‡å°‘æ‰‹åŠ¨æ“ä½œï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚

# å…·ä½“å¼€å¯æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š

![Image](pdf_images\page74_img1.png)

![Image](pdf_images\page74_img2.png)

## ç„¶ååœ¨å½“å‰é¡µé¢å®Œæˆè®¢é˜…ï¼š

# ç„¶åå³å¯é‡‡ç”¨Agentæ¨¡å¼è¿›è¡Œå¯¹è¯ï¼š

# Cursor ç¼–è¾‘å™¨æä¾›ä¸‰ç§å¯¹è¯æ¨¡å¼ï¼šAskã€Agent å’Œ Manualï¼Œæ¯ç§æ¨¡å¼é€‚ç”¨äºä¸åŒçš„å¼€å‘éœ€æ±‚ã€‚

1. Ask æ¨¡å¼ï¼š æ­¤æ¨¡å¼ä¸»è¦ç”¨äºæ¢ç´¢å’Œäº†è§£ä»£ç åº“ï¼Œè€Œä¸ä¼šå¯¹ä»£ç è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚å¼€å‘è€…å¯ä»¥åœ¨è¯¥æ¨¡å¼ä¸‹

å‘ AI æé—®ï¼Œè·å–å…³äºä»£ç çš„è§£é‡Šã€åŠŸèƒ½è¯´æ˜æˆ–å»ºè®®ã€‚è¯¥æ¨¡å¼æ˜¯â€œåªè¯»â€çš„ï¼Œä¸ä¼šä¸»åŠ¨æ›´æ”¹ä»£ç ã€‚

2. Agent æ¨¡å¼ï¼š è¿™æ˜¯ Cursor ä¸­æœ€ä¸ºè‡ªä¸»çš„æ¨¡å¼ï¼Œè®¾è®¡ç”¨äºå¤„ç†å¤æ‚çš„ç¼–ç ä»»åŠ¡ï¼Œå…·æœ‰å…¨é¢çš„å·¥å…·è®¿é—®

# æƒé™ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼ŒAgent å¯ä»¥è‡ªä¸»æ¢ç´¢ä»£ç åº“ã€è¯»å–æ–‡æ¡£ã€æµè§ˆç½‘é¡µã€ç¼–è¾‘æ–‡ä»¶ï¼Œå¹¶è¿è¡Œç»ˆç«¯å‘½ä»¤ï¼Œ ä»¥é«˜æ•ˆå®Œæˆä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯ä»¥æŒ‡ç¤º Agent æ·»åŠ æ–°åŠŸèƒ½æˆ–é‡æ„ä»£ç ï¼ŒAgent å°†è‡ªåŠ¨æ‰§è¡Œç›¸å…³æ“ä½œã€‚

3. Manual æ¨¡å¼ï¼š æ­¤æ¨¡å¼å…è®¸å¼€å‘è€…æ‰‹åŠ¨æ§åˆ¶ AI å¯¹ä»£ç çš„ä¿®æ”¹ã€‚å¼€å‘è€…å¯ä»¥é€‰æ‹©ç‰¹å®šçš„ä»£ç ç‰‡æ®µï¼Œæè¿° å¸Œæœ›è¿›è¡Œçš„æ›´æ”¹ï¼ŒAI å°†æ ¹æ®æè¿°æä¾›ä¿®æ”¹å»ºè®®ï¼Œå¼€å‘è€…å¯ä»¥é€‰æ‹©æ˜¯å¦åº”ç”¨è¿™äº›æ›´æ”¹ã€‚è¯¥æ¨¡å¼é€‚ç”¨äºéœ€è¦ ç²¾ç¡®æ§åˆ¶ä»£ç ä¿®æ”¹çš„åœºæ™¯ã€‚

![Image](pdf_images\page75_img1.png)

## 2.å°†æ–°ç‰ˆCursoræ¥å…¥MCP

# Cursoræ¥å…¥MCPçš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œæˆ‘ä»¬é¦–å…ˆå°è¯•å°†æ›´åŠ è§„èŒƒã€ç»´æŠ¤æ›´å¥½çš„Smitheryå¹³å°ä¸Šçš„MCPå·¥

# å…·æ¥å…¥Cursorï¼Œç„¶åå†æ¥å…¥GitHub MCPå·¥å…·ã€‚

# https://smithery.ai/

# Smithery æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç®¡ç†å’Œåˆ†å‘ MCPï¼ˆModel Context Protocolï¼‰æœåŠ¡å™¨çš„å¹³å°ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…

# å’Œ AI æ¨¡å‹è½»æ¾å‘ç°ã€å®‰è£…å’Œç®¡ç†å„ç§ MCP æœåŠ¡å™¨ã€‚Smithery å¹³å°ä¸Šçš„ MCP å·¥å…·ä¸ GitHub ä¸Šçš„ MCP å·¥å…·çš„å¯¹æ¯”ï¼š

1. æ‰˜ç®¡æ–¹å¼ï¼š

# Smithery å¹³å°ï¼šæä¾›ä¸¤ç§æ¨¡å¼çš„ MCP æœåŠ¡å™¨ï¼š

# è¿œç¨‹ï¼ˆRemoteï¼‰/ æ‰˜ç®¡ï¼ˆHostedï¼‰ï¼šè¿™äº›æœåŠ¡å™¨ç”± Smithery åœ¨å…¶åŸºç¡€è®¾æ–½ä¸Šè¿è¡Œï¼Œç”¨

# æˆ·é€šè¿‡ç½‘ç»œè®¿é—®ã€‚

# æœ¬åœ°ï¼ˆLocalï¼‰ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡ Smithery çš„ CLI å·¥å…·å°† MCP æœåŠ¡å™¨å®‰è£…å¹¶è¿è¡Œåœ¨æœ¬åœ°ç¯

# å¢ƒä¸­ã€‚

# GitHubï¼šä¸»è¦æä¾› MCP æœåŠ¡å™¨çš„æºä»£ç ï¼Œå¼€å‘è€…éœ€è¦è‡ªè¡Œä¸‹è½½ã€é…ç½®å¹¶åœ¨æœ¬åœ°æˆ–è‡ªæœ‰æœåŠ¡å™¨

# ä¸Šè¿è¡Œã€‚

2. å®‰è£…ä¸ç®¡ç†ï¼š

# Smithery å¹³å°ï¼šæä¾›ç»Ÿä¸€çš„ç•Œé¢å’Œ CLI å·¥å…·ï¼Œç®€åŒ–äº† MCP æœåŠ¡å™¨çš„å‘ç°ã€å®‰è£…å’Œç®¡ç†è¿‡ ç¨‹ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ç®€å•çš„å‘½ä»¤æˆ–ç•Œé¢æ“ä½œå®ŒæˆæœåŠ¡å™¨çš„éƒ¨ç½²å’Œé…ç½®ã€‚

# GitHubï¼šå¼€å‘è€…éœ€è¦æ‰‹åŠ¨å…‹éš†ä»“åº“ã€å®‰è£…ä¾èµ–é¡¹ï¼Œå¹¶æ ¹æ®æä¾›çš„æ–‡æ¡£è¿›è¡Œé…ç½®å’Œè¿è¡Œï¼Œè¿‡ç¨‹

# ç›¸å¯¹ç¹çï¼Œéœ€è¦æ›´å¤šçš„æŠ€æœ¯èƒŒæ™¯çŸ¥è¯†ã€‚

3. å®‰å…¨æ€§ä¸æ§åˆ¶ï¼š

# Smithery å¹³å°ï¼šå¯¹äºæ‰˜ç®¡çš„ MCP æœåŠ¡å™¨ï¼ŒSmithery å£°æ˜å…¶é…ç½®å‚æ•°ï¼ˆå¦‚è®¿é—®ä»¤ç‰Œï¼‰æ˜¯ä¸´æ—¶

# çš„ï¼Œä¸ä¼šé•¿æœŸå­˜å‚¨åœ¨å…¶æœåŠ¡å™¨ä¸Šã€‚ ç„¶è€Œï¼Œç”¨æˆ·éœ€ä¿¡ä»» Smithery çš„æ•°æ®å¤„ç†æ”¿ç­–ã€‚

# GitHubï¼šå¼€å‘è€…å®Œå…¨æ§åˆ¶ MCP æœåŠ¡å™¨çš„ä»£ç å’Œè¿è¡Œç¯å¢ƒï¼Œå¯ä»¥è‡ªè¡Œå®¡æŸ¥ä»£ç ï¼Œç¡®ä¿å®‰å…¨æ€§å’Œ

# éšç§æ€§ã€‚

4. ç¤¾åŒºä¸æ”¯æŒï¼š

Smithery å¹³å°ï¼šä½œä¸º MCP æœåŠ¡å™¨çš„é›†ä¸­ç®¡ç†å¹³å°ï¼ŒSmithery èšé›†äº†å¤§é‡çš„ MCP æœåŠ¡å™¨ï¼Œ æ–¹ä¾¿å¼€å‘è€…æŸ¥æ‰¾å’Œä½¿ç”¨ã€‚

![Image](pdf_images\page76_img1.png)

![Image](pdf_images\page76_img2.png)

![Image](pdf_images\page76_img3.png)

## GitHubï¼šä½œä¸ºå…¨çƒæœ€å¤§çš„å¼€æºå¹³å°ï¼Œæ‹¥æœ‰å¹¿æ³›çš„ç¤¾åŒºæ”¯æŒï¼Œå¼€å‘è€…å¯ä»¥åœ¨ç›¸å…³ä»“åº“çš„ issue

## åŒºåŸŸæå‡ºé—®é¢˜æˆ–è´¡çŒ®ä»£ç ã€‚

# 2.1 å®‰è£…åŸºç¡€ä¾èµ–

# MCP å·¥å…·ä¾èµ–äº Node.js å’Œ npmï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¯¹å…¶è¿›è¡Œå®‰è£…ã€‚Windowsä¸‹å¯ä»¥åœ¨å®˜ç½‘ä¸Šè¿›è¡Œä¸‹è½½

# å®‰è£…ï¼šhttps://nodejs.org/zh-cn

# åœ¨ä½¿ç”¨ Model Context Protocolï¼ˆMCPï¼‰æ—¶ï¼Œæ˜¯å¦éœ€è¦å®‰è£… Node.js å–å†³äºæ‚¨æ‰€é€‰æ‹©çš„ MCP æœåŠ¡

# å™¨çš„å®ç°æ–¹å¼ã€‚MCP æ˜¯ä¸€ä¸ªå¼€æ”¾åè®®ï¼Œå…è®¸å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºè¿›è¡Œæ ‡å‡†åŒ–äº¤

# äº’ã€‚ä¸åŒçš„ MCP æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨å¤šç§ç¼–ç¨‹è¯­è¨€å®ç°ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Node.jsã€Python å’Œ Javaã€‚è€Œç›®å‰

# Node.js å®ç°çš„ MCP æœåŠ¡å™¨ï¼šè®¸å¤šå¼€å‘è€…é€‰æ‹©ä½¿ç”¨ Node.js æ¥å®ç° MCP æœåŠ¡å™¨ï¼Œä¸»è¦å› ä¸ºå…¶æ‹¥æœ‰ä¸°å¯Œ

# çš„åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿï¼ˆå¦‚ npmï¼‰ï¼Œä»¥åŠåœ¨å¤„ç†å¼‚æ­¥æ“ä½œå’Œ I/O å¯†é›†å‹ä»»åŠ¡æ–¹é¢çš„é«˜æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œå¼€å‘è€…å¯ ä»¥ä½¿ç”¨ Node.js å¿«é€Ÿæ­å»ºä¸€ä¸ª MCP æœåŠ¡å™¨ï¼Œä»¥æä¾›ç‰¹å®šçš„åŠŸèƒ½æˆ–å·¥å…·ã€‚

å…·ä½“å®‰è£…è¿‡ç¨‹ä¸€è·¯ç‚¹å‡»ä¸‹ä¸€æ­¥å³å¯ï¼š

![Image](pdf_images\page77_img1.png)

![Image](pdf_images\page77_img2.png)

# ç„¶åä½¿ç”¨pipå®‰è£…uvï¼š

# pip install uv

# å®‰è£…å®Œæˆåå³å¯åœ¨cursorä¸­æŸ¥çœ‹å®‰è£…ç»“æœï¼š

# node -v

npm -v

# pip show uv

![Image](pdf_images\page78_img1.png)

![Image](pdf_images\page78_img2.png)

## 2.2 å°è¯•ä¸ºCursoræ·»åŠ MCPå·¥å…·

# Sequential Thinking æ˜¯ä¸€ä¸ªåŸºäº Model Context Protocolï¼ˆMCPï¼‰çš„æœåŠ¡å™¨å·¥å…·ï¼Œæ—¨åœ¨é€šè¿‡ç»“æ„

# åŒ–çš„æ€ç»´æµç¨‹ï¼Œå¸®åŠ©ç”¨æˆ·åŠ¨æ€ã€åæ€æ€§åœ°è§£å†³å¤æ‚é—®é¢˜ã€‚ è¯¥å·¥å…·å°†é—®é¢˜æ‹†è§£ä¸ºå¯ç®¡ç†çš„æ­¥éª¤ï¼Œæ¯ä¸ªæ­¥éª¤ éƒ½å¯ä»¥å»ºç«‹åœ¨å…ˆå‰çš„è§è§£ä¹‹ä¸Šï¼Œæˆ–å¯¹å…¶è¿›è¡Œè´¨ç–‘å’Œä¿®æ­£ï¼Œä»è€Œé€æ­¥æ·±åŒ–å¯¹é—®é¢˜çš„ç†è§£ï¼Œæœ€ç»ˆå½¢æˆå…¨é¢çš„

# è§£å†³æ–¹æ¡ˆã€‚

![Image](pdf_images\page79_img1.png)

![Image](pdf_images\page79_img2.png)

# ç„¶åæ‰“å¼€cursorï¼š

# å¹¶å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š

![Image](pdf_images\page80_img1.png)

## "server-sequential-thinking": {

## "command": "cmd",

# "args": [

"/c",

"npx",

"-y",

"@smithery/cli@latest",

"run",

"@smithery-ai/server-sequential-thinking",

"--key",

"..."

]

}

# ç„¶åå›åˆ°MCP Serversé¡µé¢ï¼Œç­‰å¾…éªŒè¯ï¼š

![Image](pdf_images\page81_img1.png)

![Image](pdf_images\page81_img2.png)

# éªŒè¯é€šè¿‡åï¼Œå³å¯å¼€å¯è‡ªåŠ¨è°ƒç”¨å·¥å…·é€‰é¡¹ï¼š

# ç‚¹å‡»ç¡®è®¤ï¼š

![Image](pdf_images\page82_img1.png)

![Image](pdf_images\page82_img2.png)

# ç„¶åè¿›è¡Œç®€å•é—®ç­”æµ‹è¯•ï¼ŒæŸ¥çœ‹èƒ½å¦é¡ºåˆ©è°ƒç”¨å·¥å…·ï¼š

# è¯·é—®strawberryæœ‰å‡ ä¸ªrï¼Ÿè¯·å…ˆè°ƒç”¨sequential-thinking MCPå·¥å…·è¿›è¡Œæ€è€ƒï¼Œç„¶åå†å›ç­”ã€‚

# 2.4 æ·»åŠ Playwright MCP

# Playwright Automation æ˜¯ä¸€ä¸ªåŸºäº Model Context Protocolï¼ˆMCPï¼‰çš„æœåŠ¡å™¨å·¥å…·ï¼Œåˆ©ç”¨

# Microsoft å¼€å‘çš„å¼€æºæµè§ˆå™¨è‡ªåŠ¨åŒ–åº“ Playwrightï¼Œä¸ºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰å’Œ AI åŠ©æ‰‹æä¾›ä¸ç½‘é¡µäº¤äº’ çš„èƒ½åŠ›ã€‚

ä¸»è¦åŠŸèƒ½ï¼š

![Image](pdf_images\page83_img1.png)

![Image](pdf_images\page83_img2.png)

## ç½‘é¡µå¯¼èˆªä¸äº¤äº’ï¼šè‡ªåŠ¨æ‰§è¡Œç½‘é¡µå¯¼èˆªã€ç‚¹å‡»ã€è¡¨å•å¡«å†™ç­‰æ“ä½œï¼Œæ”¯æŒå¤æ‚çš„ç”¨æˆ·è¡Œä¸ºæ¨¡æ‹Ÿã€‚

## å†…å®¹æå–ä¸ç½‘é¡µæŠ“å–ï¼šä»ç½‘é¡µä¸­æå–ç»“æ„åŒ–æ•°æ®ï¼Œé€‚ç”¨äºä¿¡æ¯æ£€ç´¢å’Œå†…å®¹åˆ†æã€‚

# æˆªå›¾ä¸å¯è§†åŒ–ï¼šæ•è·ç½‘é¡µæˆ–ç‰¹å®šå…ƒç´ çš„æˆªå›¾ï¼Œä¾¿äºè°ƒè¯•å’Œç»“æœå±•ç¤ºã€‚

# JavaScript æ‰§è¡Œï¼šåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œè‡ªå®šä¹‰ JavaScript ä»£ç ï¼Œæ»¡è¶³ç‰¹å®šçš„äº¤äº’éœ€æ±‚ã€‚

# Playwright Automationä¸»é¡µï¼šhttps://smithery.ai/server/@microsoft/playwright-mcp

# ç„¶åéœ€è¦åœ¨é…ç½®é¡µé¢å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š

![Image](pdf_images\page84_img1.png)

## "playwright-mcp": {

## "command": "cmd",

# "args": [

"/c",

"npx",

"-y",

"@smithery/cli@latest",

"run",

"@microsoft/playwright-mcp",

"--key",

"......"

]

}

![Image](pdf_images\page85_img1.png)

![Image](pdf_images\page85_img2.png)

# ç„¶åè¾“å…¥å¦‚ä¸‹é—®é¢˜ï¼š

# ä½ å¥½ï¼Œè¯·å¸®æˆ‘æŸ¥æ‰¾MCPï¼ˆModel Context Protocolï¼‰æŠ€æœ¯çš„ç›¸å…³å†…å®¹ï¼Œå¹¶åˆ¶ä½œä¸€ä»½ç®€æ˜“çš„å…¥é—¨çº§è°ƒç ”æŠ¥

# å‘Šï¼ŒMCPå®˜ç½‘åœ°å€åœ¨@https://github.com/modelcontextprotocol ã€‚ä½ å¯ä»¥ä½¿ç”¨server-

# sequential-thinkingè¿›è¡Œæ€è€ƒï¼Œå¹¶ä½¿ç”¨playwright-mcpè¿›è¡Œç½‘ç»œä¿¡æ¯è·å–ã€‚

æ­¤æ—¶MCPå·¥å…·ä¼šè‡ªåŠ¨æ‰“å¼€ç½‘é¡µè¿›è¡Œåˆ˜å…°å…°ï¼Œç„¶åæ¢³ç†æ€»ç»“æŠ¥å‘Šå†…å®¹ï¼š

![Image](pdf_images\page86_img1.png)

## 2.4 æ·»åŠ FileSystemå·¥å…·

# FileSystemå·¥å…·ï¼šhttps://github.com/modelcontextprotocol/servers/tree/main/src/filesystem

# Filesystem MCP æ˜¯ä¸€ä¸ªåŸºäº Model Context Protocolï¼ˆMCPï¼‰çš„æœåŠ¡å™¨å·¥å…·ï¼Œæ—¨åœ¨ä¸ºå¤§å‹è¯­è¨€æ¨¡å‹

# ï¼ˆLLMsï¼‰å’Œ AI åŠ©æ‰‹æä¾›å¯¹æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„å®‰å…¨ã€å—æ§è®¿é—®ã€‚

# ä¸»è¦åŠŸèƒ½ï¼š

# æ–‡ä»¶è¯»å†™ï¼šå…è®¸è¯»å–å’Œå†™å…¥æ–‡ä»¶å†…å®¹ï¼Œæ”¯æŒåˆ›å»ºæ–°æ–‡ä»¶æˆ–è¦†ç›–ç°æœ‰æ–‡ä»¶ã€‚

# ç›®å½•ç®¡ç†ï¼šæ”¯æŒåˆ›å»ºã€åˆ—å‡ºå’Œåˆ é™¤ç›®å½•ï¼Œä»¥åŠç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•ã€‚

# æ–‡ä»¶æœç´¢ï¼šèƒ½å¤Ÿåœ¨æŒ‡å®šè·¯å¾„ä¸­æœç´¢åŒ¹é…ç‰¹å®šæ¨¡å¼çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚

# å…ƒæ•°æ®è·å–ï¼šæä¾›è·å–æ–‡ä»¶æˆ–ç›®å½•çš„è¯¦ç»†å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬å¤§å°ã€åˆ›å»ºæ—¶é—´ã€ä¿®æ”¹æ—¶é—´ã€è®¿é—®æ—¶é—´ã€ç±»

# å‹å’Œæƒé™ç­‰ä¿¡æ¯ã€‚

# è°ƒç”¨è¿‡ç¨‹å¦‚ä¸‹ï¼Œéœ€è¦å†™å…¥å¦‚ä¸‹é…ç½®ï¼š

# "filesystem": {

"command": "cmd",

# "args": [

"/c",

"npx",

"-y",

"@modelcontextprotocol/server-filesystem",

# "run", "C:/Users/Administrator/Desktop/æœ€æ–°æµé‡è§†é¢‘/MCPä½“éªŒè¯¾/MCPTest"

]

}

![Image](pdf_images\page87_img1.png)

![Image](pdf_images\page87_img2.png)

# ç„¶åè¿›è¡Œæµ‹è¯•ï¼š

# éå¸¸å¥½ï¼Œæ¥ä¸‹æ¥è¯·æŠŠä½ çš„è¿™ä»½è°ƒç ”æŠ¥å‘Šï¼Œè°ƒç”¨filesystemå·¥å…·ï¼Œä»¥mdæ ¼å¼å†™å…¥æœ¬åœ°æ–‡ä»¶ï¼Œå¹¶å–åä¸ºMCPæŠ€æœ¯åˆ

# çº§è°ƒç ”æŠ¥å‘Š

![Image](pdf_images\page88_img1.png)

![Image](pdf_images\page88_img2.png)

# ä¸‰ã€ä¸ªäººåŠ©ç†Cherry Studioæ¥å…¥MCPå®ç°æµç¨‹

# Cherry Studio æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„æ¡Œé¢å®¢æˆ·ç«¯ï¼Œæ”¯æŒä¸å¤šç§å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æœåŠ¡å•†çš„æ— ç¼é›†

æˆï¼ŒåŒ…æ‹¬ OpenAIã€Geminiã€Anthropic ç­‰ï¼ŒåŒæ—¶å…¼å®¹æœ¬åœ°æ¨¡å‹ï¼Œå¦‚é€šè¿‡ Ollama å’Œ LM Studio éƒ¨ç½²çš„ æ¨¡å‹ã€‚è¯¥åº”ç”¨é€‚ç”¨äº Windowsã€Mac å’Œ Linux æ“ä½œç³»ç»Ÿï¼Œæä¾›äº†ä¸°å¯Œçš„ä¸ªæ€§åŒ–é€‰é¡¹å’Œå…ˆè¿›çš„åŠŸèƒ½ï¼Œæ—¨åœ¨

å¸®åŠ©ç”¨æˆ·åœ¨å„ç§åœºæ™¯ä¸‹æå‡å·¥ä½œæ•ˆç‡ã€‚

![Image](pdf_images\page89_img1.png)

## ä¸»è¦åŠŸèƒ½ï¼š

å¤šæ¨¡å‹æ”¯æŒï¼šç”¨æˆ·å¯ä»¥å¿«é€Ÿåœ¨ä¸åŒçš„ LLM ä¹‹é—´åˆ‡æ¢ï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚

# AI åŠ©æ‰‹ä¸å¯¹è¯ï¼šå†…ç½®è¶…è¿‡ 300 ä¸ªé¢„é…ç½®çš„ AI åŠ©æ‰‹ï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰åŠ©æ‰‹åˆ›å»ºï¼Œæ–¹ä¾¿ç”¨æˆ·æ ¹æ®å…·ä½“ä»»

# åŠ¡å®šåˆ¶ä¸ªæ€§åŒ–åŠ©æ‰‹ã€‚

# æ–‡æ¡£ä¸æ•°æ®å¤„ç†ï¼šæ”¯æŒå¤„ç†å¤šç§æ–‡ä»¶æ ¼å¼ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€å›¾åƒã€Office æ–‡æ¡£å’Œ PDF ç­‰ï¼Œå†…ç½® WebDAV æ–‡ä»¶ç®¡ç†å’Œå¤‡ä»½åŠŸèƒ½ï¼Œæ–¹ä¾¿ç”¨æˆ·ç®¡ç†å’Œå¤‡ä»½æ–‡ä»¶ã€‚

å®ç”¨å·¥å…·é›†æˆï¼šæä¾›å…¨å±€æœç´¢ã€ä¸»é¢˜ç®¡ç†ã€AI é©±åŠ¨çš„ç¿»è¯‘ç­‰å®ç”¨å·¥å…·ï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚

æ¥å…¥ MCP çš„ä¼˜åŠ¿ï¼š

# é€šè¿‡é›†æˆ Model Context Protocolï¼ˆMCPï¼‰ï¼ŒCherry Studio çš„åŠŸèƒ½å¾—åˆ°äº†è¿›ä¸€æ­¥æ‰©å±•ã€‚MCP æ˜¯ä¸€

# ä¸ªå¼€æ”¾æ ‡å‡†åè®®ï¼Œæ—¨åœ¨ä¸º AI ç³»ç»Ÿä¸å¤–éƒ¨æ•°æ®æºä¹‹é—´å»ºç«‹æ ‡å‡†åŒ–çš„æ¥å£ã€‚é€šè¿‡ MCPï¼ŒCherry Studio èƒ½å¤Ÿ

ä¸å„ç§å¤–éƒ¨å·¥å…·å’ŒæœåŠ¡è¿›è¡Œäº¤äº’ï¼Œä¾‹å¦‚æ–‡ä»¶ç³»ç»Ÿã€æµè§ˆå™¨è‡ªåŠ¨åŒ–å·¥å…·ç­‰ï¼Œä»è€Œä½¿ AI åŠ©æ‰‹å…·å¤‡æ›´å¼ºçš„ç¯å¢ƒ æ„ŸçŸ¥å’Œæ“ä½œèƒ½åŠ›ã€‚

# ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥åœ¨ Cherry Studio ä¸­é€šè¿‡è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼Œç›´æ¥è®© AI åŠ©æ‰‹è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€è°ƒç”¨æµ

# è§ˆå™¨è¿›è¡Œç½‘é¡µæœç´¢ï¼Œç”šè‡³æ§åˆ¶å…¶ä»–ä¸“ä¸šè½¯ä»¶è¿›è¡Œç‰¹å®šæ“ä½œã€‚è¿™ç§æ·±åº¦é›†æˆä½¿å¾—ç”¨æˆ·æ— éœ€ç¦»å¼€ Cherry

# Studioï¼Œå°±èƒ½å®Œæˆä»¥å¾€éœ€è¦åœ¨å¤šä¸ªå·¥å…·ä¹‹é—´åˆ‡æ¢æ‰èƒ½å®Œæˆçš„ä»»åŠ¡ï¼Œå¤§å¤§æå‡äº†å·¥ä½œæ•ˆç‡å’Œå·¥ä½œæµçš„è¿è´¯

# æ€§ã€‚

# CherryStudioä¸»é¡µï¼šhttps://github.com/CherryHQ/cherry-studio

# 1.Cherry Studioå®‰è£…æµç¨‹

# CherryStudioæ–‡æ¡£é¡µï¼šhttps://docs.cherry-ai.com/cherry-studio/download

![Image](pdf_images\page91_img1.png)

![Image](pdf_images\page91_img2.png)

# ä¸‹è½½å®Œå³å¯è¿›å…¥å¯¹è¯é¡µé¢ï¼š

# ç„¶åæˆ‘ä»¬å¯ä»¥å°†æ¨¡å‹åˆ‡æ¢ä¸ºDeepSeekå®˜æ–¹çš„æ¨¡å‹APIï¼š

![Image](pdf_images\page92_img1.png)

![Image](pdf_images\page92_img2.png)

# ç„¶åå¼€å¯ï¼š

# å¹¶å°è¯•è¿›è¡Œä½¿ç”¨ï¼š

![Image](pdf_images\page93_img1.png)

![Image](pdf_images\page93_img2.png)

# åŒæ—¶ï¼Œä¸ºäº†èƒ½é¡ºåˆ©è°ƒç”¨MCPå·¥å…·ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£…uvå’Œbunæ–‡ä»¶ï¼š

![Image](pdf_images\page94_img1.png)

![Image](pdf_images\page94_img2.png)

![Image](pdf_images\page94_img3.png)

# è¿™é‡Œæ¨èæœ€å¿«é€Ÿçš„æ–¹æ³•æ˜¯ç›´æ¥ä»ç½‘ç›˜ä¸­è¿›è¡Œä¸‹è½½ï¼š

# ç„¶ååœ¨C:\Users{ç”¨æˆ·å}ä¸‹åˆ›å»º.cherrystudio\binç›®å½•ï¼Œå¹¶å°†ä¸Šé¢ä¸‰ä¸ª.exeæ–‡ä»¶ç§»å…¥å³å¯ã€‚

![Image](pdf_images\page95_img1.png)

# å…¶ä»–æ“ä½œç³»ç»Ÿé…ç½®è¯¦è§ï¼šhttps://docs.cherry-ai.com/advanced-basic/mcp/install

2. Cherry Studioæ¥å…¥MCPæµç¨‹

# æ¥ä¸‹æ¥å°è¯•æ¥å…¥filesystem MCPå·¥å…·ï¼šhttps://github.com/modelcontextprotocol/servers/tree/

# main/src/filesystem ã€‚

éœ€è¦åœ¨ç¼–è¾‘MCPé…ç½®é¡µé¢è¾“å…¥å¦‚ä¸‹å†…å®¹ï¼š

{

# "mcpServers": {

# "filesystem": {

"isActive": true,

"command": "npx",

# "args": [

"-y",

"@modelcontextprotocol/server-filesystem",

# "C:/Users/Administrator/Desktop/æœ€æ–°æµé‡è§†é¢‘/MCPä½“éªŒè¯¾/MCPTest"

],

# "name": "filesystem"

}

}

}

![Image](pdf_images\page96_img1.png)

![Image](pdf_images\page96_img2.png)

# ç„¶åç‚¹å‡»å¼€å¯ï¼š

ç„¶ååœ¨å¯¹è¯ä¸­å¼€å¯MCPå·¥å…·ï¼Œè¿™é‡Œå¯é€‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªå·¥å…·ï¼š

![Image](pdf_images\page98_img1.png)

![Image](pdf_images\page98_img2.png)

# åŒæ—¶å†å°è¯•æ¥å…¥fetch MCPå·¥å…·ï¼Œhttps://github.com/modelcontextprotocol/servers/tree/main/src/f

# etchï¼š

# Fetch MCP æœåŠ¡å™¨æ˜¯ä¸€ä¸ªéµå¾ªæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆModel Context Protocolï¼ŒMCPï¼‰çš„æœåŠ¡å™¨å·¥å…·ï¼Œæ—¨åœ¨

# ä¸ºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰æä¾›ä»äº’è”ç½‘æ£€ç´¢å’Œå¤„ç†ç½‘é¡µå†…å®¹çš„èƒ½åŠ›ã€‚é€šè¿‡å°†ç½‘é¡µçš„ HTML å†…å®¹è½¬æ¢ä¸º

# Markdown æ ¼å¼ï¼ŒFetch MCP ä½¿å¾— LLMs èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ç†è§£å’Œåˆ©ç”¨ç½‘é¡µä¿¡æ¯ã€‚

# ä¸»è¦åŠŸèƒ½ï¼š

# ç½‘é¡µå†…å®¹è·å–ä¸è½¬æ¢ï¼šFetch MCP æä¾›äº† fetch å·¥å…·ï¼Œå¯ä»æŒ‡å®šçš„ URL è·å–ç½‘é¡µå†…å®¹ï¼Œå¹¶å°†å…¶æ

# å–ä¸º Markdown æ ¼å¼ï¼Œæ–¹ä¾¿ LLMs æ¶ˆåŒ–å’Œå¤„ç†ã€‚

# æ”¯æŒå¤šç§å†…å®¹æ ¼å¼ï¼šé™¤äº† Markdownï¼ŒFetch MCP è¿˜æ”¯æŒè·å–ç½‘é¡µçš„ HTMLã€JSON å’Œçº¯æ–‡æœ¬æ ¼

# å¼ï¼Œæ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚

# å†…å®¹æˆªå–ä¸åˆ†é¡µï¼šé€šè¿‡ start_index å‚æ•°ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šä»ç½‘é¡µå†…å®¹çš„ç‰¹å®šä½ç½®å¼€å§‹æå–ï¼Œå…è®¸

# æ¨¡å‹åˆ†æ®µè¯»å–ç½‘é¡µï¼Œç›´åˆ°æ‰¾åˆ°æ‰€éœ€ä¿¡æ¯ã€‚

åŒæ ·æˆ‘ä»¬éœ€è¦åœ¨MCPé…ç½®é¡µé¢å†™å…¥å¦‚ä¸‹å†…å®¹

![Image](pdf_images\page99_img1.png)

![Image](pdf_images\page99_img2.png)

## "fetch": {

## "command": "uvx",

"args": ["mcp-server-fetch"]

}

# ç„¶åå¼€å¯å·¥å…·ï¼š

# å¹¶å°è¯•è¿›è¡Œè°ƒç”¨ï¼š

![Image](pdf_images\page100_img1.png)

![Image](pdf_images\page100_img2.png)

# å››ã€é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°æ¥å…¥MCP

# é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°ï¼šhttps://bailian.console.aliyun.com/#/home

1. é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°ä»‹ç»

# é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°æ˜¯ä¸€æ¬¾ä¸€ç«™å¼çš„å¤§æ¨¡å‹å¼€å‘åŠåº”ç”¨æ„å»ºå¹³å°ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…å’Œä¸šåŠ¡äººå‘˜å¿«é€Ÿè®¾è®¡

# å’Œæ„å»ºå¤§æ¨¡å‹åº”ç”¨ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ç®€æ´çš„ç•Œé¢æ“ä½œï¼Œåœ¨çŸ­æ—¶é—´å†…å¼€å‘å‡ºå¤§æ¨¡å‹åº”ç”¨æˆ–è®­ç»ƒä¸“å±æ¨¡å‹ï¼Œä»

# è€Œå°†æ›´å¤šç²¾åŠ›ä¸“æ³¨äºåº”ç”¨åˆ›æ–°ã€‚

# è¿‘æœŸï¼Œé˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°æ­£å¼æ¨å‡ºäº†å…¨ç”Ÿå‘½å‘¨æœŸçš„MCPï¼ˆModel-Connect-Protocolï¼‰æœåŠ¡ï¼Œå®ç°äº†ä»

# èµ„æºç®¡ç†åˆ°éƒ¨ç½²è¿ç»´çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚ç”¨æˆ·ä»…éœ€5åˆ†é’Ÿå³å¯å¿«é€Ÿåˆ›å»ºè¿æ¥MCPæœåŠ¡çš„æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ï¼Œ å°†å¤§æ¨¡å‹æŠ€æœ¯è½¬åŒ–ä¸ºç”Ÿäº§åŠ›å·¥å…·ã€‚é¦–æ‰¹é›†æˆäº†åŒ…æ‹¬é«˜å¾·åœ°å›¾ã€æ— å½±ã€Fetchã€Notionç­‰50ä½™æ¬¾é˜¿é‡Œå·´å·´é›†

å›¢åŠç¬¬ä¸‰æ–¹MCPæœåŠ¡ï¼Œè¦†ç›–ç”Ÿæ´»æœåŠ¡ã€åŠå…¬ååŒã€å†…å®¹åˆ›ä½œç­‰å¤šä¸ªé¢†åŸŸã€‚

![Image](pdf_images\page101_img1.png)

## æ¥å…¥MCPçš„ä¼˜åŠ¿ï¼š

1. å¿«é€Ÿå¼€å‘ä¸éƒ¨ç½²ï¼šé€šè¿‡MCPæœåŠ¡ï¼Œç”¨æˆ·æ— éœ€ç®¡ç†èµ„æºã€å¼€å‘éƒ¨ç½²å’Œå·¥ç¨‹è¿ç»´ç­‰å¤æ‚å·¥ä½œï¼Œå¯åœ¨çŸ­æ—¶

# é—´å†…æ­å»ºå¹¶ä¸Šçº¿æ™ºèƒ½ä½“åº”ç”¨ã€‚

2. ä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿï¼šç™¾ç‚¼å¹³å°æ•´åˆäº†200å¤šæ¬¾ä¸šç•Œé¢†å…ˆçš„å¤§æ¨¡å‹å’Œé˜¿é‡Œäº‘å‡½æ•°è®¡ç®—èµ„æºï¼Œä»¥åŠä¼—å¤š

MCPæœåŠ¡ï¼Œæä¾›ä¸€ç«™å¼æ™ºèƒ½ä½“å¼€å‘è§£å†³æ–¹æ¡ˆï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„åº”ç”¨éœ€æ±‚ã€‚

3. æ·±åº¦åœºæ™¯åŒ–å®šåˆ¶ï¼šä¸å¸‚åœºä¸Šé€šç”¨çš„Agentåº”ç”¨ä¸åŒï¼Œç™¾ç‚¼MCPæœåŠ¡æ”¯æŒæ·±åº¦åœºæ™¯åŒ–å®šåˆ¶ã€‚ç”¨æˆ·æ— éœ€

# ç¼–å†™ä»£ç ï¼Œé€šè¿‡ç®€å•çš„å¯è§†åŒ–é…ç½®å³å¯æ‰“é€ å…·å¤‡è‡ªä¸»æ€è€ƒã€ä»»åŠ¡æ‹†è§£å’Œå†³ç­–æ‰§è¡Œç­‰èƒ½åŠ›çš„ä¸“å±æ™ºèƒ½

# ä½“ã€‚

4. æŒç»­æ‰©å±•çš„åº”ç”¨è¾¹ç•Œï¼šéšç€MCPåè®®ç”Ÿæ€çš„ä¸æ–­æ‰©å±•ï¼Œç™¾ç‚¼å¹³å°å°†æŒç»­å¼•å…¥æ›´å¤šé˜¿é‡Œå·´å·´é›†å›¢åŠç¬¬

# ä¸‰æ–¹åº”ç”¨æœåŠ¡ï¼Œè¿›ä¸€æ­¥æ‹“å®½æ™ºèƒ½ä½“çš„åº”ç”¨è¾¹ç•Œï¼Œæ¨åŠ¨å¤§æ¨¡å‹æŠ€æœ¯åœ¨å„è¡Œä¸šçš„è½åœ°åº”ç”¨ã€‚

# é€šè¿‡æ¥å…¥MCPæœåŠ¡ï¼Œé˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°ä¸ºç”¨æˆ·æä¾›äº†é«˜æ•ˆã€ä¾¿æ·çš„å¤§æ¨¡å‹åº”ç”¨å¼€å‘ç¯å¢ƒï¼Œé™ä½äº†å¼€å‘é—¨

# æ§›ï¼ŒåŠ é€Ÿäº†å¤§æ¨¡å‹æŠ€æœ¯çš„äº§ä¸šåŒ–åº”ç”¨è¿›ç¨‹ã€‚

2. é˜¿é‡Œäº‘ç™¾ç‚¼æ¥å…¥MCPæµç¨‹

ç„¶åæˆ‘ä»¬è¿›å…¥MCPæœåŠ¡ä¸­å¿ƒï¼Œå…ˆé€‰æ‹©é«˜å¾·MCPå·¥å…·è¿›è¡Œæµ‹è¯•ï¼š

# ç‚¹å‡»å¼€å¯æœåŠ¡ï¼š

![Image](pdf_images\page102_img1.png)

![Image](pdf_images\page102_img2.png)

é«˜å¾·åœ°å›¾ MCP å·¥å…·æ˜¯é«˜å¾·åœ°å›¾åŸºäº MCP åè®®æ„å»ºçš„æœåŠ¡å™¨ï¼Œæ•´åˆäº†é«˜å¾·å¼€æ”¾å¹³å°çš„åœ°å›¾æœåŠ¡ä¸æ™ºèƒ½ç®— æ³•ï¼Œä¸ºä¼ä¸šåŠå¼€å‘è€…æä¾›å…¨åœºæ™¯çš„åœ°å›¾æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚ å…¶ 12 é¡¹æ ¸å¿ƒåŠŸèƒ½æ¶µç›–äº†åœ°å›¾æœåŠ¡çš„æ–¹æ–¹é¢é¢ï¼Œ

# æ»¡è¶³ä¼ä¸šå¼€å‘çš„å¤šæ ·åŒ–éœ€æ±‚ã€‚

# ä¸»è¦åŠŸèƒ½ï¼š

POI æ™ºèƒ½æå–ï¼šèƒ½å¤Ÿä»æ–‡å­—ä¸­ç²¾å‡†æå– POIï¼ˆå…´è¶£ç‚¹ï¼‰ä¿¡æ¯ï¼Œæ¶µç›–ä½ç½®ã€è¯¦æƒ…ã€æ‰“å¡ç‚¹ã€ä»·æ ¼ç­‰å¤š ç»´åº¦å†…å®¹ã€‚

# è·¯å¾„è§„åˆ’ï¼šæä¾›é©¾è½¦ã€æ­¥è¡Œã€éª‘è¡Œç­‰å¤šç§å‡ºè¡Œæ–¹å¼çš„è·¯å¾„è§„åˆ’æœåŠ¡ï¼Œå¸®åŠ©ç”¨æˆ·é€‰æ‹©æœ€ä¼˜è·¯çº¿ã€‚

# å®æ—¶è·¯å†µæŸ¥è¯¢ï¼šå®æ—¶æŸ¥è¯¢ç‰¹å®šé“è·¯æˆ–åŒºåŸŸçš„æ‹¥å µçŠ¶å†µåŠè¶‹åŠ¿ï¼Œä¸ºå‡ºè¡Œæä¾›åŠæ—¶å‚è€ƒã€‚

# å¤©æ°”æŸ¥è¯¢ï¼šé€šè¿‡ç»çº¬åº¦ä¿¡æ¯ï¼Œè·å–å®æ—¶å¤©æ°”æƒ…å†µåŠæœªæ¥å¤©æ°”é¢„æŠ¥ï¼Œä¸ºç”¨æˆ·å‡ºè¡Œè®¡åˆ’æä¾›æ”¯æŒã€‚

# é€šè¿‡é«˜å¾·åœ°å›¾ MCP å·¥å…·ï¼ŒAI æ™ºèƒ½ä½“å¯ä»¥ç›´æ¥è°ƒç”¨é«˜å¾·åœ°å›¾çš„å„é¡¹æœåŠ¡ï¼Œå®ç°å¦‚ä½ç½®æŸ¥è¯¢ã€è·¯çº¿è§„åˆ’ã€å®

æ—¶è·¯å†µæŸ¥è¯¢ç­‰åŠŸèƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’ŒæœåŠ¡æ•ˆç‡ã€‚

![Image](pdf_images\page103_img1.png)

![Image](pdf_images\page103_img2.png)

## ç„¶åè¿›å…¥åº”ç”¨ç®¡ç†ï¼Œå³å¯çœ‹åˆ°å½“å‰å¼€å¯çš„MCPæœåŠ¡ï¼š

# ç„¶åç‚¹å‡»åˆ›å»ºæ–°çš„åº”ç”¨ï¼Œå…¶å®ä¹Ÿå°±æ˜¯æ–°çš„Agentï¼š

# ç‚¹å‡»åˆ›å»º

![Image](pdf_images\page104_img1.png)

![Image](pdf_images\page104_img2.png)

ç„¶åå³å¯è¿›è¡Œæ¨¡å‹å’ŒMCPå·¥å…·é…ç½®äº†ï¼š

![Image](pdf_images\page106_img1.png)

![Image](pdf_images\page106_img2.png)

# ç„¶åè¾“å…¥ç³»ç»Ÿæç¤ºè¯ï¼šä½ æ˜¯ä¸€åç»éªŒä¸°å¯Œçš„å¯¼æ¸¸ï¼Œè¯·è€å¿ƒè®¤çœŸçš„ä¸ºç”¨æˆ·è§„åˆ’å‡ºæ¸¸è¡Œç¨‹ã€‚

# ç„¶åæµ‹è¯•è¿›è¡Œå‡ºæ¸¸è·¯çº¿è§„åˆ’ï¼š

![Image](pdf_images\page107_img1.png)

![Image](pdf_images\page107_img2.png)

èƒ½å¤Ÿçœ‹åˆ°è§„åˆ’ç»“æœå’ŒMCPå·¥å…·è°ƒç”¨æµç¨‹ï¼š

2. Firecrawl MCPå·¥å…·

# Firecrawl MCP å·¥å…·æ˜¯ä¸€æ¬¾åŸºäºæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰çš„ä¼ä¸šçº§ç½‘é¡µæ•°æ®é‡‡é›†æœåŠ¡å™¨ï¼Œç”±

# Mendable.ai å¼€å‘ï¼Œä¸“é—¨é’ˆå¯¹å¤æ‚ç½‘é¡µåœºæ™¯è®¾è®¡ã€‚å®ƒæ”¯æŒ JavaScript åŠ¨æ€æ¸²æŸ“ã€æ‰¹é‡æ•°æ®å¤„ç†ã€æ™ºèƒ½å†…

å®¹æœç´¢å’Œæ·±åº¦ç½‘é¡µçˆ¬å–ç­‰é«˜çº§åŠŸèƒ½ï¼Œèƒ½å¤Ÿä¸ºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æä¾›å¼ºå¤§çš„ç½‘é¡µæŠ“å–èƒ½åŠ›ã€‚

# ä¸»è¦åŠŸèƒ½ï¼š

# JavaScript æ¸²æŸ“ï¼šèƒ½å¤Ÿå¤„ç†åŠ¨æ€ç½‘é¡µå†…å®¹ï¼Œçªç ´ä¼ ç»ŸæŠ“å–å·¥å…·çš„å±€é™ï¼Œè·å–æ›´å…¨é¢çš„æ•°æ®ã€‚

# æ‰¹é‡å¤„ç†ï¼šæ”¯æŒå¹¶è¡Œå¤„ç†å’Œé˜Ÿåˆ—ç®¡ç†ï¼Œæé«˜æ•°æ®æŠ“å–æ•ˆç‡ã€‚

# æ™ºèƒ½é™é€Ÿï¼šæ ¹æ®ç½‘ç»œçŠ¶å†µå’Œä»»åŠ¡éœ€æ±‚æ™ºèƒ½è°ƒæ•´æŠ“å–é€Ÿåº¦ï¼Œé¿å…å¯¹ç›®æ ‡ç½‘ç«™é€ æˆè¿‡å¤§å‹åŠ›ã€‚

# å¤šç§è¾“å‡ºæ ¼å¼ï¼šæ”¯æŒå°†æŠ“å–çš„å†…å®¹è½¬æ¢ä¸º Markdownã€HTML ç­‰æ ¼å¼ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€æ±‚ã€‚

![Image](pdf_images\page108_img1.png)

## é€šè¿‡ Firecrawl MCP å·¥å…·ï¼Œå¼€å‘è€…å¯ä»¥é«˜æ•ˆåœ°ä»ç½‘é¡µæå–ç»“æ„åŒ–æ•°æ®ï¼Œå¢å¼º LLM åœ¨ä¿¡æ¯æ£€ç´¢å’Œå†…å®¹ç”Ÿæˆ

## æ–¹é¢çš„èƒ½åŠ›ã€‚

# Firecrawlå’ŒFetchéƒ½æ˜¯åŸºäºæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆMCPï¼‰çš„æœåŠ¡å™¨å·¥å…·ï¼Œæ—¨åœ¨å¢å¼ºå¤§å‹è¯­è¨€æ¨¡å‹

# ï¼ˆLLMsï¼‰å¯¹ç½‘é¡µå†…å®¹çš„è·å–å’Œå¤„ç†èƒ½åŠ›ï¼Œä½†å®ƒä»¬åœ¨åŠŸèƒ½å’Œé€‚ç”¨åœºæ™¯ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚

# Firecrawl MCP å·¥å…·ï¼š

# é«˜çº§ç½‘é¡µæŠ“å–ï¼šFirecrawl ä¸“ä¸ºå¤æ‚çš„ç½‘é¡µæŠ“å–ä»»åŠ¡è®¾è®¡ï¼Œæ”¯æŒ JavaScript æ¸²æŸ“ï¼Œèƒ½å¤Ÿå¤„ç†åŠ¨

# æ€å†…å®¹ä¸°å¯Œçš„ç½‘ç«™ã€‚

# æ‰¹é‡å¤„ç†ä¸æ·±åº¦çˆ¬å–ï¼šå…·å¤‡æ‰¹é‡æ•°æ®å¤„ç†ã€URL å‘ç°å’Œæ·±åº¦çˆ¬å–èƒ½åŠ›ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡æ•°æ®é‡‡

# é›†ä»»åŠ¡ã€‚

# æ™ºèƒ½å†…å®¹æœç´¢ï¼šå†…ç½®æ™ºèƒ½å†…å®¹æœç´¢å’Œæå–åŠŸèƒ½ï¼Œèƒ½å¤Ÿé«˜æ•ˆåœ°ä»ç½‘é¡µä¸­æå–ç»“æ„åŒ–æ•°æ®ã€‚

# Fetch MCP å·¥å…·ï¼š

# ç½‘é¡µå†…å®¹è·å–ä¸è½¬æ¢ï¼šFetch ä¸»è¦ç”¨äºä»æŒ‡å®šçš„ URL è·å–ç½‘é¡µå†…å®¹ï¼Œå¹¶å°† HTML è½¬æ¢ä¸º

# Markdown æ ¼å¼ï¼Œä¾¿äº LLMs ç†è§£å’Œå¤„ç†ã€‚

# è½»é‡çº§è®¾è®¡ï¼šFetch æ³¨é‡ç®€æ´å’Œæ˜“ç”¨ï¼Œé€‚åˆéœ€è¦å¿«é€Ÿè·å–å’Œè½¬æ¢ç½‘é¡µå†…å®¹çš„åœºæ™¯ã€‚

# ç„¶åéœ€è¦åˆ›å»ºFirecrawl APIï¼š

![Image](pdf_images\page109_img1.png)

![Image](pdf_images\page109_img2.png)

![Image](pdf_images\page109_img3.png)

# ç‚¹å‡»å¤åˆ¶å³å¯ï¼š

ç„¶åå¼€å¯Firecrawl MCPå·¥å…·ï¼š

![Image](pdf_images\page110_img1.png)

![Image](pdf_images\page110_img2.png)

# ç„¶åè¾“å…¥ç³»ç»Ÿæç¤ºè¯

# ## è§’è‰²è®¾å®šï¼ˆä¼˜åŒ–ç‰ˆï¼‰

# ä½ æ˜¯ä¸€ä½**å†…å®¹æ•´ç†ä¸“å®¶**ï¼Œæ“…é•¿é«˜æ•ˆæå–ç½‘é¡µä¸­çš„å…³é”®ä¿¡æ¯ã€‚

# ## æ ¸å¿ƒæŠ€èƒ½

# ### æŸ¥è¯¢ä¸æ€»ç»“ç½‘é¡µå†…å®¹ - æ ¹æ®ç”¨æˆ·æä¾›çš„ç½‘é¡µé“¾æ¥ï¼Œä½¿ç”¨ **Firecrawl MCP å·¥å…·** æŠ“å–ç½‘é¡µä¸»å†…å®¹ï¼ˆä»¥ Markdown æ ¼å¼è¿”

å›ï¼‰ã€‚

é˜…è¯»å¹¶ç†è§£ç½‘é¡µä¿¡æ¯ï¼Œ**ç”¨ä¸­æ–‡æç‚¼å‡ºå…³é”®è¦ç‚¹ä¸æ ¸å¿ƒè§‚ç‚¹**ã€‚ - ç”Ÿæˆç»“æ„æ¸…æ™°ã€é€»è¾‘å®Œæ•´çš„å†…å®¹æ€»ç»“ï¼Œé€‚åˆç›´æ¥ç”¨äºçŸ¥è¯†ç®¡ç†æˆ–éšæ‰‹è®°å½• ## é™åˆ¶è¦æ±‚

1. æ‰€æœ‰å†…å®¹æ€»ç»“å¿…é¡»ä¸º**ä¸­æ–‡**ã€‚

2. æ¯æ¡è®°å½•åªæ·»åŠ ä¸€ä¸ªæ ‡ç­¾ã€‚ 3. æ ‡ç­¾ä¹¦å†™è§„èŒƒï¼š`#æ ‡ç­¾`ï¼Œå‰ç¼€ä¸º `#`ï¼Œ**æ— ç©ºæ ¼**ã€‚

# å¹¶å°è¯•çˆ¬å–ç½‘é¡µå†…å®¹ï¼š

![Image](pdf_images\page111_img1.png)

![Image](pdf_images\page111_img2.png)

![Image](pdf_images\page111_img3.png)

## 3. ç™¾ç‚¼åº”ç”¨APIè·å–ä¸è°ƒç”¨

ç„¶åæˆ‘ä»¬å³å¯ä½¿ç”¨APIæ¥è°ƒç”¨å·²ç»åˆ›å»ºå¥½çš„åº”ç”¨ï¼š

![Image](pdf_images\page112_img1.png)

![Image](pdf_images\page112_img2.png)

# !pip install dashscope

# import os

# from http import HTTPStatus

# from dashscope import Application

# response = Application.call(

# api_key=DASHSCOPE_API_KEY, # æ›¿æ¢ä¸ºå®é™…API-KEY app_id=APP_ID, # æ›¿æ¢ä¸ºå®é™…çš„åº”ç”¨ ID

# prompt='ä½ æ˜¯è°ï¼Ÿ')

# print(response.output.text)

# prompt = 'è¯·å¸®æˆ‘è¯¦ç»†æ•´ç†ä¸‹è¿™ä¸ªç½‘é¡µé‡Œçš„å†…å®¹ï¼šhttps://docs.cherry-ai.com/'

# response = Application.call(

# api_key=DASHSCOPE_API_KEY, # æ›¿æ¢ä¸ºå®é™…API-KEY app_id=APP_ID, # æ›¿æ¢ä¸ºå®é™…çš„åº”ç”¨ ID

# prompt=prompt)

# print(response.output.text)

# å…·ä½“æ‰§è¡Œæ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š

![Image](pdf_images\page114_img1.png)

![Image](pdf_images\page114_img2.png)

# äº”ã€Open-WebUIæ¥å…¥MCPæµç¨‹

# Open-WebUIï¼šhttps://github.com/open-webui/open-webui

# Open WebUI æ˜¯ä¸€æ¬¾å¯æ‰©å±•ã€åŠŸèƒ½ä¸°å¯Œä¸”ç”¨æˆ·å‹å¥½çš„è‡ªæ‰˜ç®¡ AI å¹³å°ï¼Œæ—¨åœ¨å®Œå…¨ç¦»çº¿è¿è¡Œã€‚å®ƒæ”¯æŒ

# å¤šç§å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¿è¡Œç¯å¢ƒï¼ŒåŒ…æ‹¬ Ollama å’Œå…¼å®¹ OpenAI çš„ APIã€‚

# ä¸»è¦åŠŸèƒ½ï¼š

å¤šæ¨¡å‹æ”¯æŒï¼šå…¼å®¹å¤šç§ LLM è¿è¡Œç¯å¢ƒï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©é€‚åˆçš„æ¨¡å‹è¿›è¡Œéƒ¨ç½²å’Œäº¤äº’ã€‚

# ç¦»çº¿è¿è¡Œï¼šè®¾è®¡ä¸Šæ”¯æŒå®Œå…¨ç¦»çº¿æ“ä½œï¼Œç¡®ä¿æ•°æ®éšç§å’Œå®‰å…¨ï¼Œé€‚åˆå¯¹æ•°æ®æ•æ„Ÿçš„åº”ç”¨åœºæ™¯ã€‚

# ç”¨æˆ·å‹å¥½ç•Œé¢ï¼šæä¾›ç±»ä¼¼ ChatGPT çš„äº¤äº’ç•Œé¢ï¼Œæ–¹ä¾¿ç”¨æˆ·ä¸æœ¬åœ°æˆ–è¿œç¨‹éƒ¨ç½²çš„è¯­è¨€æ¨¡å‹è¿›è¡Œå¯¹

# è¯ã€‚

# è‡ªæ‰˜ç®¡éƒ¨ç½²ï¼šæ”¯æŒé€šè¿‡ Docker ç­‰æ–¹å¼è¿›è¡Œè‡ªæ‰˜ç®¡éƒ¨ç½²ï¼Œæ–¹ä¾¿ç”¨æˆ·åœ¨æœ¬åœ°ç¯å¢ƒä¸­è¿è¡Œå’Œç®¡ç†ã€‚

![Image](pdf_images\page115_img1.png)

![Image](pdf_images\page115_img2.png)

## 1. ã€å¯é€‰ã€‘å€ŸåŠ©ollamaæ‹‰å–æ¨¡å‹

# 1.1 ollamaå®‰è£…ä¸éƒ¨ç½²

# Open-WebUIåŸç”Ÿæ”¯æŒä½¿ç”¨Ollamaè°ƒç”¨æœ¬åœ°æ¨¡å‹è¿›è¡Œæ¨ç†ï¼ŒOllamaæ˜¯ä¸€æ¬¾å¤§æ¨¡å‹ä¸‹è½½ã€ç®¡ç†ã€æ¨

# ç†ã€ä¼˜åŒ–é›†ä¸€ä½“çš„å¼ºå¤§å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿè°ƒç”¨å„ç±»ç¦»çº¿éƒ¨ç½²çš„å¤§æ¨¡å‹ã€‚Ollamaå®˜ç½‘ï¼šhttps://ollama.com/

# ã€å®‰è£…æ–¹æ¡ˆä¸€ã€‘Ollamaåœ¨çº¿å®‰è£…

# åœ¨Linuxç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¿«é€Ÿå®‰è£…Ollama

# curl -fsSL https://ollama.com/install.sh | sh

![Image](pdf_images\page116_img1.png)

![Image](pdf_images\page116_img2.png)

![Image](pdf_images\page116_img3.png)

# ä½†è¯¥ä¸‹è½½æµç¨‹ä¼šå—é™äºå›½å†…ç½‘ç»œç¯å¢ƒï¼Œä¸‹è½½è¿‡ç¨‹å¹¶ä¸ç¨³å®šã€‚

# ã€å®‰è£…æ–¹æ¡ˆäºŒã€‘Ollamaç¦»çº¿å®‰è£…

# å› æ­¤ï¼Œåœ¨æ›´ä¸ºä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨Ollamaç¦»çº¿éƒ¨ç½²ã€‚æˆ‘ä»¬å¯ä»¥åœ¨Ollama Githubä¸»é¡µæŸ¥çœ‹ç›®å‰

# Ollamaæ”¯æŒçš„å„æ“ä½œç³»ç»Ÿå®‰è£…åŒ…ï¼šhttps://github.com/ollama/ollama/releases

# è‹¥æ˜¯Ubuntuæ“ä½œç³»ç»Ÿï¼Œé€‰æ‹©å…¶ä¸­ ollama-linux-amd64.tgz ä¸‹è½½å’Œå®‰è£…å³å¯ã€‚

# æ­¤å¤–ï¼Œå®‰è£…åŒ…ä¹Ÿå¯ä»ç½‘ç›˜ä¸­ä¸‹è½½ï¼š

![Image](pdf_images\page117_img1.png)

![Image](pdf_images\page117_img2.png)

![Image](pdf_images\page117_img3.png)

![Image](pdf_images\page117_img4.png)

# ä¸‹è½½å®Œæˆåï¼Œéœ€è¦å…ˆä¸Šä¼ è‡³æœåŠ¡å™¨ï¼š

# ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè§£å‹ç¼©

# mkdir ./ollama

# tar -zxvf ollama-linux-amd64.tgz -C ./ollama

# è§£å‹ç¼©åé¡¹ç›®æ–‡ä»¶å¦‚å›¾æ‰€ç¤ºï¼š

# è€Œåœ¨binä¸­ï¼Œå¯ä»¥æ‰¾åˆ°ollamaå‘½ä»¤çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

# æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼ä½¿ç”¨ollamaï¼š

# cd ./bin

# ./ollama help

![Image](pdf_images\page118_img1.png)

![Image](pdf_images\page118_img2.png)

# æ­¤å¤„è‹¥æ˜¾ç¤ºæ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸ºå½“å‰è„šæœ¬æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼š

# chmod +x ollama

# è€Œä¸ºäº†ä½¿ç”¨å‘½ä»¤æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è„šæœ¬æ–‡ä»¶å†™å…¥ç¯å¢ƒå˜é‡ä¸­ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸»ç›®å½•ï¼ˆrootï¼‰ä¸‹æ‰¾

# åˆ°.bashrcæ–‡ä»¶ï¼š

# ç„¶ååœ¨ .bashrc æ–‡ä»¶ç»“å°¾å†™å…¥ollama/binæ–‡ä»¶è·¯å¾„ï¼š

![Image](pdf_images\page119_img1.png)

# export PATH=$PATH:/root/autodl-tmp/ollama/bin

# ä¿å­˜å¹¶é€€å‡ºåï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤æ¥ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š

# source ~/.bashrc

# ç„¶ååœ¨ä»»æ„è·¯å¾„ä¸‹è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œæµ‹è¯•ollamaç¯å¢ƒå˜é‡æ˜¯å¦ç”Ÿæ•ˆ

# ollama help

![Image](pdf_images\page120_img1.png)

# ã€å¯é€‰ã€‘æ›´æ¢Ollamaé»˜è®¤æ¨¡å‹æƒé‡ä¸‹è½½åœ°å€

# æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ollamaæ¥ä¸‹è½½æ¨¡å‹ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œollamaä¼šå°†æ¨¡å‹ä¸‹è½½åˆ°/root/.ollamaæ–‡ä»¶

# å¤¹ä¸­ï¼Œä¼šå ç”¨ç³»ç»Ÿç›˜ç©ºé—´ï¼Œå› æ­¤ï¼Œè‹¥æœ‰éœ€è¦ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹æ³•æ›´æ¢æ¨¡å‹æƒé‡ä¸‹è½½åœ°å€ã€‚

# æ­¤å¤–æ— è®ºæ˜¯åœ¨çº¿è¿˜æ˜¯ç¦»çº¿å®‰è£…çš„ollamaï¼Œéƒ½å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹æ³•æ›´æ¢æ¨¡å‹æƒé‡ä¸‹è½½åœ°å€ã€‚è¿˜æ˜¯éœ€è¦æ‰“

# å¼€ /root/.bashrc æ–‡ä»¶ï¼Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š

# export OLLAMA_MODELS=/root/autodl-tmp/models

![Image](pdf_images\page121_img1.png)

![Image](pdf_images\page121_img2.png)

# è¿™é‡Œçš„è·¯å¾„éœ€è¦æ”¹å†™ä¸ºè‡ªå·±çš„æ–‡ä»¶åœ°å€

# ä¿å­˜å¹¶é€€å‡ºåï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤æ¥ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š

# source ~/.bashrc

# æµ‹è¯•ç¯å¢ƒå˜é‡æ˜¯å¦ç”Ÿæ•ˆ

# echo $OLLAMA_MODELS

# å¯åŠ¨ollama

# æ¥ä¸‹æ¥å³å¯å¯åŠ¨ollamaï¼Œä¸ºåç»­ä¸‹è½½æ¨¡å‹åšå‡†å¤‡ï¼š

# ollama start

![Image](pdf_images\page122_img1.png)

![Image](pdf_images\page122_img2.png)

![Image](pdf_images\page122_img3.png)

# æ³¨æ„ï¼Œåœ¨æ•´ä¸ªåº”ç”¨ä½¿ç”¨æœŸé—´ï¼Œéœ€è¦æŒç»­å¼€å¯Ollamaã€‚

# 1.2 ä¸‹è½½Gemma-27Bæ¨¡å‹

ollama run gemma3:27b

# ollama list

# å®é™…æ˜¾å­˜å ç”¨ï¼š

![Image](pdf_images\page123_img1.png)

![Image](pdf_images\page123_img2.png)

2. Open-WebUIå®‰è£…ä¸è°ƒç”¨

# pip isntall open-webui

# åœ¨å‡†å¤‡å¥½äº†Open-WebUIå’Œä¸€ç³»åˆ—æ¨¡å‹æƒé‡åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•å¯åŠ¨Open-WebUIï¼Œå¹¶å€ŸåŠ©æœ¬åœ°æ¨¡

# å‹è¿›è¡Œé—®ç­”ã€‚

# é¦–å…ˆéœ€è¦è®¾ç½®ç¦»çº¿ç¯å¢ƒï¼Œé¿å…Open-WebUIå¯åŠ¨æ—¶è‡ªåŠ¨è¿›è¡Œæ¨¡å‹ä¸‹è½½ï¼š

# export HF_HUB_OFFLINE=1

# ç„¶åå¯åŠ¨Open-WebUI

# open-webui serve

# éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯åŠ¨çš„æ—¶å€™ä»ç„¶æŠ¥é”™æ˜¾ç¤ºæ— æ³•ä¸‹è½½æ¨¡å‹ï¼Œæ˜¯Open-WebUIè¯•å›¾ä»huggingfaceä¸Šä¸‹è½½ embeddingæ¨¡å‹ï¼Œä¹‹åæˆ‘ä»¬ä¼šæ‰‹åŠ¨å°†å…¶åˆ‡æ¢ä¸ºæœ¬åœ°è¿è¡Œçš„Embeddingæ¨¡å‹ã€‚

ç„¶ååœ¨æœ¬åœ°æµè§ˆå™¨è¾“å…¥åœ°å€:8080ç«¯å£å³å¯è®¿é—®ï¼š

![Image](pdf_images\page124_img1.png)

![Image](pdf_images\page124_img2.png)

# è‹¥ä½¿ç”¨AutoDLï¼Œåˆ™éœ€è¦ä½¿ç”¨SSHéš§é“å·¥å…·è¿›è¡Œåœ°å€ä»£ç†

![Image](pdf_images\page125_img1.png)

![Image](pdf_images\page125_img2.png)

## æ›´å¤šAutoDLç›¸å…³æ“ä½œè¯¦è§å…¬å¼€è¯¾ï¼šã€ŠAutoDLå¿«é€Ÿå…¥é—¨ä¸GPUç§Ÿèµä½¿ç”¨æŒ‡å—ã€‹|https://www.bilibil

## i.com/video/BV1bxB7YYEST/

# ç„¶åé¦–æ¬¡ä½¿ç”¨å‰ï¼Œéœ€è¦åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼š

# ç„¶åç‚¹å‡»ç™»å½•å³å¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶Open-WebUIä¼šè‡ªåŠ¨æ£€æµ‹åå°æ˜¯å¦å¯åŠ¨äº†ollamaæœåŠ¡ï¼Œå¹¶åˆ—ä¸¾

# å½“å‰å¯ç”¨çš„æ¨¡å‹ã€‚ç¨ç­‰ç‰‡åˆ»ï¼Œå³å¯è¿›å…¥åˆ°å¦‚ä¸‹é¡µé¢ï¼š

![Image](pdf_images\page126_img1.png)

![Image](pdf_images\page126_img2.png)

# æ¥ä¸‹æ¥å³å¯è¿›å…¥åˆ°å¯¹è¯é¡µé¢ï¼š

3. Open-WebUIæ¥å…¥MCPæµç¨‹

# MCP Supportï¼šhttps://docs.openwebui.com/openapi-servers/mcp

![Image](pdf_images\page127_img1.png)

# æœ€æ–°Open WebUI æä¾›çš„ MCPï¼ˆModel Context Protocolï¼‰åˆ° OpenAPI çš„ä»£ç†æœåŠ¡å™¨ï¼ˆmcpoï¼‰MCP

# åˆ° OpenAPI çš„ä»£ç†æœåŠ¡å™¨è®©ä½ å¯ä»¥é€šè¿‡æ ‡å‡†çš„ REST/OpenAPI API æ¥ç›´æ¥ä½¿ç”¨åŸºäº MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡

# åè®®ï¼‰å®ç°çš„å·¥å…·æœåŠ¡å™¨â€”â€”æ— éœ€å­¦ä¹ æˆ–å¤„ç†ä»»ä½•å¤æ‚çš„è‡ªå®šä¹‰åè®®ã€‚

# ğŸ’¡ ä¸ºä»€ä¹ˆä½¿ç”¨ mcpoï¼Ÿ

# å°½ç®¡ MCP å·¥å…·æœåŠ¡å™¨åŠŸèƒ½å¼ºå¤§ã€çµæ´»ï¼Œä½†å®ƒä»¬é€šå¸¸é€šè¿‡æ ‡å‡†è¾“å…¥/è¾“å‡ºï¼ˆstdioï¼‰è¿›è¡Œé€šä¿¡â€”â€”è¿™æ„å‘³ç€

# å®ƒä»¬é€šå¸¸è¿è¡Œåœ¨æœ¬åœ°ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è®¿é—®æ–‡ä»¶ç³»ç»Ÿã€ç¯å¢ƒå˜é‡åŠå…¶ä»–ç³»ç»Ÿèµ„æºã€‚è¿™æ—¢æ˜¯ä¼˜åŠ¿ï¼Œä¹Ÿæ˜¯ä¸€ç§é™

# åˆ¶ã€‚

# å› ä¸º MCP æœåŠ¡å™¨é€šå¸¸ä¾èµ–äºåŸå§‹çš„ stdio é€šä¿¡æ–¹å¼ï¼Œå®ƒï¼š

# ğŸ”“ åœ¨è·¨ç¯å¢ƒä½¿ç”¨æ—¶ä¸å®‰å…¨

# âŒ ä¸å¤§å¤šæ•°ç°ä»£å·¥å…·ã€UI æˆ–å¹³å°ä¸å…¼å®¹

# ğŸ§© ç¼ºä¹è®¤è¯ã€æ–‡æ¡£å’Œé”™è¯¯å¤„ç†ç­‰å…³é”®ç‰¹æ€§

# è€Œ mcpo ä»£ç† è‡ªåŠ¨è§£å†³äº†è¿™äº›é—®é¢˜ï¼š

# âœ… ä¸ç°æœ‰çš„ OpenAPI å·¥å…·ã€SDK å’Œå®¢æˆ·ç«¯å³æ—¶å…¼å®¹

# ğŸ›¡ å°†ä½ çš„å·¥å…·åŒ…è£¹ä¸ºå®‰å…¨ã€å¯æ‰©å±•ã€åŸºäºæ ‡å‡†çš„ HTTP æ¥å£

# ğŸ§  è‡ªåŠ¨ä¸ºæ¯ä¸ªå·¥å…·ç”Ÿæˆäº¤äº’å¼ OpenAPI æ–‡æ¡£ï¼Œæ— éœ€ä»»ä½•é…ç½®

# ğŸ”Œ ä½¿ç”¨çº¯ HTTPâ€”â€”æ— éœ€é…ç½® socketã€ä¸ç”¨ç®¡ç†åå°æœåŠ¡æˆ–ç¼–å†™å¹³å°ç›¸å…³ä»£ç 

# å› æ­¤ï¼Œè™½ç„¶å¼•å…¥ mcpo è¡¨é¢ä¸Šçœ‹åƒæ˜¯â€œåˆå¤šäº†ä¸€å±‚â€ï¼Œä½†å®é™…ä¸Šå®ƒï¼š

# âœ… ç®€åŒ–äº†é›†æˆæµç¨‹ âœ… æå‡äº†å®‰å…¨æ€§ âœ… å¼ºåŒ–äº†å¯æ‰©å±•æ€§ âœ… è®©å¼€å‘è€…å’Œç”¨æˆ·æ›´æ»¡æ„

# âœ¨ æœ‰äº† mcpoï¼Œä½ æœ¬åœ°è¿è¡Œçš„ AI å·¥å…·å¯ä»¥ç«‹åˆ»æ”¯æŒäº‘ç«¯éƒ¨ç½²ã€é€‚é…å„ç§ UIï¼Œå¹¶å®ç°æ— ç¼äº¤äº’â€”â€”æ— éœ€ ä¿®æ”¹å·¥å…·æœåŠ¡å™¨ä»£ç ä¸­çš„ä»»ä½•ä¸€è¡Œã€‚

# âœ… å¿«é€Ÿå¼€å§‹ï¼šæœ¬åœ°è¿è¡Œä»£ç†æœåŠ¡å™¨

![Image](pdf_images\page128_img1.png)

## pip install uv

## pip install mcpo

# æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œæ¨èçš„ MCP æœåŠ¡å™¨ï¼ˆå¦‚ mcp-server-time ï¼‰å¹¶åŒæ—¶é€šè¿‡ mcpo ä»£ç†

# è¿›è¡Œå¼€æ”¾ï¼š

# uvx mcpo --port 8000 -- uvx mcp-server-time --local-timezone=Asia/Shanghai

![Image](pdf_images\page132_img1.png)

![Image](pdf_images\page132_img2.png)

# âš¡ MCP åˆ° OpenAPI ä»£ç†çš„ä¼˜åŠ¿

# ä¸ºä»€ä¹ˆé€šè¿‡ä»£ç†ä½¿ç”¨ MCP å·¥å…·æœåŠ¡å™¨æ˜¯æ›´ä¼˜é€‰æ‹©ï¼ŸOpen WebUI å¼ºçƒˆæ¨èè¿™ä¸€æ–¹å¼ï¼š

# ç”¨æˆ·å‹å¥½ä¸”ç†Ÿæ‚‰çš„æ¥å£ï¼šä¸éœ€è¦å­¦ä¹ æ–°çš„å®¢æˆ·ç«¯ï¼Œåªéœ€ä½¿ç”¨ä½ ç†Ÿæ‚‰çš„ HTTP æ¥å£

# å³æ—¶é›†æˆï¼šä¸æ•°åƒä¸ªç°æœ‰çš„ REST/OpenAPI å·¥å…·ã€SDK å’ŒæœåŠ¡æ— ç¼å…¼å®¹

# å¼ºå¤§è‡ªåŠ¨æ–‡æ¡£æ”¯æŒï¼šSwagger UI è‡ªåŠ¨ç”Ÿæˆã€å‡†ç¡®ç»´æŠ¤

# æ— éœ€æ–°åè®®å¼€é”€ï¼šå…å»ç›´æ¥å¤„ç† MCP åè®®å¤æ‚æ€§å’Œ socket é€šä¿¡é—®é¢˜

ç¨³å®šå®‰å…¨ï¼šæ²¿ç”¨æˆç†Ÿçš„ HTTPSã€è®¤è¯æœºåˆ¶ï¼ˆå¦‚ JWTã€API keyï¼‰ã€FastAPI çš„å¯é æ¶æ„

# é¢å‘æœªæ¥ï¼šä½¿ç”¨æ ‡å‡† REST/OpenAPIï¼Œé•¿æœŸè·å¾—ç¤¾åŒºæ”¯æŒä¸å‘å±•

## MCPæ™ºèƒ½ä½“å¼€å‘å®æˆ˜å…¥é—¨

# ä»é›¶åˆ°ä¸€MCPå¿«é€Ÿå…¥é—¨å®æˆ˜

# ä¸€ã€MCPæŠ€æœ¯ä½“ç³»ä»‹ç»

1. MCPå…¥é—¨ä»‹ç» 2. Function callingæŠ€æœ¯å›é¡¾

3. å¤§æ¨¡å‹Agentå¼€å‘æŠ€æœ¯ä½“ç³»å›é¡¾

# äºŒã€MCPå®¢æˆ·ç«¯Clientå¼€å‘æµç¨‹ 1. uvå·¥å…·å…¥é—¨ä½¿ç”¨æŒ‡å—

# 1.1 uvå…¥é—¨ä»‹ç»

# 1.2 uvå®‰è£…æµç¨‹

# 1.3 uvçš„åŸºæœ¬ç”¨æ³•ä»‹ç» 2.MCPæç®€å®¢æˆ·ç«¯æ­å»ºæµç¨‹

# 2.1 åˆ›å»º MCP å®¢æˆ·ç«¯é¡¹ç›®

# 2.2 åˆ›å»ºMCPå®¢æˆ·ç«¯è™šæ‹Ÿç¯å¢ƒ 2.3 ç¼–å†™åŸºç¡€ MCP å®¢æˆ·ç«¯

# 2.4 MCPå®¢æˆ·ç«¯åŸºæœ¬ä»£ç ç»“æ„

# 2.5 è¿è¡Œ MCP å®¢æˆ·ç«¯

# 2.6 Jupyterä¸­ä»£ç è¿è¡Œæ•ˆæœ

3. MCPå®¢æˆ·ç«¯æ¥å…¥OpenAIã€DeepSeekåœ¨çº¿æ¨¡å‹æµç¨‹

# 3.1 æ–°å¢ä¾èµ–

# 3.2 åˆ›å»º.envæ–‡ä»¶ 3.3 ä¿®æ”¹client.pyä»£ç 

# 3.4 è¿è¡Œclient.py

# 3.5 clint.pyä»£ç è§£é‡Š

4. MCPå®¢æˆ·ç«¯æ¥å…¥æœ¬åœ°ollamaã€vLLMæ¨¡å‹æµç¨‹

# 4.1 MCPå®¢æˆ·ç«¯æ¥å…¥æœ¬åœ°ollama

# 4.2 MCPå®¢æˆ·ç«¯æ¥å…¥vLLM

# ä¸‰ã€MCPå¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨serverä¸ä½¿ç”¨

1. MCPæœåŠ¡å™¨æ¦‚å¿µä»‹ç» 2. MCPæœåŠ¡å™¨é€šè®¯æœºåˆ¶

3. å¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨Serveråˆ›å»ºæµç¨‹

# 3.1 æœåŠ¡å™¨ä¾èµ–å®‰è£… 3.2 æœåŠ¡å™¨ä»£ç ç¼–å†™

4. å¤©æ°”æŸ¥è¯¢å®¢æˆ·ç«¯clientåˆ›å»ºæµç¨‹

# 4.1 ä»£ç ç¼–å†™

# 4.2 æµ‹è¯•è¿è¡Œ 4.3 ä»£ç è§£é‡Š

# 5.MCP InspectoråŠŸèƒ½ä»‹ç»

# å››ã€MCPæ›´å¤šè¿›é˜¶ä½¿ç”¨

1. MCPæœåŠ¡å™¨Serverè¿›é˜¶åŠŸèƒ½

2. MCPå®¢æˆ·ç«¯Clientè¿›é˜¶åŠŸèƒ½

# MCPå¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨æŒ‡å—

# ä¸€ã€MCPåŸºç¡€æŠ€æœ¯å›é¡¾

1. MCPå…¥é—¨ä»‹ç»

# 2.MCPæœåŠ¡å™¨Serveråˆé›†

3. MCPçƒ­é—¨å®¢æˆ·ç«¯Client äºŒã€Cursoræ¥å…¥MCPå·¥å…·æµç¨‹ 1.Cursorå®‰è£…ä¸Agentæ¨¡å¼å¼€å¯

# 1.1 Cursorå®‰è£…æµç¨‹

# 1.2 Cursor Agentè°ƒç”¨æ¨¡å¼

# 2.å°†æ–°ç‰ˆCursoræ¥å…¥MCP

# 2.1 å®‰è£…åŸºç¡€ä¾èµ–

2.2 å°è¯•ä¸ºCursoræ·»åŠ MCPå·¥å…· 2.4 æ·»åŠ Playwright MCP

## 2.4 æ·»åŠ FileSystemå·¥å…·

## ä¸‰ã€ä¸ªäººåŠ©ç†Cherry Studioæ¥å…¥MCPå®ç°æµç¨‹

# 1.Cherry Studioå®‰è£…æµç¨‹

2. Cherry Studioæ¥å…¥MCPæµç¨‹

# å››ã€é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°æ¥å…¥MCP

1. é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°ä»‹ç» 2. é˜¿é‡Œäº‘ç™¾ç‚¼æ¥å…¥MCPæµç¨‹

2. Firecrawl MCPå·¥å…·

3. ç™¾ç‚¼åº”ç”¨APIè·å–ä¸è°ƒç”¨

# äº”ã€Open-WebUIæ¥å…¥MCPæµç¨‹

1. ã€å¯é€‰ã€‘å€ŸåŠ©ollamaæ‹‰å–æ¨¡å‹

# 1.1 ollamaå®‰è£…ä¸éƒ¨ç½²

# 1.2 ä¸‹è½½Gemma-27Bæ¨¡å‹

2. Open-WebUIå®‰è£…ä¸è°ƒç”¨

3. Open-WebUIæ¥å…¥MCPæµç¨‹

# MCPæ™ºèƒ½ä½“å¼€å‘å®æˆ˜å…¥é—¨

# ä¸€ã€MCPæŠ€æœ¯ä½“ç³»ä»‹ç»

1. MCPå…¥é—¨ä»‹ç»

2. MCPæ™ºèƒ½ä½“å¼€å‘å…¥é—¨é¡¹ç›®

# äºŒã€GraphRAGåŸºäºçŸ¥è¯†å›¾è°±çš„æ£€ç´¢å¢å¼ºæŠ€æœ¯

# 1.GraphRAGå…¥é—¨ä»‹ç»

# 2.GraphRAGåŸºæœ¬åŸç†å›é¡¾

3. GraphRAGè¿è¡Œæµç¨‹

# 3.1 ç´¢å¼•ï¼ˆIndexingï¼‰è¿‡ç¨‹ 3.2 æŸ¥è¯¢ï¼ˆQueryï¼‰è¿‡ç¨‹

# 3.3 Prompt è°ƒä¼˜

# 3.4 GraphRAGè®¡ç®—æµç¨‹æç®€ç¤ºä¾‹

# 4.GraphRAGå®‰è£…ä¸Indexing&Queryæµç¨‹å®ç°

# 5.GraphRAG APIä½¿ç”¨æ–¹æ³•

# ä¸‰ã€MCP+GraphRAGæ­å»ºæ£€ç´¢å¢å¼ºæ™ºèƒ½ä½“

# 1.MCP+GraphRAGé¡¹ç›®ç¯å¢ƒæ­å»º 1.1 åˆ›å»º MCP å®¢æˆ·ç«¯é¡¹ç›®

# 1.2 åˆ›å»ºMCPå®¢æˆ·ç«¯è™šæ‹Ÿç¯å¢ƒ

# 1.3 åˆ›å»ºGraphRAGå¹¶æ„å»ºç´¢å¼•ï¼ˆIndexï¼‰

# 2.åˆ›å»ºGraphRAGæœåŠ¡å™¨Server

# 3.åˆ›å»ºGraphRAGæœåŠ¡å™¨client

# 4.MCP+GraphRAGé—®ç­”æµ‹è¯•

# 4.1 å‘½ä»¤è¡Œé—®ç­” 4.2 Claude Desktopé—®ç­”

# å››ã€MCPæ™ºèƒ½ä½“å¼€å‘åŸºç¡€ç†è®ºå…¥é—¨

1. çœŸå®ä¸–ç•Œçš„å¤æ‚æ™ºèƒ½ä½“å¼€å‘é¡¹ç›®

# 1.1 2023å¹´MateGen 1.0ä»£ç ç»“æ„å›¾

# 1.2 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹ä¼ä¸šé—®ç­”æ™ºèƒ½ä½“é¡¹ç›®æµç¨‹å›¾

# 1.3 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹æ™ºèƒ½å®¢æœé¡¹ç›®æµç¨‹å›¾

# 1.4 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹æ™ºèƒ½å¸‚åœºåˆ†æé¡¹ç›®æµç¨‹å›¾ 1.5 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹MateGen 2.0é¡¹ç›®æ¶æ„

2. æ™ºèƒ½ä½“å¼€å‘æ¡†æ¶é€‰å‹

3. ä»é›¶å¿«é€Ÿäº†è§£æ™ºèƒ½ä½“å¼€å‘

# äº”ã€OpenAIé£æ ¼API Function callingè¿›é˜¶åŠŸèƒ½ä»‹ç» å…­ã€å€ŸåŠ©MCPæ­å»ºAIæ•°æ®åˆ†ææ™ºèƒ½ä½“

1. miniMateGené¡¹ç›®åˆå§‹åŒ–

2. åˆ›å»ºMCPæœåŠ¡å™¨ä¸€ï¼šSQL_server

# 2.1 Linuxç¯å¢ƒä¸‹å®‰è£…MySQLæœåŠ¡å™¨å¹¶åˆ›å»ºç®€å•æ•°æ®é›†

# 2.2 ç¼–å†™SQL_server.pyä»£ç 

3. åˆ›å»ºMCPæœåŠ¡å™¨äºŒï¼šPython_server

4.åˆ›å»ºMCPå®¢æˆ·ç«¯Client

## 5.miniMateGenåŠŸèƒ½æµ‹è¯•

## 5.1 NL2SQLåŠŸèƒ½æµ‹è¯• 5.2 NL2PythonåŠŸèƒ½æµ‹è¯•

# 5.3 NL2SQL+NL2PythonåŠŸèƒ½è”åŠ¨æµ‹è¯•

# ä»é›¶åˆ°ä¸€MCPå¼€å‘ä¸éƒ¨ç½²å®æˆ˜

# ä¸€ã€MCPæŠ€æœ¯å…¥é—¨ä»‹ç»

# 1.æ™ºèƒ½ä½“å¼€å‘æ ¸å¿ƒæŠ€æœ¯â€”MCP

# 1.1 Function callingæŠ€æœ¯å›é¡¾

1.2 Function callingå…¬å¼€è¯¾ä»‹ç» 1.3 Function callingèƒ½åŠ›ä»ä½•è€Œæ¥

# 1.4 MCPæŠ€æœ¯æœ¬è´¨ï¼šFunction callingçš„æ›´é«˜å±‚å®ç°

# 1.5 MCPæŠ€æœ¯å¸¦æ¥çš„æ™ºèƒ½ä½“å¼€å‘æ•ˆç‡é©å‘½

2. MCPæœåŠ¡å™¨æ¥å…¥ç¤ºä¾‹ 3. MCPå·¥å…·æ ‡å‡†æ¥å…¥æµç¨‹

4. MCPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯

# 4.1 MCPæœåŠ¡å™¨ï¼ˆserverï¼‰ä¸å®¢æˆ·ç«¯ï¼ˆclientï¼‰æ¦‚å¿µä»‹ç»

# 4.2 MCPæœåŠ¡å™¨é›†åˆ

5. MCPä¸Function callingæŠ€æœ¯å¯¹æ¯”ä»‹ç»

6. MCPæŠ€æœ¯ç”Ÿæ€

# äºŒã€ä»é›¶åˆ°ä¸€è¿›è¡ŒMCPé¡¹ç›®å¼€å‘ 1. MCPæœåŠ¡å™¨å¼€å‘æµç¨‹ä»‹ç»

2. MCP Serveræ ¸å¿ƒåŠŸèƒ½å¼€å‘

# 2.1 Mini DeepResearché¡¹ç›®ä»‹ç»

# 2.2 Mini DeepResearché¡¹ç›®æ¶æ„ä»‹ç» 2.3 planner_agentåŠŸèƒ½å®ç°

# 2.4 search_agentåŠŸèƒ½å®ç°

# 2.5 writer_agentåŠŸèƒ½å®ç° 2.6 MCPæœåŠ¡å™¨ä¸»å‡½æ•°ç¼–å†™

3. MCP Serveré¡¹ç›®å¼€å‘

# Step 1. å€ŸåŠ©uvåˆ›å»ºPythoné¡¹ç›®

# Step 2. æ·»åŠ é¡¹ç›®ä¾èµ– Step 3.ç¼–å†™é¡¹ç›®æºç 

4. å€ŸåŠ©MCP Inspectorè¿›è¡ŒåŠŸèƒ½æµ‹è¯•

# ä¸‰ã€MCPæœåŠ¡å™¨éƒ¨ç½²æµç¨‹

1. DeepResearché¡¹ç›®å®Œå–„

# 1.1 src layouté¡¹ç›®ç»“æ„

# 1.2 ä¿®æ”¹pyproject.toml

2. é¡¹ç›®ç¦»çº¿æ‹·è´ 3. é¡¹ç›®å‘å¸ƒåˆ°pipyå¹³å°

# å››ã€åŸºäºSSEä¼ è¾“æ–¹å¼çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

1. stdioã€SSEä¸åŸºäºHTTPçš„æµå¼ä¼ è¾“å½¢å¼å¯¹æ¯”

# 1.1 MCPé€šä¿¡åè®®ä»‹ç»

# 1.2 Stdio ä¼ è¾“ï¼ˆStandard Input/Outputï¼‰

# 1.3 Server-Sent Eventsï¼ˆSSEï¼‰

# 1.4 Streamable HTTP 1.1.4 MCP ä¼ è¾“æ–¹å¼ä¼˜åŠ£åŠ¿å¯¹æ¯”

2. åŸºäºSSEä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

3. åŸºäºSSEçš„MCPæœåŠ¡å™¨æµ‹è¯•ä¸å‘å¸ƒæµç¨‹

# 3.1 SSE MCPæœåŠ¡å™¨æµ‹è¯•æµç¨‹ 3.2 SSE MCPæœåŠ¡å™¨å‘å¸ƒä¸è°ƒç”¨æµç¨‹

# äº”ã€åŸºäºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

1. HTTPæµå¼ä¼ è¾“åè®®

# 1.1 Streamable HTTPåè®®ç®€ä»‹

# 1.2 HTTPè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

1.3 HTTPæœåŠ¡å™¨å¤–éƒ¨å·¥å…·è°ƒç”¨è¯†åˆ«ä¸è°ƒç”¨æµç¨‹

1.4 HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡æµç¨‹

![Image](pdf_images\page136_img1.png)

## 2. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å‘æµç¨‹

## 3. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å¯ä¸æµ‹è¯• 4. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨Cherry Studioè°ƒç”¨æµ‹è¯•

5. è‡ªå®šä¹‰MCPå®¢æˆ·ç«¯Clientæ¥å…¥HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨

# 5.1 ç¼–å†™client.pyè„šæœ¬

# 5.2 åˆ›å»º.envå’Œservers_config.jsonæ–‡ä»¶ 5.3 å€ŸåŠ©è‡ªå®šä¹‰clientæ¥å…¥æµå¼HTTP MCPæœåŠ¡å™¨

# æµå¼HTTP MCPæœåŠ¡å™¨å¼€å‘æŒ‡å—

# ä¸€ã€åŸºäºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨å¼€å‘æµç¨‹ äºŒã€HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å¯ä¸æµ‹è¯•

# ä¸‰ã€æµå¼HTTP MCPæœåŠ¡å™¨å¼‚åœ°è°ƒç”¨

# å››ã€æµå¼HTTP MCPæœåŠ¡å™¨å‘å¸ƒæµç¨‹

# Anthropic MCPå‘å¸ƒé€šå‘Šï¼šhttps://www.anthropic.com/news/model-context-protocol

# MCP GitHubä¸»é¡µï¼šhttps://github.com/modelcontextprotocol

# ä¸€ã€MCPæŠ€æœ¯ä½“ç³»ä»‹ç»

1. MCPå…¥é—¨ä»‹ç»

# MCPï¼Œå…¨ç§°æ˜¯Model Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼Œç”±Claudeæ¯å…¬å¸Anthropicäºå»å¹´11æœˆæ­£å¼

# æå‡ºã€‚

# MCPåˆšå‘å¸ƒçš„æ—¶å€™ä¸æ¸©ä¸ç«ï¼Œç›´åˆ°ä»Šå¹´Agentå¤§çˆ†å‘æ‰è¢«å¹¿æ³›å…³æ³¨ã€‚è€Œåœ¨ä»Šå¹´2æœˆï¼ŒCursoræ­£å¼å®£å¸ƒåŠ å…¥

# MCPåŠŸèƒ½æ”¯æŒï¼Œä¸€ä¸¾å°†MCPæ¨åˆ°äº†å…¨ä½“å¼€å‘äººå‘˜é¢å‰ã€‚ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒMCPæ˜¯ä¸€ç§æŠ€æœ¯åè®®ï¼Œä¸€ç§æ™ºèƒ½

# ä½“Agentå¼€å‘è¿‡ç¨‹ä¸­å…±åŒçº¦å®šçš„ä¸€ç§è§„èŒƒã€‚è¿™å°±å¥½æ¯”ç§¦å§‹çš‡çš„â€œä¹¦åŒæ–‡ã€è½¦åŒè½¨â€ï¼Œåœ¨ç»Ÿä¸€çš„è§„èŒƒä¸‹ï¼Œå¤§å®¶

# çš„åä½œæ•ˆç‡å°±èƒ½å¤§å¹…æé«˜ï¼Œæœ€ç»ˆæå‡æ™ºèƒ½ä½“Agentçš„å¼€å‘æ•ˆç‡ã€‚æˆªæ­¢ç›®å‰ï¼Œå·²ä¸Šåƒç§MCPå·¥å…·è¯ç”Ÿï¼Œåœ¨

å¼ºæ‚çš„MCPç”Ÿæ€åŠ æŒä¸‹ï¼Œ äººäººæ‰‹æ“Manusçš„æ—¶ä»£å³å°†åˆ°æ¥ã€‚

![Image](pdf_images\page137_img1.png)

![Image](pdf_images\page137_img2.png)

## 7åˆ†é’Ÿè®²æ¸…æ¥šMCPæ˜¯ä»€ä¹ˆï¼Ÿhttps://www.bilibili.com/video/BV1uXQzYaEpJ/

# æ€»çš„æ¥è¯´ï¼ŒMCPè§£å†³çš„æœ€å¤§ç—›ç‚¹ï¼Œå°±æ˜¯Agentå¼€å‘ä¸­è°ƒç”¨å¤–éƒ¨å·¥å…·çš„æŠ€æœ¯é—¨æ§›è¿‡é«˜çš„é—®é¢˜ã€‚

# æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œèƒ½è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œæ˜¯å¤§æ¨¡å‹è¿›åŒ–ä¸ºæ™ºèƒ½ä½“Agentçš„å…³é”®ï¼Œå¦‚æœä¸èƒ½ä½¿ç”¨å¤–éƒ¨å·¥å…·ï¼Œå¤§æ¨¡å‹å°± åªèƒ½æ˜¯ä¸ªç®€å•çš„èŠå¤©æœºå™¨äººï¼Œç”šè‡³è¿æŸ¥è¯¢å¤©æ°”éƒ½åšä¸åˆ°ã€‚ç”±äºåº•å±‚æŠ€æœ¯é™åˆ¶å•Šï¼Œå¤§æ¨¡å‹æœ¬èº«æ˜¯æ— æ³•å’Œå¤–

# éƒ¨å·¥å…·ç›´æ¥é€šä¿¡çš„ï¼Œå› æ­¤Function callingçš„æ€è·¯ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼ˆfunctionï¼‰ä½œä¸ºä¸­ä»‹ï¼Œä¸€è¾¹

# ä¼ é€’å¤§æ¨¡å‹çš„è¯·æ±‚ï¼Œå¦ä¸€è¾¹è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼Œæœ€ç»ˆè®©å¤§æ¨¡å‹èƒ½å¤Ÿé—´æ¥çš„è°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚

# ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è¦æŸ¥è¯¢å½“å‰å¤©æ°”æ—¶ï¼Œè®©å¤§æ¨¡å‹è°ƒç”¨å¤–éƒ¨å·¥å…·çš„function callingçš„è¿‡ç¨‹å°±å¦‚å›¾æ‰€ç¤ºï¼š

![Image](pdf_images\page138_img1.png)

# Function callingæ˜¯ä¸ªéå¸¸ä¸é”™çš„æŠ€æœ¯è®¾è®¡ï¼Œè‡ªè¯ç”Ÿä»¥æ¥ï¼Œä¸€ç›´è¢«ä¸šå†…å¥‰ä¸ºåœ­è‡¬ã€‚ä½†å”¯ä¸€çš„é—®é¢˜å°±æ˜¯ï¼Œç¼–

# å†™è¿™ä¸ªå¤–éƒ¨å‡½æ•°çš„å·¥ä½œé‡å¤ªå¤§äº†ï¼Œä¸€ä¸ªç®€å•çš„å¤–éƒ¨å‡½æ•°å¾€å¾€å°±å¾—ä¸Šç™¾è¡Œä»£ç ï¼Œè€Œä¸”ï¼Œä¸ºäº†è®©å¤§æ¨¡å‹â€œè®¤è¯†â€

# è¿™äº›å¤–éƒ¨å‡½æ•°ï¼Œæˆ‘ä»¬è¿˜è¦é¢å¤–ä¸ºæ¯ä¸ªå¤–éƒ¨å‡½æ•°ç¼–å†™ä¸€ä¸ªJSON Schemaæ ¼å¼çš„åŠŸèƒ½è¯´æ˜ï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€

# è¦ç²¾å¿ƒè®¾è®¡ä¸€ä¸ªæç¤ºè¯æ¨¡ç‰ˆï¼Œæ‰èƒ½æé«˜Function callingå“åº”çš„å‡†ç¡®ç‡ã€‚

# è€ŒMCPçš„ç›®æ ‡ï¼Œå°±æ˜¯èƒ½åœ¨Agentå¼€å‘è¿‡ç¨‹ä¸­ï¼Œè®©å¤§æ¨¡å‹æ›´åŠ ä¾¿æ·çš„è°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚ä¸ºæ­¤ï¼ŒMCPæå‡ºäº†ä¸¤

# ä¸ªæ–¹æ¡ˆï¼Œå…¶ä¸€ï¼Œâ€œè½¦åŒè½¨ã€ä¹¦åŒæ–‡â€ï¼Œç»Ÿä¸€Function callingçš„è¿è¡Œè§„èŒƒã€‚

# é¦–å…ˆæ˜¯å…ˆç»Ÿä¸€åç§°ï¼ŒMCPæŠŠå¤§æ¨¡å‹è¿è¡Œç¯å¢ƒç§°ä½œ MCP Clientï¼Œä¹Ÿå°±æ˜¯MCPå®¢æˆ·ç«¯ï¼ŒåŒæ—¶ï¼ŒæŠŠå¤–éƒ¨å‡½æ•°è¿

# è¡Œç¯å¢ƒç§°ä½œMCP Serverï¼Œä¹Ÿå°±æ˜¯MCPæœåŠ¡å™¨ï¼Œ

![Image](pdf_images\page139_img1.png)

# ç„¶åï¼Œç»Ÿä¸€MCPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„è¿è¡Œè§„èŒƒï¼Œå¹¶ä¸”è¦æ±‚MCPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œä¹Ÿç»Ÿä¸€æŒ‰ç…§æŸä¸ªæ—¢å®š

# çš„æç¤ºè¯æ¨¡æ¿è¿›è¡Œé€šä¿¡ã€‚

â€œè½¦åŒè½¨ã€ä¹¦åŒæ–‡â€æœ€å¤§çš„å¥½å¤„å°±åœ¨äºï¼Œå¯ä»¥é¿å…MCPæœåŠ¡å™¨çš„é‡å¤å¼€å‘ï¼Œä¹Ÿå°±æ˜¯é¿å…å¤–éƒ¨å‡½æ•°é‡å¤ç¼–å†™ã€‚

# ä¾‹å¦‚ï¼ŒåƒæŸ¥è¯¢å¤©æ°”ã€ç½‘é¡µçˆ¬å–ã€æŸ¥è¯¢æœ¬åœ°MySQLæ•°æ®åº“è¿™ç§é€šç”¨çš„éœ€æ±‚ï¼Œå¤§å®¶æœ‰ä¸€ä¸ªäººå¼€å‘äº†ä¸€ä¸ªæœåŠ¡

# å™¨å°±å¥½ï¼Œå¼€å‘å®Œå¤§å®¶éƒ½èƒ½å¤åˆ¶åˆ°è‡ªå·±çš„é¡¹ç›®é‡Œæ¥ä½¿ç”¨ï¼Œä¸ç”¨æ¯ä¸ªäººæ¯æ¬¡éƒ½å•ç‹¬å†™ä¸€å¥—ã€‚

# è¿™å¯æ˜¯ä¿ƒè¿›å…¨çƒAIå¼€å‘è€…å…±åŒåä½œçš„å¥½äº‹å„¿ï¼Œå¾ˆå¿«ï¼ŒGitHubä¸Šå°±å‡ºç°äº†æµ·é‡çš„å·²ç»å¼€å‘å¥½çš„MCP æœåŠ¡

å™¨ï¼Œä»SQLæ•°æ®åº“æ£€ç´¢ã€åˆ°ç½‘é¡µæµè§ˆä¿¡æ¯çˆ¬å–ï¼Œä»å‘½ä»¤è¡Œæ“ä½œç”µè„‘ã€åˆ°æ•°æ®åˆ†ææœºå™¨å­¦ä¹ å»ºæ¨¡ï¼Œç­‰ç­‰ç­‰ ç­‰ï¼Œä¸ä¸€è€Œè¶³ã€‚

![Image](pdf_images\page142_img1.png)

# ç°åœ¨ï¼Œåªè¦ä½ æœ¬åœ°è¿è¡Œçš„å¤§æ¨¡å‹æ”¯æŒMCPåè®®ï¼Œä¹Ÿå°±æ˜¯åªè¦å®‰è£…äº†ç›¸å…³çš„åº“ï¼Œä»…éœ€å‡ è¡Œä»£ç å³å¯æ¥å…¥è¿™

# äº›æµ·é‡çš„å¤–éƒ¨å·¥å…·ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰Agentå¼€å‘é—¨æ§›ç¬é—´é™ä½äº†å‘¢ã€‚

# è¿™ç§â€œè½¦åŒè½¨ã€ä¹¦åŒæ–‡â€çš„è§„èŒƒï¼Œåœ¨æŠ€æœ¯é¢†åŸŸå°±è¢«ç§°ä½œåè®®ï¼Œä¾‹å¦‚httpå°±æ˜¯ç½‘ç»œä¿¡æ¯äº¤æ¢çš„æŠ€æœ¯åè®®ã€‚å„ç±»

# æŠ€æœ¯åè®®çš„ç›®æ ‡ï¼Œéƒ½æ˜¯å¸Œæœ›é€šè¿‡æé«˜åä½œæ•ˆç‡æ¥æå‡å¼€å‘æ•ˆç‡ï¼Œè€ŒMCPï¼ŒModel Context Protocolï¼Œå°±

# æ˜¯ä¸€ç§æ—¨åœ¨æé«˜å¤§æ¨¡å‹Agentå¼€å‘æ•ˆç‡çš„æŠ€æœ¯åè®®ã€‚

![Image](pdf_images\page143_img1.png)

![Image](pdf_images\page143_img2.png)

## é‚£æ—¢ç„¶æ˜¯åè®®ï¼Œå¿…ç„¶æ˜¯ä½¿ç”¨çš„äººè¶Šå¤šæ‰è¶Šæœ‰ç”¨ã€‚å› æ­¤ï¼Œä¸ºäº†è¿›ä¸€æ™®åŠMCPåè®®ï¼ŒAnthropicè¿˜æä¾›äº†ä¸€æ•´

## å¥—MCPå®¢æˆ·ç«¯ã€æœåŠ¡å™¨å¼€å‘çš„SDKï¼Œä¹Ÿå°±æ˜¯å¼€å‘å·¥å…·ï¼Œå¹¶ä¸”æ”¯æŒPythonã€TSå’ŒJavaç­‰å¤šç§è¯­è¨€ï¼Œå€ŸåŠ©

SDKï¼Œä»…éœ€å‡ è¡Œä»£ç ï¼Œå°±å¯ä»¥å¿«é€Ÿå¼€å‘ä¸€ä¸ªMCPæœåŠ¡å™¨ã€‚

ç„¶åï¼Œä½ å°±å¯ä»¥æŠŠå®ƒæ¥å…¥ä»»æ„ä¸€ä¸ªMCPå®¢æˆ·ç«¯æ¥æ„å»ºæ™ºèƒ½ä½“ï¼Œå¦‚æœæ„¿æ„ï¼Œè¿˜å¯ä»¥æŠŠMCPæœåŠ¡å™¨åˆ†äº«åˆ°ç¤¾ åŒºï¼Œç»™æœ‰éœ€æ±‚çš„å¼€å‘è€…ä½¿ç”¨ï¼Œç”šè‡³ä½ è¿˜å¯ä»¥æŠŠä½ çš„MCPæœåŠ¡å™¨æ”¾åˆ°çº¿ä¸Šè¿è¡Œï¼Œè®©ç”¨æˆ·ä»˜è´¹ä½¿ç”¨ã€‚

# è€ŒMCPçš„å®¢æˆ·ç«¯ï¼Œä¸ä»…æ”¯æŒClaudeæ¨¡å‹ï¼Œä¹Ÿæ”¯æŒä»»æ„æœ¬åœ°æ¨¡å‹æˆ–è€…åœ¨çº¿å¤§æ¨¡å‹ï¼Œæˆ–è€…æ˜¯ä¸€äº›IDEã€‚ä¾‹ å¦‚ï¼Œç°åœ¨Cursoræ­£å¼æ¥å…¥MCPï¼Œä»£è¡¨ç€Cursoræ­£å¼æˆä¸ºMCPå®¢æˆ·ç«¯ï¼Œåœ¨Cursorä¸­ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½å¿«é€Ÿç¼–å†™

# MCPæœåŠ¡å™¨ï¼ˆå¤–éƒ¨å‡½æ•°ï¼‰ï¼Œæ›´èƒ½å€ŸåŠ©Cursorä¸€é”®è¿æ¥ä¸Šæˆç™¾ä¸Šåƒçš„å¼€æºMCPæœåŠ¡å™¨ï¼Œè®©å¤§æ¨¡å‹å¿«é€Ÿæ¥å…¥

# æµ·é‡å·¥å…·ï¼Œä»è€Œå¤§å¹…åŠ å¿«Agentå¼€å‘è¿›åº¦ã€‚

![Image](pdf_images\page147_img1.png)

![Image](pdf_images\page147_img2.png)

![Image](pdf_images\page147_img3.png)

## 2. MCPæ™ºèƒ½ä½“å¼€å‘å…¥é—¨é¡¹ç›®

# äºŒã€GraphRAGåŸºäºçŸ¥è¯†å›¾è°±çš„æ£€ç´¢å¢å¼ºæŠ€æœ¯

# ã€6å°æ—¶æœ€å¼ºåˆé›†ã€‘GraphRAGä»åŸç†åˆ°å®æˆ˜æŠ€æœ¯ç²¾è®²ï¼šhttps://www.bilibili.com/video/BV1uCifY

# LEQd/

# GraphRAG é¡¹ç›®åœ°å€ï¼šhttps://github.com/microsoft/graphrag/

![Image](pdf_images\page148_img1.png)

![Image](pdf_images\page148_img2.png)

# 1.GraphRAGå…¥é—¨ä»‹ç»

# æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ æ˜¯ä¸€ç§é€šè¿‡ç»“åˆçœŸå®ä¸–ç•Œçš„ä¿¡æ¯æ¥æå‡å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¾“å‡ºè´¨é‡çš„æŠ€

# æœ¯ã€‚RAG æŠ€æœ¯æ˜¯å¤§å¤šæ•°åŸºäº LLM çš„å·¥å…·ä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚å¤§å¤šæ•° RAG æ–¹æ³•ä½¿ç”¨ å‘é‡ç›¸ä¼¼æ€§ ä½œä¸º æ£€ç´¢æŠ€æœ¯ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸º åŸºçº¿ RAGï¼ˆBaseline RAGï¼‰ã€‚

# RAG æŠ€æœ¯åœ¨å¸®åŠ© LLM æ¨ç†ç§æœ‰æ•°æ®é›†æ–¹é¢æ˜¾ç¤ºäº†å¾ˆå¤§çš„æ½œåŠ›â€”â€”ä¾‹å¦‚ï¼ŒLLM æ²¡æœ‰åœ¨è®­ç»ƒæ—¶æ¥è§¦è¿‡ çš„ã€ä¼ä¸šçš„ä¸“æœ‰ç ”ç©¶ã€ä¸šåŠ¡æ–‡æ¡£æˆ–é€šä¿¡æ•°æ®ã€‚åŸºçº¿ RAG æŠ€æœ¯æœ€åˆæ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œæå‡ºçš„ï¼Œä½†æˆ‘ä»¬

è§‚å¯Ÿåˆ°ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒåŸºçº¿ RAG çš„è¡¨ç°å¹¶ä¸ç†æƒ³ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…¸å‹çš„åœºæ™¯ï¼š

1. åŸºçº¿ RAG å¾ˆéš¾å°†ä¿¡æ¯ä¸²è”èµ·æ¥ï¼šå½“ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆéœ€è¦é€šè¿‡å¤šä¸ªä¸åŒçš„ä¿¡æ¯ç‰‡æ®µï¼Œå¹¶é€šè¿‡å®ƒä»¬å…±

äº«çš„å±æ€§æ¥è¿æ¥ï¼Œè¿›è€Œæä¾›æ–°çš„ç»¼åˆè§è§£æ—¶ï¼ŒåŸºçº¿ RAG è¡¨ç°å¾—å¾ˆå·®ã€‚

# ä¾‹å¦‚ï¼Œåœ¨å›ç­”ç±»ä¼¼â€œå¦‚ä½•é€šè¿‡ç°æœ‰çš„æ•°æ®æ¨æ–­å‡ºæ–°ç»“è®ºâ€è¿™ç§é—®é¢˜æ—¶ï¼ŒåŸºçº¿ RAG æ— æ³•å¾ˆå¥½åœ°å¤„ç†è¿™äº›

# æ•£å¸ƒåœ¨ä¸åŒæ–‡æ¡£ä¸­çš„ç›¸å…³ä¿¡æ¯ï¼Œå®ƒå¯èƒ½ä¼šé—æ¼ä¸€äº›å…³é”®è”ç³»ç‚¹ã€‚

2. åŸºçº¿ RAG æ— æ³•æœ‰æ•ˆç†è§£å¤§å‹æ•°æ®é›†æˆ–å•ä¸€å¤§æ–‡æ¡£çš„æ•´ä½“è¯­ä¹‰æ¦‚å¿µï¼šå½“è¢«è¦æ±‚åœ¨å¤§é‡æ•°æ®æˆ–å¤æ‚æ–‡

æ¡£ä¸­è¿›è¡Œæ€»ç»“ã€æç‚¼å’Œç†è§£æ—¶ï¼ŒåŸºçº¿ RAG å¾€å¾€è¡¨ç°ä¸ä½³ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœé—®é¢˜è¦æ±‚å¯¹æ•´ä¸ªæ–‡æ¡£æˆ–å¤šç¯‡æ–‡æ¡£çš„ä¸»é¢˜è¿›è¡Œæ€»ç»“å’Œç†è§£ï¼ŒåŸºçº¿ RAG çš„ç®€å•å‘é‡æ£€ç´¢æ–¹æ³• å¯èƒ½æ— æ³•å¤„ç†æ–‡æ¡£é—´çš„å¤æ‚å…³ç³»ï¼Œå¯¼è‡´å¯¹å…¨å±€è¯­ä¹‰çš„ç†è§£ä¸å®Œæ•´ã€‚

# ä¸ºäº†åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼ŒæŠ€æœ¯ç¤¾åŒºæ­£åœ¨åŠªåŠ›å¼€å‘æ‰©å±•å’Œå¢å¼º RAG çš„æ–¹æ³•ã€‚å¾®è½¯ç ”ç©¶é™¢ï¼ˆMicrosoft

# Researchï¼‰æå‡ºçš„ GraphRAG æ–¹æ³•ï¼Œä½¿ç”¨ LLM åŸºäºè¾“å…¥è¯­æ–™åº“æ„å»º çŸ¥è¯†å›¾è°±ã€‚è¿™ä¸ªå›¾è°±ä¸ç¤¾åŒºæ€»ç»“å’Œ

# å›¾è°±æœºå™¨å­¦ä¹ è¾“å‡ºç»“åˆï¼Œèƒ½å¤Ÿåœ¨æŸ¥è¯¢æ—¶å¢å¼ºæç¤ºï¼ˆpromptï¼‰ã€‚GraphRAG åœ¨å›ç­”ä»¥ä¸Šä¸¤ç±»é—®é¢˜æ—¶ï¼Œå±•ç¤º

# äº† æ˜¾è‘—çš„æ”¹è¿›ï¼Œå°¤å…¶æ˜¯åœ¨ å¤æ‚ä¿¡æ¯çš„æ¨ç†èƒ½åŠ› å’Œ æ™ºèƒ½æ€§ ä¸Šï¼Œè¶…è¶Šäº†åŸºçº¿ RAG ä¹‹å‰åº”ç”¨äºç§æœ‰æ•°æ®é›†çš„

# å…¶ä»–æ–¹æ³•ã€‚

![Image](pdf_images\page149_img1.png)

## 2.GraphRAGåŸºæœ¬åŸç†å›é¡¾

# GraphRAG æ˜¯å¾®è½¯ç ”ç©¶é™¢å¼€å‘çš„ä¸€ç§å…ˆè¿›çš„å¢å¼ºæ£€ç´¢ç”Ÿæˆï¼ˆRAGï¼‰æ¡†æ¶ï¼Œæ—¨åœ¨æå‡è¯­è¨€æ¨¡å‹

# ï¼ˆLLMï¼‰åœ¨å¤„ç†å¤æ‚æ•°æ®æ—¶çš„æ€§èƒ½ã€‚ä¸ä¼ ç»Ÿçš„ RAG æ–¹æ³•ä¾èµ–å‘é‡ç›¸ä¼¼æ€§æ£€ç´¢ä¸åŒï¼ŒGraphRAG åˆ©ç”¨ çŸ¥ è¯†å›¾è°± æ¥æ˜¾è‘—å¢å¼ºè¯­è¨€æ¨¡å‹çš„é—®ç­”èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†ç§æœ‰æ•°æ®é›†æˆ–å¤§å‹ã€å¤æ‚æ•°æ®é›†æ—¶è¡¨ç°å°¤ä¸ºå‡º

# è‰²ã€‚

# ä¼ ç»Ÿçš„ Baseline RAG æ–¹æ³•åœ¨æŸäº›æƒ…å†µä¸‹è¡¨ç°ä¸ä½³ï¼Œå°¤å…¶æ˜¯å½“æŸ¥è¯¢éœ€è¦åœ¨ä¸åŒä¿¡æ¯ç‰‡æ®µä¹‹é—´å»ºç«‹è”

# ç³»æ—¶ï¼Œæˆ–æ˜¯å½“éœ€è¦å¯¹å¤§è§„æ¨¡æ•°æ®é›†è¿›è¡Œæ•´ä½“ç†è§£æ—¶ã€‚GraphRAG é€šè¿‡ä»¥ä¸‹æ–¹å¼å…‹æœäº†è¿™äº›é—®é¢˜ï¼š

# æ›´å¥½çš„è¿æ¥ä¿¡æ¯ç‚¹ï¼šGraphRAG èƒ½å¤Ÿå¤„ç†é‚£äº›éœ€è¦ä»å¤šä¸ªæ•°æ®ç‚¹åˆæˆæ–°è§è§£çš„ä»»åŠ¡ã€‚

# æ›´å…¨é¢çš„ç†è§£èƒ½åŠ›ï¼šGraphRAG æ›´æ“…é•¿å¯¹å¤§å‹æ•°æ®é›†è¿›è¡Œå…¨é¢ç†è§£ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†å¤æ‚çš„æŠ½è±¡é—®

# é¢˜ã€‚

# è€Œå€ŸåŠ©å¾®è½¯å¼€æºçš„GeaphRAGé¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿåšåˆ°ä»¥ä¸‹äº‹é¡¹ï¼š

# åŸºäºå›¾çš„æ£€ç´¢ï¼šä¼ ç»Ÿçš„ RAG æ–¹æ³•ä½¿ç”¨å‘é‡ç›¸ä¼¼æ€§è¿›è¡Œæ£€ç´¢ï¼Œè€Œ GraphRAG å¼•å…¥äº†çŸ¥è¯†å›¾è°±æ¥æ•æ‰ å®ä½“ã€å…³ç³»åŠå…¶ä»–é‡è¦å…ƒæ•°æ®ï¼Œä»è€Œæ›´æœ‰æ•ˆåœ°è¿›è¡Œæ¨ç†ã€‚

# å±‚æ¬¡èšç±»ï¼šGraphRAG ä½¿ç”¨ Leiden æŠ€æœ¯è¿›è¡Œå±‚æ¬¡èšç±»ï¼Œå°†å®ä½“åŠå…¶å…³ç³»è¿›è¡Œç»„ç»‡ï¼Œæä¾›æ›´ä¸°å¯Œçš„

# ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥å¤„ç†å¤æ‚çš„æŸ¥è¯¢ã€‚

# å¤šæ¨¡å¼æŸ¥è¯¢ï¼šæ”¯æŒå¤šç§æŸ¥è¯¢æ¨¡å¼ï¼š

# å…¨å±€æœç´¢ï¼šé€šè¿‡åˆ©ç”¨ç¤¾åŒºæ€»ç»“æ¥è¿›è¡Œå…¨å±€æ€§æ¨ç†ã€‚

# å±€éƒ¨æœç´¢ï¼šé€šè¿‡æ‰©å±•ç›¸å…³å®ä½“çš„é‚»å±…å’Œå…³è”æ¦‚å¿µæ¥è¿›è¡Œå…·ä½“å®ä½“çš„æ¨ç†ã€‚

DRIFT æœç´¢ï¼šç»“åˆå±€éƒ¨æœç´¢å’Œç¤¾åŒºä¿¡æ¯ï¼Œæä¾›æ›´å‡†ç¡®å’Œç›¸å…³çš„ç­”æ¡ˆã€‚

# å›¾æœºå™¨å­¦ä¹ ï¼šé›†æˆäº†å›¾æœºå™¨å­¦ä¹ æŠ€æœ¯ï¼Œæå‡æŸ¥è¯¢å“åº”è´¨é‡ï¼Œå¹¶æä¾›æ¥è‡ªç»“æ„åŒ–å’Œéç»“æ„åŒ–æ•°æ®çš„æ·±

# åº¦æ´å¯Ÿã€‚

# Prompt è°ƒä¼˜ï¼šæä¾›è°ƒä¼˜å·¥å…·ï¼Œå¸®åŠ©æ ¹æ®ç‰¹å®šæ•°æ®å’Œéœ€æ±‚è°ƒæ•´æŸ¥è¯¢æç¤ºï¼Œä»è€Œæé«˜ç»“æœè´¨é‡ã€‚

3. GraphRAGè¿è¡Œæµç¨‹

# 3.1 ç´¢å¼•ï¼ˆIndexingï¼‰è¿‡ç¨‹

1. æ–‡æœ¬å•å…ƒåˆ‡åˆ†ï¼šå°†è¾“å…¥æ–‡æœ¬åˆ†å‰²æˆ TextUnitsï¼Œæ¯ä¸ª TextUnit æ˜¯ä¸€ä¸ªå¯åˆ†æçš„å•å…ƒï¼Œç”¨äºæå–å…³

# é”®ä¿¡æ¯ã€‚

2. å®ä½“å’Œå…³ç³»æå–ï¼šä½¿ç”¨ LLM ä» TextUnits ä¸­æå–å®ä½“ã€å…³ç³»å’Œå…³é”®å£°æ˜ã€‚

3. å›¾æ„å»ºï¼šæ„å»ºçŸ¥è¯†å›¾è°±ï¼Œä½¿ç”¨ Leiden ç®—æ³•è¿›è¡Œå®ä½“çš„å±‚æ¬¡èšç±»ã€‚æ¯ä¸ªå®ä½“ç”¨èŠ‚ç‚¹è¡¨ç¤ºï¼ŒèŠ‚ç‚¹çš„å¤§

å°å’Œé¢œè‰²åˆ†åˆ«ä»£è¡¨å®ä½“çš„åº¦æ•°å’Œæ‰€å±ç¤¾åŒºã€‚

4. ç¤¾åŒºæ€»ç»“ï¼šä»ä¸‹åˆ°ä¸Šç”Ÿæˆæ¯ä¸ªç¤¾åŒºåŠå…¶æˆå‘˜çš„æ€»ç»“ï¼Œå¸®åŠ©å…¨å±€ç†è§£æ•°æ®é›†ã€‚

![Image](pdf_images\page150_img1.png)

![Image](pdf_images\page150_img2.png)

## 3.2 æŸ¥è¯¢ï¼ˆQueryï¼‰è¿‡ç¨‹

# ç´¢å¼•å®Œæˆåï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¸åŒçš„æœç´¢æ¨¡å¼è¿›è¡ŒæŸ¥è¯¢ï¼š

# å…¨å±€æœç´¢ï¼šå½“æˆ‘ä»¬æƒ³äº†è§£æ•´ä¸ªè¯­æ–™åº“æˆ–æ•°æ®é›†çš„æ•´ä½“æ¦‚å†µæ—¶ï¼ŒGraphRAG å¯ä»¥åˆ©ç”¨ ç¤¾åŒºæ€»ç»“ æ¥å¿«

# é€Ÿæ¨ç†å’Œè·å–ä¿¡æ¯ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äºå¤§èŒƒå›´é—®é¢˜ï¼Œå¦‚æŸä¸ªä¸»é¢˜çš„æ€»ä½“ç†è§£ã€‚

# å±€éƒ¨æœç´¢ï¼šå¦‚æœé—®é¢˜å…³æ³¨äºæŸä¸ªç‰¹å®šçš„å®ä½“ï¼ŒGraphRAG ä¼šå‘è¯¥å®ä½“çš„ é‚»å±…ï¼ˆå³ç›¸å…³å®ä½“ï¼‰æ‰©å±•æœ

# ç´¢ï¼Œä»¥è·å¾—æ›´è¯¦ç»†å’Œç²¾å‡†çš„ç­”æ¡ˆã€‚

DRIFT æœç´¢ï¼šè¿™æ˜¯å¯¹å±€éƒ¨æœç´¢çš„å¢å¼ºï¼Œé™¤äº†è·å–é‚»å±…å’Œç›¸å…³æ¦‚å¿µï¼Œè¿˜å¼•å…¥äº† ç¤¾åŒºä¿¡æ¯ çš„ä¸Šä¸‹æ–‡ï¼Œ

# ä»è€Œæä¾›æ›´æ·±å…¥çš„æ¨ç†å’Œè¿æ¥ã€‚

# 3.3 Prompt è°ƒä¼˜

# ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼ŒGraphRAG å¼ºçƒˆå»ºè®®è¿›è¡Œ Prompt è°ƒä¼˜ï¼Œç¡®ä¿æ¨¡å‹å¯ä»¥æ ¹æ®ä½ çš„ç‰¹å®šæ•°æ®å’ŒæŸ¥è¯¢éœ€

# æ±‚è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œæä¾›æ›´å‡†ç¡®å’Œç›¸å…³çš„ç­”æ¡ˆã€‚

# 3.4 GraphRAGè®¡ç®—æµç¨‹æç®€ç¤ºä¾‹

# 4.GraphRAGå®‰è£…ä¸Indexing&Queryæµç¨‹å®ç°

# æ³¨æ„ï¼Œä»¥ä¸‹å†…å®¹åœ¨Jupyterä¸­é€šè¿‡ä»£ç å®Œæˆï¼Œæ‰«ç å³å¯é¢†å–è¯¾ä»¶ä»£ç ã€‚

## 5.GraphRAG APIä½¿ç”¨æ–¹æ³•

![Image](pdf_images\page162_img1.png)

![Image](pdf_images\page162_img2.png)

# ä¸‰ã€MCP+GraphRAGæ­å»ºæ£€ç´¢å¢å¼ºæ™ºèƒ½ä½“

# æ¥ä¸‹æ¥å³å¯æ ¹æ®GraphRAG APIçš„è°ƒç”¨æ–¹æ³•ï¼Œæ¥åˆ›å»ºä¸€ä¸ªåŸºäºGraphRAGçš„MCPæ™ºèƒ½ä½“æœåŠ¡å™¨ï¼Œå¹¶å°

# è¯•åœ¨æœ¬åœ°clientå¯¹å…¶è¿›è¡Œè°ƒç”¨ã€‚

# 1.MCP+GraphRAGé¡¹ç›®ç¯å¢ƒæ­å»º

# 1.1 åˆ›å»º MCP å®¢æˆ·ç«¯é¡¹ç›®

# # åˆ›å»ºé¡¹ç›®ç›®å½•

# uv init mcp-graphrag

# cd mcp-graphrag

![Image](pdf_images\page163_img1.png)

![Image](pdf_images\page163_img2.png)

![Image](pdf_images\page163_img3.png)

# 1.2 åˆ›å»ºMCPå®¢æˆ·ç«¯è™šæ‹Ÿç¯å¢ƒ

# # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

# uv venv

# # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

# source .venv/bin/activate

# è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›¸æ¯”pipï¼Œuvä¼šè‡ªåŠ¨è¯†åˆ«å½“å‰é¡¹ç›®ä¸»ç›®å½•å¹¶åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚

# ç„¶åå³å¯é€šè¿‡addæ–¹æ³•åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…ç›¸å…³çš„åº“ã€‚

# # å®‰è£… MCP SDK

uv add mcp graphrag pathlib pandas

# 1.3 åˆ›å»ºGraphRAGå¹¶æ„å»ºç´¢å¼•ï¼ˆIndexï¼‰

# åˆ›å»ºé¡¹ç›®ç›®å½•å¹¶è¿›è¡Œåˆå§‹åŒ–

mkdir -p ./graphrag/input

graphrag init --root ./graphrag

![Image](pdf_images\page164_img1.png)

![Image](pdf_images\page164_img2.png)

![Image](pdf_images\page164_img3.png)

# ä¿®æ”¹é…ç½®æ–‡ä»¶

# æ‰“å¼€.envæ–‡ä»¶ï¼Œå¡«å†™DeepSeek API-KEYæˆ–OpenAI API-Key

# æ‰“å¼€setting.yamlæ–‡ä»¶ï¼Œå¡«å†™æ¨¡å‹åç§°å’Œä»£ç†åœ°å€ï¼š

# ä¸Šä¼ æ–‡æœ¬æ•°æ®

![Image](pdf_images\page165_img1.png)

![Image](pdf_images\page165_img2.png)

![Image](pdf_images\page165_img3.png)

# indexè¿‡ç¨‹

# graphrag index --root ./graphrag

# 2.åˆ›å»ºGraphRAGæœåŠ¡å™¨Server

# è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå½“å‰åˆ›å»ºçš„GraphRAG Serveråªè´Ÿè´£è¿›è¡Œå¯¹æŸä¸€ä¸ªå®ŒæˆIndexçš„çŸ¥è¯†åº“è¿›è¡ŒQueryï¼Œ

# æ›´åŠ å¤æ‚çš„å¦‚æ–‡ä»¶ç®¡ç†ã€å®æ—¶å¢åŠ æ£€ç´¢ã€å¤šæ–‡ä»¶åº“æ£€ç´¢ç­‰ï¼Œè¯¦è§2025å¤§æ¨¡å‹Agentæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ã€‹

# ï¼ˆæ˜¥å­£ç­ï¼‰https://whakv.xetslk.com/s/pxKHGå†…å®¹ä»‹ç»ã€‚

![Image](pdf_images\page166_img1.png)

![Image](pdf_images\page166_img2.png)

# è¿™é‡Œæˆ‘ä»¬åœ¨å½“å‰é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºrag_server.pyçš„serverï¼Œ

![Image](pdf_images\page167_img1.png)

# å¹¶å†™å…¥å¦‚ä¸‹ä»£ç ï¼š

# from pathlib import Path

# from pprint import pprint

# import pandas as pd

# import graphrag.api as api

# from graphrag.config.load_config import load_config

# from graphrag.index.typing.pipeline_run_result import PipelineRunResult

from typing import Any

# from mcp.server.fastmcp import FastMCP

# # åˆå§‹åŒ– MCP æœåŠ¡å™¨

mcp = FastMCP("rag_ML")

# USER_AGENT = "rag_ML-app/1.0"

# @mcp.tool()

# async def rag_ML(query: str) -> str:

"""

# ç”¨äºæŸ¥è¯¢æœºå™¨å­¦ä¹ å†³ç­–æ ‘ç›¸å…³ä¿¡æ¯ã€‚

# :param query: ç”¨æˆ·æå‡ºçš„å…·ä½“é—®é¢˜ :return: æœ€ç»ˆè·å¾—çš„ç­”æ¡ˆ

"""

# PROJECT_DIRECTORY = "/root/autodl-tmp/MCP/mcp-graphrag/graphrag"

# graphrag_config = load_config(Path(PROJECT_DIRECTORY))

# # åŠ è½½å®ä½“

entities = pd.read_parquet(f"{PROJECT_DIRECTORY}/output/entities.parquet") # åŠ è½½ç¤¾åŒº

communities = pd.read_parquet(f"

# {PROJECT_DIRECTORY}/output/communities.parquet")

# åŠ è½½ç¤¾åŒºæŠ¥å‘Š

community_reports = pd.read_parquet(

## f"{PROJECT_DIRECTORY}/output/community_reports.parquet"

## ) # è¿›è¡Œå…¨å±€æœç´¢

# response, context = await api.global_search(

config=graphrag_config,

entities=entities,

communities=communities,

community_reports=community_reports,

community_level=2,

dynamic_community_selection=False,

response_type="Multiple Paragraphs",

query=query,

)

# return response

if __name__ == "__main__": # ä»¥æ ‡å‡† I/O æ–¹å¼è¿è¡Œ MCP æœåŠ¡å™¨

# mcp.run(transport='stdio')

# ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

1. å¯¼å…¥å¿…è¦çš„æ¨¡å—å’Œåº“ï¼š

# Path å’Œ pprint ï¼šç”¨äºè·¯å¾„æ“ä½œå’Œç¾åŒ–æ‰“å°è¾“å‡ºã€‚

pandas ï¼šç”¨äºæ•°æ®å¤„ç†ï¼Œç‰¹åˆ«æ˜¯è¯»å– Parquet æ ¼å¼çš„æ•°æ®æ–‡ä»¶ã€‚

# graphrag.api å’Œç›¸å…³é…ç½®æ¨¡å—ï¼šç”¨äºåŠ è½½é…ç½®å’Œè°ƒç”¨ GraphRAG çš„ APIã€‚

# FastMCP ï¼šMCP åè®®çš„å¿«é€Ÿå®ç°ï¼Œç”¨äºåˆ›å»º MCP æœåŠ¡å™¨ã€‚

2. åˆå§‹åŒ– MCP æœåŠ¡å™¨ï¼š

mcp = FastMCP("rag_ML") ï¼šåˆ›å»ºä¸€ä¸ªåä¸º rag_ML çš„ MCP æœåŠ¡å™¨å®ä¾‹ã€‚

# USER_AGENT = "rag_ML-app/1.0" ï¼šå®šä¹‰ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²ï¼Œå¯èƒ½ç”¨äºæ ‡è¯†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„

# ç‰ˆæœ¬ä¿¡æ¯ã€‚

3. å®šä¹‰å·¥å…·å‡½æ•° rag_ML ï¼š

ä½¿ç”¨è£…é¥°å™¨ @mcp.tool() å°†å‡½æ•°æ³¨å†Œä¸º MCP å·¥å…·ï¼Œä½¿å…¶å¯è¢«å®¢æˆ·ç«¯è°ƒç”¨ã€‚(cid:0)

# å‡½æ•°ä¸ºå¼‚æ­¥å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„ query å‚æ•°ï¼Œè¡¨ç¤ºç”¨æˆ·çš„æŸ¥è¯¢ã€‚

# å‡½æ•°å†…éƒ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

# åŠ è½½ GraphRAG é…ç½®ï¼š

PROJECT_DIRECTORY ï¼šå®šä¹‰é¡¹ç›®ç›®å½•è·¯å¾„ã€‚

# graphrag_config = load_config(Path(PROJECT_DIRECTORY)) ï¼šåŠ è½½

# GraphRAG çš„é…ç½®æ–‡ä»¶ã€‚

# åŠ è½½æ•°æ®æ–‡ä»¶ï¼š

ä½¿ç”¨ pandas çš„ read_parquet æ–¹æ³•åˆ†åˆ«åŠ è½½å®ä½“ã€ç¤¾åŒºå’Œç¤¾åŒºæŠ¥å‘Šçš„ Parquet

# æ–‡ä»¶ã€‚

# è°ƒç”¨

# api.global_search

![Image](pdf_images\page169_img1.png)

## æ–¹æ³•è¿›è¡Œå…¨å±€æœç´¢ï¼š

## ä¼ å…¥é…ç½®ã€å®ä½“ã€ç¤¾åŒºå’Œç¤¾åŒºæŠ¥å‘Šç­‰å‚æ•°ã€‚

è®¾ç½® community_level=2 å’Œ dynamic_community_selection=False ï¼Œç”¨äºæ§

# åˆ¶ç¤¾åŒºå±‚çº§å’Œæ˜¯å¦åŠ¨æ€é€‰æ‹©ç¤¾åŒºã€‚

# è®¾ç½® response_type="Multiple Paragraphs" ï¼ŒæŒ‡å®šå“åº”ç±»å‹ä¸ºå¤šæ®µè½æ–‡æœ¬ã€‚

# è¿”å›æœç´¢ç»“æœ response ã€‚

4. è¿è¡Œ MCP æœåŠ¡å™¨ï¼š

åœ¨ä¸»ç¨‹åºä¸­ï¼Œè°ƒç”¨ mcp.run(transport='stdio') ä»¥æ ‡å‡†è¾“å…¥è¾“å‡ºï¼ˆ stdio ï¼‰çš„æ–¹å¼è¿è¡Œ

MCP æœåŠ¡å™¨ï¼Œä½¿å…¶èƒ½å¤Ÿæ¥æ”¶å’Œå“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚

MCPå…¥é—¨å®æˆ˜æ•™ç¨‹è¯¦è§ï¼š

# 3.åˆ›å»ºGraphRAGæœåŠ¡å™¨client

# æ¥ä¸‹æ¥ç»§ç»­åˆ›å»ºå®¢æˆ·ç«¯ï¼Œåœ¨é¡¹ç›®ä¸»ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º client.py çš„å®¢æˆ·ç«¯ï¼Œ

![Image](pdf_images\page170_img1.png)

# å¹¶å†™å…¥å¦‚ä¸‹ä»£ç ï¼š

# import asyncio

# import os

# import json

from typing import Optional

# from contextlib import AsyncExitStack

# from openai import OpenAI

# from dotenv import load_dotenv

# from mcp import ClientSession, StdioServerParameters

# from mcp.client.stdio import stdio_client

# # åŠ è½½ .env æ–‡ä»¶ï¼Œç¡®ä¿ API Key å—åˆ°ä¿æŠ¤

# load_dotenv()

# class MCPClient:

# def __init__(self):

"""åˆå§‹åŒ– MCP å®¢æˆ·ç«¯"""

# self.exit_stack = AsyncExitStack()

self.openai_api_key = os.getenv("OPENAI_API_KEY") # è¯»å– OpenAI API Key self.base_url = os.getenv("BASE_URL") # è¯»å– BASE YRL

# self.model = os.getenv("MODEL") # è¯»å– model

# if not self.openai_api_key: raise ValueError("âŒ æœªæ‰¾åˆ° OpenAI API Keyï¼Œè¯·åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½®

OPENAI_API_KEY")

# self.client = OpenAI(api_key=self.openai_api_key, base_url=self.base_url)

# # åˆ›å»ºOpenAI client

# self.session: Optional[ClientSession] = None

# async def transform_json(self, json2_data):

"""

å°†Claude Function callingå‚æ•°æ ¼å¼è½¬æ¢ä¸ºOpenAI Function callingå‚æ•°æ ¼å¼ï¼Œå¤šä½™å­—

æ®µä¼šè¢«ç›´æ¥åˆ é™¤ã€‚

## :param json2_data: ä¸€ä¸ªå¯è¢«è§£é‡Šä¸ºåˆ—è¡¨çš„ Python å¯¹è±¡ï¼ˆæˆ–å·²è§£æçš„ JSON æ•°æ®ï¼‰ :return: è½¬æ¢åçš„æ–°åˆ—è¡¨

"""

# result = []

# for item in json2_data:

# ç¡®ä¿æœ‰ "type" å’Œ "function" ä¸¤ä¸ªå…³é”®å­—æ®µ

# if not isinstance(item, dict) or "type" not in item or "function" not

# in item:

# continue

# old_func = item["function"]

# # ç¡®ä¿ function ä¸‹æœ‰æˆ‘ä»¬éœ€è¦çš„å…³é”®å­å­—æ®µ

# if not isinstance(old_func, dict) or "name" not in old_func or

# "description" not in old_func:

# continue

# # å¤„ç†æ–° function å­—æ®µ

# new_func = {

"name": old_func["name"],

"description": old_func["description"],

# "parameters": {}

}

# # è¯»å– input_schema å¹¶è½¬æˆ parameters

# if "input_schema" in old_func and

# isinstance(old_func["input_schema"], dict):

# old_schema = old_func["input_schema"]

# æ–°çš„ parameters ä¿ç•™ type, properties, required è¿™ä¸‰ä¸ªå­—æ®µ

new_func["parameters"]["type"] = old_schema.get("type", "object")

new_func["parameters"]["properties"] =

# old_schema.get("properties", {})

new_func["parameters"]["required"] = old_schema.get("required",

[])

# new_item = {

"type": item["type"],

# "function": new_func

}

# result.append(new_item)

# return result

# async def connect_to_server(self, server_script_path: str):

"""è¿æ¥åˆ° MCP æœåŠ¡å™¨å¹¶åˆ—å‡ºå¯ç”¨å·¥å…·"""

# is_python = server_script_path.endswith('.py')

# is_js = server_script_path.endswith('.js')

# if not (is_python or is_js): raise ValueError("æœåŠ¡å™¨è„šæœ¬å¿…é¡»æ˜¯ .py æˆ– .js æ–‡ä»¶")

command = "python" if is_python else "node"

server_params = StdioServerParameters(

## command=command,

## args=[server_script_path],

# env=None

)

# # å¯åŠ¨ MCP æœåŠ¡å™¨å¹¶å»ºç«‹é€šä¿¡

# stdio_transport = await

# self.exit_stack.enter_async_context(stdio_client(server_params))

# self.stdio, self.write = stdio_transport

# self.session = await

# self.exit_stack.enter_async_context(ClientSession(self.stdio, self.write))

# await self.session.initialize()

# # åˆ—å‡º MCP æœåŠ¡å™¨ä¸Šçš„å·¥å…·

# response = await self.session.list_tools()

tools = response.tools print("\nå·²è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œæ”¯æŒä»¥ä¸‹å·¥å…·:", [tool.name for tool in tools])

# async def process_query(self, query: str) -> str:

"""

# ä½¿ç”¨å¤§æ¨¡å‹å¤„ç†æŸ¥è¯¢å¹¶è°ƒç”¨å¯ç”¨çš„ MCP å·¥å…· (Function Calling)

"""

messages = [{"role": "user", "content": query}]

# response = await self.session.list_tools()

# available_tools = [{

"type": "function",

# "function": {

"name": tool.name,

"description": tool.description,

# "input_schema": tool.inputSchema

}

} for tool in response.tools]

# # print(available_tools)

# # è¿›è¡Œå‚æ•°æ ¼å¼è½¬åŒ–

available_tools = await self.transform_json(available_tools)

# response = self.client.chat.completions.create(

model=self.model,

messages=messages,

# tools=available_tools

)

# # å¤„ç†è¿”å›çš„å†…å®¹

content = response.choices[0]

if content.finish_reason == "tool_calls": # å¦‚ä½•æ˜¯éœ€è¦ä½¿ç”¨å·¥å…·ï¼Œå°±è§£æå·¥å…·

# tool_call = content.message.tool_calls[0]

# tool_name = tool_call.function.name

# tool_args = json.loads(tool_call.function.arguments)

# æ‰§è¡Œå·¥å…·

result = await self.session.call_tool(tool_name, tool_args)

## print(f"\n\n[Calling tool {tool_name} with args {tool_args}]\n\n")

# # å°†æ¨¡å‹è¿”å›çš„è°ƒç”¨å“ªä¸ªå·¥å…·æ•°æ®å’Œå·¥å…·æ‰§è¡Œå®Œæˆåçš„æ•°æ®éƒ½å­˜å…¥messagesä¸­

# messages.append(content.message.model_dump())

# messages.append({

"role": "tool",

"content": result.content[0].text,

"tool_call_id": tool_call.id,

})

# # å°†ä¸Šé¢çš„ç»“æœå†è¿”å›ç»™å¤§æ¨¡å‹ç”¨äºç”Ÿäº§æœ€ç»ˆçš„ç»“æœ

# response = self.client.chat.completions.create(

model=self.model,

messages=messages,

)

return response.choices[0].message.content

# return content.message.content

# async def chat_loop(self): """è¿è¡Œäº¤äº’å¼èŠå¤©å¾ªç¯""" print("\nğŸ¤– MCP å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€å‡º")

# while True:

# try:

# query = input("\nä½ : ").strip()

if query.lower() == 'quit':

# break

# response = await self.process_query(query) # å‘é€ç”¨æˆ·è¾“å…¥åˆ° OpenAI

# API print(f"\nğŸ¤– OpenAI: {response}")

# except Exception as e: print(f"\nâš  å‘ç”Ÿé”™è¯¯: {str(e)}")

# async def cleanup(self):

"""æ¸…ç†èµ„æº"""

# await self.exit_stack.aclose()

# async def main():

if len(sys.argv) < 2:

# print("Usage: python client.py <path_to_server_script>")

# sys.exit(1)

# client = MCPClient()

# try:

# await client.connect_to_server(sys.argv[1])

# await client.chat_loop()

# finally:

# await client.cleanup()

if __name__ == "__main__":

# import sys

asyncio.run(main())

## è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ª MCP å®¢æˆ·ç«¯ï¼Œç”¨äºè¿æ¥ MCP æœåŠ¡å™¨ï¼Œå¹¶åˆ©ç”¨ OpenAI çš„ API è¿›è¡Œ Function

## Callingï¼ˆå‡½æ•°è°ƒç”¨ï¼‰ã€‚è¯¥å®¢æˆ·ç«¯èƒ½å¤Ÿä¸ MCP æœåŠ¡å™¨äº¤äº’ï¼Œåˆ—å‡ºå¯ç”¨å·¥å…·ï¼Œå¹¶æ ¹æ®ç”¨æˆ·è¾“å…¥é€‰æ‹©é€‚å½“çš„å·¥

# å…·è°ƒç”¨ã€‚

1. åˆå§‹åŒ–

AsyncExitStack() å¤„ç†å¤šä¸ªå¼‚æ­¥ä¸Šä¸‹æ–‡ï¼ˆå¦‚ MCP è¿æ¥ï¼‰ã€‚

# è¯»å– .envé…ç½®ï¼š

# OPENAI_API_KEY

BASE_URL ï¼ˆå¯é€‰ï¼Œç”¨äºè‡ªå®šä¹‰ API ä»£ç†ï¼‰

# MODEL ï¼ˆæŒ‡å®š OpenAI ä½¿ç”¨çš„æ¨¡å‹ï¼‰

self.client = OpenAI(...) åˆ›å»º OpenAI API å®¢æˆ·ç«¯ã€‚

2. è½¬æ¢ API æ ¼å¼ ( transform_json )

# OpenAI å’Œ Claude API çš„ Function Calling æ ¼å¼ä¸åŒã€‚

# è¯¥å‡½æ•°å°† Claude çš„ input_schema è½¬æ¢ä¸º OpenAI å…¼å®¹æ ¼å¼ã€‚

3. è¿æ¥ MCP æœåŠ¡å™¨

# è¿æ¥ MCP æœåŠ¡å™¨ï¼Œæ”¯æŒ Python æˆ– JavaScript æœåŠ¡å™¨è„šæœ¬ã€‚

stdio_client(server_params) é€šè¿‡ stdio è¿›è¡Œé€šä¿¡ã€‚

await self.session.list_tools() åˆ—å‡º MCP æœåŠ¡å™¨ä¸Šå¯ç”¨çš„å·¥å…·ã€‚

4. å¤„ç†ç”¨æˆ·æŸ¥è¯¢ ( process_query )

è·å– MCP æœåŠ¡å™¨ä¸Šå¯ç”¨çš„å·¥å…· ( list_tools )ã€‚

è®© OpenAI é€‰æ‹©æ˜¯å¦éœ€è¦è°ƒç”¨ MCP æœåŠ¡å™¨ä¸Šçš„å·¥å…· ( tool_calls )ã€‚

# è‹¥éœ€è¦å·¥å…·è°ƒç”¨ï¼š

# è§£æ tool_calls

call_tool(tool_name, tool_args) è°ƒç”¨ MCP æœåŠ¡å™¨ä¸Šçš„å·¥å…·

# å†æ¬¡å‘ OpenAI æäº¤æ–°ä¿¡æ¯ï¼Œè·å–æœ€ç»ˆç­”æ¡ˆ

5. äº¤äº’å¼èŠå¤© ( chat_loop )

å…è®¸ç”¨æˆ·è¾“å…¥æŸ¥è¯¢ï¼Œè‡ªåŠ¨é€‰æ‹© MCP å·¥å…·æˆ–ç›´æ¥å›ç­”ã€‚

# è¾“å…¥ quit é€€å‡ºèŠå¤©ã€‚

# ç„¶ååˆ›å»ºé…ç½®æ–‡ä»¶.envï¼š

![Image](pdf_images\page175_img1.png)

![Image](pdf_images\page175_img2.png)

# å¹¶æ‰‹åŠ¨è¾“å…¥

BASE_URL=

MODEL=

OPENAI_API_KEY=

# æ­¤å¤„å¯ä»¥è®¾ç½®OpenAIã€DeepSeekæˆ–è€…ä»»ä½•ollamaã€vLLMè°ƒåº¦çš„æœ¬åœ°æ¨¡å‹ã€‚å…·ä½“é…ç½®æ–¹æ³•å‚è€ƒã€ŠMCP

# å…¥é—¨å®æˆ˜æ•™ç¨‹ã€‹ã€‚

MCPå…¥é—¨å®æˆ˜æ•™ç¨‹è¯¦è§ï¼š

![Image](pdf_images\page176_img1.png)

![Image](pdf_images\page176_img2.png)

# 4.MCP+GraphRAGé—®ç­”æµ‹è¯•

# 4.1 å‘½ä»¤è¡Œé—®ç­”

# æœ€åå³å¯å¼€å§‹è¿›è¡Œé—®ç­”æµ‹è¯•ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯å¯åŠ¨é—®ç­”ï¼š

# uv run client.py rag_server.py

# é—®ç­”æ•ˆæœå¦‚å›¾æ‰€ç¤ºï¼š

![Image](pdf_images\page177_img1.png)

![Image](pdf_images\page177_img2.png)

## 4.2 Claude Desktopé—®ç­”

# è¯¦è§2025å¤§æ¨¡å‹Agentæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ã€‹ï¼ˆæ˜¥å­£ç­ï¼‰https://whakv.xetslk.com/s/pxKHGå†…å®¹ä»‹ç»ã€‚

![Image](pdf_images\page180_img1.png)

## å››ã€MCPæ™ºèƒ½ä½“å¼€å‘åŸºç¡€ç†è®ºå…¥é—¨

1. çœŸå®ä¸–ç•Œçš„å¤æ‚æ™ºèƒ½ä½“å¼€å‘é¡¹ç›®

# 1.1 2023å¹´MateGen 1.0ä»£ç ç»“æ„å›¾

![Image](pdf_images\page181_img1.png)

## 1.2 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹ä¼ä¸šé—®ç­”æ™ºèƒ½ä½“é¡¹ç›®æµç¨‹å›¾

![Image](pdf_images\page182_img1.png)

## 1.3 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹æ™ºèƒ½å®¢æœé¡¹ç›®æµç¨‹å›¾

![Image](pdf_images\page183_img1.png)

![Image](pdf_images\page183_img2.png)

## 1.4 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹æ™ºèƒ½å¸‚åœºåˆ†æé¡¹ç›®æµç¨‹å›¾

# 1.5 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹MateGen 2.0é¡¹ç›®æ¶æ„

è¯¦è§2025å¤§æ¨¡å‹Agentæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ã€‹ï¼ˆæ˜¥å­£ç­ï¼‰https://whakv.xetslk.com/s/pxKHGå†…å®¹ä»‹ç»ã€‚

![Image](pdf_images\page184_img1.png)

![Image](pdf_images\page184_img2.png)

![Image](pdf_images\page184_img3.png)

2. æ™ºèƒ½ä½“å¼€å‘æ¡†æ¶é€‰å‹

# 12é¡¹Agentæ™ºèƒ½ä½“å¼€å‘æ¡†æ¶å…¥é—¨ä¸é€‰å‹ï¼https://www.bilibili.com/video/BV16NBJYRE3s/

![Image](pdf_images\page185_img1.png)

![Image](pdf_images\page185_img2.png)

## 3. ä»é›¶å¿«é€Ÿäº†è§£æ™ºèƒ½ä½“å¼€å‘

# åœ¨ä½¿ç”¨ LLM æ„å»ºåº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å»ºè®®å°½å¯èƒ½é€‰æ‹©æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œåªæœ‰åœ¨ç¡®å®éœ€è¦æ—¶æ‰å¢åŠ å¤æ‚

# æ€§ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½æ ¹æœ¬ä¸éœ€è¦æ„å»ºä»£ç†ç³»ç»Ÿã€‚

# ä»£ç†ç³»ç»Ÿï¼ˆAgentic Systemsï¼‰*é€šå¸¸ä¼š*ç‰ºç‰²å“åº”é€Ÿåº¦ï¼ˆlatencyï¼‰å’Œæˆæœ¬ï¼ˆcostï¼‰ï¼Œä»¥æ¢å–æ›´å¥½

# çš„ä»»åŠ¡æ‰§è¡Œèƒ½åŠ›ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ä»£ç†ä¹‹å‰ï¼Œä½ éœ€è¦è€ƒè™‘è¿™ç§æƒè¡¡æ˜¯å¦åˆç†ã€‚

# å½“åº”ç”¨åœºæ™¯éœ€è¦æ›´å¤æ‚çš„é€»è¾‘æ—¶ï¼š

# å·¥ä½œæµï¼ˆWorkflowsï¼‰ æä¾›äº†å¯é¢„æµ‹æ€§å’Œä¸€è‡´æ€§ï¼Œé€‚ç”¨äºä»»åŠ¡æµç¨‹æ¸…æ™°çš„æƒ…å†µã€‚

# ä»£ç†ï¼ˆAgentsï¼‰ æ›´é€‚ç”¨äºéœ€è¦çµæ´»æ€§å’Œå¤§è§„æ¨¡æ¨¡å‹é©±åŠ¨å†³ç­–çš„åœºæ™¯ã€‚

# ç„¶è€Œï¼Œå¯¹äºè®¸å¤šåº”ç”¨æ¥è¯´ï¼Œä¼˜åŒ–å•æ¬¡ LLM è°ƒç”¨ï¼ˆä¾‹å¦‚ç»“åˆæ£€ç´¢å¢å¼ºï¼ˆRAGï¼‰*å’Œ*ä¸Šä¸‹æ–‡ç¤ºä¾‹ï¼ˆin- context examplesï¼‰ï¼‰é€šå¸¸å·²ç»è¶³å¤Ÿï¼Œæ— éœ€ä½¿ç”¨å¤æ‚çš„ä»£ç†ç³»ç»Ÿã€‚

# åˆ†å‘æ¨¡å¼ï¼šå°†ä»»åŠ¡åˆ†å‘ï¼ˆFan-outï¼‰ç»™å¤šä¸ªå­ä»£ç†ï¼ˆsub-agentsï¼‰ï¼Œç„¶åæ±‡æ€»ï¼ˆFan-inï¼‰ç»“æœã€‚æ¯ä¸ª å­ä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ª AugmentedLLMï¼Œæ•´ä¸ª Parallel å·¥ä½œæµæœ¬èº«ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªå­ä»»åŠ¡å¯ä»¥é€‰æ‹©

# æ€§åœ°æˆä¸ºä¸€ä¸ªæ›´å¤æ‚çš„å·¥ä½œæµã€‚

# è·¯ç”±æ¨¡å¼ï¼šå¯¹äºç»™å®šçš„è¾“å…¥ï¼Œç³»ç»Ÿä¼šå°†å…¶è·¯ç”±ï¼ˆåˆ†é…ï¼‰åˆ°æœ€ç›¸å…³çš„ top_k ä¸ªç±»åˆ«ã€‚

# å…¶ä¸­ï¼Œæ¯ä¸ªç±»åˆ«ï¼ˆcategoryï¼‰å¯ä»¥æ˜¯ï¼š

1. Agentï¼ˆæ™ºèƒ½ä»£ç†ï¼‰ï¼šå¯èƒ½æ˜¯ä¸€ä¸ª AI ä»£ç†ï¼ˆå¦‚ LLM é©±åŠ¨çš„ä»»åŠ¡å¤„ç†å•å…ƒï¼‰ã€‚

2. MCP æœåŠ¡å™¨ï¼ˆMCP Serverï¼‰ï¼šå¯ä»¥æ˜¯åŸºäº Model Context Protocol (MCP) çš„æœåŠ¡å™¨ï¼Œç”¨äºå¤„ç†

# ç‰¹å®šä»»åŠ¡æˆ–æä¾›å¤–éƒ¨æ•°æ®æ”¯æŒã€‚

3. å¸¸è§„å‡½æ•°ï¼ˆRegular Functionï¼‰ï¼šå³æ™®é€šçš„ä»£ç å‡½æ•°ï¼Œå¯èƒ½æ˜¯æ‰§è¡Œè®¡ç®—ã€æ•°æ®å¤„ç†ç­‰ä»»åŠ¡çš„å‡½æ•°ã€‚

![Image](pdf_images\page186_img1.png)

![Image](pdf_images\page186_img2.png)

## ç¼–æ’æ¨¡å¼ï¼šä¸€ä¸ªæ›´é«˜å±‚æ¬¡çš„ LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰è´Ÿè´£ç”Ÿæˆä»»åŠ¡è®¡åˆ’ï¼ˆplanï¼‰ï¼Œç„¶åå°†å„ä¸ªå­ä»»åŠ¡åˆ†

## é…ç»™å­ä»£ç†ï¼ˆsub-agentsï¼‰ï¼Œå¹¶æœ€ç»ˆæ•´åˆï¼ˆsynthesizeï¼‰è¿™äº›å­ä»»åŠ¡çš„ç»“æœã€‚

# å…¶ä¸­ï¼š

é«˜å±‚ LLM ç”Ÿæˆè®¡åˆ’ï¼šè¿™ä¸ª LLM å……å½“â€œæŒ‡æŒ¥å®˜â€ï¼Œæ ¹æ®è¾“å…¥ä»»åŠ¡åˆ¶å®šæ‰§è¡Œæ­¥éª¤ã€‚

# å­ä»£ç†ï¼ˆsub-agentsï¼‰æ‰§è¡Œä»»åŠ¡ï¼šæ¯ä¸ªå­ä»»åŠ¡è¢«åˆ†é…ç»™ä¸åŒçš„å­ä»£ç†ï¼Œå¯èƒ½æ˜¯ä¸åŒçš„ AI ç»„ä»¶ã€

MCP æœåŠ¡å™¨æˆ–ç‰¹å®šå‡½æ•°ã€‚

# æ•´åˆï¼ˆsynthesizeï¼‰ç»“æœï¼šåœ¨æ‰€æœ‰å­ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œç³»ç»Ÿä¼šå°†å®ƒä»¬çš„ç»“æœåˆå¹¶ï¼Œç”Ÿæˆæœ€ç»ˆè¾“å‡ºã€‚

# ä¼˜åŒ–å™¨æ¨¡å¼ï¼šä¸€ä¸ª LLM å……å½“â€œä¼˜åŒ–å™¨â€ï¼ˆoptimizerï¼‰ï¼Œä¸æ–­ä¼˜åŒ–å›ç­”ï¼›å¦ä¸€ä¸ª LLM å……å½“â€œè¯„ä¼°è€…â€

# ï¼ˆevaluatorï¼‰ï¼Œå¯¹å›ç­”è¿›è¡Œæ‰¹åˆ¤æ€§è¯„ä¼°ï¼Œç›´åˆ°å›ç­”è¾¾åˆ°è´¨é‡æ ‡å‡†ã€‚

# å…·ä½“æµç¨‹

1. ä¼˜åŒ–å™¨ï¼ˆoptimizerï¼‰

# ç”Ÿæˆåˆæ­¥çš„å›ç­”ï¼Œå¹¶åœ¨æ¯è½®è¿­ä»£ä¸­ä¸æ–­ä¼˜åŒ–å®ƒï¼Œä½¿å…¶æ›´å‡†ç¡®ã€æ›´ç¬¦åˆè¦æ±‚ã€‚

2. è¯„ä¼°è€…ï¼ˆevaluatorï¼‰

# å¯¹ä¼˜åŒ–å™¨ç”Ÿæˆçš„å›ç­”è¿›è¡Œå®¡æŸ¥å’Œæ‰¹è¯„ï¼ŒæŒ‡å‡ºå…¶ä¸­çš„é—®é¢˜ï¼ˆå¦‚é€»è¾‘é”™è¯¯ã€ä¿¡æ¯ç¼ºå¤±ã€è¯­ä¹‰ä¸æ¸…

ç­‰ï¼‰ã€‚

# å¦‚æœå›ç­”æœªè¾¾åˆ°è´¨é‡æ ‡å‡†ï¼Œå®ƒä¼šè¦æ±‚ä¼˜åŒ–å™¨è¿›è¡Œä¿®æ”¹å’Œæ”¹è¿›ã€‚

3. å¾ªç¯ä¼˜åŒ–

# è¿™ä¸ªè¿‡ç¨‹ä¼šåå¤è¿›è¡Œï¼Œç›´åˆ°è¯„ä¼°è€…è®¤å¯ç­”æ¡ˆçš„è´¨é‡ï¼ˆå³è¶…è¿‡æŸä¸ªè´¨é‡æ ‡å‡†ï¼‰ã€‚

# æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•å€ŸåŠ©MCPï¼Œå®ç°åˆ†å‘æ¨¡å¼å’Œè·¯ç”±æ¨¡å¼ï¼Œå¹¶æ®æ­¤æ­å»ºä¸€ä¸ªNL2SQL+NL2Pythonçš„åˆçº§æ•°æ®

åˆ†ææ™ºèƒ½ä½“ã€‚

![Image](pdf_images\page187_img1.png)

![Image](pdf_images\page187_img2.png)

## äº”ã€OpenAIé£æ ¼API Function callingè¿›é˜¶åŠŸèƒ½ä»‹ç»

# æœ¬éƒ¨åˆ†å†…å®¹éœ€å‚è€ƒä»¥ä¸‹Jupyeréƒ¨åˆ†ä»£ç è¿›è¡Œå­¦ä¹ ã€‚

# å…­ã€å€ŸåŠ©MCPæ­å»ºAIæ•°æ®åˆ†ææ™ºèƒ½ä½“

# åœ¨äº†è§£äº†Function callingçš„è¿›é˜¶åŠŸèƒ½å¤–ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­ä»‹ç»å¦‚ä½•åŸºäºä¸Šè¿°åŠŸèƒ½ï¼Œæ¥è¿›è¡ŒMCPæ™ºèƒ½

# ä½“å¿«é€Ÿå‘å¼€å‘ï¼Œæ¥æ­å»ºä¸€ä¸ªèƒ½å¤Ÿè¿›è¡ŒSQLæŸ¥è¯¢å’ŒPythonè‡ªåŠ¨ç¼–å†™çš„å…¥é—¨çº§æ•°æ®åˆ†ææ™ºèƒ½ä½“ã€‚

1. miniMateGené¡¹ç›®åˆå§‹åŒ–

# cd /root/autodl-tmp/MCP

# # åˆ›å»ºé¡¹ç›®ç›®å½•

# uv init miniMateGen

# cd miniMateGen

![Image](pdf_images\page188_img1.png)

![Image](pdf_images\page188_img2.png)

![Image](pdf_images\page188_img3.png)

# # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

# uv venv

# # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

# source .venv/bin/activate

# åˆ›å»ºé¡¹ç›®å¦‚ä¸‹ï¼š

![Image](pdf_images\page189_img1.png)

![Image](pdf_images\page189_img2.png)

## 2. åˆ›å»ºMCPæœåŠ¡å™¨ä¸€ï¼šSQL_server

# 2.1 Linuxç¯å¢ƒä¸‹å®‰è£…MySQLæœåŠ¡å™¨å¹¶åˆ›å»ºç®€å•æ•°æ®é›†

# åˆ›å»ºMySQLæ•°æ®åº“

# apt install mysql-server

# ç„¶åå¯åŠ¨mysqlï¼Œå¹¶è®¾ç½®åˆå§‹å¯†ç ï¼š

# mysqld &

# mysql

è¿›å…¥åˆ°SQLå‘½ä»¤è¡Œåï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š

# ALTER USER 'root'@'localhost' IDENTIFIED BY '123';

# æ­¤å¤„å¯†ç å¯æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®ã€‚

# ç„¶åè¾“å…¥ exit; å³å¯é€€å‡ºã€‚

# ç„¶åå†æ¬¡è¿›å…¥MySQLï¼Œå¹¶æ ¹æ®è¦æ±‚è¾“å…¥å¯†ç ï¼š

# mysql -u root -p

![Image](pdf_images\page190_img1.png)

## ç„¶ååˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼š

# CREATE DATABASE school;

# USE school;

# ç„¶ååˆ›å»ºä¸€ä¸ªè™šæ‹Ÿè¡¨æ ¼ï¼Œé‡Œé¢åŒ…å«äº†10ä½åŒå­¦å„è‡ª3é—¨è¯¾ç¨‹çš„åˆ†æ•°ï¼š

# CREATE TABLE students_scores (

id INT AUTO_INCREMENT PRIMARY KEY,

name VARCHAR(50),

course1 INT,

course2 INT,

# course3 INT

);

# INSERT INTO students_scores (name, course1, course2, course3)

# VALUES

('å­¦ç”Ÿ1', 85, 92, 78), ('å­¦ç”Ÿ2', 76, 88, 91),

('å­¦ç”Ÿ3', 90, 85, 80),

('å­¦ç”Ÿ4', 65, 70, 72), ('å­¦ç”Ÿ5', 82, 89, 95),

('å­¦ç”Ÿ6', 91, 93, 87),

('å­¦ç”Ÿ7', 77, 78, 85),

('å­¦ç”Ÿ8', 88, 92, 91), ('å­¦ç”Ÿ9', 84, 76, 80),

('å­¦ç”Ÿ10', 89, 90, 92);

ç„¶åå³å¯æŸ¥çœ‹æ•°æ®é›†åŸºæœ¬æƒ…å†µï¼š

![Image](pdf_images\page191_img1.png)

![Image](pdf_images\page191_img2.png)

![Image](pdf_images\page191_img3.png)

## SELECT * FROM students_scores;

# æ­¤å¤–ï¼Œè¿˜éœ€è¦åˆ·æ–°èº«ä»½éªŒè¯ï¼Œä½¿å¾—å…¶ä»–åº“ï¼ˆå¦‚pymysqlï¼‰å¯ä»¥é€šè¿‡å¯†ç éªŒè¯ç™»å½•ï¼š

# ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123';

# 2.2 ç¼–å†™SQL_server.pyä»£ç 

# åŠŸèƒ½ç¤ºæ„å›¾

# ä»£ç ä½ç½®

![Image](pdf_images\page192_img1.png)

# éœ€è¦å¢åŠ é¢å¤–ä¾èµ–ï¼š

uv add pymysql numpy pandas

# ä»£ç å†…å®¹å¦‚ä¸‹ï¼š

# import json

# import httpx

from typing import Any

# import pymysql

# import csv

# from mcp.server.fastmcp import FastMCP

# # åˆå§‹åŒ– MCP æœåŠ¡å™¨

# mcp = FastMCP("SQLServer")

# USER_AGENT = "SQLserver-app/1.0"

# @mcp.tool()

# async def sql_inter(sql_query):

"""

# æŸ¥è¯¢æœ¬åœ°MySQLæ•°æ®åº“ï¼Œé€šè¿‡è¿è¡Œä¸€æ®µSQLä»£ç æ¥è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ã€‚\

# :param sql_query: å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæ‰§è¡Œå¯¹MySQLä¸­schoolæ•°æ®åº“ä¸­å„å¼ è¡¨è¿›è¡ŒæŸ¥ è¯¢ï¼Œå¹¶è·å¾—å„è¡¨ä¸­çš„å„ç±»ç›¸å…³ä¿¡æ¯

# :returnï¼šsql_queryåœ¨MySQLä¸­çš„è¿è¡Œç»“æœã€‚

"""

# connection = pymysql.connect(

# host='localhost', # æ•°æ®åº“åœ°å€

# user='root', # æ•°æ®åº“ç”¨æˆ·å passwd='123', # æ•°æ®åº“å¯†ç 

# db='school', # æ•°æ®åº“å

# charset='utf8' # å­—ç¬¦é›†é€‰æ‹©utf8

)

try:

with connection.cursor() as cursor:

## # SQLæŸ¥è¯¢è¯­å¥

## sql = sql_query

# cursor.execute(sql)

# # è·å–æŸ¥è¯¢ç»“æœ

results = cursor.fetchall()

# finally:

# connection.close()

# return json.dumps(results)

# @mcp.tool()

# async def export_table_to_csv(table_name, output_file):

"""

# å°† MySQL æ•°æ®åº“ä¸­çš„æŸä¸ªè¡¨å¯¼å‡ºä¸º CSV æ–‡ä»¶ã€‚

# :param table_name: éœ€è¦å¯¼å‡ºçš„è¡¨å

# :param output_file: è¾“å‡ºçš„ CSV æ–‡ä»¶è·¯å¾„

"""

# # è¿æ¥ MySQL æ•°æ®åº“

# connection = pymysql.connect(

# host='localhost', # æ•°æ®åº“åœ°å€ user='root', # æ•°æ®åº“ç”¨æˆ·å

# passwd='123', # æ•°æ®åº“å¯†ç 

# db='school', # æ•°æ®åº“å charset='utf8' # å­—ç¬¦é›†

)

# try:

# with connection.cursor() as cursor:

# # æŸ¥è¯¢æ•°æ®è¡¨çš„æ‰€æœ‰æ•°æ®

# query = f"SELECT * FROM {table_name};"

# cursor.execute(query)

# # è·å–æ‰€æœ‰åˆ—å

column_names = [desc[0] for desc in cursor.description]

# # è·å–æŸ¥è¯¢ç»“æœ

rows = cursor.fetchall()

# # å°†æ•°æ®å†™å…¥ CSV æ–‡ä»¶

# with open(output_file, mode='w', newline='', encoding='utf-8') as

# file:

# writer = csv.writer(file)

# # å†™å…¥è¡¨å¤´

# writer.writerow(column_names)

# # å†™å…¥æ•°æ®

# writer.writerows(rows)

# print(f"æ•°æ®è¡¨ {table_name} å·²æˆåŠŸå¯¼å‡ºè‡³ {output_file}")

except Exception as e:

## print(f"å¯¼å‡ºå¤±è´¥: {e}")

# finally:

# connection.close()

if __name__ == "__main__": # ä»¥æ ‡å‡† I/O æ–¹å¼è¿è¡Œ MCP æœåŠ¡å™¨

# mcp.run(transport='stdio')

# ä»£ç è¯¦ç»†è§£é‡Š

# è¿™æ®µä»£ç æ˜¯ä¸€ä¸ª MCP æœåŠ¡å™¨ï¼ˆModel Context Protocol Serverï¼‰ï¼Œå®ƒæä¾›äº†ä¸¤ä¸ªä¸»è¦åŠŸèƒ½ï¼š

1. æŸ¥è¯¢ MySQL æ•°æ®åº“ï¼ˆ sql_inter ï¼‰ï¼šå…è®¸ç”¨æˆ·è¾“å…¥ SQL æŸ¥è¯¢ï¼Œå¹¶è·å– MySQL æ•°æ®åº“çš„æŸ¥è¯¢ç»“

# æœã€‚

2. å°†æ•°æ®åº“è¡¨å¯¼å‡ºä¸º CSV æ–‡ä»¶ï¼ˆ export_table_to_csv ï¼‰ï¼šæŠŠ MySQL æ•°æ®åº“ä¸­çš„æŸä¸ªè¡¨è½¬æ¢ä¸º

CSV æ–‡ä»¶å¹¶ä¿å­˜åˆ°æœ¬åœ°ã€‚

# æ­¤å¤–ï¼Œæ•´ä¸ª MCP æœåŠ¡å™¨æ˜¯åŸºäº FastMCP è¿è¡Œçš„ï¼Œå…è®¸å…¶ä»–ç³»ç»Ÿæˆ–ç”¨æˆ·é€šè¿‡ MCP åè®®è°ƒç”¨è¿™äº›å·¥å…·ã€‚

# å…¶ä¸­ä¸¤ä¸ªæ ¸å¿ƒå‡½æ•°è§£é‡Šå¦‚ä¸‹

(1) sql_inter(sql_query) ï¼šæŸ¥è¯¢ MySQL æ•°æ®åº“

# åŠŸèƒ½

# è¯¥å‡½æ•°æ¥æ”¶ä¸€æ¡ SQL æŸ¥è¯¢è¯­å¥ï¼Œå¹¶åœ¨ MySQL æ•°æ®åº“ school ä¸­æ‰§è¡ŒæŸ¥è¯¢ã€‚

é€šè¿‡ pymysql.connect() è¿æ¥æœ¬åœ° MySQL æœåŠ¡å™¨ï¼ˆç”¨æˆ·å root ï¼Œå¯†ç  123 ï¼‰ã€‚

ä½¿ç”¨ cursor.execute(sql_query) æ‰§è¡Œ SQL è¯­å¥ï¼Œå¹¶ä½¿ç”¨ fetchall() è·å–æ‰€æœ‰æŸ¥è¯¢ç»“æœã€‚

ç»“æœæœ€ç»ˆè½¬æ¢ä¸º JSON æ ¼å¼è¿”å›ã€‚

# (2) export_table_to_csv(table_name, output_file) ï¼šå¯¼å‡ºè¡¨ä¸º CSV

# åŠŸèƒ½

# è¯¥å‡½æ•°å¯¼å‡º MySQL æ•°æ®è¡¨ä¸º CSV æ–‡ä»¶ã€‚

# è¿æ¥ MySQL æœåŠ¡å™¨å¹¶æ‰§è¡Œ SELECT * FROM table_name; æŸ¥è¯¢è·å–è¡¨æ•°æ®ã€‚

æå–è¡¨å¤´ï¼ˆåˆ—åï¼‰ï¼Œå¹¶å°†å…¶ä¸æŸ¥è¯¢ç»“æœä¸€èµ·å†™å…¥ CSV æ–‡ä»¶ã€‚

# æ‰“å°å¯¼å‡ºæˆåŠŸæ¶ˆæ¯ æˆ– é”™è¯¯ä¿¡æ¯ã€‚

# åŠŸèƒ½

# ä½œç”¨

# MCP æœåŠ¡å™¨ ( FastMCP )

å…è®¸ MCP å®¢æˆ·ç«¯è°ƒç”¨ SQL æŸ¥è¯¢å’Œæ•°æ®å¯¼å‡ºåŠŸèƒ½ã€‚

# sql_inter()

æ‰§è¡Œ SQL è¯­å¥å¹¶è¿”å› JSON ç»“æœã€‚

# export_table_to_csv()

# å¯¼å‡º MySQL æ•°æ®è¡¨ä¸º CSV æ–‡ä»¶ã€‚

# mcp.run()

å¯åŠ¨ MCP æœåŠ¡å™¨ï¼Œç›‘å¬å®¢æˆ·ç«¯è¯·æ±‚ã€‚

![Image](pdf_images\page195_img1.png)

![Image](pdf_images\page195_img2.png)

## 3. åˆ›å»ºMCPæœåŠ¡å™¨äºŒï¼šPython_server

# import json

from typing import Any

# import csv

# import numpy as np

# import pandas as pd

# import random

# from mcp.server.fastmcp import FastMCP

# # åˆå§‹åŒ– MCP æœåŠ¡å™¨

# mcp = FastMCP("PythonServer")

# USER_AGENT = "Pythonserver-app/1.0"

# @mcp.tool()

# async def python_inter(py_code):

# """ è¿è¡Œç”¨æˆ·æä¾›çš„ Python ä»£ç ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚

# :param py_code: å­—ç¬¦ä¸²å½¢å¼çš„ Python ä»£ç  :return: ä»£ç è¿è¡Œçš„æœ€ç»ˆç»“æœ

"""

# g = globals()

## try:

## # è‹¥æ˜¯è¡¨è¾¾å¼ï¼Œç›´æ¥è¿è¡Œå¹¶è¿”å›

# result = eval(py_code, g)

# return json.dumps(str(result), ensure_ascii=False)

# except Exception:

# global_vars_before = set(g.keys())

# try:

# exec(py_code, g)

# except Exception as e:

return json.dumps(f"ä»£ç æ‰§è¡Œæ—¶æŠ¥é”™: {e}", ensure_ascii=False)

global_vars_after = set(g.keys())

# new_vars = global_vars_after - global_vars_before

# if new_vars:

# # åªè¿”å›å¯åºåˆ—åŒ–çš„å˜é‡å€¼

# safe_result = {}

# for var in new_vars:

# try: json.dumps(g[var]) # å°è¯•åºåˆ—åŒ–ï¼Œç¡®ä¿å¯ä»¥è½¬æ¢ä¸º JSON

# safe_result[var] = g[var]

# except (TypeError, OverflowError):

# safe_result[var] = str(g[var]) # å¦‚æœä¸èƒ½åºåˆ—åŒ–ï¼Œåˆ™è½¬æ¢ä¸ºå­—ç¬¦ä¸²

# return json.dumps(safe_result, ensure_ascii=False)

# else:

# return json.dumps("å·²ç»é¡ºåˆ©æ‰§è¡Œä»£ç ", ensure_ascii=False)

if __name__ == "__main__": # ä»¥æ ‡å‡† I/O æ–¹å¼è¿è¡Œ MCP æœåŠ¡å™¨

# mcp.run(transport='stdio')

# è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ª MCP æœåŠ¡å™¨ï¼Œå®ƒå…è®¸ è¿œç¨‹æ‰§è¡Œ Python ä»£ç ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚

# ä»£ç æ‰§è¡Œé€»è¾‘å¦‚ä¸‹

(a) eval() å¤„ç†å•è¡Œ Python è¡¨è¾¾å¼

# try:

# result = eval(py_code, g)

# return json.dumps(str(result), ensure_ascii=False)

# å¦‚æœ py_code æ˜¯ä¸€ä¸ªç®€å•è¡¨è¾¾å¼ï¼ˆå¦‚ "1 + 1" æˆ– "max([3,5,7])" ï¼‰ï¼Œåˆ™ç›´æ¥ç”¨ eval() è®¡ç®—

# å¹¶è¿”å›ç»“æœã€‚

# ç¤ºä¾‹

# python_inter("3 + 4")

# è¿”å›

"7"

## (b) exec() å¤„ç†å®Œæ•´çš„ Python ä»£ç 

# å¦‚æœ eval() æ‰§è¡Œå¤±è´¥ï¼ˆæ„å‘³ç€è¾“å…¥æ˜¯ä»£ç å—è€Œä¸æ˜¯å•ä¸ªè¡¨è¾¾å¼ï¼‰ï¼Œé‚£ä¹ˆï¼š

# global_vars_before = set(g.keys()) # è®°å½•æ‰§è¡Œå‰çš„å…¨å±€å˜é‡

# try: exec(py_code, g) # è¿è¡Œ Python ä»£ç 

# except Exception as e:

return json.dumps(f"ä»£ç æ‰§è¡Œæ—¶æŠ¥é”™: {e}", ensure_ascii=False)

ä½¿ç”¨ exec() æ‰§è¡Œå®Œæ•´çš„ Python ä»£ç ï¼ˆå¦‚å®šä¹‰å˜é‡ã€å¾ªç¯ã€å‡½æ•°ï¼‰ã€‚

# å¦‚æœ exec() å‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›é”™è¯¯ä¿¡æ¯ã€‚

# (c) æå–æ–°åˆ›å»ºçš„å˜é‡

global_vars_after = set(g.keys()) # è®°å½•æ‰§è¡Œåçš„å…¨å±€å˜é‡ new_vars = global_vars_after - global_vars_before # æ‰¾å‡ºæ–°åˆ›å»ºçš„å˜é‡

# if new_vars:

# safe_result = {}

# for var in new_vars:

# try:

# json.dumps(g[var]) # å°è¯•åºåˆ—åŒ–

# safe_result[var] = g[var]

# except (TypeError, OverflowError):

# safe_result[var] = str(g[var]) # ä¸èƒ½åºåˆ—åŒ–çš„å˜é‡è½¬æ¢ä¸ºå­—ç¬¦ä¸²

# return json.dumps(safe_result, ensure_ascii=False)

# æ£€æŸ¥ exec() è¿è¡Œåæ–°å¢çš„å˜é‡ï¼Œåªè¿”å›å¯åºåˆ—åŒ–çš„å˜é‡ã€‚

# ç¤ºä¾‹

# python_inter("a = 10\nb = 20\nc = a + b")

# è¿”å›

{

"a": 10,

"b": 20,

"c": 30

}

# å¦‚æœä»£ç è¿è¡Œåæ²¡æœ‰æ–°å˜é‡ï¼Œåªè¿”å› å·²é¡ºåˆ©æ‰§è¡Œä»£ç  ã€‚

# ä»£ç æ€»ç»“ï¼š

# åŠŸèƒ½

# ä½œç”¨

# MCP æœåŠ¡å™¨ ( FastMCP )

# å…è®¸è¿œç¨‹æ‰§è¡Œ Python ä»£ç 

# python_inter()

# è¿è¡Œ Python ä»£ç ï¼Œè¿”å› JSON ç»“æœ

æ”¯æŒ eval()

è®¡ç®—ç®€å• Python è¡¨è¾¾å¼

![Image](pdf_images\page198_img1.png)

![Image](pdf_images\page198_img2.png)

## åŠŸèƒ½

## ä½œç”¨

# æ”¯æŒ exec()

# è¿è¡Œå®Œæ•´ Python ä»£ç 

# ä»£ç å®‰å…¨æ£€æŸ¥

# ä»…è¿”å›å¯åºåˆ—åŒ–å˜é‡

# 4.åˆ›å»ºMCPå®¢æˆ·ç«¯Client

# æ¥ä¸‹æ¥è€ƒè™‘åˆ›å»ºå®¢æˆ·ç«¯Clientï¼Œæ­¤æ—¶å®¢æˆ·ç«¯éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ç‚¹è¦æ±‚ï¼š

1. åŒæ—¶è¿æ¥å¤šä¸ªæœåŠ¡å™¨ä¸Šçš„è‹¥å¹²ä¸ªå·¥å…·ï¼›

2. éœ€è¦èƒ½å¤ŸåŒæ—¶å®Œæˆä¸²è”æˆ–è€…å¹¶è”æ¨¡å¼ï¼›

3. éœ€è¦èƒ½å¤Ÿæ”¯æŒå¤šè½®å¯¹è¯ã€‚

# æ®æ­¤è®¾è®¡æ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

# ä»£ç ä½ç½®ï¼š

## å®Œæ•´ä»£ç å†…å®¹å¦‚ä¸‹ï¼š

# import asyncio

# import os

# import json

from typing import Optional, Dict

# from contextlib import AsyncExitStack

# from openai import OpenAI

# from dotenv import load_dotenv

# from mcp import ClientSession, StdioServerParameters

# from mcp.client.stdio import stdio_client

# load_dotenv()

# class MultiServerMCPClient:

# def __init__(self): """ç®¡ç†å¤šä¸ª MCP æœåŠ¡å™¨çš„å®¢æˆ·ç«¯"""

# self.exit_stack = AsyncExitStack()

# self.openai_api_key = os.getenv("OPENAI_API_KEY")

# self.base_url = os.getenv("BASE_URL")

# self.model = os.getenv("MODEL")

# if not self.openai_api_key: raise ValueError("âŒ æœªæ‰¾åˆ° OPENAI_API_KEYï¼Œè¯·åœ¨ .env æ–‡ä»¶ä¸­é…ç½®")

# # åˆå§‹åŒ– OpenAI Client

# self.client = OpenAI(api_key=self.openai_api_key, base_url=self.base_url)

# # å­˜å‚¨ (server_name -> MCP ClientSession) æ˜ å°„

# self.sessions: Dict[str, ClientSession] = {}

# å­˜å‚¨å·¥å…·ä¿¡æ¯ self.tools_by_session: Dict[str, list] = {} # æ¯ä¸ª session çš„ tools åˆ—è¡¨

self.all_tools = [] # åˆå¹¶æ‰€æœ‰å·¥å…·çš„åˆ—è¡¨

# async def connect_to_servers(self, servers: dict):

"""

# åŒæ—¶å¯åŠ¨å¤šä¸ªæœåŠ¡å™¨å¹¶è·å–å·¥å…·

servers: å½¢å¦‚ {"weather": "weather_server.py", "rag": "rag_server.py"}

"""

# for server_name, script_path in servers.items():

# session = await self._start_one_server(script_path)

self.sessions[server_name] = session

# # åˆ—å‡ºæ­¤æœåŠ¡å™¨çš„å·¥å…·

resp = await session.list_tools() self.tools_by_session[server_name] = resp.tools # ä¿å­˜åˆ°

# self.tools_by_session

# for tool in resp.tools: # OpenAI Function Calling æ ¼å¼ä¿®æ­£

# function_name = f"{server_name}_{tool.name}"

# # print(tool.name)

# self.all_tools.append({

"type": "function",

## "function": {

## "name": function_name,

"description": tool.description,

# "input_schema": tool.inputSchema

}

})

# # è½¬åŒ–function callingæ ¼å¼

self.all_tools = await self.transform_json(self.all_tools)

# # print(self.all_tools)

# print("\nâœ… å·²è¿æ¥åˆ°ä¸‹åˆ—æœåŠ¡å™¨:") for name in servers:

print(f" - {name}: {servers[name]}")

# print("\næ±‡æ€»çš„å·¥å…·:")

# for t in self.all_tools:

# print(f" - {t['function']['name']}")

# async def transform_json(self, json2_data):

"""

# å°†ç±»ä¼¼ json2 çš„æ ¼å¼è½¬æ¢ä¸ºç±»ä¼¼ json1 çš„æ ¼å¼ï¼Œå¤šä½™å­—æ®µä¼šè¢«ç›´æ¥åˆ é™¤ã€‚

# :param json2_data: ä¸€ä¸ªå¯è¢«è§£é‡Šä¸ºåˆ—è¡¨çš„ Python å¯¹è±¡ï¼ˆæˆ–å·²è§£æçš„ JSON æ•°æ®ï¼‰

# :return: è½¬æ¢åçš„æ–°åˆ—è¡¨

"""

# result = []

# for item in json2_data:

# ç¡®ä¿æœ‰ "type" å’Œ "function" ä¸¤ä¸ªå…³é”®å­—æ®µ

# if not isinstance(item, dict) or "type" not in item or "function" not

# in item:

# continue

# old_func = item["function"]

# # ç¡®ä¿ function ä¸‹æœ‰æˆ‘ä»¬éœ€è¦çš„å…³é”®å­å­—æ®µ

# if not isinstance(old_func, dict) or "name" not in old_func or

# "description" not in old_func:

# continue

# # å¤„ç†æ–° function å­—æ®µ

# new_func = {

"name": old_func["name"],

"description": old_func["description"],

# "parameters": {}

}

# # è¯»å– input_schema å¹¶è½¬æˆ parameters

# if "input_schema" in old_func and

# isinstance(old_func["input_schema"], dict):

# old_schema = old_func["input_schema"]

# æ–°çš„ parameters ä¿ç•™ type, properties, required è¿™ä¸‰ä¸ªå­—æ®µ

new_func["parameters"]["type"] = old_schema.get("type", "object")

## new_func["parameters"]["properties"] =

## old_schema.get("properties", {})

new_func["parameters"]["required"] = old_schema.get("required",

[])

# new_item = {

"type": item["type"],

# "function": new_func

}

# result.append(new_item)

# return result

# async def _start_one_server(self, script_path: str) -> ClientSession:

# """å¯åŠ¨å•ä¸ª MCP æœåŠ¡å™¨å­è¿›ç¨‹ï¼Œå¹¶è¿”å› ClientSession"""

# is_python = script_path.endswith(".py")

# is_js = script_path.endswith(".js")

# if not (is_python or is_js):

# raise ValueError("æœåŠ¡å™¨è„šæœ¬å¿…é¡»æ˜¯ .py æˆ– .js æ–‡ä»¶")

command = "python" if is_python else "node"

server_params = StdioServerParameters(

command=command,

args=[script_path],

# env=None

)

# stdio_transport = await

# self.exit_stack.enter_async_context(stdio_client(server_params))

# read_stream, write_stream = stdio_transport

# session = await

# self.exit_stack.enter_async_context(ClientSession(read_stream, write_stream))

# await session.initialize()

# return session

# async def chat_base(self, messages: list) -> list:

# messages = [{"role": "user", "content": query}]

# response = self.client.chat.completions.create(

model=self.model,

messages=messages,

# tools=self.all_tools

)

if response.choices[0].finish_reason == "tool_calls":

# while True:

messages = await self.create_function_response_messages(messages,

# response)

# response = self.client.chat.completions.create(

model=self.model,

messages=messages,

# tools=self.all_tools

)

if response.choices[0].finish_reason != "tool_calls":

break

## # return response.choices[0].message.content

## return response

# async def create_function_response_messages(self, messages, response):

# function_call_messages = response.choices[0].message.tool_calls

# messages.append(response.choices[0].message.model_dump())

# for function_call_message in function_call_messages:

# tool_name = function_call_message.function.name

# tool_args = json.loads(function_call_message.function.arguments)

# # è¿è¡Œå¤–éƒ¨å‡½æ•°

# function_response = await self._call_mcp_tool(tool_name, tool_args)

# # æ‹¼æ¥æ¶ˆæ¯é˜Ÿåˆ—

# messages.append(

{

"role": "tool",

"content": function_response,

"tool_call_id": function_call_message.id,

}

)

# return messages

# async def process_query(self, user_query: str) -> str:

"""

OpenAI æœ€æ–° Function Calling é€»è¾‘: 1. å‘é€ç”¨æˆ·æ¶ˆæ¯ + tools ä¿¡æ¯

2. è‹¥æ¨¡å‹ `finish_reason == "tool_calls"`ï¼Œåˆ™è§£æ toolCalls å¹¶æ‰§è¡Œç›¸åº” MCP

# å·¥å…·

3. æŠŠè°ƒç”¨ç»“æœè¿”å›ç»™ OpenAIï¼Œè®©æ¨¡å‹ç”Ÿæˆæœ€ç»ˆå›ç­”

"""

messages = [{"role": "user", "content": user_query}]

# # ç¬¬ä¸€æ¬¡è¯·æ±‚

# response = self.client.chat.completions.create(

model=self.model,

messages=messages,

# tools=self.all_tools

)

content = response.choices[0]

# print(content)

# print(self.all_tools)

# # å¦‚æœæ¨¡å‹è°ƒç”¨äº† MCP å·¥å…·

if content.finish_reason == "tool_calls":

# # è§£æ tool_calls

# tool_call = content.message.tool_calls[0]

# tool_name = tool_call.function.name # å½¢å¦‚ "weather_query_weather"

# tool_args = json.loads(tool_call.function.arguments)

print(f"\n[ è°ƒç”¨å·¥å…·: {tool_name}, å‚æ•°: {tool_args} ]\n")

# # æ‰§è¡ŒMCPå·¥å…·

result = await self._call_mcp_tool(tool_name, tool_args)

## # æŠŠå·¥å…·è°ƒç”¨å†å²å†™è¿› messages

## messages.append(content.message.model_dump())

# messages.append({

"role": "tool",

"content": result,

"tool_call_id": tool_call.id,

})

# # ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œè®©æ¨¡å‹æ•´åˆå·¥å…·ç»“æœï¼Œç”Ÿæˆæœ€ç»ˆå›ç­”

# response = self.client.chat.completions.create(

model=self.model,

# messages=messages

)

return response.choices[0].message.content

# # å¦‚æœæ¨¡å‹æ²¡è°ƒç”¨å·¥å…·ï¼Œç›´æ¥è¿”å›å›ç­”

# return content.message.content

# async def _call_mcp_tool(self, tool_full_name: str, tool_args: dict) -> str:

"""

# æ ¹æ® "serverName_toolName" è°ƒç”¨ç›¸åº”çš„æœåŠ¡å™¨å·¥å…·

"""

parts = tool_full_name.split("_", 1) # æ‹†åˆ† "weather_query_weather" ->

# ["weather", "query_weather"]

if len(parts) != 2: return f"æ— æ•ˆçš„å·¥å…·åç§°: {tool_full_name}"

# server_name, tool_name = parts

# session = self.sessions.get(server_name)

# if not session:

# return f"æ‰¾ä¸åˆ°æœåŠ¡å™¨: {server_name}"

# # æ‰§è¡Œ MCP å·¥å…·

# resp = await session.call_tool(tool_name, tool_args)

# print(resp) return resp.content if resp.content else "å·¥å…·æ‰§è¡Œæ— è¾“å‡º"

async def chat_loop(self): print("\nğŸ¤– å¤šæœåŠ¡å™¨ MCP + æœ€æ–° Function Calling å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼è¾“å…¥ 'quit' é€€ å‡ºã€‚")

messages = []

# while True:

# query = input("\nä½ : ").strip()

if query.lower() == "quit":

# break

# try:

# messages.append({"role": "user", "content": query})

messages = messages[-20: ]

# # print(messages)

# response = await self.chat_base(messages)

# messages.append(response.choices[0].message.model_dump())

result = response.choices[0].message.content

# print(f"\nAI: {result}")

except Exception as e: print(f"\nâš  è°ƒç”¨è¿‡ç¨‹å‡ºé”™: {e}")

![Image](pdf_images\page204_img1.png)

## async def cleanup(self): # å…³é—­æ‰€æœ‰èµ„æº

# await self.exit_stack.aclose()

# async def main(): # æœåŠ¡å™¨è„šæœ¬

servers = {

"write": "write_server.py",

"weather": "weather_server.py",

"SQLServer":"SQL_server.py",

# "PythonServer":"Python_server.py"

}

# client = MultiServerMCPClient()

# try:

# await client.connect_to_servers(servers)

# await client.chat_loop()

# finally:

# await client.cleanup()

if __name__ == "__main__":

# asyncio.run(main())

# ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

# 5.miniMateGenåŠŸèƒ½æµ‹è¯•

æ¥ä¸‹æ¥å³å¯å¯åŠ¨MCPå®¢æˆ·ç«¯ï¼š

# source .venv/bin/activate

# uv run client.py

# æ­¤æ—¶é¡¹ç›®å†…æ‹·è´äº†weather_server.pyï¼ˆå¤©æ°”æŸ¥è¯¢å®¢æˆ·ç«¯ï¼‰ï¼Œå› æ­¤å¯ä»¥å…ˆæµ‹è¯•function callingå¹¶è¡Œèƒ½å¦é¡º

# åˆ©è¿è¡Œï¼š

![Image](pdf_images\page205_img1.png)

![Image](pdf_images\page205_img2.png)

![Image](pdf_images\page205_img3.png)

![Image](pdf_images\page205_img4.png)

# ä»¥åŠFunction callingä¸²è”èƒ½å¦è¿è¡Œï¼š

![Image](pdf_images\page206_img1.png)

![Image](pdf_images\page206_img2.png)

![Image](pdf_images\page206_img3.png)

## 5.1 NL2SQLåŠŸèƒ½æµ‹è¯•

# è¯·å¸®æˆ‘æŸ¥è¯¢æ•°æ®åº“ä¸­æ€»å…±åŒ…å«å‡ å¼ è¡¨ï¼Ÿ

# è¿™å¼ è¡¨ä¸­æ€»å…±æœ‰å‡ æ¡æ•°æ®ï¼Ÿ

# è¯·å¸®æˆ‘å°†è¿™å¼ è¡¨å¯¼å‡ºåˆ°æœ¬åœ°

# 5.2 NL2PythonåŠŸèƒ½æµ‹è¯•

# ä½ å¥½ï¼Œè¯·å¸®æˆ‘ç¼–å†™å¹¶è¿è¡Œä¸€æ®µPythonä»£ç ï¼Œæ¥åˆ›å»ºä¸€ä¸ª10ä½çš„éšæœºæ•°

![Image](pdf_images\page207_img1.png)

![Image](pdf_images\page207_img2.png)

![Image](pdf_images\page207_img3.png)

## 5.3 NL2SQL+NL2PythonåŠŸèƒ½è”åŠ¨æµ‹è¯•

# è¯·å¸®æˆ‘è¿è¡ŒPythonä»£ç æ¥è¯»å–æœ¬åœ°students_scores.csvæ–‡ä»¶ï¼Œå¹¶æ‰“å°ç¬¬ä¸€è¡Œæ•°æ®

# å¥½çš„ï¼Œæ¥ä¸‹æ¥æˆ‘æƒ³è¦æŸ¥çœ‹è¿™å¼ è¡¨çš„å…¨éƒ¨ä¿¡æ¯ï¼Œè¯·å¸®æˆ‘æ‰“å°è¿™å¼ è¡¨

# è¯·å¸®æˆ‘è®¡ç®—è¿™å¼ è¡¨ä¸­å…¨éƒ¨å­¦ç”Ÿä¸‰é—¨å­¦ç§‘çš„å¹³å‡åˆ†æ•°

# ä»é›¶åˆ°ä¸€MCPå¼€å‘ä¸éƒ¨ç½²å®æˆ˜

# ä»é›¶åˆ°ä¸€MCPå¿«é€Ÿå…¥é—¨å®æˆ˜ ä¸€ã€MCPæŠ€æœ¯ä½“ç³»ä»‹ç»

1. MCPå…¥é—¨ä»‹ç»

2. Function callingæŠ€æœ¯å›é¡¾

3. å¤§æ¨¡å‹Agentå¼€å‘æŠ€æœ¯ä½“ç³»å›é¡¾

# äºŒã€MCPå®¢æˆ·ç«¯Clientå¼€å‘æµç¨‹

1. uvå·¥å…·å…¥é—¨ä½¿ç”¨æŒ‡å—

1.1 uvå…¥é—¨ä»‹ç»

## 1.2 uvå®‰è£…æµç¨‹

## 1.3 uvçš„åŸºæœ¬ç”¨æ³•ä»‹ç» 2.MCPæç®€å®¢æˆ·ç«¯æ­å»ºæµç¨‹

# 2.1 åˆ›å»º MCP å®¢æˆ·ç«¯é¡¹ç›®

# 2.2 åˆ›å»ºMCPå®¢æˆ·ç«¯è™šæ‹Ÿç¯å¢ƒ

# 2.3 ç¼–å†™åŸºç¡€ MCP å®¢æˆ·ç«¯ 2.4 MCPå®¢æˆ·ç«¯åŸºæœ¬ä»£ç ç»“æ„

# 2.5 è¿è¡Œ MCP å®¢æˆ·ç«¯

# 2.6 Jupyterä¸­ä»£ç è¿è¡Œæ•ˆæœ

3. MCPå®¢æˆ·ç«¯æ¥å…¥OpenAIã€DeepSeekåœ¨çº¿æ¨¡å‹æµç¨‹

# 3.1 æ–°å¢ä¾èµ–

# 3.2 åˆ›å»º.envæ–‡ä»¶

# 3.3 ä¿®æ”¹client.pyä»£ç  3.4 è¿è¡Œclient.py

# 3.5 clint.pyä»£ç è§£é‡Š

4. MCPå®¢æˆ·ç«¯æ¥å…¥æœ¬åœ°ollamaã€vLLMæ¨¡å‹æµç¨‹

# 4.1 MCPå®¢æˆ·ç«¯æ¥å…¥æœ¬åœ°ollama 4.2 MCPå®¢æˆ·ç«¯æ¥å…¥vLLM

# ä¸‰ã€MCPå¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨serverä¸ä½¿ç”¨

1. MCPæœåŠ¡å™¨æ¦‚å¿µä»‹ç» 2. MCPæœåŠ¡å™¨é€šè®¯æœºåˆ¶

3. å¤©æ°”æŸ¥è¯¢æœåŠ¡å™¨Serveråˆ›å»ºæµç¨‹

# 3.1 æœåŠ¡å™¨ä¾èµ–å®‰è£…

# 3.2 æœåŠ¡å™¨ä»£ç ç¼–å†™

4. å¤©æ°”æŸ¥è¯¢å®¢æˆ·ç«¯clientåˆ›å»ºæµç¨‹

# 4.1 ä»£ç ç¼–å†™

# 4.2 æµ‹è¯•è¿è¡Œ 4.3 ä»£ç è§£é‡Š

# 5.MCP InspectoråŠŸèƒ½ä»‹ç»

# å››ã€MCPæ›´å¤šè¿›é˜¶ä½¿ç”¨

1. MCPæœåŠ¡å™¨Serverè¿›é˜¶åŠŸèƒ½ 2. MCPå®¢æˆ·ç«¯Clientè¿›é˜¶åŠŸèƒ½

# MCPå¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨æŒ‡å—

# ä¸€ã€MCPåŸºç¡€æŠ€æœ¯å›é¡¾

1. MCPå…¥é—¨ä»‹ç»

# 2.MCPæœåŠ¡å™¨Serveråˆé›†

3. MCPçƒ­é—¨å®¢æˆ·ç«¯Client

# äºŒã€Cursoræ¥å…¥MCPå·¥å…·æµç¨‹

# 1.Cursorå®‰è£…ä¸Agentæ¨¡å¼å¼€å¯

# 1.1 Cursorå®‰è£…æµç¨‹

# 1.2 Cursor Agentè°ƒç”¨æ¨¡å¼

# 2.å°†æ–°ç‰ˆCursoræ¥å…¥MCP

# 2.1 å®‰è£…åŸºç¡€ä¾èµ–

# 2.2 å°è¯•ä¸ºCursoræ·»åŠ MCPå·¥å…·

# 2.4 æ·»åŠ Playwright MCP 2.4 æ·»åŠ FileSystemå·¥å…·

# ä¸‰ã€ä¸ªäººåŠ©ç†Cherry Studioæ¥å…¥MCPå®ç°æµç¨‹

# 1.Cherry Studioå®‰è£…æµç¨‹

2. Cherry Studioæ¥å…¥MCPæµç¨‹

# å››ã€é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°æ¥å…¥MCP

1. é˜¿é‡Œäº‘ç™¾ç‚¼å¹³å°ä»‹ç»

2. é˜¿é‡Œäº‘ç™¾ç‚¼æ¥å…¥MCPæµç¨‹ 2. Firecrawl MCPå·¥å…·

3. ç™¾ç‚¼åº”ç”¨APIè·å–ä¸è°ƒç”¨

äº”ã€Open-WebUIæ¥å…¥MCPæµç¨‹

1. ã€å¯é€‰ã€‘å€ŸåŠ©ollamaæ‹‰å–æ¨¡å‹

## 1.1 ollamaå®‰è£…ä¸éƒ¨ç½²

## 1.2 ä¸‹è½½Gemma-27Bæ¨¡å‹

2. Open-WebUIå®‰è£…ä¸è°ƒç”¨

3. Open-WebUIæ¥å…¥MCPæµç¨‹

# MCPæ™ºèƒ½ä½“å¼€å‘å®æˆ˜å…¥é—¨

# ä¸€ã€MCPæŠ€æœ¯ä½“ç³»ä»‹ç»

1. MCPå…¥é—¨ä»‹ç»

2. MCPæ™ºèƒ½ä½“å¼€å‘å…¥é—¨é¡¹ç›®

# äºŒã€GraphRAGåŸºäºçŸ¥è¯†å›¾è°±çš„æ£€ç´¢å¢å¼ºæŠ€æœ¯

# 1.GraphRAGå…¥é—¨ä»‹ç»

# 2.GraphRAGåŸºæœ¬åŸç†å›é¡¾

3. GraphRAGè¿è¡Œæµç¨‹

# 3.1 ç´¢å¼•ï¼ˆIndexingï¼‰è¿‡ç¨‹ 3.2 æŸ¥è¯¢ï¼ˆQueryï¼‰è¿‡ç¨‹

# 3.3 Prompt è°ƒä¼˜

# 3.4 GraphRAGè®¡ç®—æµç¨‹æç®€ç¤ºä¾‹

# 4.GraphRAGå®‰è£…ä¸Indexing&Queryæµç¨‹å®ç° 5.GraphRAG APIä½¿ç”¨æ–¹æ³•

# ä¸‰ã€MCP+GraphRAGæ­å»ºæ£€ç´¢å¢å¼ºæ™ºèƒ½ä½“

# 1.MCP+GraphRAGé¡¹ç›®ç¯å¢ƒæ­å»º 1.1 åˆ›å»º MCP å®¢æˆ·ç«¯é¡¹ç›®

# 1.2 åˆ›å»ºMCPå®¢æˆ·ç«¯è™šæ‹Ÿç¯å¢ƒ

# 1.3 åˆ›å»ºGraphRAGå¹¶æ„å»ºç´¢å¼•ï¼ˆIndexï¼‰

# 2.åˆ›å»ºGraphRAGæœåŠ¡å™¨Server 3.åˆ›å»ºGraphRAGæœåŠ¡å™¨client

# 4.MCP+GraphRAGé—®ç­”æµ‹è¯•

# 4.1 å‘½ä»¤è¡Œé—®ç­” 4.2 Claude Desktopé—®ç­”

# å››ã€MCPæ™ºèƒ½ä½“å¼€å‘åŸºç¡€ç†è®ºå…¥é—¨

1. çœŸå®ä¸–ç•Œçš„å¤æ‚æ™ºèƒ½ä½“å¼€å‘é¡¹ç›®

# 1.1 2023å¹´MateGen 1.0ä»£ç ç»“æ„å›¾ 1.2 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹ä¼ä¸šé—®ç­”æ™ºèƒ½ä½“é¡¹ç›®æµç¨‹å›¾

# 1.3 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹æ™ºèƒ½å®¢æœé¡¹ç›®æµç¨‹å›¾

# 1.4 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹æ™ºèƒ½å¸‚åœºåˆ†æé¡¹ç›®æµç¨‹å›¾ 1.5 2025å¤§æ¨¡å‹Agentå¼€å‘å®æˆ˜ä»˜è´¹è¯¾ç¨‹MateGen 2.0é¡¹ç›®æ¶æ„

2. æ™ºèƒ½ä½“å¼€å‘æ¡†æ¶é€‰å‹

3. ä»é›¶å¿«é€Ÿäº†è§£æ™ºèƒ½ä½“å¼€å‘

# äº”ã€OpenAIé£æ ¼API Function callingè¿›é˜¶åŠŸèƒ½ä»‹ç» å…­ã€å€ŸåŠ©MCPæ­å»ºAIæ•°æ®åˆ†ææ™ºèƒ½ä½“

1. miniMateGené¡¹ç›®åˆå§‹åŒ–

2. åˆ›å»ºMCPæœåŠ¡å™¨ä¸€ï¼šSQL_server

# 2.1 Linuxç¯å¢ƒä¸‹å®‰è£…MySQLæœåŠ¡å™¨å¹¶åˆ›å»ºç®€å•æ•°æ®é›†

# 2.2 ç¼–å†™SQL_server.pyä»£ç 

3. åˆ›å»ºMCPæœåŠ¡å™¨äºŒï¼šPython_server

# 4.åˆ›å»ºMCPå®¢æˆ·ç«¯Client 5.miniMateGenåŠŸèƒ½æµ‹è¯•

# 5.1 NL2SQLåŠŸèƒ½æµ‹è¯•

# 5.2 NL2PythonåŠŸèƒ½æµ‹è¯•

# 5.3 NL2SQL+NL2PythonåŠŸèƒ½è”åŠ¨æµ‹è¯•

# ä»é›¶åˆ°ä¸€MCPå¼€å‘ä¸éƒ¨ç½²å®æˆ˜

# ä¸€ã€MCPæŠ€æœ¯å…¥é—¨ä»‹ç»

# 1.æ™ºèƒ½ä½“å¼€å‘æ ¸å¿ƒæŠ€æœ¯â€”MCP

# 1.1 Function callingæŠ€æœ¯å›é¡¾

# 1.2 Function callingå…¬å¼€è¯¾ä»‹ç»

1.3 Function callingèƒ½åŠ›ä»ä½•è€Œæ¥

1.4 MCPæŠ€æœ¯æœ¬è´¨ï¼šFunction callingçš„æ›´é«˜å±‚å®ç°

## 1.5 MCPæŠ€æœ¯å¸¦æ¥çš„æ™ºèƒ½ä½“å¼€å‘æ•ˆç‡é©å‘½

## 2. MCPæœåŠ¡å™¨æ¥å…¥ç¤ºä¾‹ 3. MCPå·¥å…·æ ‡å‡†æ¥å…¥æµç¨‹

4. MCPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯

# 4.1 MCPæœåŠ¡å™¨ï¼ˆserverï¼‰ä¸å®¢æˆ·ç«¯ï¼ˆclientï¼‰æ¦‚å¿µä»‹ç»

# 4.2 MCPæœåŠ¡å™¨é›†åˆ

5. MCPä¸Function callingæŠ€æœ¯å¯¹æ¯”ä»‹ç»

6. MCPæŠ€æœ¯ç”Ÿæ€

# äºŒã€ä»é›¶åˆ°ä¸€è¿›è¡ŒMCPé¡¹ç›®å¼€å‘ 1. MCPæœåŠ¡å™¨å¼€å‘æµç¨‹ä»‹ç»

2. MCP Serveræ ¸å¿ƒåŠŸèƒ½å¼€å‘

# 2.1 Mini DeepResearché¡¹ç›®ä»‹ç»

# 2.2 Mini DeepResearché¡¹ç›®æ¶æ„ä»‹ç» 2.3 planner_agentåŠŸèƒ½å®ç°

# 2.4 search_agentåŠŸèƒ½å®ç°

# 2.5 writer_agentåŠŸèƒ½å®ç°

# 2.6 MCPæœåŠ¡å™¨ä¸»å‡½æ•°ç¼–å†™

3. MCP Serveré¡¹ç›®å¼€å‘

# Step 1. å€ŸåŠ©uvåˆ›å»ºPythoné¡¹ç›®

# Step 2. æ·»åŠ é¡¹ç›®ä¾èµ– Step 3.ç¼–å†™é¡¹ç›®æºç 

4. å€ŸåŠ©MCP Inspectorè¿›è¡ŒåŠŸèƒ½æµ‹è¯•

# ä¸‰ã€MCPæœåŠ¡å™¨éƒ¨ç½²æµç¨‹

1. DeepResearché¡¹ç›®å®Œå–„ 1.1 src layouté¡¹ç›®ç»“æ„ 1.2 ä¿®æ”¹pyproject.toml

2. é¡¹ç›®ç¦»çº¿æ‹·è´ 3. é¡¹ç›®å‘å¸ƒåˆ°pipyå¹³å°

# å››ã€åŸºäºSSEä¼ è¾“æ–¹å¼çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

1. stdioã€SSEä¸åŸºäºHTTPçš„æµå¼ä¼ è¾“å½¢å¼å¯¹æ¯”

# 1.1 MCPé€šä¿¡åè®®ä»‹ç» 1.2 Stdio ä¼ è¾“ï¼ˆStandard Input/Outputï¼‰

# 1.3 Server-Sent Eventsï¼ˆSSEï¼‰

# 1.4 Streamable HTTP 1.1.4 MCP ä¼ è¾“æ–¹å¼ä¼˜åŠ£åŠ¿å¯¹æ¯”

2. åŸºäºSSEä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

3. åŸºäºSSEçš„MCPæœåŠ¡å™¨æµ‹è¯•ä¸å‘å¸ƒæµç¨‹

# 3.1 SSE MCPæœåŠ¡å™¨æµ‹è¯•æµç¨‹ 3.2 SSE MCPæœåŠ¡å™¨å‘å¸ƒä¸è°ƒç”¨æµç¨‹

# äº”ã€åŸºäºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

1. HTTPæµå¼ä¼ è¾“åè®®

# 1.1 Streamable HTTPåè®®ç®€ä»‹

# 1.2 HTTPè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

# 1.3 HTTPæœåŠ¡å™¨å¤–éƒ¨å·¥å…·è°ƒç”¨è¯†åˆ«ä¸è°ƒç”¨æµç¨‹

# 1.4 HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡æµç¨‹

2. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å‘æµç¨‹

3. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å¯ä¸æµ‹è¯•

4. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨Cherry Studioè°ƒç”¨æµ‹è¯•

5. è‡ªå®šä¹‰MCPå®¢æˆ·ç«¯Clientæ¥å…¥HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨

# 5.1 ç¼–å†™client.pyè„šæœ¬

# 5.2 åˆ›å»º.envå’Œservers_config.jsonæ–‡ä»¶

# 5.3 å€ŸåŠ©è‡ªå®šä¹‰clientæ¥å…¥æµå¼HTTP MCPæœåŠ¡å™¨

# æµå¼HTTP MCPæœåŠ¡å™¨å¼€å‘æŒ‡å—

# ä¸€ã€åŸºäºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨å¼€å‘æµç¨‹

äºŒã€HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å¯ä¸æµ‹è¯•

ä¸‰ã€æµå¼HTTP MCPæœåŠ¡å™¨å¼‚åœ°è°ƒç”¨

![Image](pdf_images\page211_img1.png)

## å››ã€æµå¼HTTP MCPæœåŠ¡å™¨å‘å¸ƒæµç¨‹

# å…¬å¼€è¯¾ä»£ç é¢†å–

# ä¸€ã€MCPæŠ€æœ¯å…¥é—¨ä»‹ç»

# 1.æ™ºèƒ½ä½“å¼€å‘æ ¸å¿ƒæŠ€æœ¯â€”MCP

# 1.1 Function callingæŠ€æœ¯å›é¡¾

# å¦‚ä½•å¿«é€Ÿå¼€å‘ä¸€æ¬¾æ™ºèƒ½ä½“åº”ç”¨ï¼Œæœ€å…³é”®çš„æŠ€æœ¯éš¾ç‚¹å°±åœ¨äºå¦‚ä½•è®©å¤§æ¨¡å‹é«˜æ•ˆç¨³å®šçš„æ¥å…¥ä¸€äº›å¤–éƒ¨å·¥

# å…·ã€‚è€Œåœ¨MCPæŠ€æœ¯è¯ç”Ÿä¹‹å‰ï¼Œæœ€ä¸»æµçš„æ–¹æ³•ï¼Œæ˜¯å€ŸåŠ©Function callingæŠ€æœ¯æ¥æ‰“é€šå¤§æ¨¡å‹å’Œå¤–éƒ¨å·¥å…·ä¹‹é—´

# çš„è”ç³»ï¼Œæ¢è€Œè¨€ä¹‹ï¼Œä¹Ÿå°±æ˜¯å€ŸåŠ©Function callingï¼Œæ¥è®©å¤§æ¨¡å‹çµæ´»çš„è°ƒç”¨å¤–éƒ¨å·¥å…·ã€‚

# ä¾‹å¦‚ä¸€ä¸ªå…¸å‹çš„Function callingç¤ºä¾‹ï¼Œæˆ‘ä»¬å¸Œæœ›è®©å¤§æ¨¡å‹èƒ½å¤Ÿè°ƒç”¨ä¸€äº›å¤©æ°”APIæŸ¥è¯¢å³æ—¶å¤©æ°”ï¼Œæ­¤

æ—¶æˆ‘ä»¬å°±éœ€è¦åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢å¤©æ°”çš„å¤–éƒ¨å‡½æ•°ï¼Œè´Ÿè´£è°ƒç”¨å¤©æ°”APIæ¥æŸ¥è¯¢å¤©æ°”ï¼ŒåŒæ—¶å°†å¤–éƒ¨å‡½æ•°çš„è¯´æ˜ä¼ é€’ ç»™å¤§æ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿæ ¹æ®ç”¨æˆ·æ„å›¾ï¼Œåœ¨å¿…è¦çš„æ—¶å€™å‘å¤–éƒ¨å‡½æ•°å‘èµ·è°ƒç”¨è¯·æ±‚ã€‚

![Image](pdf_images\page212_img1.png)

![Image](pdf_images\page212_img2.png)

# Function callingæœ€æ—©ç”±OpenAIä¸2023å¹´6æœˆ13å·æ­£å¼æå‡ºï¼Œè¯¥é¡¹æŠ€æœ¯çš„åå­—ä¹Ÿç”±æ­¤å‘½åï¼šhttps://

# openai.com/index/function-calling-and-other-api-updates/

# æ­¤å¤–ï¼ŒFunction callingä¹Ÿè¢«ç§°ä½œtool useã€tool callç­‰æŠ€æœ¯ã€‚

# æ¯«æ— ç–‘é—®ï¼ŒFunction callingçš„è¯ç”Ÿæ„ä¹‰é‡å¤§ï¼Œè¿™é¡¹æŠ€æœ¯ç›®å‰ä¹Ÿæˆä¸ºå¤§æ¨¡å‹è°ƒç”¨å¤–éƒ¨å·¥å…·çš„åŸºæœ¬æŠ€æœ¯

# èŒƒå¼ï¼Œå“ªæ€•æ˜¯MCPç››è¡Œçš„ä»Šå¤©ï¼Œåº•å±‚ä»ç„¶æ˜¯Function callingæ‰§è¡Œæµç¨‹ã€‚

# 1.2 Function callingå…¬å¼€è¯¾ä»‹ç»

# è€Œå¯¹äºå¤§æ¨¡å‹å¼€å‘è€…æ¥è¯´ï¼Œæ— è®ºæ˜¯é‡‡ç”¨ä½•ç§Agentå¼€å‘æ¡†æ¶æˆ–MCPæŠ€æœ¯ï¼ŒæŒæ¡Function callingçš„å® ç°æµç¨‹å’Œåº•å±‚åŸç†è‡³å…³é‡è¦ï¼Œå…·ä½“Function callingå®ç°åŸç†å¯ä»¥å‚è€ƒå…¬å¼€è¯¾ã€Šæ™ºèƒ½ä½“ä»ä½•è€Œæ¥ï¼Ÿæ·±åº¦è¯¦

# è§£å¤§æ¨¡å‹è°ƒç”¨å·¥å…·åº•å±‚åŸç†ã€‹ï¼šhttps://www.bilibili.com/video/BV1w6dBYxELA/ï¼Œè€Œå…³äºDeepSeekæ¨¡

# å‹Function callingå®ç°æµç¨‹ï¼Œå¯ä»¥å‚è€ƒå…¬å¼€è¯¾ã€ŠDeepSeekæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ï¼Œä»é›¶æ‰‹æ“Mini

# Manusï¼ã€‹ï¼šhttps://www.bilibili.com/video/BV1L3ZDYDEnE/ã€‚

![Image](pdf_images\page213_img1.png)

![Image](pdf_images\page213_img2.png)

## 1.3 Function callingèƒ½åŠ›ä»ä½•è€Œæ¥

# ä¸è¿‡ä¸ºäº†æ›´å¥½çš„å­¦ä¹ æœ¬æœŸå…¬å¼€è¯¾ï¼Œéœ€è¦é‡ç‚¹å¼ºè°ƒçš„æ˜¯å…³äºå¤§æ¨¡å‹çš„Function callingçš„èƒ½åŠ›å¦‚ä½•è€Œ

# æ¥ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¯¹äºå½“å‰å¤§æ¨¡å‹æ¥è¯´ï¼Œæœ‰äº›æ¨¡å‹æœ‰Function callingèƒ½åŠ›ï¼Œå¦‚DeepSeek-V3æ¨¡å‹ï¼Œè€Œæœ‰ äº›æ¨¡å‹æ²¡æœ‰ï¼Œå¦‚DeepSeek-R1æ¨¡å‹ï¼š

# ç”šè‡³å¯¹äºDeepSeek-V3-0324æ¨¡å‹æ¥è¯´ï¼Œè¿˜æ”¯æŒå·¥å…·çš„å¹¶è”ã€ä¸²è”è°ƒç”¨ç”šè‡³æ˜¯è‡ªåŠ¨debugï¼š

# å…·ä½“ä»£ç å®ç°æµç¨‹å¯å‚è€ƒå…¬å¼€è¯¾ã€ŠDeepSeekæ™ºèƒ½ä½“å¼€å‘å®æˆ˜ï¼Œä»é›¶æ‰‹æ“Mini Manusï¼ã€‹ï¼šhttp s://www.bilibili.com/video/BV1L3ZDYDEnE/ã€‚

![Image](pdf_images\page214_img1.png)

![Image](pdf_images\page214_img2.png)

![Image](pdf_images\page214_img3.png)

## é‚£æ¨¡å‹æ˜¯å¦‚ä½•å…·å¤‡Function callingèƒ½åŠ›çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡æ¨¡å‹è®­ç»ƒã€‚å¯¹äºDeepSeek-V3æ¨¡å‹æ¥è¯´ï¼Œç”±äº

## åœ¨è®­ç»ƒé˜¶æ®µï¼ˆæŒ‡ä»¤å¾®è°ƒé˜¶æ®µï¼‰å°±å¸¦å…¥äº†å¤§é‡çš„ç±»ä¼¼å¦‚ä¸‹çš„å·¥å…·è°ƒç”¨å¯¹è¯æ•°æ®è¿›è¡Œè®­ç»ƒï¼Œå› æ­¤èƒ½å¤Ÿè¯†åˆ«å¤–

# éƒ¨å·¥å…·å¹¶å‘èµ·å¯¹å¤–éƒ¨å·¥å…·è°ƒç”¨çš„è¯·æ±‚ã€‚è€Œç±»ä¼¼çš„ï¼ŒR1æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹æ²¡æœ‰å·¥å…·è°ƒç”¨æ•°æ®ï¼Œå› æ­¤å°±ä¸å…·å¤‡ Function callingèƒ½åŠ›ã€‚

# æ›´å¤šå…³äºFunction callingåŸç†ï¼Œå¯ä»¥å‚è€ƒå…¬å¼€è¯¾ã€Šæ™ºèƒ½ä½“ä»ä½•è€Œæ¥ï¼Ÿæ·±åº¦è¯¦è§£å¤§æ¨¡å‹è°ƒç”¨å·¥å…·åº•

# å±‚åŸç†ã€‹ï¼šhttps://www.bilibili.com/video/BV1w6dBYxELA/ï¼Œ

# è€ŒFunction callingçš„èƒ½åŠ›ï¼Œæ˜¯å¤§æ¨¡å‹é¡ºåˆ©å¼€å¯MCPåŠŸèƒ½çš„åŸºç¡€ã€‚

# 1.4 MCPæŠ€æœ¯æœ¬è´¨ï¼šFunction callingçš„æ›´é«˜å±‚å®ç°

# è€Œè¿‘ä¸€æ®µæ—¶é—´å¤§ç«çš„MCPæŠ€æœ¯ï¼Œå…¶å®å°±å¯ä»¥å°†å…¶ç†è§£ä¸ºFunction callingæŠ€æœ¯çš„æ›´é«˜å±‚å°è£…å’Œå®ç°ã€‚

# ä¼ ç»Ÿçš„Function callingæŠ€æœ¯è¦æ±‚å›´ç»•ä¸åŒçš„å¤–éƒ¨å·¥å…·APIå•ç‹¬åˆ›å»ºä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œç±»ä¼¼ä¸€æŠŠé”å•ç‹¬é…ä¸€æŠŠ

# é’¥åŒ™ï¼Œè€Œä¸€ä¸ªæ™ºèƒ½ä½“åˆå¾€å¾€æ¶‰åŠåˆ°å¤šä¸ªå¤–éƒ¨å·¥å…·è®¾è®¡ï¼Œå› æ­¤å¼€å‘å·¥ä½œé‡å¾ˆå¤§ã€‚

# è€ŒMCPæŠ€æœ¯ï¼Œå…¨ç§°ä¸ºModel Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼Œæ˜¯ä¸€ç§å¼€å‘è€…å…±åŒéµå®ˆçš„åè®®ï¼Œåœ¨è¿™

ä¸ªåè®®æ¡†æ¶ä¸‹ï¼Œå¤§å®¶å›´ç»•æŸä¸ªAPIå¼€å‘çš„å¤–éƒ¨å·¥å…·å°±èƒ½å¤Ÿå…±ç”¨ï¼Œä»è€Œå¤§å¹…å‡å°‘é‡å¤é€ è½®å­çš„æ—¶é—´ã€‚

![Image](pdf_images\page215_img1.png)

![Image](pdf_images\page215_img2.png)

## 1.5 MCPæŠ€æœ¯å¸¦æ¥çš„æ™ºèƒ½ä½“å¼€å‘æ•ˆç‡é©å‘½

# ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æˆ‘ä»¬å¼€è®¾çš„ã€Šå¤§æ¨¡å‹åŸç†ä¸å®æˆ˜è¯¾ç¨‹ã€‹ï¼šhttps://whakv.xetslk.com/s/3p66pNç³»åˆ—è¯¾

# ç¨‹ä¸­ï¼Œ2023å¹´çš„ç¬¬ä¸€æœŸè¯¾ç¨‹é‡Œæ›¾ç»è®²è§£è¿‡ä¸€ä¸ªAgentå®æˆ˜é¡¹ç›®ï¼Œ

# å…¶ä¸­æ¶‰åŠå…³äºå¤§æ¨¡å‹å¯¹è¯é•¿çŸ­æœŸè®°å¿†å­˜å‚¨å’Œç®¡ç†ç›¸å…³åŠŸèƒ½å®ç°æ—¶ï¼Œå…‰æ˜¯ç¼–å†™æ¶ˆæ¯ç±»ï¼ˆMessagesï¼‰å¯¹è±¡çš„

# å„ç§æ“ä½œæ–¹æ³•ä»¥åŠå›´ç»•æœ¬åœ°æ–‡ä»¶å¤¹çš„å„ç±»æ“ä½œï¼Œå¦‚åˆ›å»ºã€åˆ é™¤ã€å†™å…¥æ–‡æ¡£ã€æ¸…ç©ºå¯¹è¯ã€ç»Ÿè®¡æ–‡æœ¬é•¿åº¦

# ç­‰ï¼Œå°±å†™äº†300å¤šè¡Œä»£ç ï¼š

![Image](pdf_images\page216_img1.png)

## è€Œç°åœ¨ï¼Œå€ŸåŠ©MCPæŠ€æœ¯ï¼Œé‡‡ç”¨åˆ«äººå·²ç»å¼€å‘å¥½çš„Filesystemå·¥å…·ï¼Œä»…éœ€å‡ è¡Œä»£ç ï¼Œå¯¼å…¥å·¥å…·é…ç½®å³å¯å®

## ç°å®Œå…¨ç›¸åŒçš„åŠŸèƒ½ã€‚ç”±æ­¤Agentå¼€å‘æ•ˆç‡å¤§å¹…æé«˜ï¼Œè€Œè¿™å°±æ˜¯MCPæŠ€æœ¯æ­å»ºèµ·æ¥çš„åä½œä½“ç³»çš„åŠ›é‡ã€‚

2. MCPæœåŠ¡å™¨æ¥å…¥ç¤ºä¾‹

# è€Œåœ¨MCPæŠ€æœ¯å¤§çˆ†å‘çš„ä»Šå¤©ï¼Œæ¥å…¥ä¸€ä¸ªMCPå·¥å…·ä¹Ÿæ˜¯éå¸¸ç®€å•ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå°†é«˜å¾·åœ°å›¾å¯¼èˆªMCP

# ï¼ˆæœåŠ¡å™¨ï¼‰æ¥å…¥Cherry Studioï¼ˆå®¢æˆ·ç«¯ï¼‰çš„ç¤ºä¾‹ï¼š

æˆ‘ä»¬å¯ä»¥æš‚æ—¶æŠŠMCPæœåŠ¡å™¨è§†ä½œMCPå·¥å…·ã€‚

# æˆ‘ä»¬èƒ½çœ‹åˆ°ï¼Œç°åœ¨å¦‚æœæƒ³è¦æ¥å…¥ä¸€ä¸ªMCPå·¥å…·ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æ”¯æŒMCPåŠŸèƒ½çš„å®¢æˆ·ç«¯ä¸­å†™å…¥ç›¸å…³é…ç½®å³

# å¯ã€‚ä¾‹å¦‚æˆ‘ä»¬åªéœ€è¦åœ¨Cherry Studioçš„MCPé…ç½®æ–‡æ¡£ä¸­å†™å…¥å¦‚ä¸‹å­—æ®µï¼š

![Image](pdf_images\page217_img1.png)

![Image](pdf_images\page217_img2.png)

## "amap-maps": {

## "isActive": true,

"command": "npx",

# "args": [

"-y",

# "@amap/amap-maps-mcp-server"

],

"env": {

"AMAP_MAPS_API_KEY": "YOUR_API_KRY"

},

# "name": "amap-maps"

}

å³å¯è®©å¤§æ¨¡å‹è‡ªåŠ¨å…³è”é«˜å¾·MCPå·¥å…·ï¼ˆæœåŠ¡å™¨ï¼‰ï¼Œè€Œä¸€ä¸ªé«˜å¾·MCPæœåŠ¡å™¨çš„APIæœ‰å‡ åç§ä¹‹å¤šï¼š

# å¯ä»¥è¯´æ˜¯è¦†ç›–äº†å‡ºè¡Œç”Ÿæ´»çš„æ”¾æ–¹é¢ã€‚è€Œå½“ä¸€ä¸ªå¤§æ¨¡å‹æ¥å…¥é«˜å¾·MCPæœåŠ¡å™¨åï¼Œå°±èƒ½ç¬é—´åŒ–èº«å‡ºè¡Œè§„åˆ’æ™º

# èƒ½ä½“ã€‚

# æ›´å¤šå®¢æˆ·ç«¯æ¥å…¥æœåŠ¡å™¨æ–¹æ³•ï¼Œè¯¦è§å…¬å¼€è¯¾ã€Šé›¶é—¨æ§›æ¥å…¥MCPï¼Cursorã€é˜¿é‡Œäº‘ç™¾ç‚¼ã€Open-

# WebUIã€Cherry Studioæ¥å…¥10å¤§æœ€çƒ­é—¨MCPå·¥å…·ã€‹ï¼šhttps://www.bilibili.com/video/BV1dCo7Y

# dEgK/

# è€Œè¦çŸ¥é“çš„æ˜¯ï¼Œå¦‚æœæ²¡æœ‰MCPå·¥å…·ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬å›´ç»•è¿™äº›APIå°†å…¶å°è£…ä¸ºä¸€ä¸ªä¸ªå¤–éƒ¨å‡½æ•°ï¼Œå†æ®æ­¤åˆ›å»º

ä¸€ä¸ªå‡ºè¡Œè§„åˆ’æ™ºèƒ½ä½“ï¼Œå…¶å·¥ä½œé‡å¯æƒ³è€ŒçŸ¥ã€‚

![Image](pdf_images\page218_img1.png)

## 3. MCPå·¥å…·æ ‡å‡†æ¥å…¥æµç¨‹

åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œä¸€ä¸ªMCPæœåŠ¡å™¨æ ‡å‡†æ¥å…¥æµç¨‹æ˜¯é€šè¿‡å†™å…¥ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥å®Œæˆçš„ã€‚

# è€Œåœ¨æ”¯æŒMCPåŠŸèƒ½çš„å®¢æˆ·ç«¯ï¼ˆå¦‚Cherry Studioï¼‰ä¸­å†™å…¥MCPå·¥å…·çš„é…ç½®ï¼Œå…¶æœ¬è´¨å°±æ˜¯å…ˆå°†æŒ‡å®šçš„MCPå·¥ å…·ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶ååœ¨æœ‰éœ€è¦çš„æ—¶å€™å¯¹å…¶è¿›è¡Œè°ƒç”¨ã€‚ä¾‹å¦‚é«˜å¾·MCPé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š

# "amap-maps": {

"isActive": true,

"command": "npx",

# "args": [

"-y",

# "@amap/amap-maps-mcp-server"

],

"env": {

"AMAP_MAPS_API_KEY": "YOUR_API_KRY"

},

# "name": "amap-maps"

}

# ä»£è¡¨çš„å«ä¹‰å°±æ˜¯æˆ‘ä»¬éœ€è¦å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š

# npx -y @amap/amap-maps-mcp-server

# å¯¹è¿™ä¸ªåº“ @amap/amap-maps-mcp-server è¿›è¡Œä¸‹è½½ï¼Œç„¶ååœ¨æœ¬åœ°è¿è¡Œï¼Œå½“æœ‰å¿…è¦çš„æ—¶å€™è°ƒç”¨è¿™ä¸ªåº“é‡Œé¢

# çš„å‡½æ•°æ‰§è¡Œç›¸å…³åŠŸèƒ½ã€‚

# è€Œè¿™ä¸ª @amap/amap-maps-mcp-server åº“æ˜¯ä¸€ä¸ªæ‰˜ç®¡åœ¨https://www.npmjs.com/ä¸Šçš„åº“ï¼Œ

# å¯ä»¥ä½¿ç”¨npxå‘½ä»¤è¿›è¡Œä¸‹è½½ã€‚æœç´¢åº“åå³å¯çœ‹åˆ°è¿™ä¸ªåº“çš„å®Œæ•´ä»£ç ï¼Œhttps://www.npmjs.com/package/

# @amap/amap-maps-mcp-serverï¼š

![Image](pdf_images\page219_img1.png)

![Image](pdf_images\page219_img2.png)

# è€Œè¿™ç§é€šè¿‡é…ç½®æ–‡ä»¶æ¥è¿›è¡ŒMCPå·¥å…·ä¸‹è½½çš„æ–¹å¼ï¼Œæœ€æ—©ç”±Claudeï¼ˆMCPæŠ€æœ¯çš„æå‡ºè€…ï¼‰æå‡ºå¹¶è¢«å¹¿æ³›æ¥

# çº³ã€‚

4. MCPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯

# 4.1 MCPæœåŠ¡å™¨ï¼ˆserverï¼‰ä¸å®¢æˆ·ç«¯ï¼ˆclientï¼‰æ¦‚å¿µä»‹ç»

# åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒCherry Studioæ˜¯ä¸€ä¸ªæ”¯æŒMCPåŠŸèƒ½çš„å®¢æˆ·ç«¯ï¼Œè€Œæ¥å…¥çš„é«˜å¾·MCPæ˜¯ä¸€ä¸ªMCPæœ

# åŠ¡å™¨ï¼Œè¿™é‡Œçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åˆæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

è¿™å…¶å®æ˜¯MCPæŠ€æœ¯ä½“ç³»ä¸­å¯¹äºå¤§æ¨¡å‹å’Œå¤–éƒ¨å·¥å…·çš„å¦ä¸€ç§åˆ’åˆ†æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨MCPæŠ€æœ¯ä½“ç³»ä¸­ï¼Œ

# ä¼šå°†å¤–éƒ¨å·¥å…·è¿è¡Œè„šæœ¬ç§°ä½œæœåŠ¡å™¨ï¼Œè€Œæ¥å…¥è¿™äº›å¤–éƒ¨å·¥å…·çš„å¤§æ¨¡å‹è¿è¡Œç¯å¢ƒç§°ä½œå®¢æˆ·ç«¯ã€‚

# ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥æ¥å…¥å¤šä¸ªä¸åŒç±»å‹çš„æœåŠ¡å™¨çš„ï¼Œä½†è¦æ±‚æ˜¯éƒ½å¯ä»¥éµå¾ªMCPé€šä¿¡åè®®ã€‚ç®€å•ç†è§£å°±æ˜¯MCP

# æœåŠ¡å™¨çš„è¾“å‡ºå†…å®¹æ˜¯ä¸€ç§æ ‡å‡†æ ¼å¼çš„å†…å®¹ï¼Œåªèƒ½è¢«MCPå®¢æˆ·ç«¯æ‰€è¯†åˆ«ã€‚åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½éµå¾ªMCPå è®®çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å°±èƒ½å¤ŸåƒFunction callingä¸­å¤§æ¨¡å‹è°ƒç”¨å¤–éƒ¨å·¥å…·ä¸€æ ·ï¼Œè°ƒç”¨MCPæœåŠ¡å™¨é‡Œé¢çš„å·¥å…·ã€‚

![Image](pdf_images\page220_img1.png)

![Image](pdf_images\page220_img2.png)

# 4.2 MCPæœåŠ¡å™¨é›†åˆ

æš‚æ—¶æŠ›å¼€åº•å±‚åŸç†ä¸è°ˆï¼Œåœ¨MCPæŠ€æœ¯çˆ†å‘çš„è¿™å‡ ä¸ªæœˆï¼Œå¸‚é¢ä¸Šå·²ç»è¯ç”Ÿäº†æˆç™¾ä¸Šåƒçš„MCPæœåŠ¡å™¨ï¼Œ

ç”šè‡³è¿˜å‡ºç°äº†å¤§é‡çš„MCPæœåŠ¡å™¨é›†åˆç½‘ç«™ï¼š

# MCPå®˜æ–¹æœåŠ¡å™¨åˆé›†ï¼šhttps://github.com/modelcontextprotocol/servers

# MCP Githubçƒ­é—¨å¯¼èˆªï¼šhttps://github.com/punkpeye/awesome-mcp-servers

![Image](pdf_images\page221_img1.png)

![Image](pdf_images\page221_img2.png)

![Image](pdf_images\page221_img3.png)

# Smitheryï¼šhttps://smithery.ai/

# MCPå¯¼èˆªï¼šhttps://mcp.so/

![Image](pdf_images\page222_img1.png)

## åœ¨å®é™…è¿›è¡Œæ™ºèƒ½ä½“å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒè¿™äº›ç½‘ç«™ä¸Šçš„MCPå·¥å…·ï¼Œå¹¶æœ‰é€‰æ‹©çš„å¯¹å…¶è¿›è¡Œè°ƒç”¨ã€‚ä½†éœ€

## è¦æ³¨æ„çš„æ˜¯ï¼Œæ— è®ºè¿™äº›ç½‘ç«™çš„ç»„ç»‡å½¢å¼å¤šä¹ˆèŠ±æ ·ç™¾å‡ºï¼Œä½†å®é™…ä¸Šå½“æˆ‘ä»¬æœ¬åœ°è°ƒç”¨MCPå·¥å…·çš„æ—¶å€™ï¼Œéƒ½æ˜¯

# é€šè¿‡uvxæˆ–è€…npxå°†å¯¹åº”çš„åº“ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åå†è¿›è¡Œè¿è¡Œã€‚

5. MCPä¸Function callingæŠ€æœ¯å¯¹æ¯”ä»‹ç»

# æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¡¥å……ä¸€ç‚¹çš„æ˜¯å…³äºFunction callingå’ŒMCPæŠ€æœ¯çš„å…³ç³»ã€‚é€šè¿‡åœ¨MCPè¿è¡Œè¿‡ç¨‹çš„æŠ“

# åŒ…å¯çŸ¥ï¼ŒMCPåº•å±‚å®é™…ä¸Šä»ç„¶æ˜¯å€ŸåŠ©å¤§æ¨¡å‹åŸç”Ÿçš„Function callingæ¥å®Œæˆå¤–éƒ¨å·¥å…·è°ƒç”¨ï¼Œåªä¸è¿‡è¿›è¡Œäº†

# æ›´é«˜å±‚çš„å°è£…ã€‚

å®é™…ä¸ŠMCPå®¢æˆ·ç«¯å¯¹MCPæœåŠ¡å™¨ä¸Šçš„å·¥å…·è°ƒç”¨æµç¨‹å¦‚ä¸‹ï¼š

# Step 1. å»ºç«‹å’ŒæœåŠ¡å™¨çš„é€šä¿¡ï¼›

# Step 2. æŸ¥è¯¢æœåŠ¡å™¨ä¸Šæ€»å…±æœ‰å¤šå°‘ä¸ªå¤–éƒ¨å·¥å…·ï¼›

# Step 3. å°†å¤–éƒ¨å·¥å…·ç»„æˆåˆ—è¡¨ï¼Œå¸¦å…¥åˆ°å½“å‰å¯¹è¯ä¸­ï¼›

# Step 4. å€ŸåŠ©Function callingè¿›è¡Œå¤–éƒ¨å·¥å…·è°ƒç”¨ã€‚

# ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ¨¡å‹æœ¬èº«ä¸æ”¯æŒFunction callingï¼Œé‚£ä¹ˆæ˜¯æ— æ³•é¡ºåˆ©å¼€å¯MCPåŠŸèƒ½çš„ã€‚

# ä¸è¿‡è¿™é‡Œä¹Ÿæœ‰ä¾‹å¤–ï¼Œé‚£å°±æ˜¯Open-WebUIå’Œclineä½œä¸ºMCPå®¢æˆ·ç«¯æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸å…·å¤‡Function

# callingåŠŸèƒ½çš„DeepSeek-R1æ¨¡å‹è¿›è¡ŒMCPå·¥å…·è°ƒç”¨ï¼Œè¿™æ˜¯ä¸ºä½•å‘¢ï¼Ÿ

# åŸå› éå¸¸ç®€å•ï¼Œé‚£å°±æ˜¯è¿™äº›å®¢æˆ·ç«¯å†…ç½®äº†ä¸€äº›æç¤ºè¯æ¨¡æ¿ï¼Œå€ŸåŠ©æç¤ºè®©å¤§æ¨¡å‹è¾“å‡ºç±»ä¼¼Function

# call messageï¼ˆè°ƒç”¨å¤–éƒ¨å·¥å…·çš„ä¿¡æ¯ï¼‰çš„å†…å®¹ï¼Œç„¶åå¼€å¯Function callingï¼Œä»è€Œèƒ½å¤Ÿè°ƒç”¨MCPå·¥å…·ã€‚ä¸¾

# ä¸ªä¾‹å­ï¼Œå¯¹äºclineæ¥è¯´ä¼šé€šè¿‡ä¸€æ®µéå¸¸é•¿çš„æç¤ºè¯ï¼Œå¼•å¯¼æ¨¡å‹è¾“å‡ºFunction call messageï¼š

![Image](pdf_images\page223_img1.png)

# clineé¡¹ç›®å®˜ç½‘ï¼šhttps://github.com/cline/cline

# æˆ‘ä»¬å¯ä»¥å°†å…¶ç²¾ç®€ä¸ºå¦‚ä¸‹å½¢å¼ï¼š

# system_message = (

"You are a helpful assistant with access to these tools:\n\n"

# f"{tools_description}\n"

"Choose the appropriate tool based on the user's question. "

"If no tool is needed, reply directly.\n\n"

"IMPORTANT: When you need to use a tool, you must ONLY respond with "

# "the exact JSON object format below, nothing else:\n"

"{\n"

# ' "tool": "tool-name",\n'

# ' "arguments": {\n'

# ' "argument-name": "value"\n'

" }\n"

"}\n\n"

"After receiving a tool's response:\n"

"1. Transform the raw data into a natural, conversational response\n"

"2. Keep responses concise but informative\n"

# "3. Focus on the most relevant information\n"

# "4. Use appropriate context from the user's question\n"

"5. Avoid simply repeating the raw data\n\n"

"Please use only the tools that are explicitly defined above."

)

# ç¿»è¯‘å¦‚ä¸‹ï¼š

# ä½ æ˜¯ä¸€ä¸ªä¹äºåŠ©äººçš„åŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š

```

# {tools_description}

```

# è¯·æ ¹æ®ç”¨æˆ·çš„é—®é¢˜é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚ å¦‚æœä¸éœ€è¦ä½¿ç”¨å·¥å…·ï¼Œè¯·ç›´æ¥å›å¤ã€‚

é‡è¦æç¤ºï¼šå¦‚æœéœ€è¦ä½¿ç”¨å·¥å…·ï¼Œ**ä½ å¿…é¡»ä»…ä»¥ä»¥ä¸‹ç²¾ç¡®çš„ JSON å¯¹è±¡æ ¼å¼è¿›è¡Œå›å¤ï¼Œä¸è¦æ·»åŠ å…¶ä»–å†…å®¹**ï¼š

```json

{

![Image](pdf_images\page224_img1.png)

## "tool": "å·¥å…·åç§°",

## "arguments": { "å‚æ•°åç§°": "å‚æ•°å€¼"

}

}

```

# åœ¨æ”¶åˆ°å·¥å…·è¿”å›çš„ç»“æœåï¼š

1. å°†åŸå§‹æ•°æ®è½¬åŒ–ä¸ºè‡ªç„¶ã€å¯¹è¯å¼çš„å›ç­”

2. ä¿æŒå›ç­”ç®€æ´ä½†å¯Œæœ‰ä¿¡æ¯é‡

3. èšç„¦äºæœ€ç›¸å…³çš„ä¿¡æ¯

4. ä½¿ç”¨ç”¨æˆ·é—®é¢˜ä¸­çš„ç›¸å…³ä¸Šä¸‹æ–‡ 5. é¿å…ç›´æ¥ç…§æ¬åŸå§‹æ•°æ®

# è¯·**åªä½¿ç”¨ä¸Šè¿°æ˜ç¡®å®šä¹‰çš„å·¥å…·**ã€‚

# åœ¨è¿™äº›æç¤ºè¯å¼•å¯¼ä¸‹ï¼Œä¸€äº›ä¸å…·å¤‡Function callingçš„å¤§æ¨¡å‹ï¼Œä¹Ÿèƒ½é¡ºåˆ©ä½¿ç”¨MCPå·¥å…·ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„ æ˜¯ï¼Œå€ŸåŠ©æç¤ºè¯å¼€å¯çš„MCPåŠŸèƒ½ï¼Œæ¯•ç«Ÿä¸å¦‚æ¨¡å‹åŸç”Ÿèƒ½åŠ›ç¨³å®šï¼Œå› æ­¤å¦‚æœå¸Œæœ›æ­å»ºä¼ä¸šçº§åº”ç”¨çš„Agentï¼Œ

# æœ€å¥½è¿˜æ˜¯ä½¿ç”¨å…·å¤‡Function callingåŠŸèƒ½çš„å¤§æ¨¡å‹ã€‚

6. MCPæŠ€æœ¯ç”Ÿæ€

# æœ€åéœ€è¦ä»‹ç»å½“å‰MCPå®Œæ•´çš„æŠ€æœ¯ç”Ÿæ€ã€‚MCPæŠ€æœ¯å‘å±•è‡³ä»Šï¼Œå·²ç»ä¸å†æ˜¯ç®€å•çš„â€œåè®®â€ï¼Œè€Œæ˜¯ä¸€ä¸ª

åŒ…å«äº†åè®®ã€å¼€å‘å·¥å…·å’Œç°æˆçš„å·²ç»å¼€å‘å¥½çš„MCPå·¥å…·æ‰€å…±åŒç»„æˆçš„å®Œæ•´æŠ€æœ¯ç”Ÿæ€ã€‚

# å…¶ä¸­ï¼š

# MCPåè®®ï¼šæŒ‡çš„æ˜¯â€œè™šâ€çš„è§„èŒƒï¼Œä¾‹å¦‚å¤§æ¨¡å‹å’Œå·¥å…·è°ƒåº¦è§„èŒƒã€æœåŠ¡å™¨å®¢æˆ·ç«¯çš„é€šä¿¡è§„èŒƒç­‰ï¼Œéµå¾ªè¿™

äº›åè®®çš„å¯¹è±¡å°±æ˜¯MCPæœåŠ¡å™¨æˆ–å®¢æˆ·ç«¯ï¼›

MCPå¼€å‘å·¥å…·ï¼šåŒ…å«å¤šç§è¯­è¨€çš„SDKï¼Œä¹Ÿå°±æ˜¯å¼€å‘å·¥å…·åŒ…ï¼Œå¼€å‘äººå‘˜èƒ½å¤Ÿä½¿ç”¨è¿™äº›SDKå¿«é€Ÿå®Œæˆ MCPçš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¼€å‘ï¼›

![Image](pdf_images\page225_img1.png)

## MCPæœåŠ¡å™¨ç”Ÿæ€ï¼šå¼€æºçš„MCPæœåŠ¡å™¨ï¼Œæ˜¯åŸºäºMCPåè®®çš„åºå¤§çš„æŠ€æœ¯ç”Ÿæ€ï¼Œæ™ºèƒ½ä½“å¼€å‘äººå‘˜å¯ä»¥ç›´

## æ¥ä½¿ç”¨å¼€æºçš„MCPå·¥å…·æ¥åŠ å¿«å¼€å‘è¿›ç¨‹ã€‚

# å…¬å¼€è¯¾ä»£ç é¢†å–

# äºŒã€ä»é›¶åˆ°ä¸€è¿›è¡ŒMCPé¡¹ç›®å¼€å‘

# åœ¨åŸºæœ¬äº†è§£MCPæŠ€æœ¯æ¦‚å¿µä¹‹åï¼Œæ¥ä¸‹æ¥ä¸ºå¤§å®¶è¯¦ç»†ä»‹ç»å¦‚ä½•ä»é›¶åˆ°ä¸€å®ŒæˆMCPé¡¹ç›®å¼€å‘ã€‚æ ¹æ®æ­¤å‰ çš„ä»‹ç»ä¸éš¾å‘ç°ï¼ŒMCPé¡¹ç›®å¼€å‘ä¼šæ¶‰åŠä¸¤ä¸ªæ–¹é¢ï¼Œåˆ†åˆ«æ˜¯MCPå®¢æˆ·ç«¯å¼€å‘å’ŒæœåŠ¡å™¨å¼€å‘ï¼Œæœ¬èŠ‚å…¬å¼€è¯¾æˆ‘

ä»¬å°†é‡ç‚¹ä»‹ç»MCPæœåŠ¡å™¨å¼€å‘ï¼ŒåŒæ—¶ä¸ºå¤§å®¶æä¾›ä¸€ä¸ªé€šç”¨çš„å®¢æˆ·ç«¯æ¨¡æ¿ã€‚

1. MCPæœåŠ¡å™¨å¼€å‘æµç¨‹ä»‹ç»

MCPæœåŠ¡å™¨é€šç”¨å¼€å‘æµç¨‹å¦‚ä¸‹ï¼š

# Step 1.åˆ›å»ºåŠŸèƒ½å‡½æ•°ï¼Œå¹¶åœ¨ä»£ç ç¯å¢ƒä¸­å®Œæˆæµ‹è¯•ï¼›

# Step 2.åˆ›å»ºMCPæœåŠ¡å™¨é¡¹ç›®ï¼Œå®ŒæˆæœåŠ¡å™¨é¡¹ç›®å¼€å‘ï¼›

# Step 3.å€ŸåŠ©MCPå®˜æ–¹å·¥å…·Inspectorè¿›è¡ŒMCPæœåŠ¡å™¨debugï¼›

# Step 4.å€ŸåŠ©MCPå®¢æˆ·ç«¯ï¼Œè¿›è¡Œæœ¬åœ°é€šä¿¡æµ‹è¯•

# Step 5.ã€å¯é€‰ã€‘å°†MCPæœåŠ¡å™¨å‘å¸ƒåˆ°npmæˆ–è€…pypiå¹³å°ï¼Œä¾›å…¶ä»–å¼€å‘äººå‘˜ä½¿ç”¨ï¼›

# Step 6.ã€å¯é€‰ã€‘å°†MCPæœåŠ¡å™¨é¡¹ç›®ç¦»çº¿æ‹·è´å¹¶åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚

![Image](pdf_images\page226_img1.png)

# æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¯¦ç»†ä»‹ç»è¿™6ä¸ªç¯èŠ‚çš„å®ç°æ–¹æ³•ã€‚

2. MCP Serveræ ¸å¿ƒåŠŸèƒ½å¼€å‘

# 2.1 Mini DeepResearché¡¹ç›®ä»‹ç»

# åœ¨è§„åˆ’MCPæœåŠ¡å™¨é¡¹ç›®å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç¡®å®šå½“å‰MCPæœåŠ¡å™¨çš„æ ¸å¿ƒåŠŸèƒ½ã€‚æˆ‘ä»¬è¿™é‡Œå°è¯• åˆ›å»ºä¸€ä¸ªæ­¤å‰å…¬å¼€è¯¾ä»‹ç»çš„Mini DeepResearché¡¹ç›®çš„MCPæœåŠ¡å™¨ï¼Œå³ä¸€ä¸ªé›†æˆäº†Mini DeepResearch

# åŠŸèƒ½çš„MCPæœåŠ¡å™¨ï¼Œèƒ½å¤Ÿå›´ç»•ç”¨æˆ·ç»™å‡ºçš„ä¸»é¢˜è¿›è¡Œæ·±åº¦æœç´¢ï¼Œå¹¶ç»™å‡ºæœ€ç»ˆç»“æœã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†æŠŠMini

# DeepResearchå°è£…ä¸ºMCPæœåŠ¡å™¨ï¼Œä¸€æ–¹é¢è¯¦ç»†ä»‹ç»MCP Serverå¼€å‘æµç¨‹ï¼ŒåŒæ—¶ä¹Ÿä»‹ç»å¦‚ä½•å°†ä¸€ä¸ª

# Multi-Agentå°è£…ä¸ºMCP serverå¹¶å¸¦å…¥åˆ°å…¶ä»–åº”ç”¨åœºæ™¯ä¸­ã€‚

# é¡¹ç›®æ•ˆæœæ¼”ç¤º

# é¡¹ç›®æ•ˆæœç±»ä¼¼äºChatGPT DeepResearchåŠŸèƒ½ï¼Œå…·ä½“é¡¹ç›®æ¼”ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

# æ­¤æ—¶è¾“å…¥ï¼š ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸‹MCPï¼ˆModel Context Protocolï¼‰è¿™é¡¹æŠ€æœ¯

# è¾“å‡ºï¼š

# # MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æŠ€æœ¯æ·±å…¥è§£ææŠ¥å‘Š

# æœ¬æ–‡æ—¨åœ¨å¯¹ MCPï¼ˆModel Protocol Contextï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æŠ€æœ¯è¿›è¡Œå…¨é¢è€Œæ·±å…¥çš„è§£æã€‚ä»å…¶æŠ€æœ¯èƒŒ

æ™¯ã€å‘å±•å†ç¨‹ã€æ ¸å¿ƒæ¶æ„ï¼Œåˆ°åº”ç”¨é¢†åŸŸå’Œæœªæ¥å‘å±•è¶‹åŠ¿ï¼Œæœ¬æ–‡å°†ä»¥è¯¦ç»†çš„è¯´æ˜å’Œå®ä¾‹åˆ†æï¼Œå¸®åŠ©è¯»è€…å¯¹ MCP æŠ€ æœ¯æœ‰ä¸€ä¸ªé€å½»çš„è®¤è¯†ã€‚

---

## 1. å¼•è¨€

éšç€äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰çš„è¿…é€Ÿå‘å±•å’Œå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ™®åŠï¼Œä¼ ç»Ÿçš„ä¾èµ–é™æ€è®­ç»ƒæ•°æ®çš„æ¨¡å¼é€æ¸æš´éœ²å‡ºå±€ é™æ€§ã€‚AI æ¨¡å‹åœ¨é¢å¯¹å¤æ‚ã€åŠ¨æ€çš„åº”ç”¨åœºæ™¯æ—¶ï¼ŒäºŸéœ€ä¸€ç§èƒ½å¤Ÿå®æ—¶é“¾æ¥å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·çš„æŠ€æœ¯æ–¹æ¡ˆã€‚MCPï¼Œ

# å³æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼Œæ­£æ˜¯åœ¨è¿™ç§èƒŒæ™¯ä¸‹åº”è¿è€Œç”Ÿã€‚MCP æä¾›äº†æ ‡å‡†åŒ–çš„æ¥å£ï¼Œä½¿ AI æ¨¡å‹å¯ä»¥å®‰å…¨ã€ä¾¿æ·åœ°ä¸

å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œæ•°æ®äº¤äº’å’ŒåŠŸèƒ½è°ƒç”¨ã€‚æœ¬æ–‡å°†è¯¦ç»†æ¢è®¨ MCP çš„æŠ€æœ¯æ¶æ„ã€æ ¸å¿ƒä¼˜åŠ¿ã€å®é™…åº”ç”¨æ¡ˆä¾‹åŠæœªæ¥å±•æœ›ã€‚

---

# ## 2. MCP æŠ€æœ¯çš„èµ·æºä¸å‘å±•

# MCP æŠ€æœ¯æœ€åˆç”± Anthropic å…¬å¸æå‡ºï¼Œä½œä¸ºä¸€ç§å¼€æ”¾æ ‡å‡†åè®®ï¼Œå…¶ç›®æ ‡åœ¨äºè§£å†³ AI æ¨¡å‹ä¿¡æ¯è·å–å—é™ä»¥

# åŠå®šåˆ¶æ¥å£å¼€å‘æˆæœ¬é«˜æ˜‚çš„é—®é¢˜ã€‚ä¼ ç»Ÿçš„å¤§å‹è¯­è¨€æ¨¡å‹ä»…ä»…ä¾é ä¹‹å‰çš„è®­ç»ƒæ•°æ®è¿›è¡Œé—®ç­”æˆ–ç”Ÿæˆå†…å®¹ï¼Œè€Œä¸€æ—¦é‡

åˆ°åº”ç”¨åœºæ™¯ä¸­æ–°äº§ç”Ÿçš„æ•°æ®æˆ–éœ€æ±‚ï¼Œå°±ä¼šé™·å…¥ä¿¡æ¯æ›´æ–°æ»åçš„å°´å°¬ã€‚MCP åè®®é€šè¿‡æä¾›ä¸€ç§æ ‡å‡†åŒ–çš„é€šä¿¡æ–¹ æ³•ï¼Œå®ç°äº† AI æ¨¡å‹ä¸å¤–éƒ¨æ•°æ®æºå’Œå·¥å…·çš„æ— ç¼è¡”æ¥ã€‚

### 2.1 èƒŒæ™¯ä»‹ç»

## - **AI å‘å±•å¸¦æ¥çš„æ–°è¦æ±‚**ï¼šéšç€ç®—æ³•å’Œç®—åŠ›çš„æå‡ï¼ŒAI æ¨¡å‹åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ã€å›¾åƒè¯†åˆ«ã€åŒ»å­¦å½±åƒåˆ†æ ç­‰é¢†åŸŸå±•ç°äº†å“è¶Šçš„èƒ½åŠ›ã€‚ç„¶è€Œï¼Œè¿™äº›æ¨¡å‹çš„è®­ç»ƒæ•°æ®ç›¸å¯¹é™æ€ï¼Œéš¾ä»¥å®æ—¶åæ˜ ç°å®ä¸–ç•Œä¸­å¤§é‡åŠ¨æ€å˜åŒ–çš„ä¿¡

# æ¯ã€‚MCP çš„è®¾è®¡åˆè¡·å°±æ˜¯ä¸ºäº†è§£å†³è¿™ç±»é™æ€æ•°æ®ä¸åŠ¨æ€åº”ç”¨ä¹‹é—´çš„è„±èŠ‚é—®é¢˜ã€‚ - **ä¼ ç»Ÿæ¥å£çš„å±€é™æ€§**ï¼šåœ¨ä¼ ç»Ÿåº”ç”¨ä¸­ï¼Œå¼€å‘è€…é€šå¸¸éœ€è¦ä¸ºæ¯ä¸ªå¤–éƒ¨æ•°æ®æºæˆ–å·¥å…·ç¼–å†™ä¸“é—¨çš„æ¥å£ï¼Œé€ æˆäº† å¼€å‘å‘¨æœŸé•¿ã€æ¥å£ç¢ç‰‡åŒ–çš„é—®é¢˜ã€‚MCP çš„å‡ºç°ä½¿å¾—å„ç±»æ•°æ®æºå¯ä»¥é€šè¿‡ç»Ÿä¸€å…¥å£è¢« AI æ¨¡å‹è°ƒç”¨ï¼Œå¤§å¹…é™ä½äº†

# å¼€å‘è€…çš„é›†æˆæˆæœ¬ã€‚

### 2.2 å‘å±•å†ç¨‹

# è‡ªæå‡ºä»¥æ¥ï¼ŒMCP è¿…é€Ÿå¼•èµ·å„ç•Œå…³æ³¨ã€‚ä»æœ€åˆçš„æ ‡å‡†æ„æ¶åˆ°ç›®å‰æ”¯æŒ STDIO ä¸ HTTP+SSE ä¸¤ç§æ•°æ®ä¼ è¾“æ–¹

# å¼ï¼ŒMCP æ­£åœ¨ä¸æ–­å®Œå–„è‡ªèº«çš„åè®®è§„èŒƒï¼Œæ”¯æŒæ›´å¤šæ ·åŒ–çš„æ•°æ®äº¤äº’æ¨¡å¼ã€‚å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œçº·çº·å¼€å±•é’ˆå¯¹ MCP

çš„ç ”ç©¶å’Œåº”ç”¨ï¼ŒåŠ›æ±‚æ›´å¥½åœ°ä¸ç°æœ‰ç³»ç»Ÿé›†æˆï¼Œä»è€Œæ¨åŠ¨ AI æ¨¡å‹çš„åº”ç”¨è¾¹ç•Œä¸æ–­æ‹“å®½ã€‚

---

# ## 3. MCP çš„æŠ€æœ¯åŸç†ä¸æ¶æ„

# MCP åè®®é‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ï¼Œç”±ä¸‰å¤§æ ¸å¿ƒç»„ä»¶æ„æˆï¼šMCP ä¸»æœºã€MCP å®¢æˆ·ç«¯ä»¥åŠ MCP æœåŠ¡å™¨ã€‚è¿™ä¸€æ¨¡

å‹ç¡®ä¿ AI æ¨¡å‹èƒ½å¤Ÿé€šè¿‡æ ‡å‡†åŒ–æ¥å£ä¸å¤–éƒ¨å·¥å…·æˆ–æ•°æ®æºè¿›è¡Œé«˜æ•ˆäº¤äº’ã€‚

### 3.1 æ ¸å¿ƒç»„ä»¶

**MCP ä¸»æœº**ï¼šé€šå¸¸æŒ‡è¿è¡Œåœ¨æ¡Œé¢ç‰ˆå·¥å…·ã€é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰æˆ– AI è¾…åŠ©åº”ç”¨ä¸­çš„ä¸»ç¨‹åºï¼Œè´Ÿè´£å‘èµ· ä¸å¤–éƒ¨ç³»ç»Ÿçš„è¿æ¥è¯·æ±‚ã€‚ - **MCP å®¢æˆ·ç«¯**ï¼šä½äºä¸»æœºç¨‹åºå†…éƒ¨ï¼Œå’Œ MCP æœåŠ¡å™¨ä¿æŒ 1:1 çš„è¿æ¥å…³ç³»ï¼Œæ‰§è¡Œåè®®å±‚é¢çš„æ¶ˆæ¯ä¼ é€’ å’Œå“åº”å¤„ç†ã€‚ - **MCP æœåŠ¡å™¨**ï¼šç‹¬ç«‹çš„è½»é‡çº§ç¨‹åºï¼Œé€šè¿‡æ ‡å‡†åŒ–çš„ MCP æ¥å£ï¼Œè¿æ¥å„ç§æœ¬åœ°æˆ–è¿œç¨‹çš„æ•°æ®æºä¸å¤–éƒ¨æœ åŠ¡ï¼Œå¹¶æŒ‰ç…§åè®®è¦æ±‚æä¾›ç›¸åº”çš„åŠŸèƒ½ã€‚ ### 3.2 åè®®é€šä¿¡æœºåˆ¶

# MCP åè®®é‡‡ç”¨ JSON-RPC 2.0 æ ¼å¼å®šä¹‰æ¶ˆæ¯ä¼ è¾“ï¼Œç¡®ä¿é€šä¿¡å†…å®¹å…·æœ‰æ¸…æ™°çš„è¯·æ±‚ä¸å“åº”é€»è¾‘ã€‚ä¸»è¦åŒ…å«ä»¥ä¸‹

# ä¸¤ç§ä¼ è¾“æ–¹å¼ï¼š

**STDIO ä¼ è¾“**ï¼šåˆ©ç”¨æ ‡å‡†è¾“å…¥è¾“å‡ºæµå®Œæˆæ•°æ®ä¼ è¾“ï¼Œå…·æœ‰ä½å»¶è¿Ÿçš„ä¼˜ç‚¹ï¼Œé€‚ç”¨äºé«˜æ•ˆé€šä¿¡éœ€æ±‚çš„åœºæ™¯ã€‚ - **HTTP+SSE ä¼ è¾“**ï¼šé€šè¿‡ HTTP åè®®ç»“åˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆServer-Sent Eventsï¼‰ï¼Œå®ç°å®æ—¶æ•°æ® æµå’Œé•¿è¿æ¥é€šä¿¡ï¼Œé€‚åˆäºè·¨ç½‘ç»œç¯å¢ƒçš„æ•°æ®åŒæ­¥å’Œæ›´æ–°ã€‚

# è¿™ç§çµæ´»çš„é€šä¿¡æœºåˆ¶ä¸ä»…æ»¡è¶³äº†é«˜æ€§èƒ½åº”ç”¨çš„è¦æ±‚ï¼Œä¹Ÿä¸ºå¼€å‘è€…å…è®¸å®ç°å®šåˆ¶çš„ä¼ è¾“æ–¹å¼æä¾›äº†å¯èƒ½æ€§ï¼Œä½†å‰æ

æ˜¯å¿…é¡»ä¿ç•™ MCP æŒ‡å®šçš„æ¶ˆæ¯æ ¼å¼å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†è¦æ±‚ã€‚

# ### 3.3 æ¶ˆæ¯äº¤æ¢å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†

# MCP åè®®é‡‡ç”¨æ˜ç¡®çš„æ¶ˆæ¯å¸§æ ¼å¼ï¼Œå¯¹è¯·æ±‚ã€å“åº”ã€é€šçŸ¥ç­‰å¤šç§æ¶ˆæ¯æ¨¡å¼è¿›è¡Œäº†è¯¦ç»†å®šä¹‰ã€‚æ•´ä¸ªé€šä¿¡ç”Ÿå‘½å‘¨æœŸåŒ…

# æ‹¬ï¼š

1. **åˆå§‹åŒ–é˜¶æ®µ**ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œå¹¶è¿›è¡Œèº«ä»½è®¤è¯å’ŒåŠŸèƒ½åå•†ã€‚ 2. **æ¶ˆæ¯äº¤æ¢é˜¶æ®µ**ï¼šåœ¨è¿æ¥ä¿æŒæœŸé—´ï¼ŒåŒæ–¹é€šè¿‡è¯·æ±‚-å“åº”æ¨¡å‹æˆ–æ¨é€é€šçŸ¥æ¨¡å¼è¿›è¡Œæ•°æ®ä¼ è¾“å’ŒæŒ‡ä»¤äº¤äº’ã€‚ 3. **ç»ˆæ­¢é˜¶æ®µ**ï¼šå½“é€šä¿¡ä»»åŠ¡å®Œæˆæˆ–å‡ºç°å¼‚å¸¸æ—¶ï¼Œå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ç»ˆæ­¢è¿æ¥ï¼Œå¹¶è¿›è¡Œèµ„æºå›æ”¶ã€‚

# è¿™ç§è®¾è®¡ç¡®ä¿äº†é€šä¿¡çš„ç¨³å®šæ€§å’Œå¯é æ€§ï¼Œæå¤§åœ°é™ä½äº†ç³»ç»Ÿé›†æˆçš„å¤æ‚æ€§ã€‚

---

## 4. MCP çš„å…³é”®ä¼˜åŠ¿ä¸åº”ç”¨åœºæ™¯

## ### 4.1 å…³é”®ä¼˜åŠ¿

**ç»Ÿä¸€æ ‡å‡†**ï¼šMCP æä¾›äº†å¼€æ”¾ã€ç»Ÿä¸€çš„é€šä¿¡æ¥å£ï¼Œè§£å†³äº†ä¼ ç»Ÿ API æ¥å£ç¢ç‰‡åŒ–çš„é—®é¢˜ï¼Œä½¿å¾—ä¸åŒç³»ç»Ÿ ä¹‹é—´çš„é›†æˆæ›´åŠ ç®€å•é«˜æ•ˆã€‚ - **åŠ¨æ€æ•°æ®äº¤äº’**ï¼šå€ŸåŠ© MCPï¼ŒAI æ¨¡å‹å¯ä»¥åœ¨è¿è¡Œè¿‡ç¨‹ä¸­åŠ¨æ€è·å–å¤–éƒ¨æ•°æ®ï¼Œè€Œä¸å†å±€é™äºé¢„å…ˆè®­ç»ƒæ•°æ® çš„å†…å®¹ï¼Œè¿™å¤§å¤§æå‡äº†æ¨¡å‹çš„å®ç”¨æ€§å’Œæ™ºèƒ½åŒ–æ°´å¹³ã€‚ - **å®‰å…¨æ€§ä¸ç”¨æˆ·æ§åˆ¶**ï¼šMCP çš„è®¾è®¡å¼ºè°ƒç”¨æˆ·å¯¹æ•°æ®äº¤äº’çš„æ§åˆ¶æƒï¼Œé€šè¿‡æ ‡å‡†åŒ–å’Œä¸¥æ ¼çš„è®¤è¯æœºåˆ¶ï¼Œåœ¨ä¸€ å®šç¨‹åº¦ä¸Šä¿éšœäº†æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤ã€‚ - **æ‰©å±•æ€§å¼º**ï¼šæƒ åŠå¤šç§ä¼ è¾“æ–¹å¼å’Œåº”ç”¨åœºæ™¯ï¼Œä¸è®ºæ˜¯æœ¬åœ°æ•°æ®è®¿é—®è¿˜æ˜¯è¿œç¨‹æœåŠ¡è°ƒç”¨ï¼Œéƒ½èƒ½å¤Ÿçµæ´»é€‚é…ã€‚ ### 4.2 åº”ç”¨åœºæ™¯

#### 4.2.1 è½¯ä»¶å¼€å‘ä¸è°ƒè¯•

# åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸï¼Œé›†æˆäº† MCP çš„ç¼–ç å·¥å…·èƒ½å¤Ÿè‡ªåŠ¨è¯»å–å’Œä¿®æ”¹ä»£ç åº“ï¼Œåˆ©ç”¨å®æ—¶æ•°æ®è¿›è¡Œé™æ€æ£€æŸ¥å’Œä»£ç ä¼˜

åŒ–ï¼Œä»è€Œæå‡å¼€å‘æ•ˆç‡ã€‚ä¾‹å¦‚ï¼ŒIDE é€šå¸¸ä¼šé›†æˆ MCP å®¢æˆ·ç«¯ï¼Œå®ç°è‡ªåŠ¨åŒ–é”™è¯¯æç¤ºå’Œä¿®æ­£å»ºè®®ã€‚

# #### 4.2.2 æ•°æ®ç§‘å­¦ä¸å®‰å…¨å®¡è®¡

æ•°æ®ç§‘å­¦å®¶å¯ä»¥é€šè¿‡ MCP å®‰å…¨åœ°æŸ¥è¯¢å†…éƒ¨æ•°æ®åº“æˆ–è€…è°ƒç”¨å¤§æ•°æ®å¹³å°æ¥å£ï¼Œæ— éœ€æš´éœ²åº•å±‚æ•æ„Ÿå‡­æ®ã€‚åŒæ—¶ï¼Œ MCP åè®®æ”¯æŒå®‰å…¨å®¡è®¡æœºåˆ¶ï¼Œå‡å°‘äº†å®‰å…¨å®¡è®¡é¡¹ï¼Œä»è€Œé™ä½ç³»ç»Ÿç»´æŠ¤æˆæœ¬ã€‚

#### 4.2.3 åŒ»ç–—ä¸å¥åº·ç®¡ç†

# åœ¨åŒ»ç–—é¢†åŸŸï¼ŒåŒ»ç–—ç³»ç»Ÿé€šè¿‡ MCP åè®®æ•´åˆæ‚£è€…ç”Ÿç†æ•°æ®ã€å½±åƒä¿¡æ¯åŠå®éªŒå®¤æ£€æµ‹ç»“æœï¼Œç”Ÿæˆæ›´ä¸ºç²¾ç¡®çš„è¯Šæ–­æŠ¥

# å‘Šã€‚è¿™ç§è·¨ç³»ç»Ÿçš„æ•°æ®æ•´åˆï¼Œæ˜¾è‘—æå‡äº†åŒ»ç–—å†³ç­–çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚

# #### 4.2.4 äº‘å¹³å°ä¸å¤šé›†ç¾¤ç®¡ç†

# éƒ¨åˆ†äº‘å¹³å°ï¼Œå¦‚åä¸ºäº‘çš„å¤šäº‘å®¹å™¨å¹³å°ï¼Œå·²ç»å¼€å§‹å€ŸåŠ© MCP å®ç°è·¨äº‘å’Œå¤šé›†ç¾¤çš„ç»Ÿä¸€ç®¡ç†ã€‚é€šè¿‡ MCPï¼Œä¼ä¸š

# å¯ä»¥å®ç°åº”ç”¨åœ¨å¤šé›†ç¾¤é—´çš„åŠ¨æ€éƒ¨ç½²å’Œå¼¹æ€§ä¼¸ç¼©ï¼Œæœ‰æ•ˆè§£å†³å¤šäº‘ç¯å¢ƒä¸‹åº”ç”¨ç®¡ç†å’Œèµ„æºè°ƒåº¦çš„æŒ‘æˆ˜ã€‚

---

# ## 5. æ¡ˆä¾‹åˆ†æä¸æŠ€æœ¯æ¯”è¾ƒ

# ### 5.1 å®é™…åº”ç”¨æ¡ˆä¾‹

# ä»¥æŸä¸‰ç”²åŒ»é™¢çš„åŒ»ç–—ä¿¡æ¯ç³»ç»Ÿä¸ºä¾‹ï¼Œé€šè¿‡å¼•å…¥ MCPï¼ŒåŒ»é™¢å¤§å¤§ç¼©çŸ­äº†åŒ»ç–—å½±åƒç³»ç»Ÿä¸ç”µå­ç—…å†å¯¹æ¥çš„å‘¨æœŸã€‚ä»¥

# å‰éœ€è¦æ•°æœˆæ—¶é—´å®Œæˆçš„æ•°æ®å¯¹æ¥ï¼Œå¦‚ä»Šå¯åœ¨çŸ­çŸ­å‡ å¤©å†…å®ç°ï¼Œæ—¢æé«˜äº†åŒ»ç–—æœåŠ¡æ•ˆç‡ï¼Œä¹Ÿé™ä½äº†ç³»ç»Ÿçš„é›†æˆæˆ

# æœ¬ã€‚

# ### 5.2 ä¸ä¼ ç»Ÿ API çš„æ¯”è¾ƒ

# ä¼ ç»Ÿ API æ¥å£å¾€å¾€éœ€è¦é’ˆå¯¹æ¯ä¸ªæ•°æ®æºè¿›è¡Œå•ç‹¬å¼€å‘å’Œç»´æŠ¤ï¼Œå­˜åœ¨å®šåˆ¶æˆæœ¬é«˜ã€é€‚é…æ€§å·®ç­‰é—®é¢˜ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ MCP çš„æ ‡å‡†åŒ–æ¥å£èƒ½å¤Ÿå¿«é€Ÿå¯¹æ¥å„ç§å¤–éƒ¨å·¥å…·å’Œæ•°æ®æºï¼Œæå¤§åœ°æå‡äº† AI æ¨¡å‹åœ¨å®é™…åœºæ™¯ä¸­çš„å“åº”é€Ÿåº¦å’Œå‡†

# ç¡®æ€§ã€‚

---

# ## 6. MCP æŠ€æœ¯çš„å‘å±•è¶‹åŠ¿ä¸é¢ä¸´çš„æŒ‘æˆ˜

### 6.1 å‘å±•è¶‹åŠ¿

éšç€æŠ€æœ¯ä¸æ–­æ¼”è¿›ï¼ŒMCP æ­£åœ¨å‘æ›´é«˜çš„é›†æˆåŒ–å’Œæ™ºèƒ½åŒ–æ–¹å‘å‘å±•ã€‚æœªæ¥çš„å‘å±•è¶‹åŠ¿ä¸»è¦åŒ…æ‹¬ï¼š

**æ ‡å‡†çš„ä¸æ–­å®Œå–„**ï¼šéšç€è¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…å’Œä¼ä¸šå‚ä¸ï¼ŒMCP çš„åè®®è§„èŒƒå°†è¿›ä¸€æ­¥ç»†åŒ–ï¼Œæ¶µç›–æ›´å¤šåº”ç”¨ åœºæ™¯ã€‚ - **è·¨å¹³å°çš„å¹¿æ³›åº”ç”¨**ï¼šMCP çš„ç»Ÿä¸€æ ‡å‡†ä¸ä»…é€‚ç”¨äºæ¡Œé¢å·¥å…·å’Œäº‘å¹³å°ï¼Œè¿˜å°†æ‰©å±•åˆ°ç§»åŠ¨è®¾å¤‡ã€ç‰©è”ç½‘è®¾ å¤‡ç­‰å„ç±»ç»ˆç«¯ä¸­ã€‚ - **å¤šæ™ºèƒ½ä½“åä½œ**ï¼šæœªæ¥çš„ AI åº”ç”¨å°†è¶Šæ¥è¶Šä¾èµ–å¤šä¸ªæ¨¡å‹ä¹‹é—´çš„ååŒå·¥ä½œï¼ŒMCP å°†ä¸ºè¿™äº›å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ æä¾›é«˜æ•ˆçš„ä¸Šä¸‹æ–‡ä¼ é€’å’ŒçŠ¶æ€åŒæ­¥èƒ½åŠ›ã€‚ - **å®‰å…¨æ€§ä¸éšç§ä¿æŠ¤è¿›ä¸€æ­¥åŠ å¼º**ï¼šåœ¨æ•°æ®å®‰å…¨å’Œç”¨æˆ·éšç§æ–¹é¢ï¼ŒMCP å°†å¼•å…¥æ›´å¤šå…ˆè¿›çš„åŠ å¯†å’Œè®¤è¯æŠ€ æœ¯ï¼Œä»¥æ»¡è¶³æ—¥ç›Šä¸¥æ ¼çš„å®‰å…¨éœ€æ±‚ã€‚ ### 6.2 é¢ä¸´çš„æŒ‘æˆ˜

å°½ç®¡ MCP æŠ€æœ¯å…·å¤‡è¯¸å¤šä¼˜åŠ¿ï¼Œä½†åœ¨æ¨å¹¿å’Œåº”ç”¨è¿‡ç¨‹ä¸­ä»é¢ä¸´ä¸€äº›æŒ‘æˆ˜ï¼š

**æŠ€æœ¯æ™®åŠå’Œæ ‡å‡†ç»Ÿä¸€**ï¼šä½œä¸ºæ–°å…´æŠ€æœ¯ï¼ŒMCP éœ€è¦æ›´å¤šçš„è¡Œä¸šå‚ä¸è€…å’Œå¼€å‘è€…æ”¯æŒï¼Œæ‰èƒ½å½¢æˆç»Ÿä¸€çš„æ ‡ å‡†ç”Ÿæ€ã€‚ - **å…¼å®¹æ€§ä¸æ‰©å±•æ€§å¹³è¡¡**ï¼šåœ¨è®¾è®¡ä¸Šï¼Œå¦‚ä½•åœ¨ä¿è¯æ ‡å‡†åŒ–çš„åŒæ—¶ï¼Œåˆèƒ½çµæ´»åº”å¯¹ä¸åŒåº”ç”¨çš„ç‰¹æ®Šéœ€æ±‚ï¼Œæ˜¯ MCP éœ€è¦è§£å†³çš„é—®é¢˜ã€‚ - **å®‰å…¨æ€§ä¿éšœ**ï¼šåœ¨è·¨å¹³å°ã€è·¨ç³»ç»Ÿæ•°æ®äº¤äº’è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•ç¡®ä¿æ•°æ®ä¸è¢«æ³„éœ²å¹¶ä¸¥æ ¼æ§åˆ¶è®¿é—®æƒé™ï¼Œæ˜¯æŠ€æœ¯ å®ç°ä¸­çš„é‡ç‚¹å’Œéš¾ç‚¹ã€‚ ---

# ## 7. æ€»ç»“ä¸å±•æœ›

# MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰ä½œä¸ºä¸€ç§å‰æ²¿çš„å¼€æ”¾æ ‡å‡†åè®®ï¼Œé€šè¿‡æ ‡å‡†åŒ–çš„æ¥å£ï¼Œå®ç°äº† AI æ¨¡å‹ä¸å¤–éƒ¨æ•°æ®æºå’Œ

# å·¥å…·ä¹‹é—´é«˜æ•ˆã€å®‰å…¨çš„äº¤äº’ã€‚æœ¬æ–‡ä» MCP çš„èµ·æºã€æŠ€æœ¯æ¶æ„ã€ä¼˜åŠ¿ã€åº”ç”¨æ¡ˆä¾‹åŠæœªæ¥å‘å±•è¶‹åŠ¿ç­‰å¤šä¸ªæ–¹é¢è¿›è¡Œ

# äº†è¯¦ç»†é˜è¿°ï¼Œå±•ç¤ºäº†å…¶åœ¨è½¯ä»¶å¼€å‘ã€åŒ»ç–—ä¿¡æ¯ç³»ç»Ÿã€äº‘å¹³å°ç®¡ç†ç­‰é¢†åŸŸçš„æ½œåœ¨ä»·å€¼ã€‚

# å¯ä»¥é¢„è§ï¼Œåœ¨ AI åº”ç”¨ä¸æ–­æ·±å…¥å’Œåœºæ™¯æ—¥ç›Šå¤æ‚çš„èƒŒæ™¯ä¸‹ï¼ŒMCP æœ‰æœ›æˆä¸ºè¿æ¥é™æ€æ¨¡å‹ä¸åŠ¨æ€æ•°æ®çš„é‡è¦æ¡¥

# æ¢ï¼Œæ¨åŠ¨äººå·¥æ™ºèƒ½è¿ˆå‘æ›´åŠ æ™ºèƒ½å’Œé«˜æ•ˆçš„æœªæ¥ã€‚é¢å¯¹æœªæ¥ï¼Œè¡Œä¸šå†…å„æ–¹éœ€è¦è¿›ä¸€æ­¥ååŒåˆä½œï¼Œå®Œå–„æ ‡å‡†ã€æå‡å®‰

å…¨é˜²æŠ¤ï¼Œå¹¶ä¸æ–­æ‰©å±•åè®®çš„åº”ç”¨é¢†åŸŸï¼Œå…±åŒæ¢ç´¢ MCP æŠ€æœ¯çš„æœ€ä½³å®è·µå’Œå‘å±•è·¯å¾„ã€‚

---

# ## å‚è€ƒæ–‡çŒ®ä¸è¿›ä¸€æ­¥é˜…è¯»

1. [æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆWikipediaï¼‰]

(https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8

D%8F%E8%AE%AE)

2. [Model Context Protocol å®˜æ–¹æ–‡æ¡£](https://modelcontextprotocol.info/zh-

# cn/docs/introduction/) 3. [æœ‰å…³ MCP åœ¨ AI é›†æˆä¸­çš„åº”ç”¨æ¢è®¨](https://blog.eimoon.com/p/mcp-introduction/?

# utm_source=openai)

---

æ³¨ï¼šæœ¬æ–‡ä¸»è¦èšç„¦äº MCP ä½œä¸ºä¸€é¡¹å¼€æ”¾æ ‡å‡†åè®®çš„æŠ€æœ¯ä½“ç³»ï¼Œä¸åŒé¢†åŸŸä¸­åŒæ ·ç¼©å†™ä¸º MCP çš„å…¶ä»–æŠ€æœ¯ï¼ˆå¦‚

# å¤šèŠ¯ç‰‡å°è£…ã€å¾®é€šé“æ¿ï¼‰åˆ™å±äºæˆªç„¶ä¸åŒçš„æŠ€æœ¯ä½“ç³»ï¼Œè¯»è€…åœ¨æŸ¥é˜…ç›¸å…³æ–‡çŒ®æ—¶éœ€æ³¨æ„åŒºåˆ†ã€‚*

# è¯¾ä»¶é¢†å–

# Mini DeepResearchå…¬å¼€è¯¾èµ„æ–™è§æœ¬èŠ‚å…¬å¼€è¯¾ç½‘ç›˜ï¼š

![Image](pdf_images\page231_img1.png)

![Image](pdf_images\page231_img2.png)

![Image](pdf_images\page231_img3.png)

![Image](pdf_images\page231_img4.png)

# Mini DeepResearchæŠ€æœ¯æ ˆ

# Mini DeepResearchä»¥OpenAIæ¨¡å‹åŠå¼€æºAgents SDKæ¡†æ¶ä¸ºä¸»è¿›è¡Œçš„å¼€å‘ï¼Œå®é™…è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦

# è¾“å…¥OpenAI API-KEYã€‚OpenAI API-KEYè·å–æ–¹æ³•è¯¦è§è¯¾ä»¶ä¸­çš„å‚è€ƒèµ„æ–™ã€ŠOpenAIæ³¨å†ŒæŒ‡å—ã€‹éƒ¨åˆ†ï¼Œæ­¤

# å¤–ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æŸå®ä¸Šè´­ä¹°å®˜æ–¹API-KEYã€‚æ­¤å¤–ï¼Œé¡¹ç›®ä¸­è‡ªå¸¦å›½å†…åå‘ä»£ç†åœ°å€ï¼Œæ— éœ€é¢å¤–ç½‘ç»œé—¨æ§›å³å¯

# ä½¿ç”¨ã€‚

# éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»è¦ä½¿ç”¨OpenAIå®˜æ–¹API-KEYæ‰èƒ½è¿è¡Œé¡¹ç›®ï¼Œä¸­è½¬API-KEYæ— æ³•è¿è¡Œã€‚

# Mini DeepResearchå‘½ä»¤è¡Œå¿«é€Ÿä¸Šæ‰‹ä½¿ç”¨

# åœ¨è¯¾ä»¶ä¸­ä¸‹è½½MiniDeepResearch.zipå‹ç¼©åŒ…å¹¶è§£å‹ç¼©ï¼Œç„¶åå³å¯åœ¨ä¸»ç›®å½•ä¸‹è¿è¡Œè¯¥é¡¹ç›®ï¼š

![Image](pdf_images\page232_img1.png)

## éœ€è¦æå‰å®‰è£…openaiåº“å’Œagentsåº“

# pip install openai openai-agents

# å¹¶ä¸”åœ¨ä¸‰ä¸ª_agent.pyæ–‡ä»¶ä¸­å†™å…¥å›½å†…åå‘ä»£ç†åœ°å€å’ŒOpenAIå®˜æ–¹API-KEYï¼Œç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯è¿ è¡Œï¼š

# python -m ChatBot.main

# 2.2 Mini DeepResearché¡¹ç›®æ¶æ„ä»‹ç»

# æ¥ä¸‹æ¥è®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾è¿™ä¸ªMulti-Agentç³»ç»Ÿæ ¸å¿ƒä»£ç ç»“æ„ã€‚Mini DeepResearchä¸»è¦ç”±ä¸‰ä¸ªAgent

# æ„æˆï¼š

# Agent

# åŠŸèƒ½

# planner_agent

# ç”Ÿæˆç ”ç©¶å…³é”®è¯å’Œæœç´¢ç­–ç•¥

# search_agent

# è´Ÿè´£æ‰§è¡Œç½‘ç»œæœç´¢ + æ€»ç»“å†…å®¹ï¼ˆä½¿ç”¨å·¥å…·ï¼‰

# writer_agent

# æ±‡æ€»æ‰€æœ‰æœç´¢ç»“æœï¼Œç¼–å†™æŠ¥å‘Š

# å¹¶ä¸”å®é™…è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸‰ä¸ªAgentç»„æˆä¸€ä¸ªçº¿æ€§çš„workflowè¿›è¡Œè¿è¡Œï¼š

# è¿™å…¶å®æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„Multi-Agentç³»ç»Ÿï¼Œå¹¶ä¸”åœ¨æœ€æ–°GPT-4.1å’Œo4-miniæ¨¡å‹åŠ æŒä¸‹ï¼Œä»¥åŠæ­é…å¼€æºçš„

Agents-SDKæ¡†æ¶å’ŒGPTæ¨¡å‹åŸç”Ÿçš„ç½‘ç»œæœç´¢åŠŸèƒ½ï¼Œèƒ½å¤Ÿéå¸¸é«˜æ•ˆç¨³å®šçš„å®ç°ç±»DeepResearchåŠŸèƒ½ã€‚

![Image](pdf_images\page233_img1.png)

![Image](pdf_images\page233_img2.png)

![Image](pdf_images\page233_img3.png)

## æ¥ä¸‹æ¥æˆ‘ä»¬é€ä¸ªä»‹ç»è¿™ä¸‰ä¸ªAgentä»£ç å®ç°ã€‚ä»¥ä¸‹ä»£ç å‡åœ¨Jupyterä¸­å®Œæˆæµ‹è¯•ï¼Œä»£ç è¯¾ä»¶è¯¦è§ï¼š

# 2.3 planner_agentåŠŸèƒ½å®ç°

# åŸºç¡€ä¾èµ–åº“å®‰è£…

# pip install openai openai-agents

# åŸºç¡€ä»£ç æµ‹è¯•

# è¿™é‡Œé¦–å…ˆéœ€è¦è®¾ç½®åŸºç¡€Agents-SDKå¼€å‘ç¯å¢ƒå¹¶è¿›è¡Œç®€å•æµ‹è¯•ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š

# from openai import AsyncOpenAI

# from agents import

OpenAIChatCompletionsModel,Agent,Runner,set_default_openai_client,

# set_tracing_disabled

# from agents.model_settings import ModelSettings

# from pydantic import BaseModel

# from agents import Agent, WebSearchTool

# from agents.model_settings import ModelSettings

# import os

from dotenv import load_dotenv

load_dotenv(override=True)

![Image](pdf_images\page234_img1.png)

## external_client = AsyncOpenAI(

base_url = os.getenv("BASE_URL"),

api_key = os.getenv("API_KEY"),

)

# set_default_openai_client(external_client)

# set_tracing_disabled(True)

# agent = Agent(name="Assistant", instructions="ä½ æ˜¯ä¸€ååŠ©äººä¸ºä¹çš„åŠ©æ‰‹ã€‚")

# result = await Runner.run(agent, "è¯·å†™ä¸€é¦–å…³äºç¼–ç¨‹ä¸­é€’å½’çš„ä¿³å¥ã€‚")

# print(result.final_output)

# è¿™é‡Œéœ€è¦åœ¨base_urlä¸­å¡«å†™å›½å†…åå‘ä»£ç†åœ°å€ï¼Œéœ€è¦åœ¨api_keyä¸­å¡«å†™OpenAIçš„API-KEYã€‚å®é™…è¿è¡Œç»“æœ

# å¦‚ä¸‹ï¼š

# planner_agentä»£ç è¯¦è§£ä¸åŠŸèƒ½ä»‹ç»

# æ¥ä¸‹æ¥åˆ›å»ºplanner_agentï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š

PROMPT = (

"You are a helpful research assistant. Given a query, come up with a set of

web searches "

"to perform to best answer the query. Output between 10 and 20 terms to query

# for."

)

# class WebSearchItem(BaseModel):

# reason: str

"Your reasoning for why this search is important to the query."

query: str

"The search term to use for the web search."

# class WebSearchPlan(BaseModel):

searches: list[WebSearchItem]

"""A list of web searches to perform to best answer the query."""

# planner_agent = Agent(

name="PlannerAgent",

instructions=PROMPT,

model="o4-mini",

output_type=WebSearchPlan,

)

# å…¶ä¸­Planner Agent çš„èŒè´£æ˜¯æ¥æ”¶ä¸€ä¸ªç ”ç©¶ä¸»é¢˜ï¼Œç”Ÿæˆä¸€ä»½â€œæœç´¢è®¡åˆ’ï¼ˆWebSearchPlanï¼‰â€ï¼Œå‘Šè¯‰

# ç³»ç»Ÿåº”è¯¥æœç´¢å“ªäº›å­é—®é¢˜/å…³é”®è¯ä»¥åŠæœç´¢è¿™äº›å…³é”®è¯çš„ç†ç”±ã€‚å…·ä½“ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

# from pydantic import BaseModel

# å¯¼å…¥ Pydanticï¼Œç”¨äºå®šä¹‰ç»“æ„åŒ–æ•°æ®æ¨¡å‹ã€‚å®ƒæ˜¯æ•´ä¸ª Agents SDK ä¸­ç”¨äºç±»å‹æ ¡éªŒ + æ•°æ®ç»“æ„å®šä¹‰çš„æ ¸ å¿ƒåº“ã€‚

# from agents import Agent

# å¯¼å…¥ SDK çš„æ ¸å¿ƒç±» Agent ï¼Œæˆ‘ä»¬åé¢ä¼šå®ä¾‹åŒ–ä¸€ä¸ªå…·ä½“çš„ Agent å®ä½“ planner_agent ã€‚

PROMPT = (

"You are a helpful research assistant. Given a query, come up with a set of

web searches "

"to perform to best answer the query. Output between 20 and 30 terms to query

# for."

)

# å®šä¹‰è¿™ä¸ª Agent çš„æç¤ºè¯ï¼ˆPromptï¼‰ï¼Œå‘Šè¯‰ LLMï¼š

# ä½ æ˜¯ä¸€ä¸ªç ”ç©¶åŠ©æ‰‹ï¼›

# æ”¶åˆ°ä¸€ä¸ªä¸»é¢˜åï¼Œè¯·ç”Ÿæˆ 20 åˆ° 30 æ¡æœç´¢å»ºè®®ï¼›

# æ¯æ¡å»ºè®®åº”å½“åŒ…æ‹¬ æœç´¢å…³é”®è¯ + æœç´¢åŸå› ã€‚

# æ¥ä¸‹æ¥æ˜¯ä¸¤ä¸ªé‡è¦çš„æ•°æ®ç»“æ„å®šä¹‰ï¼š

# class WebSearchItem(BaseModel):

# reason: str

"Your reasoning for why this search is important to the query."

# query: str

"The search term to use for the web search."

# è¿™æ˜¯ä¸€ä¸ªâ€œå•ä¸ªæœç´¢å»ºè®®â€çš„ç»“æ„ï¼ŒåŒ…å«ä¸¤ä¸ªå­—æ®µï¼š

## å­—æ®µ

## è¯´æ˜

# reason

# ä½ ä¸ºä»€ä¹ˆè¦æœç´¢è¿™ä¸ªå…³é”®è¯ï¼Ÿï¼ˆç”¨äºè§£é‡Šæœç´¢åŠ¨æœºï¼‰

# query

# ä½ è¦æœç´¢çš„å…³é”®è¯æœ¬èº«

# class WebSearchPlan(BaseModel):

searches: list[WebSearchItem]

"""A list of web searches to perform to best answer the query."""

è¿™æ˜¯â€œæœç´¢è®¡åˆ’â€çš„æ•´ä½“ç»“æ„ï¼ŒåŒ…å«ä¸€ä¸ªåˆ—è¡¨ searches ï¼Œæ¯é¡¹æ˜¯ä¸Šé¢çš„ WebSearchItem ã€‚

# å…¶ä¸­æ¨¡å‹è¾“å‡ºç»“æ„åŒ–çš„å…³é”®åœ¨è¿™ï¼š

output_type=WebSearchPlan,

# å®ƒå‘Šè¯‰ planner_agent â€œä½ å¿…é¡»è¾“å‡ºä¸€ä»½ç»“æ„åŒ–çš„ WebSearchPlan å¯¹è±¡ï¼Œé‡Œé¢åŒ…å«å¤šä¸ª

# WebSearchItemã€‚â€è¿™æ ·å¯ä»¥çº¦æŸæ¨¡å‹è¾“å‡ºæ ¼å¼ï¼Œä¹Ÿä¾¿äºä¸‹ä¸€æ­¥è‡ªåŠ¨è§£æå†…å®¹ã€‚

# å®é™…è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š

![Image](pdf_images\page237_img1.png)

# è¾“å‡ºäº†14ä¸ªæœç´¢å…³é”®è¯å’Œå¯¹åº”çš„æœç´¢åŸå› ã€‚

# 2.4 search_agentåŠŸèƒ½å®ç°

# æ¥ä¸‹æ¥æ˜¯è´Ÿè´£å®é™…æ‰§è¡Œæœç´¢å·¥ä½œçš„search_agentï¼Œä»£ç å¦‚ä¸‹ï¼š

# from agents import Agent, WebSearchTool

# from agents.model_settings import ModelSettings

INSTRUCTIONS = (

"You are a research assistant. Given a search term, you search the web for

# that term and "

"produce a concise summary of the results. The summary must 2-3 paragraphs

# and less than 300 "

"words. Capture the main points. Write succinctly, no need to have complete

sentences or good "

## "grammar. This will be consumed by someone synthesizing a report, so its

## vital you capture the "

"essence and ignore any fluff. Do not include any additional commentary other

# than the summary "

# "itself."

)

# search_agent = Agent(

name="Search agent",

instructions=INSTRUCTIONS,

tools=[WebSearchTool()],

model_settings=ModelSettings(tool_choice="required"),

)

# search_agent çš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ä¸ªæœç´¢å…³é”®è¯ï¼Œè°ƒç”¨ Web æœç´¢å·¥å…·ï¼Œç„¶åæ ¹æ®æœç´¢ç»“æœç”Ÿæˆä¸€ä»½ç®€æ´

# çš„æ‘˜è¦ï¼ˆ2-3 æ®µï¼Œ<300è¯ï¼‰ï¼Œä¸å¸¦è¯„è®ºï¼Œåªä¿ç•™ä¿¡æ¯æœ¬èº«ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­çœŸæ­£â€œå»ç½‘ä¸ŠæŸ¥èµ„

# æ–™â€çš„è§’è‰²ã€‚å…·ä½“ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

# from agents import Agent, WebSearchTool

# from agents.model_settings import ModelSettings

# å…¶ä¸­ï¼š

# Agent ï¼šå¯¼å…¥ SDK çš„æ™ºèƒ½ä½“åŸºç±»ï¼›

# WebSearchTool ï¼šä¸€ä¸ªç”± Agents SDK å†…ç½®çš„ç½‘é¡µæœç´¢å·¥å…·ï¼Œè°ƒç”¨å®ƒå¯ä»¥æ¨¡æ‹Ÿ â€œä¸Šç½‘æœç´¢â€ çš„æ•ˆ

# æœï¼›

ModelSettings ï¼šå¯ä»¥é…ç½®ä¸€äº›æ¨¡å‹ä½¿ç”¨æ—¶çš„è¡Œä¸ºï¼Œæ¯”å¦‚æ˜¯å¦å¿…é¡»ä½¿ç”¨å·¥å…·ã€‚

# ç„¶åæ˜¯é‡ç‚¹æç¤ºè¯ INSTRUCTIONS

INSTRUCTIONS = (

"You are a research assistant. Given a search term, you search the web for

# that term and"

"produce a concise summary of the results. The summary must 2-3 paragraphs

# and less than 300"

"words. Capture the main points. Write succinctly, no need to have complete

# sentences or good"

"grammar. This will be consumed by someone synthesizing a report, so its

vital you capture the"

"essence and ignore any fluff. Do not include any additional commentary other

# than the summary"

# "itself."

)

# è¿™æ˜¯æ¨¡å‹çš„è¡Œä¸ºæç¤ºï¼Œç¿»è¯‘ä¸€ä¸‹è¿™æ®µå†…å®¹çš„ç²¾é«“ï¼š

# æŒ‡ä»¤å«ä¹‰

# è¯´æ˜

# ä½ æ˜¯ä¸€ä¸ªç ”ç©¶åŠ©æ‰‹

# æ¨¡æ‹Ÿä¸€ä¸ªèƒ½æŸ¥èµ„æ–™çš„äºº

# ç»™ä½ å…³é”®è¯åä¸Šç½‘æœç´¢

# å…³é”®è¯æ¥è‡ª planner_agent

å†™å‡º 2-3 æ®µç®€æ´æ€»ç»“

æ¯æ¬¡æœç´¢ç»“æœå¿…é¡»å‹ç¼©æˆ 300 å­—ä»¥å†…çš„æ‘˜è¦

## æŒ‡ä»¤å«ä¹‰

## è¯´æ˜

# ç”¨è¦ç‚¹å¼è¯­è¨€ã€å¯ä»¥è¯­æ³•ä¸å®Œæ•´

# ä¸è¦æ±‚åƒè®ºæ–‡ï¼Œé‡ç‚¹æ˜¯ä¿¡æ¯å¯†åº¦é«˜

# ä¸è¦æ·»åŠ è‡ªå·±çš„è¯„è®º

# ä¸èƒ½ä¸»è§‚åˆ¤æ–­ï¼Œåªæå–ä¿¡æ¯

# æœ€ç»ˆç›®çš„æ˜¯ä¸ºåç»­å†™æŠ¥å‘Šçš„äººå‡†å¤‡ç´ æ

# æ‰€ä»¥æ ¼å¼è‡ªç”±ï¼Œå†…å®¹é›†ä¸­å°±è¡Œ

# æ¥ä¸‹æ¥åˆ›å»ºåˆ›å»º Agent å¯¹è±¡

# search_agent = Agent(

name="Search agent",

instructions=INSTRUCTIONS,

tools=[WebSearchTool()],

model_settings=ModelSettings(tool_choice="required"),

)

# å…¶ä¸­ name="Search agent" æ˜¯Agent åç§°ï¼Œç”¨äºæ—¥å¿—å’Œä¸Šä¸‹æ–‡æ˜¾ç¤ºã€‚è€Œ instructions=INSTRUCTIONS

å‘Šè¯‰å¤§è¯­è¨€æ¨¡å‹å®ƒè¦æ€ä¹ˆå®Œæˆä»»åŠ¡ã€‚ tools=[WebSearchTool()] è®¾ç½®å®ƒå¯ä»¥ä½¿ç”¨çš„å·¥å…·ã€‚åœ¨è¿™ä¸ª case

# ä¸­ï¼Œå®ƒåªèƒ½ç”¨ WebSearchTool ï¼Œè¿™æ˜¯ SDK å†…ç½®çš„ç½‘é¡µæœç´¢å·¥å…·ã€‚è€Œ

model_settings=ModelSettings(tool_choice="required") åˆ™è¡¨ç¤ºï¼šå¼ºåˆ¶è¦æ±‚æ¨¡å‹ä¸€å®šè¦è°ƒç”¨å·¥å…·

# ï¼ˆWebSearchToolï¼‰æ¥å®Œæˆä»»åŠ¡ã€‚ä¸å…è®¸æ¨¡å‹â€œå‡­ç©ºå›ç­”â€æˆ–â€œèƒ¡ç¼–æœç´¢å†…å®¹â€ï¼Œè¿™æœ‰åŠ©äºæå‡çœŸå®æ€§ã€‚

# æ€»ç»“æµç¨‹å¦‚ä¸‹ï¼š

å…³é”®è¯ï¼ˆæ¥è‡ª planner_agentï¼‰ â†’ search_agent â†’ ğŸ” ä½¿ç”¨ WebSearchTool æœç´¢ âœ‚ æ ¹æ®ç»“æœç”Ÿæˆ 2-3 æ®µæ‘˜è¦ ğŸ“¦ è¿”å›ç»™ writer_agent å†™æ•´åˆæŠ¥å‘Š

# å¸¦å…¥planner_agentçš„ä¸€ä¸ªæœç´¢æ¡ç›®åè¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š

![Image](pdf_images\page240_img1.png)

# 2.5 writer_agentåŠŸèƒ½å®ç°

# æœ€ååˆ™æ˜¯writer_agentçš„åŠŸèƒ½ä»‹ç»ï¼Œå…¶æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š

# from pydantic import BaseModel

# from agents import Agent

PROMPT_TEMP = (

"You are a senior researcher tasked with writing a cohesive report for a

# research query. "

"You will be provided with the original query, and some initial research done

# by a research "

# "assistant.\n"

"You should first come up with an outline for the report that describes the

# structure and "

"flow of the report. Then, generate the report and return that as your final

# output.\n"

"The final output should be in markdown format, and it should be lengthy and

detailed. Aim "

# "for 10-20 pages of content, at least 1500 words."

# "æœ€ç»ˆç»“æœè¯·ç”¨ä¸­æ–‡è¾“å‡ºã€‚"

)

# class ReportData(BaseModel):

# short_summary: str

"""A short 2-3 sentence summary of the findings."""

## markdown_report: str

# """The final report"""

# follow_up_questions: list[str]

"""Suggested topics to research further"""

# writer_agent = Agent(

name="WriterAgent",

instructions=PROMPT_TEMP,

model="o4-mini",

output_type=ReportData,

)

# Writer Agentè¿™æ˜¯ æ•´ä¸ªç ”ç©¶ç³»ç»Ÿçš„â€œè¾“å‡ºç»ˆç»“è€…â€ï¼Œè´Ÿè´£æŠŠä¹‹å‰æ‰€æœ‰æœç´¢åˆ°çš„ä¿¡æ¯ï¼Œç»¼åˆæˆä¸€ä»½å®Œæ•´ã€ç»“

# æ„åŒ–ã€å¯é˜…è¯»çš„é•¿ç¯‡æŠ¥å‘Šã€‚è¯¥ Agent çš„ä»»åŠ¡æ˜¯ï¼š

# æ”¶åˆ°ç ”ç©¶ä¸»é¢˜å’Œä¹‹å‰çš„æ‰€æœ‰æœç´¢æ‘˜è¦ï¼›

# å…ˆå†™ä¸€ä¸ªå¤§çº²ï¼ˆoutlineï¼‰ï¼›

# ç„¶åæ ¹æ®å¤§çº²å†™å‡ºä¸€ä»½ è¯¦ç»†çš„ Markdown æ ¼å¼æŠ¥å‘Šï¼›

# åŒæ—¶ç”Ÿæˆä¸€ä¸ªç®€çŸ­æ€»ç»“å’Œä¸€äº›åç»­å¯ä»¥ç ”ç©¶çš„é—®é¢˜ã€‚

# å…·ä½“ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

# Agent used to synthesize a final report from the individual summaries.

# from pydantic import BaseModel

# from agents import Agent

# å’Œå‰ä¸¤ä¸ª Agent ä¸€æ ·ï¼Œæˆ‘ä»¬å¯¼å…¥äº†ï¼š

# BaseModel ï¼šç”¨äºå®šä¹‰ç»“æ„åŒ–è¾“å‡ºï¼›

# Agent ï¼šAgent SDK ä¸­çš„æ ¸å¿ƒç±»ã€‚

# ç„¶åæ˜¯æç¤ºè¯å®šä¹‰ï¼ˆPromptï¼‰

PROMPT = (

"You are a senior researcher tasked with writing a cohesive report for a

# research query. "

"You will be provided with the original query, and some initial research done

# by a research "

# "assistant.\n"

"You should first come up with an outline for the report that describes the

# structure and "

"flow of the report. Then, generate the report and return that as your final

# output.\n"

"The final output should be in markdown format, and it should be lengthy and

detailed. Aim "

# "for 15-20 pages of content, at least 3000 words."

# "æœ€ç»ˆç»“æœè¯·ç”¨ä¸­æ–‡è¾“å‡ºã€‚"

)

æç¤ºè¯è¦ç‚¹ï¼š

## è¡Œä¸º

## è¯´æ˜

# è§’è‰²è®¾å®š

# ä½ æ˜¯ä¸€ä¸ªèµ„æ·±ç ”ç©¶å‘˜ï¼ˆsenior researcherï¼‰

# è¾“å…¥

# ä¼šæ‹¿åˆ°ï¼šç ”ç©¶ä¸»é¢˜ + æœç´¢æ‘˜è¦

# ç¬¬ä¸€æ­¥

# å†™å‡ºæŠ¥å‘Šç»“æ„ï¼ˆoutlineï¼‰

# ç¬¬äºŒæ­¥

# å†™å‡º Markdown æŠ¥å‘Šæ­£æ–‡

# è¦æ±‚

é•¿ã€è¯¦ç»†ã€æœ‰é€»è¾‘ï¼ˆ10-20é¡µï¼Œ1500+è¯ï¼‰

# è¾“å‡ºæ ¼å¼

# Markdown æ ¼å¼ï¼ˆå¦‚ # ä¸€çº§æ ‡é¢˜ , - åˆ—è¡¨ ç­‰ï¼‰

# è¯­è¨€é£æ ¼

# ç²¾ç‚¼ã€å­¦æœ¯ã€ç»“æ„æ¸…æ™°

# è¿™ä¸ª prompt æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­æœ€â€œç”Ÿæˆå‹â€çš„ä¸€ä¸ª promptã€‚ç´§æ¥ç€æ˜¯è¾“å‡ºæ•°æ®ç»“æ„å®šä¹‰ï¼Œå®šä¹‰ä¸€ä¸ª

# ReportData ç±»ï¼Œç”¨æ¥çº¦æŸæ¨¡å‹çš„è¾“å‡ºç»“æ„ï¼š

# class ReportData(BaseModel):

# short_summary: str

# """A short 2-3 sentence summary of the findings."""

# markdown_report: str

# """The final report"""

# follow_up_questions: list[str]

"""Suggested topics to research further"""

# å…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š

# å­—æ®µå

# ç±»å‹

# è¯´æ˜

# short_summary

# str

# å¯¹ç ”ç©¶ç»“æœçš„ç®€è¦æ€»ç»“ï¼ˆ2~3 å¥è¯ï¼‰

# markdown_report

# str

# æŠ¥å‘Šæ­£æ–‡ï¼ŒMarkdown æ ¼å¼ï¼Œå†…å®¹è¯¦å®

# follow_up_questions

# list[str]

# å»ºè®®åç»­å¯ä»¥è¿›ä¸€æ­¥ç ”ç©¶çš„é—®é¢˜åˆ—è¡¨

æ³¨æ„ï¼šè¿™ä¸ªç»“æ„å°±æ˜¯é€šè¿‡ output_type=ReportData æ¥å‘Šè¯‰ SDK è¦æ±‚æ¨¡å‹è¾“å‡ºè¿™ä¸ªç»“æ„ï¼Œå¦åˆ™ SDK ä¼š

# æŠ¥é”™æˆ–è§£æå¤±è´¥ã€‚

# ç´§æ¥ç€åˆ›å»º Agent å®ä¾‹

# writer_agent = Agent(

name="WriterAgent",

instructions=PROMPT,

model="gpt-4.1",

output_type=ReportData,

)

# å‚æ•°

# å«ä¹‰

name

Agent å

![Image](pdf_images\page243_img1.png)

## å‚æ•°

## å«ä¹‰

# instructions

# æç¤ºè¯æŒ‡ä»¤

# model

# ä½¿ç”¨çš„æ¨¡å‹ï¼ˆè¿™é‡Œæ˜¯ "gpt-4.1" ï¼Œå¯ä»¥æ›¿æ¢ä¸º gpt-4o ç­‰ï¼‰

# output_type

# æŒ‡å®šè¾“å‡ºä¸º ReportData ç±»å‹ï¼Œæ”¯æŒç»“æ„åŒ–ç»“æœ

# æ•´ä½“æµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š

1. ç”¨æˆ·è¾“å…¥ç ”ç©¶ä¸»é¢˜ â†’ planner_agent â†’ æœç´¢å…³é”®è¯åˆ—è¡¨

2. æ¯ä¸ªå…³é”®è¯ â†’ search_agent â†’ æœç´¢æ‘˜è¦

3. æ‰€æœ‰æ‘˜è¦é›†åˆ + åŸå§‹ä¸»é¢˜ â†’ writer_agent â†’ ğŸ“Œ è¾“å‡ºï¼š - short_summary

markdown_reportï¼ˆæ­£æ–‡ï¼‰

follow_up_questionsï¼ˆå¯ç»§ç»­ç ”ç©¶çš„é—®é¢˜ï¼‰

# æœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ªå®Œæ•´ç»“æ„åŒ–çš„ ReportData å¯¹è±¡ã€‚

# å¸¦å…¥å…¶ä¸­ç¬¬ä¸€ä¸ªæ¡ç›®æœç´¢ç»“æœåå¯ä»¥ç¼–å†™æ–‡æœ¬å¦‚ä¸‹ï¼š

## éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¸¦å…¥å…¨éƒ¨æœç´¢æ¡ç›®çš„çŸ­æ–‡æœ¬åå†ç¼–å†™æœ€ç»ˆçš„é•¿æ–‡æœ¬ã€‚

# 2.6 MCPæœåŠ¡å™¨ä¸»å‡½æ•°ç¼–å†™

# åœ¨å®ç°äº†è¿™ä¸€ç³»åˆ—Agentsçš„åŸºç¡€åŠŸèƒ½ä¹‹åï¼Œæˆ‘ä»¬æ¥ç¼–å†™å½“å‰MCPæœåŠ¡å™¨çš„ä¸»å‡½æ•°ã€‚å…¶å®MCPæœåŠ¡å™¨

# çš„ä¸»å‡½æ•°å’ŒFunction callingè¿è¡Œè¿‡ç¨‹ä¸­çš„å¤–éƒ¨å‡½æ•°ç±»ä¼¼ï¼ŒåŸºæœ¬è¦æ±‚å¦‚ä¸‹ï¼š

1. èƒ½å®ç°ç¨³å®šçš„è¾“å…¥å’Œè¾“å‡ºã€‚å¯¹äºå½“å‰Mini DeepResearchæœåŠ¡å™¨æ¥è¯´ï¼Œè¾“å…¥å°±æ˜¯ç”¨æˆ·çš„é—®é¢˜ï¼Œè€Œè¾“

# å‡ºå°±æ˜¯æœ€ç»ˆçš„è°ƒç ”æŠ¥å‘Šï¼›

2. éœ€è¦ç¼–å†™æ˜ç¡®çš„å‡½æ•°è¯´æ˜ï¼ŒåŒ…æ‹¬å‡½æ•°åŠŸèƒ½ã€å‡½æ•°å‚æ•°å’Œå‡½æ•°è¾“å‡ºç­‰ã€‚è¿™äº›å†…å®¹éƒ½æ˜¯MCPå®¢æˆ·ç«¯å»è¯†

# åˆ«å¤–éƒ¨å·¥å…·çš„å…³é”®ã€‚

3. æ¨èå¯ä»¥ä½¿ç”¨MCP SDKè¿›è¡ŒæœåŠ¡å™¨å¼€å‘ã€‚

# è¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªdeepresearchå‡½æ•°ç»„ï¼Œè¿™ä¸ªå‡½æ•°ç»„ç”¨äºè°ƒç”¨ä¸Šé¢çš„Agentsæ¥æ‰§è¡Œå®Œæ•´çš„è§„åˆ’ã€æœ

# ç´¢å’Œæ–‡æ¡£ç¼–å†™å·¥ä½œï¼Œè¯¥å‡½æ•°ç»„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

# import asyncio

# import os

# import time

from typing import List

# async def _plan_searches(query: str) -> WebSearchPlan:

"""

# ç”¨äºè¿›è¡ŒæŸä¸ªæœç´¢ä¸»é¢˜çš„æœç´¢è§„åˆ’

"""

# result = await Runner.run(

planner_agent,

f"Query: {query}",

)

# return result.final_output_as(WebSearchPlan)

async def _perform_searches(search_plan: WebSearchPlan) -> List[str]:

"""

# ç”¨äºå®é™…æ‰§è¡Œæœç´¢ï¼Œå¹¶ç»„æˆæœç´¢æ¡ç›®åˆ—è¡¨

"""

tasks = [asyncio.create_task(_search(item)) for item in search_plan.searches]

results = []

# for task in asyncio.as_completed(tasks):

# result = await task

if result is not None:

# results.append(result)

# return results

# async def _search(item: WebSearchItem) -> str | None:

# """ å®é™…è´Ÿè´£è¿›è¡Œæœç´¢ï¼Œå¹¶å®Œæˆæ¯ä¸ªæœç´¢æ¡ç›®çš„çŸ­æ–‡æœ¬ç¼–å†™

"""

# try:

# result = await Runner.run(

search_agent,

# input=f"Search term: {item.query}\nReason for searching:

# {item.reason}"

)

return str(result.final_output)

except Exception:

## return None

# async def _write_report(query: str, search_results: List[str]) -> ReportData:

"""

# æ ¹æ®æœç´¢çš„æ®µæ–‡æ¡£ï¼Œç¼–å†™é•¿æ–‡æœ¬

"""

# result = await Runner.run(

writer_agent,

input=f"Original query: {query}\nSummarized search results:

{search_results}",

)

# return result.final_output_as(ReportData)

# async def deepresearch(query: str) -> ReportData:

"""

# ä¸»å‡½æ•°ï¼Œè¾“å…¥ä¸€ä¸ªç ”ç©¶ä¸»é¢˜ï¼Œè‡ªåŠ¨å®Œæˆæœç´¢è§„åˆ’ã€æœç´¢ã€å†™æŠ¥å‘Šã€‚ è¿”å›æœ€ç»ˆçš„ ReportData å¯¹è±¡ï¼Œå°±æ˜¯ä¸€ä¸ªmarkdownæ ¼å¼çš„å®Œæ•´çš„ç ”ç©¶æŠ¥å‘Šæ–‡æ¡£

"""

# search_plan = await _plan_searches(query)

search_results = await _perform_searches(search_plan)

report = await _write_report(query, search_results)

# return report

# ç¼–å†™å®Œæˆåå¯ä»¥è¾“å…¥å¦‚ä¸‹ä»£ç è¿›è¡Œæµ‹è¯•ï¼š

# import nest_asyncio

# nest_asyncio.apply()

report = await deepresearch("äººå·¥æ™ºèƒ½åœ¨æ•™è‚²é¢†åŸŸçš„åº”ç”¨")

# from rich.markdown import Markdown

# display(Markdown(report.markdown_report))

# å…·ä½“è¿è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

![Image](pdf_images\page248_img1.png)

# è¯¾ä»¶é¢†å–

![Image](pdf_images\page249_img1.png)

![Image](pdf_images\page249_img2.png)

3. MCP Serveré¡¹ç›®å¼€å‘

# åœ¨å®Œæˆäº†ä»£ç åŠŸèƒ½æµ‹è¯•åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„MCP Serveré¡¹ç›®æ¥å®ç°è¯¥åŠŸèƒ½ã€‚å¯¹äºä¸€

ä¸ªå®Œæ•´çš„MCPé¡¹ç›®æ¥è¯´ï¼Œè¦æœ‰å®Œæ•´çš„é¡¹ç›®ä»£ç ç»“æ„ã€ä»¥åŠç¬¦åˆMCPæœåŠ¡å™¨åŸºæœ¬è°ƒç”¨è§„èŒƒã€‚å…·ä½“é¡¹ç›®åˆ›å»º æµç¨‹å¦‚ä¸‹ï¼š

# Step 1. å€ŸåŠ©uvåˆ›å»ºPythoné¡¹ç›®

# MCPå¼€å‘è¦æ±‚å€ŸåŠ©uvè¿›è¡Œè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–ç®¡ç†ã€‚ uv æ˜¯ä¸€ä¸ªPython ä¾èµ–ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼äº

pip å’Œ conda ï¼Œä½†å®ƒæ›´å¿«ã€æ›´é«˜æ•ˆï¼Œå¹¶ä¸”å¯ä»¥æ›´å¥½åœ°ç®¡ç† Python è™šæ‹Ÿç¯å¢ƒå’Œä¾èµ–é¡¹ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯ æ›¿ä»£ pip ã€ venv å’Œ pip-tools ï¼Œæä¾›æ›´å¥½çš„æ€§èƒ½å’Œæ›´ä½çš„ç®¡ç†å¼€é”€ã€‚

# uv çš„ç‰¹ç‚¹ï¼š

1. é€Ÿåº¦æ›´å¿«ï¼šç›¸æ¯” pip ï¼Œ uv é‡‡ç”¨ Rust ç¼–å†™ï¼Œæ€§èƒ½æ›´ä¼˜ã€‚

2. æ”¯æŒ PEP 582ï¼šæ— éœ€ virtualenv ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ __pypackages__ è¿›è¡Œç®¡ç†ã€‚

3. å…¼å®¹ pip ï¼šæ”¯æŒ requirements.txt å’Œ pyproject.toml ä¾èµ–ç®¡ç†ã€‚

4. æ›¿ä»£ venv ï¼šæä¾› uv venv è¿›è¡Œè™šæ‹Ÿç¯å¢ƒç®¡ç†ï¼Œæ¯” venv æ›´è½»é‡ã€‚

5. è·¨å¹³å°ï¼šæ”¯æŒ Windowsã€macOS å’Œ Linuxã€‚

# ä»¥Ubuntuç³»ç»Ÿä¸ºä¾‹ï¼Œé¦–å…ˆä½¿ç”¨pipå®‰è£…uvï¼š

# pip install uv

# æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨curlå®‰è£…uv

# curl -LsSf https://astral.sh/uv/install.sh | sh

# ç„¶åæŒ‰ç…§å¦‚ä¸‹æµç¨‹åˆ›å»ºé¡¹ç›®ä¸»ç›®å½•ï¼š

![Image](pdf_images\page250_img1.png)

![Image](pdf_images\page250_img2.png)

![Image](pdf_images\page250_img3.png)

## # cd /root/autodl-tmp/MCP

# # åˆ›å»ºé¡¹ç›®ç›®å½•

# uv init mcp-server-deepresearch

# cd mcp-server-deepresearch

# ç„¶åè¾“å…¥å¦‚ä¸‹å‘½ä»¤åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š

# # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

# uv venv

# # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

# source .venv/bin/activate

# æ­¤æ—¶å°±æ„å»ºäº†ä¸€ä¸ªåŸºç¡€é¡¹ç›®ç»“æ„ï¼š

# å„æ–‡ä»¶è§£é‡Šå¦‚ä¸‹ï¼š

# æ–‡ä»¶/æ–‡ä»¶å¤¹

# .git/

# .venv/

# .gitignore

.python-version

# ä½œç”¨

# Git ç‰ˆæœ¬æ§åˆ¶ç›®å½•

# è™šæ‹Ÿç¯å¢ƒ

# Git å¿½ç•¥è§„åˆ™

Pythonç‰ˆæœ¬å£°æ˜

![Image](pdf_images\page251_img1.png)

![Image](pdf_images\page251_img2.png)

## æ–‡ä»¶/æ–‡ä»¶å¤¹

## ä½œç”¨

# main.py

# ä¸»ç¨‹åºå…¥å£

# pyproject.toml

# é¡¹ç›®é…ç½®æ–‡ä»¶

# README.md

# é¡¹ç›®è¯´æ˜æ–‡æ¡£

# Step 2. æ·»åŠ é¡¹ç›®ä¾èµ–

# æ¥ä¸‹æ¥ç»§ç»­ä½¿ç”¨uvå·¥å…·ï¼Œä¸ºæˆ‘ä»¬çš„é¡¹ç›®æ·»åŠ åŸºç¡€ä¾èµ–ã€‚æ ¹æ®æ­¤å‰çš„ä»£ç è§£é‡Šä¸éš¾çœ‹å‡ºï¼Œå½“å‰é¡¹ç›®ä¸»

è¦éœ€è¦ç”¨åˆ° openai å’Œ openai-agents è¿™ä¸¤ä¸ªåº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å®‰è£…ç›¸å…³ä¾èµ–ï¼Œå¹¶åŒæ—¶å®‰è£…

# mcp sdkï¼š

# # å®‰è£… MCP SDK

uv add mcp openai openai-agents asyncio typing pydantic

# æ³¨æ„ï¼Œå¯¹äºuvç®¡ç†åº“æ¥è¯´ï¼Œç›¸å…³ä¾èµ–ä¼šå®‰è£…åˆ°.venvæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸ä¼šå’Œç³»ç»Ÿåº“äº§ç”Ÿå†²çªã€‚

# Step 3.ç¼–å†™é¡¹ç›®æºç 

# æ¥ä¸‹æ¥åœ¨ä¸»ç›®å½•ä¸‹åˆ›å»º /src/mcp_server_deepresearch ä½œä¸ºä»£ç ä¸»ç›®å½•

# mkdir -p ./src/mcp_server_deepresearch

# cd ./src/mcp_server_deepresearch

# ç„¶ååˆ›å»ºserver.pyè„šæœ¬ï¼Œä½œä¸ºæ•´ä¸ªDeepResearch MCPæœåŠ¡å™¨çš„æ ¸å¿ƒè„šæœ¬ï¼Œ

# å¹¶å†™å…¥ä»£ç å¦‚ä¸‹ï¼š

# import asyncio

# import argparse

from typing import List

# from mcp.server.fastmcp import FastMCP

from openai import AsyncOpenAI

from pydantic import BaseModel

## from agents import

## OpenAIChatCompletionsModel,Agent,Runner,set_default_openai_client,

set_tracing_disabled,WebSearchTool

# from agents.model_settings import ModelSettings

# # åˆå§‹åŒ– MCP æœåŠ¡å™¨

# mcp = FastMCP("DeepResearch")

# USER_AGENT = "deepresearch-app/1.0"

# API_KEY = None

# # åˆ›å»ºplanner_agent

PROMPT = (

"You are a helpful research assistant. Given a query, come up with a set of

web searches "

"to perform to best answer the query. Output between 10 and 20 terms to query

# for."

)

# class WebSearchItem(BaseModel):

# reason: str

"Your reasoning for why this search is important to the query."

# query: str

"The search term to use for the web search."

# class WebSearchPlan(BaseModel):

searches: list[WebSearchItem]

"""A list of web searches to perform to best answer the query."""

# planner_agent = Agent(

name="PlannerAgent",

instructions=PROMPT,

model="o3-mini",

output_type=WebSearchPlan,

)

# # åˆ›å»ºsearch_agent

INSTRUCTIONS = (

"You are a research assistant. Given a search term, you search the web for

# that term and "

"produce a concise summary of the results. The summary must 2-3 paragraphs

# and less than 300 "

"words. Capture the main points. Write succinctly, no need to have complete

# sentences or good "

"grammar. This will be consumed by someone synthesizing a report, so its

vital you capture the "

"essence and ignore any fluff. Do not include any additional commentary other

# than the summary "

# "itself."

)

search_agent = Agent(

name="Search agent",

## instructions=INSTRUCTIONS,

## tools=[WebSearchTool()],

model_settings=ModelSettings(tool_choice="required"),

)

# # åˆ›å»ºwriter_agent

PROMPT_TEMP = (

"You are a senior researcher tasked with writing a cohesive report for a

# research query. "

"You will be provided with the original query, and some initial research done

# by a research "

# "assistant.\n"

"You should first come up with an outline for the report that describes the

# structure and "

"flow of the report. Then, generate the report and return that as your final

# output.\n"

"The final output should be in markdown format, and it should be lengthy and

detailed. Aim "

# "for 10-20 pages of content, at least 1500 words."

# "æœ€ç»ˆç»“æœè¯·ç”¨ä¸­æ–‡è¾“å‡ºã€‚"

)

# class ReportData(BaseModel):

# short_summary: str

# """A short 2-3 sentence summary of the findings."""

# markdown_report: str

# """The final report"""

# follow_up_questions: list[str]

"""Suggested topics to research further"""

# writer_agent = Agent(

name="WriterAgent",

instructions=PROMPT_TEMP,

model="o3-mini",

output_type=ReportData,

)

# # è¾…åŠ©å‡½æ•°ç»„

# async def _plan_searches(query: str) -> WebSearchPlan:

"""

# ç”¨äºè¿›è¡ŒæŸä¸ªæœç´¢ä¸»é¢˜çš„æœç´¢è§„åˆ’

"""

# result = await Runner.run(

planner_agent,

f"Query: {query}",

)

# return result.final_output_as(WebSearchPlan)

async def _perform_searches(search_plan: WebSearchPlan) -> List[str]:

"""

ç”¨äºå®é™…æ‰§è¡Œæœç´¢ï¼Œå¹¶ç»„æˆæœç´¢æ¡ç›®åˆ—è¡¨

"""

## tasks = [asyncio.create_task(_search(item)) for item in search_plan.searches]

## results = []

# for task in asyncio.as_completed(tasks):

# result = await task

if result is not None:

# results.append(result)

# return results

# async def _search(item: WebSearchItem) -> str | None:

"""

# å®é™…è´Ÿè´£è¿›è¡Œæœç´¢ï¼Œå¹¶å®Œæˆæ¯ä¸ªæœç´¢æ¡ç›®çš„çŸ­æ–‡æœ¬ç¼–å†™

"""

# try:

# result = await Runner.run(

search_agent,

# input=f"Search term: {item.query}\nReason for searching:

# {item.reason}"

)

# return str(result.final_output)

# except Exception:

# return None

# async def _write_report(query: str, search_results: List[str]) -> ReportData:

# """ æ ¹æ®æœç´¢çš„æ®µæ–‡æ¡£ï¼Œç¼–å†™é•¿æ–‡æœ¬

"""

# result = await Runner.run(

writer_agent,

input=f"Original query: {query}\nSummarized search results:

{search_results}",

)

# return result.final_output_as(ReportData)

# # MCPæœåŠ¡å™¨ä¸»å‡½æ•°

# @mcp.tool()

# async def deepresearch(query: str) -> ReportData:

"""

# å½“ç”¨æˆ·æ˜ç¡®è¡¨ç¤ºéœ€è¦å›´ç»•æŸä¸ªä¸»é¢˜è¿›è¡Œæ·±å…¥ç ”ç©¶æ—¶ï¼Œè¯·è°ƒæœ¬å‡½æ•°ã€‚ æœ¬å‡½æ•°èƒ½å¤Ÿå›´ç»•ç”¨æˆ·è¾“å…¥çš„é—®é¢˜è¿›è¡Œè”ç½‘æœç´¢å’Œæ·±å…¥ç ”ç©¶ï¼Œå¹¶åˆ›å»ºä¸€ç¯‡å†…å®¹å®Œæ•´çš„markdownæ ¼å¼çš„ç ”ç©¶

# æŠ¥å‘Šã€‚

# è¾“å…¥å‚æ•°query:ç”¨æˆ·æå‡ºçš„ç ”ç©¶ä¸»é¢˜ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºï¼› å‡½æ•°è¿”å›ç»“æœä¸ºä¸€ä¸ªmarkdownæ ¼å¼çš„å®Œæ•´çš„ç ”ç©¶æŠ¥å‘Šæ–‡æ¡£ã€‚

"""

# search_plan = await _plan_searches(query)

search_results = await _perform_searches(search_plan)

report = await _write_report(query, search_results)

# return report

# def main():

# parser = argparse.ArgumentParser(description="DeepResearch Server")

# parser.add_argument("--openai_api_key", type=str, required=True, help="ä½ çš„

# OpenAI API Key")

# args = parser.parse_args()

# åˆå§‹åŒ– external_client å’Œè®¾ç½®

external_client = AsyncOpenAI(

![Image](pdf_images\page255_img1.png)

## base_url = "https://ai.devtool.tech/proxy/v1",

## api_key = args.openai_api_key,

)

# set_default_openai_client(external_client)

# set_tracing_disabled(True)

# mcp.run(transport='stdio')

if __name__ == "__main__":

# main()

# å…¶ä¸­ä¸»è¦å†…å®¹å‡ä¸ºæ­¤å‰ä»‹ç»çš„ä¸‰ä¸ªAgentå’Œè°ƒåº¦å‡½æ•°ç»„çš„å†…å®¹ï¼Œè€Œæ•´ä¸ªMCPæœåŠ¡å™¨å¼€å‘æ ¸å¿ƒé‡‡ç”¨äº†

# fastmcpåº“è¿›è¡Œé«˜æ•ˆå¼€å‘ï¼š

# from mcp.server.fastmcp import FastMCP

# å€ŸåŠ©fastmcpï¼Œæˆ‘ä»¬ä»…éœ€åœ¨è„šæœ¬åˆå§‹åŒ–ä¸€ä¸ªMCPæœåŠ¡å™¨å¯¹è±¡ï¼Œ

# mcp = FastMCP("DeepResearch")

# ç„¶åä½¿ç”¨è£…é¥°å™¨ä¸ºå…¶æ·»åŠ ä¸€äº›å‡½æ•°

# # MCPæœåŠ¡å™¨ä¸»å‡½æ•°

# @mcp.tool()

# async def deepresearch(query: str) -> ReportData:

# ç„¶åå³å¯åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰åŠŸèƒ½çš„MCPæœåŠ¡å™¨ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€å•çš„å°†MCPæœåŠ¡å™¨ç†è§£ä¸ºåµŒå¥—åœ¨åŠŸèƒ½å‡½æ•°å¤–

# å±‚çš„ä¸€ä¸ªå¯¹è±¡ã€‚è€Œåœ¨å®é™…è¿è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä»…éœ€åœ¨ä¸»å‡½æ•°çš„å°¾éƒ¨åŠ ä¸Šï¼š

# mcp.run(transport='stdio')

å³å¯å®ŒæˆMCPæœåŠ¡å™¨è¿›ç¨‹çš„å¼€å¯ã€‚

# ä¸éš¾çœ‹å‡ºå€ŸåŠ©MCPé«˜çº§SDKå¼€å‘MCPæœåŠ¡å™¨çš„æµç¨‹å®é™…ä¸Šéå¸¸ç®€å•ï¼Œæ•´ä¸ªä»£ç ç¼–å†™è¿‡ç¨‹ä¸»è¦è¿˜æ˜¯éœ€

# è¦å†™æ¸…æ¥šåŠŸèƒ½å‡½æ•°çš„æ‰§è¡Œé€»è¾‘ã€‚

# æ›´å¤šMCP SDKè¯¦è§å®˜ç½‘ä»‹ç»ï¼šhttps://github.com/modelcontextprotocol/python-sdk

# è€Œparserç›¸å…³ä»£ç åˆ™æ˜¯è§„å®šåœ¨è°ƒç”¨è¯¥è„šæœ¬æ—¶éœ€è¦é€šè¿‡å‚æ•°è¾“å…¥æ¥è®¾ç½®OpenAIçš„API-KEYã€‚å…·ä½“è§£é‡Š

# å¦‚ä¸‹ï¼š

def main():

## å®šä¹‰ä¸€ä¸ªåä¸º main çš„å‡½æ•°ï¼Œä½œä¸ºç¨‹åºçš„ä¸»å…¥å£å‡½æ•°ã€‚

# parser = argparse.ArgumentParser(description="DeepResearch Server")

# ä½¿ç”¨ argparse æ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°è§£æå™¨ parser ã€‚

# description="DeepResearch Server" æ˜¯è¯¥ç¨‹åºçš„æè¿°ï¼Œç”¨äºå‘½ä»¤è¡Œä¸­å¸®åŠ©ä¿¡æ¯çš„å±•ç¤ºã€‚

# parser.add_argument("--openai_api_key", type=str, required=True, help="ä½ çš„

# OpenAI API Key")

# å®šä¹‰äº†ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•° --openai_api_key ï¼Œç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œå¿…é¡»æä¾›ï¼ˆ required=True ï¼‰ã€‚

help="ä½ çš„ OpenAI API Key" è¡¨ç¤ºå½“ç”¨æˆ·è¿è¡Œ python script.py --help æ—¶ï¼Œä¼šçœ‹åˆ°è¿™æ®µæ

# ç¤ºã€‚

# âœ… ç¤ºä¾‹è°ƒç”¨ï¼š

# python script.py --openai_api_key sk-xxxxx

# args = parser.parse_args()

# ä»å‘½ä»¤è¡Œè¯»å–å¹¶è§£æç”¨æˆ·è¾“å…¥çš„å‚æ•°ï¼Œå°†å…¶ä¿å­˜åˆ° args å˜é‡ä¸­ã€‚

# ç°åœ¨å¯ä»¥é€šè¿‡ args.openai_api_key è®¿é—®ç”¨æˆ·è¾“å…¥çš„ API keyã€‚

# external_client = AsyncOpenAI(

base_url = "https://ai.devtool.tech/proxy/v1",

api_key = args.openai_api_key,

)

# åˆ›å»ºä¸€ä¸ª OpenAI çš„å¼‚æ­¥å®¢æˆ·ç«¯å®ä¾‹ external_client ï¼Œè¿™ä¸ªå®¢æˆ·ç«¯ä½¿ç”¨äº†ä¸€ä¸ªä»£ç†æ¥å£

# https://ai.devtool.tech/proxy/v1 ã€‚

# ä½¿ç”¨äº†ç”¨æˆ·æä¾›çš„ openai_api_key ä½œä¸ºèº«ä»½éªŒè¯ã€‚

# set_default_openai_client(external_client)

# å°†åˆšåˆšåˆ›å»ºçš„ external_client è®¾ç½®ä¸ºå…¨å±€é»˜è®¤çš„ OpenAI å®¢æˆ·ç«¯ï¼Œåç»­ä»£ç è°ƒç”¨æ¨¡å‹æ¥å£æ—¶å°†

# è‡ªåŠ¨ä½¿ç”¨è¿™ä¸ªå®¢æˆ·ç«¯ã€‚

# é€šå¸¸ç”¨äºå°è£…åº“å†…éƒ¨ï¼ˆæ¯”å¦‚ Agent æ¡†æ¶ï¼‰ç»Ÿä¸€ä½¿ç”¨è¿™ä¸ªå®¢æˆ·ç«¯ã€‚

# set_tracing_disabled(True)

# ç¦ç”¨â€œè¿½è¸ªï¼ˆTracingï¼‰â€åŠŸèƒ½ï¼Œå¯èƒ½ç”¨äºé¿å…è®°å½•æ—¥å¿—æˆ–è¿½è¸ªæ“ä½œã€‚å…·ä½“æ˜¯å¦å½±å“åŠŸèƒ½å–å†³äºä½ ä½¿ç”¨

# çš„ SDK æˆ– Agent æ¡†æ¶ã€‚

# mcp.run(transport='stdio')

# å¯åŠ¨ MCPï¼ˆModel Context Protocolï¼‰æœåŠ¡å™¨ï¼Œé‡‡ç”¨ stdio ä½œä¸ºä¼ è¾“æ–¹å¼ã€‚

![Image](pdf_images\page257_img1.png)

![Image](pdf_images\page257_img2.png)

## stdio ä¼ è¾“æ–¹å¼é€šå¸¸ç”¨äºä¸ç»ˆç«¯äº¤äº’æˆ–è¢«å…¶ä»–è¿›ç¨‹é€šè¿‡æ ‡å‡†è¾“å…¥/è¾“å‡ºè°ƒç”¨ï¼ˆç±»ä¼¼ CLI å·¥å…·æˆ–åµŒå¥—

## è°ƒç”¨ï¼‰ã€‚

# è¿™æ®µ main å‡½æ•°çš„é€»è¾‘æ˜¯ï¼š

1. ä»å‘½ä»¤è¡Œä¸­è·å–ç”¨æˆ·è¾“å…¥çš„ OpenAI API Key ã€‚

2. æ„é€ ä¸€ä¸ªé€šè¿‡ä»£ç†åœ°å€è®¿é—® OpenAI çš„å¼‚æ­¥å®¢æˆ·ç«¯ã€‚

3. è®¾ç½®è¿™ä¸ªå®¢æˆ·ç«¯ä¸ºé»˜è®¤å®¢æˆ·ç«¯ï¼Œç¦ç”¨ tracingã€‚

4. ä»¥ stdio æ¨¡å¼å¯åŠ¨ MCP Server

# æ•´ä¸ªé¡¹ç›®çš„è„šæœ¬æ–‡ä»¶å¯ä»¥åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š

4. å€ŸåŠ©MCP Inspectorè¿›è¡ŒåŠŸèƒ½æµ‹è¯•

# åœ¨å®Œæˆäº†é¡¹ç›®çš„æºç å¼€å‘åï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨MCPå®˜æ–¹æä¾›çš„Inspectorå·¥å…·è¿›è¡ŒåŠŸèƒ½æµ‹è¯•äº†ã€‚

# Inspectoré¡¹ç›®åœ°å€ï¼šhttps://github.com/modelcontextprotocol/inspector

![Image](pdf_images\page258_img1.png)

![Image](pdf_images\page258_img2.png)

# è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå½“å‰MCPæœåŠ¡å™¨è„šæœ¬æ˜¯ä½¿ç”¨MCP SDKè¿›è¡Œçš„å¼€å‘ï¼Œå¹¶ä¸”MCPæœåŠ¡å™¨çš„æ ¸å¿ƒåŠŸèƒ½

# æ˜¯ä¸ºMCPå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œå› æ­¤å¦‚æœä¸é‡‡ç”¨å®˜æ–¹æä¾›çš„Inspectorè¿›è¡Œdebugï¼Œå°±éœ€è¦è‡ªå·±æ‰‹å†™ä¸€ä¸ªMCP

# clientå¹¶å°è¯•ä¸MCP serverè¿›è¡Œé€šä¿¡ï¼Œæ‰èƒ½è¿›è¡Œdebugã€‚

# æ¢è€Œè¨€ä¹‹å°±æ˜¯å®˜æ–¹æä¾›çš„Inspectorå®é™…ä¸Šæ˜¯ä¸€ä¸ªé€šç”¨çš„MCP Clientï¼Œèƒ½å¤Ÿæµ‹è¯•MCP serverå®é™…è¿è¡Œ

# æ•ˆæœã€‚å…·ä½“debugæµç¨‹å¦‚ä¸‹ï¼š

# Step 1.è¿è¡ŒMCPæœåŠ¡å™¨è„šæœ¬

# # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/mcp-server-deepresearch

# # è¿è¡ŒInspector

npx -y @modelcontextprotocol/inspector uv run

# ./src/mcp_server_deepresearch/server.py --openai_api_key YOUR_KEY

# æ³¨æ„æ­¤å¤„è¦è¾“å…¥OpenAI-API-KEY

# å¯åŠ¨å®Œæˆåèƒ½å¤Ÿçœ‹åˆ°ï¼Œæ­¤æ—¶æœåŠ¡å™¨ç«¯å£å·ä¸º6277ï¼Œè€ŒInspectorç«¯å£å·ä¸º6274ï¼Œå¦‚æœæ˜¯åœ¨æœ¬åœ°è¿è¡Œï¼Œåˆ™

# å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ localhost:6274 è¿›å…¥Inspectoré¡µé¢ï¼Œè€Œå¦‚æœæ˜¯åœ¨AutoDLä¸Šè¿è¡Œï¼Œåˆ™éœ€è¦ä½¿

ç”¨SSHéš§é“å·¥å…·ï¼Œå°†ä¸¤ä¸ªç«¯å£å·éƒ½æ˜ å°„åˆ°æœ¬åœ°ï¼š

![Image](pdf_images\page259_img1.png)

![Image](pdf_images\page259_img2.png)

# ç„¶åå†åœ¨ localhost:6274 è¿›å…¥Inspectoré¡µé¢ã€‚

# Step 2.è®¾ç½®Inspectorç›¸åº”æ—¶é—´

# é¦–æ¬¡è¿›å…¥Inspectoré¡µé¢æ—¶éœ€è¦è®¾ç½®å“åº”æ—¶é—´ï¼Œç”±äºå½“å‰å¤–éƒ¨å·¥å…·è¿è¡Œæ—¶é—´è¾ƒé•¿ï¼ŒInspectoré»˜è®¤åª

# ç»™å‡º10ç§’å“åº”çª—å£ï¼Œè¶…æ—¶æœªå“åº”åˆ™ä¼šæŠ¥é”™ï¼Œå› æ­¤è¿™é‡Œéœ€è¦åœ¨Configurationä¸­è¿›è¡Œå“åº”æ—¶é—´è®¾ç½®ï¼š

![Image](pdf_images\page260_img1.png)

![Image](pdf_images\page260_img2.png)

# ç„¶åç‚¹å‡»Connectå³å¯è¿æ¥MCP Serverã€‚

# è¶…æ—¶å“åº”æŠ¥é”™ç¤ºä¾‹ï¼š

# Step 4.åœ¨çº¿è¿è¡Œ

# å½“è¿æ¥ä¸ŠMCP Serverä¹‹åï¼Œæ¥ä¸‹æ¥ç‚¹å‡»Toolsã€å†ç‚¹å‡»List Toolsï¼Œé€‰æ‹©deepresearchå·¥å…·ï¼Œå¹¶åœ¨å³

# ä¾§è¾“å…¥é—®é¢˜ï¼Œä¾‹å¦‚ ä½ å¥½ï¼Œæˆ‘æƒ³æ·±å…¥äº†è§£ä¸‹åˆ°åº•ä»€ä¹ˆæ˜¯MCPï¼ˆModel Context Protocolï¼‰æŠ€æœ¯ ï¼Œæ¥ä¸‹æ¥MCP

# æœåŠ¡å™¨ä¼šå¼€å§‹è¿›è¡Œè¿è¡Œï¼š

![Image](pdf_images\page261_img1.png)

# è¿è¡Œåå³å¯å¾—åˆ°å®Œæ•´è°ƒç ”æŠ¥å‘Šç»“æœï¼š

# ç”±æ­¤å³å®Œæˆäº†å®Œæ•´çš„MCP Serverè„šæœ¬debugã€‚æ¥ä¸‹æ¥å³å¯è€ƒè™‘å°†é¡¹ç›®è¿›è¡Œéƒ¨ç½²ä¸Šçº¿äº†ã€‚

# ä¸‰ã€MCPæœåŠ¡å™¨éƒ¨ç½²æµç¨‹

å¯¹äºMCPæœåŠ¡å™¨æ¥è¯´ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯åœ¨çº¿å‘å¸ƒå’Œç¦»çº¿æ‹·è´è¿è¡Œã€‚

# MCPæœåŠ¡å™¨åœ¨çº¿å‘å¸ƒ

# æ‰€è°“åœ¨çº¿å‘å¸ƒï¼ŒæŒ‡çš„æ˜¯æˆ‘ä»¬å¯ä»¥å°†å¼€å‘å¥½çš„MCPæœåŠ¡å™¨æ‰“åŒ…ä¸Šä¼ åˆ°pypiå¹³å°æˆ–è€…npmå¹³å°è¿›è¡Œ

# äº‘å¹³å°æ‰˜ç®¡ï¼Œä¸€æ—¦ä¸Šä¼ æˆåŠŸï¼Œåç»­ç”¨æˆ·å³å¯ä½¿ç”¨uvxæˆ–è€…npxè¿›è¡Œä¸‹è½½å’Œä½¿ç”¨ã€‚æˆ‘ä»¬åœ¨ 3. MCPå·¥å…·

# æ ‡å‡†æ¥å…¥æµç¨‹ ä¸€èŠ‚ä¸­æ‰€ä»‹ç»çš„å„ä¸»æµMCPå®¢æˆ·ç«¯æ¥å…¥MCPå·¥å…·çš„æ ‡å‡†æµç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯å®æ—¶ä¸‹è½½

# MCPå·¥å…·ï¼Œç„¶ååœ¨æœ¬åœ°è¿›è¡Œè¿è¡Œã€‚è€Œå„å¤§MCPå·¥å…·å¹³å°ï¼Œå¦‚Smitheryï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯åœ¨pipyå¹³å°æˆ–è€…

# npmå¹³å°ä¸Šæ‰˜ç®¡çš„åº“åŸºç¡€ä¸Šè¿›è¡Œçš„è¿›ä¸€æ­¥ç»´æŠ¤ã€‚

# pipyï¼šhttps://pypi.org/

![Image](pdf_images\page262_img1.png)

![Image](pdf_images\page262_img2.png)

# npmï¼šhttps://www.npmjs.com/

# MCPæœåŠ¡å™¨ç¦»çº¿æ‹·è´è¿è¡Œ

è€Œæ‰€è°“çš„ç¦»çº¿éƒ¨ç½²è¿è¡Œï¼Œå°±å¥½ç†è§£çš„å¤šï¼ŒæŒ‡çš„æ˜¯å°†æ‰“åŒ…å¥½çš„åº“ç›´æ¥æ‹·è´åˆ°æœåŠ¡å™¨ä¸Šæˆ–è€…ç»™ä»–äºº è¿›è¡Œä½¿ç”¨ï¼Œæ²¡æœ‰åœ¨äº‘å¹³å°æ‰˜ç®¡çš„è¿™ä¸ªç¯èŠ‚ï¼Œé€‚åˆéå…¬å¼€MCPæœåŠ¡å™¨è¿›è¡Œéƒ¨ç½²ã€‚

# æ¥ä¸‹æ¥å›´ç»•æˆ‘ä»¬åˆ›å»ºçš„DeepResearch MCPæœåŠ¡å™¨ï¼Œè¯¦ç»†ä»‹ç»è¿™ä¸¤ç§éƒ¨ç½²æ–¹æ³•ã€‚

1. DeepResearché¡¹ç›®å®Œå–„

# å°½ç®¡æ­¤å‰æˆ‘ä»¬å·²ç»å®Œæˆäº†DeepResearché¡¹ç›®çš„æ ¸å¿ƒè„šæœ¬debugï¼Œä½†å…¶ä»ç„¶ä¸ç®—æ˜¯ä¸€ä¸ªç»“æ„å®Œæ•´çš„é¡¹

# ç›®ã€‚æ ¸å¿ƒè„šæœ¬çš„è°ƒç”¨å…³ç³»å¹¶ä¸æ˜ç¡®ï¼ŒåŒæ—¶é¡¹ç›®è¯´æ˜ä¹Ÿä¸å¤Ÿå®Œå–„ã€‚å› æ­¤è¿™é‡Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å…ˆå®Œå–„é¡¹ç›®çš„ä¸»

# ä½“å†…å®¹ï¼Œå†è€ƒè™‘è¿›è¡Œéƒ¨ç½²æˆ–ä¸Šçº¿å‘å¸ƒã€‚

# 1.1 src layouté¡¹ç›®ç»“æ„

# å…¶å®åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å°†ä»£ç éƒ½æ”¾åœ¨srcå†…çš„æŸä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œè¿™ç§é¡¹ç›®ç»“æ„ä¹Ÿè¢«ç§°ä½œsrc layouté¡¹ç›®ç»“

# æ„ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸é€šç”¨ã€åŒæ—¶ä¹Ÿä¾¿äºä»£ç ç»´æŠ¤çš„é¡¹ç›®ç»“æ„ï¼ŒåŸºæœ¬ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![Image](pdf_images\page263_img1.png)

![Image](pdf_images\page263_img2.png)

## your-project/ â”œâ”€â”€ src/ â† âœ… æ‰€æœ‰ä¸šåŠ¡ä»£ç éƒ½é›†ä¸­åœ¨è¿™é‡Œ â”‚ â””â”€â”€ your_package/ â† Python åŒ…çš„å®é™…å†…å®¹ï¼ˆå« __init__.pyï¼‰

# â”œâ”€â”€ dist/ â† æ„å»ºåçš„åˆ†å‘åŒ…ï¼ˆå¦‚ wheelï¼‰

# â”œâ”€â”€ .venv/ â† è™šæ‹Ÿç¯å¢ƒï¼ˆæœ¬åœ°ä¾èµ–éš”ç¦»ï¼‰

# â”œâ”€â”€ .git/ â† Git ç®¡ç† â”œâ”€â”€ pyproject.toml â† é¡¹ç›®é…ç½®

# â”œâ”€â”€ README.md â† è¯´æ˜æ–‡ä»¶

# â”œâ”€â”€ .python-version â† Pythonç‰ˆæœ¬å£°æ˜ â”œâ”€â”€ .gitignore â† Git å¿½ç•¥è§„åˆ™

# â””â”€â”€ uv.lock â† uv çš„ä¾èµ–é”æ–‡ä»¶

# æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨ src/mcp_server_deepresearch ä¸­åˆ›å»ºä¸¤ä¸ªpyè„šæœ¬ï¼Œå…¶ä¸€æ˜¯ __init__.py ï¼Œä½¿å½“

# å‰æ–‡ä»¶å¤¹å¯ä»¥ä½œä¸ºPythonçš„ä¸€ä¸ªåº“è¿›è¡Œå¯¼å…¥ï¼Œéœ€è¦åœ¨ __init__.py å†™å…¥å¦‚ä¸‹ä»£ç ï¼š

# from .server import main

# åŒæ—¶å†åˆ›å»ºä¸€ä¸ª __main__.py ï¼Œç”¨äºå®é™…æ‰§è¡Œä¸»å‡½æ•°è°ƒç”¨æµç¨‹ï¼š

# from mcp_server_deepresearch import main

# main()

# æœ€ç»ˆ src/mcp_server_deepresearch ä¸­ä»£ç æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š

# æ•´ä¸ªé¡¹ç›®çš„è„šæœ¬æ–‡ä»¶å¯ä»¥åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š

![Image](pdf_images\page264_img1.png)

# 1.2 ä¿®æ”¹pyproject.toml

# åˆ›å»ºå®ŒåŸºæœ¬é¡¹ç›®ç»“æ„åï¼Œè®©æˆ‘ä»¬å›åˆ°å½“å‰é¡¹ç›®ä¸»ç›®å½•ä¸‹ï¼Œåˆ é™¤ main.py ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œç„¶åä¿®æ”¹

# é¡¹ç›®é…ç½®æ–‡ä»¶ pyproject.toml :

# [build-system]

requires = ["setuptools>=61.0", "wheel"]

# build-backend = "setuptools.build_meta"

# [project]

name = "mcp-server-deepresearch"

version = "0.1.2" description = "å®ç°ç±»deepresearchåŠŸèƒ½çš„MCPå·¥å…·"

readme = "README.md"

# requires-python = ">=3.10"

dependencies = [

"asyncio>=3.4.3",

"mcp>=1.6.0",

"openai>=1.75.0",

"openai-agents>=0.0.12",

"pydantic>=2.11.3",

"typing>=3.10.0.0",

]

# [project.scripts]

# mcp-server-deepresearch = "mcp_server_deepresearch:main"

# [tool.setuptools]

package-dir = {"" = "src"}

# [tool.setuptools.packages.find]

where = ["src"]

# å…·ä½“é…ç½®è§£é‡Šå¦‚ä¸‹ï¼š

# [build-system] æ®µ

# [build-system]

requires = ["setuptools>=61.0", "wheel"]

# build-backend = "setuptools.build_meta"

å‘Šè¯‰ Python æ„å»ºå·¥å…·ï¼ˆå¦‚ pip , uv , build ï¼‰ï¼š

## è¦ä½¿ç”¨ setuptools æ¥æ„å»ºé¡¹ç›®

## åŒæ—¶ä¾èµ– wheel ï¼Œå› ä¸ºä½ è¦æ„å»º .whl åŒ…

# [project] æ®µ

# [project]

name = "mcp-server-deepresearch"

version = "0.1.2"

description = "å®ç°ç±»deepresearchåŠŸèƒ½çš„MCPå·¥å…·"

readme = "README.md"

# requires-python = ">=3.10"

dependencies = [

"asyncio>=3.4.3",

"mcp>=1.6.0",

"openai>=1.75.0",

"openai-agents>=0.0.12",

"pydantic>=2.11.3",

"typing>=3.10.0.0",

]

# å®šä¹‰é¡¹ç›®çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ï¼š

# é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€æè¿°

# Python æœ€ä½ç‰ˆæœ¬è¦æ±‚

# è‡ªåŠ¨å®‰è£…çš„ä¾èµ–é¡¹ï¼ˆç›¸å½“äº requirements.txt ï¼‰

# [project.scripts] ï¼šå‘½ä»¤è¡Œå…¥å£

# [project.scripts]

# mcp-server-deepresearch = "mcp_server_deepresearch:main"

# å®šä¹‰ä¸€ä¸ªå¯æ‰§è¡Œå‘½ä»¤è¡Œè„šæœ¬ï¼Œç­‰ä»·äºåœ¨ç»ˆç«¯ä¸­ç›´æ¥è¿è¡Œï¼š

# mcp-server-deepresearch --openai_api_key=...

# å®ƒä¼šè‡ªåŠ¨è°ƒç”¨ä½ åŒ…å†…çš„ï¼š

# mcp_server_deepresearch/main.py é‡Œçš„ main() å‡½æ•°

# ä¹Ÿæ”¯æŒï¼š

# mcp_server_deepresearch/__init__.py ä¸­çš„ main() å‡½æ•°

# åªè¦æ˜¯ main() å‡½æ•°å³å¯ã€‚

# [tool.setuptools]

package-dir = {"" = "src"}

# [tool.setuptools.packages.find]

where = ["src"]

![Image](pdf_images\page266_img1.png)

![Image](pdf_images\page266_img2.png)

## æ˜ç¡®å‘Šè¯‰ setuptoolsï¼š

# ä½ çš„é¡¹ç›®æºä»£ç éƒ½åœ¨ src/ ç›®å½•ä¸‹

# è¯·å» src/ ä¸­æŸ¥æ‰¾ Python åŒ…ï¼ˆå³åŒ…å« __init__.py çš„ç›®å½•ï¼‰

# åŒºå—

# ä½œç”¨

# è¯„ä»·

# [build-system]

# å‘Šè¯‰æ„å»ºå·¥å…·å¦‚ä½•æ„

# å»ºé¡¹ç›®

# âœ… éå¸¸è§„èŒƒ

# [project]

# å®šä¹‰é¡¹ç›®åŸºæœ¬ä¿¡æ¯å’Œ

# ä¾èµ–

âœ… å¯ä»¥åˆ æ‰ asyncio å’Œ typing

# [project.scripts]

# å®šä¹‰å‘½ä»¤è¡Œå·¥å…·

# âœ… å¯ç›´æ¥ç”¨ mcp-server-deepresearch å‘½ä»¤è¿è¡Œ

# [tool.setuptools]

# æŒ‡å®šæºç ä½ç½®

# âœ… ä¸ src layout å®Œç¾é…åˆ

# ç„¶åå¯¹æ•´ä¸ªé¡¹ç›®è¿›è¡Œæ‰“åŒ…ã€‚é¦–å…ˆéœ€è¦å®‰è£…æ‰“åŒ…ï¼ˆå’Œä¸Šä¼ ï¼‰å·¥å…·ï¼š

uv pip install build twine

# ç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ‰“åŒ…ï¼š

# # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/mcp-server-deepresearch

# # æ‰“åŒ…

# python -m build

# æ‰“åŒ…å®Œæˆåä¼šåœ¨ä¸»ç›®å½•ä¸‹æ–°å¢ä¸€ä¸ªdistæ–‡ä»¶å¤¹ï¼š

![Image](pdf_images\page267_img1.png)

![Image](pdf_images\page267_img2.png)

# ä»¥åŠåœ¨srcç›®å½•ä¸‹ä¼šåˆ›å»ºä¸€ä¸ª.egg-infoæ–‡ä»¶å¤¹ï¼Œ

# è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹å†…å®¹è§£é‡Šå¦‚ä¸‹ï¼š

# dist/ æ–‡ä»¶å¤¹ï¼šæ‰“åŒ…äº§ç‰©ç›®å½•ï¼Œä¼šåœ¨ åŒ…å«å¦‚ä¸‹æ–‡ä»¶ï¼š

# æ–‡ä»¶ç±»å‹

# è¯´æ˜

.whl æ–‡ä»¶

# Python wheel æ ¼å¼çš„äºŒè¿›åˆ¶åˆ†å‘åŒ…ï¼Œæœ€å¸¸ç”¨

.tar.gz æ–‡ä»¶

# æºä»£ç åŒ…ï¼ˆsource distributionï¼‰

# è€Œåœ¨ç¦»çº¿éƒ¨ç½²æ—¶å€™ï¼Œåˆ«äººå®‰è£…æ—¶åªè¦ pip install xxx.whl å°±å¯ä»¥äº†ï¼ˆæ— éœ€æºç ï¼‰ï¼ŒåŒæ—¶ä¸Šä¼ åˆ°

# PyPIã€å†…ç½‘ PyPIã€AI æ¨¡å‹å¹³å°ç­‰åœ°æ–¹éƒ¨ç½²ã€‚

<project-name>.egg-info/ æ–‡ä»¶å¤¹ï¼šå…ƒæ•°æ®æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ˜¯ setuptools åœ¨æ„å»ºæˆ–æ‰“åŒ…æ—¶ç”Ÿæˆ

# çš„ä¸€ä¸ªâ€œé¡¹ç›®å…ƒä¿¡æ¯ç›®å½•â€ã€‚æ¯”å¦‚ä¼šçœ‹åˆ°è¿™æ ·çš„ç»“æ„ï¼š

# mcp_server_deepresearch.egg-info/

# â”œâ”€â”€ PKG-INFO

# â”œâ”€â”€ SOURCES.txt

# â”œâ”€â”€ top_level.txt

# â”œâ”€â”€ dependency_links.txt

# â”œâ”€â”€ requires.txt

# PKG-INFO ï¼šä½ é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€ä¾èµ–ç­‰ï¼‰ï¼Œ requires.txt ï¼šåˆ—å‡ºä¾èµ–é¡¹ï¼Œ

# SOURCES.txt ï¼šåˆ—å‡ºæ‰€æœ‰æ‰“åŒ…è¿› .whl çš„æ–‡ä»¶ï¼Œ top_level.txt ï¼šé¡¶å±‚åŒ…åï¼ˆæ¯”å¦‚

# mcp_server_deepresearch ï¼‰ã€‚

![Image](pdf_images\page268_img1.png)

![Image](pdf_images\page268_img2.png)

![Image](pdf_images\page268_img3.png)

## 2. é¡¹ç›®ç¦»çº¿æ‹·è´

# æ¥ä¸‹æ¥ç»§ç»­ä»‹ç»ç¦»çº¿æ‹·è´æµç¨‹ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨éœ€è¦ä»æœåŠ¡å™¨Aä¸ŠæŠŠé¡¹ç›®æ‹·è´åˆ°æœåŠ¡å™¨Bä¸Šï¼Œæœ€ç®€å•çš„

æ–¹æ³•é¦–å…ˆæ˜¯åœ¨æœåŠ¡å™¨Aä¸Šè¿›è¡Œé¡¹ç›®å‹ç¼©ï¼š

# # å›åˆ°ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/mcp-server-deepresearch

# tar --exclude='.venv' -czvf mcp-server-deepresearch.tar.gz *

# å‹ç¼©åä¼šåˆ›å»ºä¸€ä¸ªåä¸ºmcp-server-deepresearch.tar.gzçš„æ–‡ä»¶ï¼š

# å°†å…¶ä¸‹è½½åå³å¯ä¸Šä¼ åˆ°æœåŠ¡å™¨Bä¸Šï¼Œä¾‹å¦‚å°†å…¶ä¸Šä¼ åˆ°BæœåŠ¡å™¨çš„ /root/autodl-tmp/MCP/MCP-Test è·¯å¾„

# ä¸‹ï¼š

# ç„¶åå³å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œè§£å‹ç¼©ï¼š

# tar -xzvf mcp-server-deepresearch.tar.gz

# ç„¶åå³å¯æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶ç›¸å…³ä¾èµ–ï¼š

![Image](pdf_images\page269_img1.png)

![Image](pdf_images\page269_img2.png)

![Image](pdf_images\page269_img3.png)

## # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

## uv venv

# # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

# source .venv/bin/activate

# # ä½¿ç”¨uvï¼ˆæ¨èï¼‰æˆ–pipå®‰è£…

# uv pip install .

# ç„¶åå³å¯è¿è¡ŒInspectorè¿›è¡Œæµ‹è¯•ï¼š

# # è¿è¡ŒInspector

npx -y @modelcontextprotocol/inspector uv run

# ./src/mcp_server_deepresearch/server.py --openai_api_key YOUR_KEY

# å®Œæ•´é¡¹ç›®å‹ç¼©åŒ…åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š

![Image](pdf_images\page270_img1.png)

![Image](pdf_images\page270_img2.png)

![Image](pdf_images\page270_img3.png)

3. é¡¹ç›®å‘å¸ƒåˆ°pipyå¹³å°

# é™¤äº†ç¦»çº¿æ‹·è´ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠè‡ªå·±å¼€å‘å®Œæˆçš„MCP Serverå‘å¸ƒåˆ°ä¸€äº›æ‰˜ç®¡å¹³å°ä¸Šæ–¹ä¾¿å…¶ä»–äººä¸‹

# è½½ä½¿ç”¨ï¼Œå¦‚æœæ˜¯jså¼€å‘çš„MCP Serverå¯ä»¥å‘å¸ƒåœ¨npmå¹³å°ä¸Šï¼Œè€Œå¦‚æœæ˜¯Pythoné¡¹ç›®ï¼Œåˆ™å¯ä»¥å‘å¸ƒåœ¨pypi

# ä¸Šã€‚æˆ‘ä»¬è¿™é‡Œä»¥pypiå‘å¸ƒæµç¨‹ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºã€‚é¦–å…ˆéœ€è¦å…ˆåœ¨pypiï¼šhttps://pypi.org/ä¸Šè¿›è¡Œè´¦å·æ³¨å†Œï¼Œç„¶

åè·å–API-KEYä½œä¸ºèº«ä»½éªŒè¯ï¼Œ

# ç„¶åéœ€è¦å†æ¬¡ç¡®è®¤æ‰“åŒ…å®Œæˆï¼Œå¹¶å¼€å¯ä¸Šä¼ 

![Image](pdf_images\page271_img1.png)

![Image](pdf_images\page271_img2.png)

![Image](pdf_images\page271_img3.png)

## # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

## # cd /root/autodl-tmp/MCP/mcp-server-deepresearch

# # è‹¥æ­¤å‰æ‰“åŒ…å®Œæˆï¼Œåˆ™æ— éœ€å†æ¬¡æ‰“åŒ…

# # python -m build

# # ä¸Šä¼ åˆ°pypiå¹³å°

# python -m twine upload dist/*

# ä¸Šä¼ å®Œæˆåå³å¯åœ¨pypiä¸­æœç´¢åˆ°åŒ…çš„ä¿¡æ¯ï¼š

# ç„¶åå³å¯åœ¨æœ¬åœ°æµ‹è¯•è°ƒç”¨ã€‚

# è¿™é‡Œä»¥Cherry studioä¸ºä¾‹ï¼Œå°è¯•è°ƒç”¨æˆ‘ä»¬åˆšåˆšå‘å¸ƒçš„DeepResearchåŒ…ã€‚ç‚¹å‡»æ·»åŠ æœåŠ¡å™¨ï¼š

![Image](pdf_images\page272_img1.png)

![Image](pdf_images\page272_img2.png)

# ç„¶åè¾“å…¥MCPæœåŠ¡å™¨åç§°ï¼ˆéšæ„å¡«å†™ï¼‰ï¼Œç„¶åä½¿ç”¨uvxè¿›è¡Œä¸‹è½½ï¼ŒåŒæ—¶æ˜¯stdioé€šä¿¡æ ‡å‡†ï¼Œå¹¶åœ¨å‚æ•°ä¸­è¾“

# å…¥ä»¥ä¸‹ä¸‰è¡Œï¼š

# mcp-server-deepresearch

# --openai_api_key

# YOUR_API_KEY

![Image](pdf_images\page273_img1.png)

![Image](pdf_images\page273_img2.png)

# ç„¶åç‚¹å‡»å³ä¸Šæ–¹ä¿å­˜ï¼Œå³å¯å¼€å¯éªŒè¯å¹¶è‡ªåŠ¨å¼€å¯è¿™é¡¹MCPå·¥å…·ã€‚ç´§æ¥ç€åœ¨å¯¹è¯è¿‡ç¨‹ä¸­é€‰æ‹©deepresearch

# å·¥å…·ï¼Œåªè¦å¯¹è¯ä¸­æ˜ç¡®è¡¨è¾¾äº†å¸Œæœ›å›´ç»•æŸä¸ªé—®é¢˜è¿›è¡Œæ·±å…¥ç ”ç©¶ï¼Œæ¨¡å‹å°±ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥MCPå·¥å…·è¿›è¡Œæ·±åº¦

# è°ƒç ”ï¼š

# å®é™…æ¼”ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

# æ³¨ï¼Œå¦‚æœæ˜¯ç¦»çº¿æ‹·è´çš„é¡¹ç›®å¸Œæœ›ä½¿ç”¨cherry studioè¿›è¡Œè°ƒç”¨ï¼Œä»…éœ€åœ¨é…ç½®ä¸­å†™å…¥ï¼š

# /path/to/your/mcp-server-deepresearch

# --openai_api_key

# YOUR_API_KEY

# ä¹Ÿå°±æ˜¯ç¬¬ä¸€è¡Œæ”¹ä¸ºç¦»çº¿é¡¹ç›®çš„æœ¬åœ°å­˜å‚¨åœ°å€å³å¯ã€‚

# æ­¤å¤–ï¼Œè‹¥æ˜¯åœ¨Cursorä¸­è°ƒç”¨ï¼Œåˆ™å¯ä»¥å†™å…¥å¦‚ä¸‹é…ç½®ï¼š

{

# "mcpServers": {

# "deepresearch": {

"command": "uvx",

# "args": [

"mcp-server-deepresearch",

"--openai_api_key",

"OPENAI_API_KEY"

]

}

}

# å››ã€åŸºäºSSEä¼ è¾“æ–¹å¼çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

# ä»¥ä¸ŠMCPæœåŠ¡å™¨éƒ½æ˜¯stdioä¼ è¾“æ–¹å¼ï¼Œè€Œé™¤æ­¤ä¹‹å¤–ï¼Œç›®å‰MCPæœåŠ¡å™¨è¿˜æ”¯æŒSSEä¼ è¾“å’ŒåŸºäºHTTPçš„æµ

# å¼ä¼ è¾“ã€‚è¿™ä¸¤ç§ä¼ è¾“æ–¹å¼ä¹Ÿæœ‰éå¸¸å¹¿æ³›çš„å®é™…ç”¨é€”ï¼Œæ¥ä¸‹æ¥è¯¦ç»†ä»‹ç»å¦‚ä½•æ„å»ºåŸºäºSSEå’ŒHTTPæµå¼ä¼ è¾“

çš„MCPæœåŠ¡å™¨ã€‚

![Image](pdf_images\page275_img1.png)

## 1. stdioã€SSEä¸åŸºäºHTTPçš„æµå¼ä¼ è¾“å½¢å¼å¯¹æ¯”

# 1.1 MCPé€šä¿¡åè®®ä»‹ç»

# MCPï¼ˆModel Context Protocolï¼‰æ˜¯ä¸€ç§ä¸ºäº†ç»Ÿä¸€å¤§è§„æ¨¡æ¨¡å‹å’Œå·¥å…·é—´é€šä¿¡è€Œè®¾è®¡çš„åè®®ï¼Œå®ƒå®šä¹‰

# äº†æ¶ˆæ¯æ ¼å¼å’Œé€šä¿¡æ–¹å¼ã€‚MCP åè®®æ”¯æŒå¤šç§ä¼ è¾“æœºåˆ¶ï¼Œå…¶ä¸­åŒ…æ‹¬ stdio ã€Server-Sent Events

# ï¼ˆSSEï¼‰ å’Œ Streamable HTTPã€‚æ¯ç§é€šä¿¡æ–¹æ³•åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸­å…·æœ‰ä¸åŒçš„ä¼˜åŠ£åŠ¿ï¼Œé€‚ç”¨äºä¸åŒçš„éœ€

# æ±‚ã€‚

# 1.2 Stdio ä¼ è¾“ï¼ˆStandard Input/Outputï¼‰

# stdio ä¼ è¾“æ–¹å¼æ˜¯æœ€ç®€å•çš„é€šä¿¡æ–¹å¼ï¼Œé€šå¸¸åœ¨æœ¬åœ°å·¥å…·ä¹‹é—´è¿›è¡Œæ¶ˆæ¯ä¼ é€’æ—¶ä½¿ç”¨ã€‚å®ƒåˆ©ç”¨æ ‡å‡†è¾“å…¥

# è¾“å‡ºï¼ˆstdin/stdoutï¼‰ä½œä¸ºæ•°æ®ä¼ è¾“é€šé“ï¼Œé€‚ç”¨äºæœ¬åœ°è¿›ç¨‹é—´çš„äº¤äº’ã€‚

# å·¥ä½œæ–¹å¼ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨é€šè¿‡æ ‡å‡†è¾“å…¥è¾“å‡ºæµï¼ˆstdin/stdoutï¼‰è¿›è¡Œé€šä¿¡ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€

# å‘½ä»¤å’Œæ•°æ®ï¼ŒæœåŠ¡å™¨æ‰§è¡Œå¹¶é€šè¿‡æ ‡å‡†è¾“å‡ºè¿”å›ç»“æœã€‚

# åº”ç”¨åœºæ™¯ï¼šé€‚ç”¨äºæœ¬åœ°å¼€å‘ã€å‘½ä»¤è¡Œå·¥å…·ã€è°ƒè¯•ç¯å¢ƒï¼Œæˆ–è€…æ¨¡å‹å’Œå·¥å…·æœåŠ¡åœ¨åŒä¸€è¿›ç¨‹å†…è¿è¡Œçš„æƒ…

# å†µã€‚

# 1.3 Server-Sent Eventsï¼ˆSSEï¼‰

# SSE æ˜¯åŸºäº HTTP åè®®çš„æµå¼ä¼ è¾“æœºåˆ¶ï¼Œå®ƒå…è®¸æœåŠ¡å™¨é€šè¿‡ HTTP å•å‘æ¨é€äº‹ä»¶åˆ°å®¢æˆ·ç«¯ã€‚SSE é€‚ç”¨

# äºå®¢æˆ·ç«¯éœ€è¦æ¥æ”¶æœåŠ¡å™¨æ¨é€çš„åœºæ™¯ï¼Œé€šå¸¸ç”¨äºå®æ—¶æ•°æ®æ›´æ–°ã€‚

# å·¥ä½œæ–¹å¼ï¼šå®¢æˆ·ç«¯é€šè¿‡ HTTP GET è¯·æ±‚å»ºç«‹ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼ŒæœåŠ¡å™¨ä»¥æµå¼æ–¹å¼æŒç»­å‘å®¢æˆ·ç«¯å‘é€

# æ•°æ®ï¼Œå®¢æˆ·ç«¯é€šè¿‡è§£ææµæ•°æ®æ¥è·å–å®æ—¶ä¿¡æ¯ã€‚

# åº”ç”¨åœºæ™¯ï¼šé€‚ç”¨äºéœ€è¦æœåŠ¡å™¨ä¸»åŠ¨æ¨é€æ•°æ®çš„åœºæ™¯ï¼Œå¦‚å®æ—¶èŠå¤©ã€å¤©æ°”é¢„æŠ¥ã€æ–°é—»æ›´æ–°ç­‰ã€‚

# 1.4 Streamable HTTP

# MCPæ›´æ–°å…¬å‘Šï¼šhttps://modelcontextprotocol.io/development/updates

# Streamable HTTPåè®®å†…å®¹ï¼šhttps://github.com/modelcontextprotocol/modelcontextprotoco

# l/blob/main/docs/specification/2025-03-26/basic/transports.mdx#streamable-http

![Image](pdf_images\page276_img1.png)

# Streamable HTTP æ˜¯ MCP åè®®ä¸­æ–°å¼•å…¥çš„ä¸€ç§ä¼ è¾“æ–¹å¼ï¼Œå®ƒåŸºäº HTTP åè®®æ”¯æŒåŒå‘æµå¼ä¼ è¾“ã€‚

# ä¸ä¼ ç»Ÿçš„ HTTP è¯·æ±‚å“åº”æ¨¡å‹ä¸åŒï¼ŒStreamable HTTP å…è®¸æœåŠ¡å™¨åœ¨ä¸€ä¸ªé•¿è¿æ¥ä¸­å®æ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•° æ®ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒå¤šä¸ªè¯·æ±‚å’Œå“åº”çš„æµå¼ä¼ è¾“ã€‚

# ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMCPåªæä¾›äº†Streamable HTTPåè®®å±‚çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è§„èŒƒäº†MCPå®¢æˆ·ç«¯åœ¨ä½¿

# ç”¨Streamable HTTPé€šä¿¡æ—¶çš„é€šä¿¡è§„åˆ™ï¼Œè€Œå¹¶æ²¡æœ‰æä¾›ç›¸å…³çš„SDKå®¢æˆ·ç«¯ã€‚å¼€å‘è€…åœ¨å¼€å‘Streamable

# HTTPæœºåˆ¶ä¸‹çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¯”å¦‚Python httpxåº“è¿›è¡Œå¼€å‘ã€‚

# å·¥ä½œæ–¹å¼ï¼šå®¢æˆ·ç«¯é€šè¿‡ HTTP POST å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶å¯ä»¥æ¥æ”¶æµå¼å“åº”ï¼ˆå¦‚ JSON-RPC å“åº”

# æˆ– SSE æµï¼‰ã€‚å½“è¯·æ±‚æ•°æ®è¾ƒå¤šæˆ–éœ€è¦å¤šæ¬¡äº¤äº’æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡é•¿è¿æ¥å’Œåˆ†æ‰¹æ¨é€çš„æ–¹å¼è¿›è¡Œæ•°

# æ®ä¼ è¾“ã€‚

# åº”ç”¨åœºæ™¯ï¼šé€‚ç”¨äºéœ€è¦æ”¯æŒé«˜å¹¶å‘ã€ä½å»¶è¿Ÿé€šä¿¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯è·¨æœåŠ¡æˆ–è·¨ç½‘ç»œçš„åº”ç”¨ã€‚é€‚

# åˆé«˜å¹¶å‘çš„åœºæ™¯ï¼Œå¦‚å®æ—¶æµåª’ä½“ã€åœ¨çº¿æ¸¸æˆã€é‡‘èäº¤æ˜“ç³»ç»Ÿç­‰ã€‚

# 1.1.4 MCP ä¼ è¾“æ–¹å¼ä¼˜åŠ£åŠ¿å¯¹æ¯”

# ç‰¹æ€§

# Stdio

# SSE

# Streamable HTTP

# é€šä¿¡æ–¹å‘

# åŒå‘ï¼ˆä½†ä»…é™æœ¬

# åœ°ï¼‰

# å•å‘ï¼ˆæœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯ï¼‰

# åŒå‘ï¼ˆé€‚ç”¨äºå¤æ‚äº¤äº’ï¼‰

# ä½¿ç”¨åœºæ™¯

# æœ¬åœ°è¿›ç¨‹é—´é€šä¿¡

# å®æ—¶æ•°æ®æ¨é€ï¼Œæµè§ˆå™¨æ”¯

# æŒ

# è·¨æœåŠ¡ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€å¤§è§„

# æ¨¡å¹¶å‘æ”¯æŒ

# æ”¯æŒå¹¶å‘

# è¿æ¥æ•°

# ä½

# ä¸­ç­‰

# é«˜ï¼ˆé€‚åˆå¤§è§„æ¨¡å¹¶å‘ï¼‰

# é€‚åº”æ€§

# å±€é™äºæœ¬åœ°ç¯å¢ƒ

# æ”¯æŒæµè§ˆå™¨ï¼Œä½†å•å‘é€šä¿¡

# é«˜çµæ´»æ€§ï¼Œæ”¯æŒæµå¼æ•°æ®ä¸

# è¯·æ±‚æ‰¹å¤„ç†

# å®ç°éš¾åº¦

# ç®€å•ï¼Œé€‚åˆæœ¬åœ°è°ƒ

# è¯•

# ç®€å•ï¼Œä½†æµè§ˆå™¨å…¼å®¹æ€§å’Œ

# é•¿è¿æ¥é™åˆ¶

# å¤æ‚ï¼Œéœ€å¤„ç†é•¿è¿æ¥å’Œæµç®¡

# ç†

# é€‚åˆçš„ä¸š

# æœ¬åœ°å‘½ä»¤è¡Œå·¥å…·ï¼Œ

# å®æ—¶æ¨é€ï¼Œæ–°é—»ã€è‚¡ç¥¨ç­‰

# é«˜å¹¶å‘ã€åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®æ—¶

# åŠ¡ç±»å‹

# è°ƒè¯•ç¯å¢ƒ

# å®æ—¶æ›´æ–°

# äº¤äº’ç³»ç»Ÿ

# ä¸‰ç§ä¼ è¾“æ–¹å¼æ€»ç»“å¦‚ä¸‹ï¼š

Stdio ä¼ è¾“ï¼šé€‚åˆæœ¬åœ°è¿›ç¨‹ä¹‹é—´çš„ç®€å•é€šä¿¡ï¼Œé€‚åˆå‘½ä»¤è¡Œå·¥å…·æˆ–è°ƒè¯•é˜¶æ®µï¼Œä½†ä¸æ”¯æŒåˆ†å¸ƒå¼ã€‚

![Image](pdf_images\page277_img1.png)

## SSE ä¼ è¾“ï¼šé€‚åˆå®æ—¶æ¨é€å’Œå®¢æˆ·ç«¯/æµè§ˆå™¨çš„å•å‘é€šçŸ¥ï¼Œä½†æ— æ³•æ»¡è¶³åŒå‘å¤æ‚äº¤äº’éœ€æ±‚ã€‚

## Streamable HTTP ä¼ è¾“ï¼šæœ€çµæ´»ã€æœ€å¼ºå¤§çš„é€‰é¡¹ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡å¹¶å‘ã€é«˜åº¦äº¤äº’çš„åˆ†å¸ƒå¼åº”ç”¨ç³»

# ç»Ÿï¼Œè™½ç„¶å®ç°è¾ƒå¤æ‚ï¼Œä½†èƒ½å¤Ÿå¤„ç†æ›´å¤æ‚çš„åœºæ™¯ã€‚

2. åŸºäºSSEä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

# éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›®å‰MCP SDKåªæä¾›äº†stdioå’ŒSSEä¸¤ç§ä¼ è¾“æ–¹å¼çš„å¼€å‘åº“ï¼Œè€Œæš‚æ—¶è¿˜æ²¡æœ‰æä¾›åŸºäº æµå¼HTTPä¼ è¾“çš„å¼€å‘å·¥å…·ã€‚å› æ­¤åœ¨è¿›è¡ŒMCPå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå®ç°stdioå’ŒSSEä¼ è¾“æ–¹å¼è¾ƒä¸ºç®€å•ï¼Œä½†è¦å®ç°

æµå¼ä¼ è¾“çš„HTTPæµç¨‹åˆ™ä¼šéå¸¸å¤æ‚ã€‚

# è¿™é‡Œæˆ‘ä»¬å…ˆä»‹ç»ç›¸å¯¹ç®€å•çš„SSEä¼ è¾“æ–¹å¼çš„å®ç°æ–¹æ³•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨MCP Python SDKå¼€å‘MCPæœåŠ¡å™¨

# æ—¶ï¼Œåªéœ€è¦åœ¨æ­¤å¤„è¿›è¡Œè®¾ç½®ï¼š

# mcp.run(transport='sse')

å³å¯è®©MCPæœåŠ¡å™¨å¼€å¯SSEæ¨¡å¼ï¼Œéå¸¸ç®€å•ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥åˆ›å»ºä¸€ä¸ªæŸ¥è¯¢å¤©æ°”MCPæœåŠ¡å™¨ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºã€‚

# åˆ›å»ºé¡¹ç›®ä¸»ç›®å½•

# cd /root/autodl-tmp/MCP

# mkdir ./MCP-sse-test

# cd ./MCP-sse-test

# åˆ›å»ºåŸºç¡€é¡¹ç›®ç»“æ„

# uv init mcp-get-weather

# cd mcp-get-weather

# # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

# uv venv

# # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

# source .venv/bin/activate

uv add mcp httpx

# ç„¶ååˆ é™¤ä¸»ç›®å½•ä¸‹çš„main.pyæ–‡ä»¶ï¼Œå¹¶åˆ›å»ºä»£ç æ–‡ä»¶å¤¹ï¼š

mkdir -p ./src/mcp_get_weather

# cd ./src/mcp_get_weather

# åˆ›å»ºæœåŠ¡å™¨æ ¸å¿ƒä»£ç 

# åœ¨src/mcp_get_weatherä¸­åˆ›å»ºä¸‰ä¸ªä»£ç æ–‡ä»¶ï¼š

![Image](pdf_images\page278_img1.png)

# å…¶ä¸­server.pyä¸»è¦è´Ÿè´£è¿›è¡Œå¤©æ°”æŸ¥è¯¢ï¼Œä»£ç å¦‚ä¸‹ï¼š

# import json

# import httpx

# import argparse

from typing import Any

# from mcp.server.fastmcp import FastMCP

# # åˆå§‹åŒ– MCP æœåŠ¡å™¨

# mcp = FastMCP("WeatherServer")

# # OpenWeather API é…ç½®

# OPENWEATHER_API_BASE = "https://api.openweathermap.org/data/2.5/weather"

# API_KEY = None

# USER_AGENT = "weather-app/1.0"

# async def fetch_weather(city: str) -> dict[str, Any] | None:

""" ä» OpenWeather API è·å–å¤©æ°”ä¿¡æ¯ã€‚

"""

if API_KEY is None: return {"error": "API_KEY æœªè®¾ç½®ï¼Œè¯·æä¾›æœ‰æ•ˆçš„ OpenWeather API Keyã€‚"}

params = {

"q": city,

"appid": API_KEY,

"units": "metric",

# "lang": "zh_cn"

}

headers = {"User-Agent": USER_AGENT}

# async with httpx.AsyncClient() as client:

# try:

response = await client.get(OPENWEATHER_API_BASE, params=params,

# headers=headers, timeout=30.0)

# response.raise_for_status()

# return response.json()

# except httpx.HTTPStatusError as e:

return {"error": f"HTTP é”™è¯¯: {e.response.status_code}"}

# except Exception as e:

return {"error": f"è¯·æ±‚å¤±è´¥: {str(e)}"}

# def format_weather(data: dict[str, Any] | str) -> str:

"""

å°†å¤©æ°”æ•°æ®æ ¼å¼åŒ–ä¸ºæ˜“è¯»æ–‡æœ¬ã€‚

"""

## if isinstance(data, str):

## try:

# data = json.loads(data)

# except Exception as e:

return f"æ— æ³•è§£æå¤©æ°”æ•°æ®: {e}"

# if "error" in data: return f"âš  {data['error']}"

# city = data.get("name", "æœªçŸ¥")

country = data.get("sys", {}).get("country", "æœªçŸ¥")

# temp = data.get("main", {}).get("temp", "N/A")

# humidity = data.get("main", {}).get("humidity", "N/A")

wind_speed = data.get("wind", {}).get("speed", "N/A")

# weather_list = data.get("weather", [{}])

description = weather_list[0].get("description", "æœªçŸ¥")

return ( f"ğŸŒ {city}, {country}\n" f"ğŸŒ¡ æ¸©åº¦: {temp}Â°C\n" f"ğŸ’§ æ¹¿åº¦: {humidity}%\n" f"ğŸŒ¬ é£é€Ÿ: {wind_speed} m/s\n" f"â›… å¤©æ°”: {description}\n"

)

# @mcp.tool()

# async def query_weather(city: str) -> str:

"""

# è¾“å…¥æŒ‡å®šåŸå¸‚çš„è‹±æ–‡åç§°ï¼Œè¿”å›ä»Šæ—¥å¤©æ°”æŸ¥è¯¢ç»“æœã€‚

"""

data = await fetch_weather(city)

# return format_weather(data)

# def main():

# parser = argparse.ArgumentParser(description="Weather Server")

# parser.add_argument("--api_key", type=str, required=True, help="ä½ çš„

# OpenWeather API Key")

# args = parser.parse_args()

# global API_KEY

# API_KEY = args.api_key

# mcp.run(transport='sse')

if __name__ == "__main__":

# main()

# å…¶ä»ç„¶æ˜¯é‡‡ç”¨äº†fastmcpè¿›è¡Œåˆ›å»ºï¼Œè€Œåœ¨mcp.runä¸­è®¾ç½®äº†ä½¿ç”¨sseæ–¹å¼è¿›è¡Œä¼ è¾“ã€‚

# mcp.run(transport='sse')

# æ­¤å¤–éœ€è¦åœ¨ __init__.py ä¸­å†™å…¥

# from .server import main

è€Œåœ¨ __main__.py ä¸­å†™å…¥ï¼š

![Image](pdf_images\page280_img1.png)

## from mcp_get_weather import main

# main()

# åŒæ—¶å›åˆ°ä¸»ç›®å½•ï¼Œä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶ pyproject.toml ï¼š

# [build-system]

requires = ["setuptools>=61.0", "wheel"]

# build-backend = "setuptools.build_meta"

# [project]

name = "mcp-get-weather"

version = "0.1.5"

description = "è¾“å…¥OpenWeather-API-KEYï¼Œè·å–å¤©æ°”ä¿¡æ¯ã€‚"

readme = "README.md"

# requires-python = ">=3.9"

dependencies = [

"httpx>=0.28.1",

"mcp>=1.6.0",

"openai>=1.75.0",

"python-dotenv>=1.1.0",

]

# [project.scripts]

# mcp-get-weather = "mcp_get_weather:main"

# [tool.setuptools]

package-dir = {"" = "src"}

# [tool.setuptools.packages.find]

where = ["src"]

# è‡³æ­¤å³å®Œæˆäº†æ•´ä¸ªé¡¹ç›®çš„ä»£ç ç¼–å†™å·¥ä½œã€‚å®Œæ•´é¡¹ç›®ä»£ç å¯åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š

![Image](pdf_images\page281_img1.png)

![Image](pdf_images\page281_img2.png)

![Image](pdf_images\page281_img3.png)

3. åŸºäºSSEçš„MCPæœåŠ¡å™¨æµ‹è¯•ä¸å‘å¸ƒæµç¨‹

# 3.1 SSE MCPæœåŠ¡å™¨æµ‹è¯•æµç¨‹

# åŒæ ·ï¼Œæ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨Inspectorè¿›è¡ŒæœåŠ¡å™¨æ€§èƒ½æµ‹è¯•ï¼Œä½†æœ‰æ‰€ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¼€å¯MCPæœåŠ¡

# å™¨ï¼Œç„¶åå†å¼€å¯Inspectorï¼š

# åœ¨stdioæ¨¡å¼ä¸‹æ˜¯å¼€å¯Inspectoræ—¶åŒæ­¥å¼€å¯MCP Server

å¼€å¯SSE MCPæœåŠ¡å™¨ï¼š

# # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-get-weather

# uv run ./src/mcp_get_weather/server.py --api_key YOUR_KEY

# å¼€å¯Inspector

# # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-get-weather

# npx -y @modelcontextprotocol/inspector uv run ./src/mcp_get_weather/server.py

# --api_key YOUR_KEY

# è¿›è¡Œæµ‹è¯•

# åŒæ ·ï¼Œå¦‚æœæ˜¯ä½¿ç”¨AutoDLï¼Œåˆ™å…ˆéœ€è¦ä½¿ç”¨éš§é“å·¥å…·å°†ç«¯å£æ˜ å°„åˆ°æœ¬åœ°è¿›è¡Œè¿è¡Œï¼š

![Image](pdf_images\page282_img1.png)

![Image](pdf_images\page282_img2.png)

# ç„¶åæ‰“å¼€Inspectorï¼Œå¹¶é€‰æ‹©SSEæ¨¡å¼ï¼Œé€‰æ‹©é»˜è®¤è¿è¡Œåœ°å€ï¼š http://localhost:8000/sse ï¼Œç„¶åç‚¹å‡»

# connectï¼š

# ç„¶åè¾“å…¥åœ°åè¿›è¡Œæµ‹è¯•ï¼š

![Image](pdf_images\page283_img1.png)

# å®Œæ•´æµ‹è¯•æµç¨‹å¦‚ä¸‹ï¼š

# 3.2 SSE MCPæœåŠ¡å™¨å‘å¸ƒä¸è°ƒç”¨æµç¨‹

# æµ‹è¯•å®Œæˆåï¼Œå³å¯ä¸Šçº¿å‘å¸ƒã€‚è¿™é‡Œä»ç„¶è€ƒè™‘å‘å¸ƒåˆ°pypiå¹³å°ï¼Œå¹¶ä½¿ç”¨cherry studioè¿›è¡Œæœ¬åœ°è°ƒç”¨æµ‹

# è¯•ã€‚

# æ‰“åŒ…ä¸Šä¼ ï¼š

# # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-get-weather

uv pip install build twine

# python -m build

# python -m twine upload dist/*

![Image](pdf_images\page284_img1.png)

![Image](pdf_images\page284_img2.png)

![Image](pdf_images\page284_img3.png)

# æŸ¥çœ‹å‘å¸ƒçš„åº“ï¼šhttps://pypi.org/search/?q=mcp-get-weather

# æœ¬åœ°å®‰è£…ï¼š

# pip install mcp-get-weather

# å¼€å¯æœåŠ¡ï¼šuv run mcp-get-weather

![Image](pdf_images\page285_img1.png)

![Image](pdf_images\page285_img2.png)

![Image](pdf_images\page285_img3.png)

# ç„¶åå³å¯æ‰“å¼€æµè§ˆå™¨è¾“å…¥ http://localhost:8000/sse æµ‹è¯•è¿æ¥æƒ…å†µ

# æ³¨æ„ï¼Œè¿™é‡Œåœ¨æœåŠ¡å™¨ä¸Šå¼€å¯æœåŠ¡ç„¶åæœ¬åœ°è¿æ¥ä¹Ÿå¯ä»¥ï¼Œå’Œstdioä¸åŒï¼ŒSSEæ¨¡å¼ä¸‹çš„MCPæœåŠ¡å™¨å¹¶ä¸

# éœ€è¦æœ¬åœ°è¿è¡Œã€‚

# ä½¿ç”¨Cherry studioè¿›è¡Œè¿æ¥

# ç„¶åå³å¯ä½¿ç”¨Cherry studioè¿æ¥SSEæ¨¡å¼ä¸‹çš„MCPæœåŠ¡å™¨ï¼Œè¿™é‡Œåªéœ€è¦è¾“å…¥æœåŠ¡å™¨åœ°å€å³å¯ï¼š

# å…·ä½“æ¼”ç¤ºæ•ˆæœå¦‚ä¸‹

# è‡³æ­¤æˆ‘ä»¬å°±å®Œæˆäº†ä¸¤ä¸ªæœåŠ¡å™¨ã€åŒæ—¶ä¹Ÿæ˜¯ä¸¤ç§ç±»å‹çš„æœåŠ¡å™¨çš„å¼€å‘ä¸éƒ¨ç½²æµç¨‹ã€‚

# äº”ã€åŸºäºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹

# æœ€åä¸€éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬æ¥ä»‹ç»åŸºäºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨åˆ›å»ºæµç¨‹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡HTTP

# æµå¼ä¼ è¾“æ˜¯ç†è®ºä¸Šæ€§èƒ½æœ€å¥½çš„ä¼ è¾“æ–¹å¼ï¼Œä½†å¼€å‘å’Œåº”ç”¨çš„é—¨æ§›éƒ½å¾ˆå¤§ï¼Œä¸ä»…ç›®å‰MCP SDKæ²¡æœ‰HTTPæµå¼ ä¼ è¾“å¼€å‘å·¥å…·ï¼Œè€Œä¸”ç›®å‰ä¸»æµçš„MCPå®¢æˆ·ç«¯ï¼Œå¦‚Cherry Studioå’ŒCursorç­‰ï¼Œå¯¹äºHTTPæµå¼ä¼ è¾“çš„MCP

æœåŠ¡å™¨è°ƒç”¨æ”¯æŒéƒ½å¾ˆå·®ï¼Œå› æ­¤ç›®å‰å¯¹äºMCPæ¥è¯´ï¼ŒHTTPæµå¼ä¼ è¾“åŠŸèƒ½è¿˜å¤„äºåˆçº§é˜¶æ®µã€‚

1. HTTPæµå¼ä¼ è¾“åè®®

# ä¸Šé¢è°ˆåˆ°ï¼Œç›®å‰MCPçš„å„å®˜æ–¹SDKå¹¶æ²¡æœ‰æä¾›HTTPæµå¼ä¼ è¾“çš„MCPå¼€å‘å·¥å…·ï¼Œå› æ­¤HTTPæµå¼ä¼ è¾“

# çš„MCPæœåŠ¡å™¨å°šä¸”åœç•™åœ¨â€œåè®®é˜¶æ®µâ€ï¼Œä¹Ÿå°±æ˜¯è¯´MCPæä¾›äº†HTTPçš„ä¼ è¾“åè®®ï¼Œä½†æ²¡æœ‰æä¾›å¯¹åº”èƒ½å®Œæˆç›¸ å…³åŠŸèƒ½å¼€å‘çš„SDKï¼Œå¼€å‘è€…å¦‚æœéœ€è¦åˆ›å»ºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨ï¼Œåˆ™éœ€è¦å…ˆç ”ç©¶MCP HTTPæµå¼ä¼ 

# è¾“åè®®ï¼Œç„¶åæ‰‹åŠ¨åˆ›å»ºæ»¡è¶³è¯¥åè®®çš„MCP Serverã€‚æ•´ä½“æ¥çœ‹ç ”å‘éš¾åº¦è¾ƒå¤§ã€‚

# ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦æ·±å…¥ç ”ç©¶MCPæå‡ºçš„HTTPæµå¼ä¼ è¾“åŸºæœ¬åè®®ã€‚æ•´ä¸ªåè®®å†…å®¹è¾ƒå¤šï¼Œè¿™é‡Œéœ€è¦é‡

# ç‚¹å…³æ³¨ä»¥ä¸‹å‡ åˆ†ææ–™ï¼š

# 1.1 Streamable HTTPåè®®ç®€ä»‹

# æ–‡æ¡£è¿æ¥ï¼šhttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/docs/

# specification/2025-03-26/basic/transports.mdx#streamable-http

![Image](pdf_images\page287_img1.png)

å…¶ä¸­è¯¦ç»†è¯´æ˜äº†HTTPæµå¼ä¼ è¾“çš„åŸºæœ¬åè®®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æµç¨‹è¿›è¡Œè¯´æ˜ï¼š

![Image](pdf_images\page288_img1.png)

# 1.2 HTTPè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

# æ–‡æ¡£åœ°å€ï¼šhttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/docs/

# specification/2025-03-26/basic/lifecycle.mdx

![Image](pdf_images\page289_img1.png)

![Image](pdf_images\page289_img2.png)

# å…¶ä¸­è¯¦ç»†ä»‹ç»äº†ä»å¼€å§‹ä¼šè¯åˆ°ç»“æŸçš„å®Œæ•´æœåŠ¡å™¨ç”Ÿå‘½å‘¨æœŸè¿›ç¨‹ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‹å›¾è¿›è¡Œå±•ç¤ºï¼š

# 1.3 HTTPæœåŠ¡å™¨å¤–éƒ¨å·¥å…·è°ƒç”¨è¯†åˆ«ä¸è°ƒç”¨æµç¨‹

# æ–‡æ¡£åœ°å€ï¼šhttps://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/docs/

# specification/2025-03-26/server/tools.mdx

![Image](pdf_images\page290_img1.png)

å…¶ä¸­è¯¦ç»†è¯´æ˜äº†HTTPæµå¼ä¼ è¾“æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡æµç¨‹ï¼Œä»¥åŠå¤–éƒ¨å·¥å…·ä¿¡æ¯åŒæ­¥æ ¼å¼ä¸æµç¨‹ç­‰ï¼Œ

# ä¹Ÿå¯ä»¥ç”¨ä¸‹å›¾è¿›è¡Œè¯´æ˜ï¼š

![Image](pdf_images\page291_img1.png)

# 1.4 HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯é€šä¿¡æµç¨‹

# ä¸‹é¢æŒ‰ å®¢æˆ·ç«¯é¦–æ¬¡å¯åŠ¨ âœ æˆåŠŸè¿åˆ°æœåŠ¡å™¨ âœ ç­‰å¾…ç”¨æˆ·æé—® è¿™ä¸€å®Œæ•´è¿‡ç¨‹ï¼ŒæŠŠ MCP Streamable

HTTP çš„è¯·æ±‚â€“å“åº”é¡ºåºç”¨æ—¶é—´çº¿åˆ—å‡ºæ¥ï¼Œå¸®åŠ©ä½ å®Œå…¨æŒæ¡æ¯ä¸€æ­¥åœ¨å¹²ä»€ä¹ˆã€‚

# å¯åŠ¨æ—¶ï¼š 3 æ­¥æ¡æ‰‹ï¼ˆæ— ç”¨æˆ·è¾“å…¥ï¼‰

## æ—¶

## åˆ»

## HTTP

## JSON-RPC method

## ä½œç”¨

## æœåŠ¡å™¨å…¸å‹å“åº”

â‘ 

# POST

# /mcp

initialize

# åå•†åè®®ç‰ˆæœ¬ & èƒ½

# åŠ›

# result.protocolVersion = 2024-11-

# 05``result.capabilities.tools.listChanged =

# true

â‘¡

# POST

# /mcp

# notifications/initialized

# å‘Šè¯‰æœåŠ¡å™¨â€œæˆ‘å·²å°± ç»ªâ€ï¼ˆé€šçŸ¥ â‡’ æœåŠ¡ å™¨åªå› 204 No Contentï¼‰

# HTTP 204 æ— åŒ…ä½“

â‘¢

# POST

# /mcp

# tools/list

# å‘æœåŠ¡å™¨è¦å·¥å…·æ¸…

# å•

result.tools æ•°ç»„ + nextCursor

# å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡æé—®æ—¶ï¼ˆæ¨¡å‹åˆ¤æ–­è¦ç”¨å·¥å…·ï¼‰

# æ—¶

# åˆ»

# HTTP

# JSON-RPC method

# å†…å®¹è¦ç‚¹

â‘£

# POST

# /mcp

# tools/call

# params.name =

# get_weather``params.arguments.city æˆ–

# location

â‘¤

# æµå¼å“

# åº”

# stream /

# result

# æœåŠ¡å™¨é€è¡Œæ¨é€ï¼šâ€¢ è¿›åº¦ stream â€¢ æˆåŠŸ

# result.content[]

# å®¢æˆ·ç«¯åœ¨æ”¶åˆ° â‘¤ çš„æœ€ç»ˆ result åï¼ŒæŠŠæ–‡æœ¬å›å¡«åˆ° LLMï¼ŒLLM å†è¾“å‡ºç»™ç»ˆç«¯â€”â€”ä½ å°±çœ‹åˆ°å¤©æ°”ç»“æœ

# å•¦ã€‚

# è¯¦ç»†é¡ºåºï¼ˆå¸¦çŠ¶æ€ç ï¼‰

1. POST /mcp â†’ 200 initialize

2. POST /mcp â†’ 204 notifications/initialized

3. POST /mcp â†’ 200 tools/list

4. â€”â€”ç­‰å¾…ç”¨æˆ·â€”â€”

5. POST /mcp â†’ 200/stream tools/call ï¼ˆæœåŠ¡å™¨ä¿æŒè¿æ¥ï¼Œé€è¡Œæ¨æµï¼‰

# JSON ä¸€è¡Œ {"stream": "æ­£åœ¨æŸ¥è¯¢â€¦"}â€¦

JSON ä¸€è¡Œ {"result": { "content":[â€¦] }} â†’ æœåŠ¡å™¨éšåå…³é—­æµ

# å¦‚æœæœ‰å¤šæ¬¡å·¥å…·è°ƒç”¨ï¼Œæ­¥éª¤ â‘£ â€“ â‘¤ ä¼šé‡å¤ï¼Œæ¯æ¬¡ id è‡ªå¢ã€‚

# å®Œæ•´æµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š

# åœºæ™¯

# æœåŠ¡å™¨åº”å½“â€¦

# å®¢æˆ·ç«¯é‡æ–°è¿æ¥

# å†èµ° â‘ â‘¡â‘¢ï¼Œæ¯è½® initialize ä¼šè¯ç‹¬ç«‹

# éœ€è¦åˆ†é¡µå·¥å…·

# åœ¨ â‘¢ è¿”å› nextCursor â‰  null ï¼Œå®¢æˆ·ç«¯ä¼šç»§ç»­ tools/list

# é€šçŸ¥å·¥å…·åˆ—è¡¨å˜

ä¸»åŠ¨ notifications/tools/list_changed ï¼Œå®¢æˆ·ç«¯å†å‘ tools/list æ‹‰

# æ›´

# æ–°åˆ—è¡¨

JSON-RPC æ˜¯ä¸€ç§ç”¨ JSON ç¼–å†™çš„ã€ç»“æ„åŒ–çš„è¿œç¨‹è°ƒç”¨åè®®ã€‚å…¶åŸºæœ¬æ ¼å¼ç»“æ„å¦‚ä¸‹ï¼š

![Image](pdf_images\page293_img1.png)

## ç±»å‹

## å­—æ®µ

## è¯´æ˜

# è¯·æ±‚

# jsonrpc

å›ºå®šä¸º "2.0"

# id

# è¯·æ±‚ç¼–å·ï¼Œç”¨äºå¯¹åº”è¯·æ±‚ä¸å“åº”

# method

# è¦è°ƒç”¨çš„æ–¹æ³•åï¼ˆæ¯”å¦‚ "tools/call" ï¼‰

# params

# æ–¹æ³•å‚æ•°ï¼ˆå¯ä»¥æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼‰

# å“åº”

# jsonrpc

ä¹Ÿè¦å†™ "2.0"

# id

# ä¸è¯·æ±‚çš„ ID ä¸€è‡´

# result

# æˆåŠŸè¿”å›å€¼ï¼ˆåªéœ€ resultï¼‰

# error

# å¦‚æœå‡ºé”™åˆ™è¿”å› error å¯¹è±¡

2. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å‘æµç¨‹

# åˆ›å»ºé¡¹ç›®æ–‡ä»¶ï¼š

# cd /root/autodl-tmp/MCP/MCP-sse-test

# uv init mcp-weather-http

# cd mcp-weather-http

# # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

# uv venv

# # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

# source .venv/bin/activate

uv add mcp httpx fastapi

# mkdir -p ./src/mcp_weather_http

# cd ./src/mcp_weather_http

# ç„¶ååˆ›å»º server.py

![Image](pdf_images\page294_img1.png)

# å¹¶å†™å…¥å¦‚ä¸‹ä»£ç ï¼š

"""weather_http_server_v8.py â€“ MCP Streamable HTTP (Cherry-Studio verified) ==========================================================================

initialize â†’ protocolVersion + capabilities(streaming + tools.listChanged)

# + friendly instructions

notifications/initialized â†’ ignored (204)

tools/list â†’ single-page tool registry (get_weather)

tools/call â†’ execute get_weather, stream JSON (content[])

GET â†’ 405 (no SSE stream implemented)

"""

# from __future__ import annotations

# import argparse

# import asyncio

# import json

from typing import Any, AsyncIterator

# import httpx

# from fastapi import FastAPI, Request, Response, status

from fastapi.responses import StreamingResponse

# ---------------------------------------------------------------------------

# # Server constants

# ---------------------------------------------------------------------------

# SERVER_NAME = "WeatherServer"

SERVER_VERSION = "1.0.0"

# PROTOCOL_VERSION = "2024-11-05" # Cherry Studio current

# ---------------------------------------------------------------------------

# # Weather helpers

# ---------------------------------------------------------------------------

# OPENWEATHER_URL = "https://api.openweathermap.org/data/2.5/weather"

# API_KEY: str | None = None

# USER_AGENT = "weather-app/1.0"

# async def fetch_weather(city: str) -> dict[str, Any]:

# if not API_KEY:

return {"error": "API_KEY æœªè®¾ç½®ï¼Œè¯·æä¾›æœ‰æ•ˆçš„ OpenWeather API Keyã€‚"}

params = {"q": city, "appid": API_KEY, "units": "metric", "lang": "zh_cn"}

headers = {"User-Agent": USER_AGENT}

async with httpx.AsyncClient(timeout=30.0) as client:

## try:

## r = await client.get(OPENWEATHER_URL, params=params, headers=headers)

# r.raise_for_status()

# return r.json()

# except httpx.HTTPStatusError as exc:

return {"error": f"HTTP é”™è¯¯: {exc.response.status_code}"}

# except Exception as exc: # noqa: BLE001

return {"error": f"è¯·æ±‚å¤±è´¥: {exc}"}

# def format_weather(data: dict[str, Any]) -> str:

# if "error" in data:

return data["error"] city = data.get("name", "æœªçŸ¥")

country = data.get("sys", {}).get("country", "æœªçŸ¥")

# temp = data.get("main", {}).get("temp", "N/A")

# humidity = data.get("main", {}).get("humidity", "N/A")

# wind = data.get("wind", {}).get("speed", "N/A")

desc = data.get("weather", [{}])[0].get("description", "æœªçŸ¥")

return ( f"ğŸŒ {city}, {country}\n" f"ğŸŒ¡ æ¸©åº¦: {temp}Â°C\n" f"ğŸ’§ æ¹¿åº¦: {humidity}%\n" f"ğŸŒ¬ é£é€Ÿ: {wind} m/s\n" f"â›… å¤©æ°”: {desc}"

)

async def stream_weather(city: str, req_id: int | str) -> AsyncIterator[bytes]:

# # progress chunk

# yield json.dumps({"jsonrpc": "2.0", "id": req_id, "stream": f"æŸ¥è¯¢ {city} å¤©æ°” ä¸­â€¦"}).encode() + b"\n"

# await asyncio.sleep(0.3)

data = await fetch_weather(city)

# if "error" in data:

# yield json.dumps({"jsonrpc": "2.0", "id": req_id, "error": {"code":

32000, "message": data["error"]}}).encode() + b"\n"

# return

# yield json.dumps({

"jsonrpc": "2.0", "id": req_id,

# "result": {

# "content": [

# {"type": "text", "text": format_weather(data)}

],

# "isError": False

}

}).encode() + b"\n"

# ---------------------------------------------------------------------------

# # FastAPI app

# ---------------------------------------------------------------------------

app = FastAPI(title="WeatherServer HTTP-Stream v8")

## TOOLS_REGISTRY = {

## "tools": [

{

"name": "get_weather",

# "description": "ç”¨äºè¿›è¡Œå¤©æ°”ä¿¡æ¯æŸ¥è¯¢çš„å‡½æ•°ï¼Œè¾“å…¥åŸå¸‚è‹±æ–‡åç§°ï¼Œå³å¯è·å¾—å½“å‰åŸå¸‚å¤©

æ°”ä¿¡æ¯ã€‚",

# "inputSchema": {

"type": "object",

# "properties": {

# "city": {

"type": "string",

# "description": "City name, e.g. 'Hangzhou'"

}

},

"required": ["city"]

}

}

],

# "nextCursor": None

}

# @app.get("/mcp")

async def mcp_initialize_via_get(): # GET è¯·æ±‚ä¹Ÿæ‰§è¡Œäº† initialize æ–¹æ³•

# return {

"jsonrpc": "2.0",

"id": 0,

# "result": {

"protocolVersion": PROTOCOL_VERSION,

# "capabilities": {

"streaming": True,

"tools": {"listChanged": True}

},

# "serverInfo": {

"name": SERVER_NAME,

# "version": SERVER_VERSION

},

"instructions": "Use the get_weather tool to fetch weather by city

# name."

}

}

# @app.post("/mcp")

# async def mcp_endpoint(request: Request):

# try:

body = await request.json() # âœ… æ‰“å°å®¢æˆ·ç«¯è¯·æ±‚å†…å®¹ print("ğŸ’¡ æ”¶åˆ°è¯·æ±‚:", json.dumps(body, ensure_ascii=False, indent=2)) except Exception:

return {"jsonrpc": "2.0", "id": None, "error": {"code": -32700,

# "message": "Parse error"}}

# req_id = body.get("id", 1)

method = body.get("method")

## # âœ… æ‰“å°å½“å‰æ–¹æ³•ç±»å‹ print(f"ğŸ”§ æ–¹æ³•: {method}")

# 0) Ignore initialized notification (no response required)

if method == "notifications/initialized":

# return Response(status_code=status.HTTP_204_NO_CONTENT)

# # 1) Activation probe (no method)

if method is None:

return {"jsonrpc": "2.0", "id": req_id, "result": {"status": "MCP server

# online."}}

# # 2) initialize

if method == "initialize":

# return {

"jsonrpc": "2.0", "id": req_id,

# "result": {

"protocolVersion": PROTOCOL_VERSION,

# "capabilities": {

"streaming": True,

"tools": {"listChanged": True}

},

"serverInfo": {"name": SERVER_NAME, "version": SERVER_VERSION},

"instructions": "Use the get_weather tool to fetch weather by

# city name."

}

}

# # 3) tools/list

if method == "tools/list":

# print(json.dumps(TOOLS_REGISTRY, indent=2, ensure_ascii=False))

return {"jsonrpc": "2.0", "id": req_id, "result": TOOLS_REGISTRY}

# # 4) tools/call

if method == "tools/call":

params = body.get("params", {})

# tool_name = params.get("name")

# args = params.get("arguments", {})

# if tool_name != "get_weather":

return {"jsonrpc": "2.0", "id": req_id, "error": {"code": -32602,

# "message": "Unknown tool"}}

# city = args.get("city")

# if not city:

return {"jsonrpc": "2.0", "id": req_id, "error": {"code": -32602,

"message": "Missing city"}}

return StreamingResponse(stream_weather(city, req_id),

# media_type="application/json")

# # 5) unknown method

return {"jsonrpc": "2.0", "id": req_id, "error": {"code": -32601, "message":

"Method not found"}}

# ---------------------------------------------------------------------------

## # Runner

## # ---------------------------------------------------------------------------

# def main() -> None:

# parser = argparse.ArgumentParser(description="Weather MCP HTTP-Stream v8")

# parser.add_argument("--api_key", required=True)

# parser.add_argument("--host", default="127.0.0.1")

# parser.add_argument("--port", type=int, default=8000)

# args = parser.parse_args()

# global API_KEY

# API_KEY = args.api_key

# import uvicorn

# uvicorn.run(app, host=args.host, port=args.port, log_level="info")

if __name__ == "__main__":

# main()

# ä»£ç è§£é‡Šå¦‚ä¸‹ï¼šæ€»ä½“ç»“æ„è¯´æ˜

# ğŸ“¦ weather_http_server_v8.py â”œâ”€â”€ å¸¸é‡å®šä¹‰ï¼ˆåè®®ç‰ˆæœ¬ + OpenWeather é…ç½®ï¼‰

# â”œâ”€â”€ å·¥å…·æ–¹æ³•ï¼ˆfetch_weatherã€format_weatherã€stream_weatherï¼‰

# â”œâ”€â”€ FastAPI è·¯ç”± â”‚ â”œâ”€â”€ GET /mcp â†’ å¯é€‰æ”¯æŒ

# â”‚ â””â”€â”€ POST /mcp â†’ æ”¯æŒæ‰€æœ‰ JSON-RPC è°ƒç”¨

â””â”€â”€ main() â†’ å¯åŠ¨ uvicorn æœåŠ¡å™¨

#   å¤´éƒ¨ä¿¡æ¯ï¼ˆå…ƒæ•°æ® + æ¨¡å—å¼•å…¥ï¼‰

"""weather_http_server_v8.py â€“ MCP Streamable HTTP (Cherry-Studio verified) â€¢ initialize â†’ å£°æ˜ streaming + tools.listChanged èƒ½åŠ›

tools/list â†’ æä¾› get_weather å·¥å…· â€¢ tools/call â†’ è°ƒç”¨å stream JSON æ•°æ®

GET â†’ 405 æˆ–ç®€å•è¿”å›ä¿¡æ¯ï¼ˆæ”¯æŒ Cherry æ¢æµ‹ï¼‰

"""

# âœ” ç®€æ´æ˜äº†åœ°è¯´æ˜è¿™ä¸ªæœåŠ¡ç¬¦åˆ Cherry Studio æ‰€æ”¯æŒçš„ MCP HTTP åè®®å­é›†ã€‚

#   å¸¸é‡å®šä¹‰

# SERVER_NAME = "WeatherServer"

SERVER_VERSION = "1.0.0"

# PROTOCOL_VERSION = "2024-11-05" # MCP è§„å®šç‰ˆæœ¬å·

# OPENWEATHER_URL = "https://api.openweathermap.org/data/2.5/weather"

# API_KEY: str | None = None # å¯åŠ¨æ—¶æ³¨å…¥

# USER_AGENT = "weather-app/1.0"

# âœ” æå‰å®šä¹‰ç‰ˆæœ¬å·ã€å¤©æ°”æ¥å£ã€å…¨å±€å˜é‡ç­‰ã€‚

  å¤©æ°”å¤„ç†é€»è¾‘

## async def fetch_weather(city: str) -> dict[str, Any]:

# å‘ OpenWeather API è¯·æ±‚å¤©æ°”æ•°æ®

# è‡ªåŠ¨å¤„ç†é”™è¯¯ï¼ˆæ¯”å¦‚ key ä¸å¯¹ã€è¶…æ—¶ï¼‰

# def format_weather(data: dict[str, Any]) -> str:

æŠŠåŸå§‹ JSON æ ¼å¼åŒ–æˆå¯è¯»æ–‡æœ¬ ğŸŒ¤

async def stream_weather(city: str, req_id: int | str) -> AsyncIterator[bytes]:

ç”Ÿæˆå™¨æµå¼è¿”å›å¤©æ°”å†…å®¹ï¼ˆç¬¦åˆ MCP åè®®çš„é€è¡Œ JSONï¼‰

# ç¤ºä¾‹è¾“å‡ºï¼š

{"jsonrpc": "2.0", "id": 1, "stream": "æŸ¥è¯¢ Hangzhou å¤©æ°”ä¸­â€¦"} {"jsonrpc": "2.0", "id": 1, "result": { "content": [{"type":"text","text":"ğŸŒ¡ æ¸© åº¦: 22Â°C"}] }}

#   MCP å·¥å…·æ³¨å†Œè¡¨

TOOLS_REGISTRY = {

# "tools": [

{

"name": "get_weather",

"description": "...",

# "inputSchema": {

"type": "object",

# "properties": {

# "city": {

"type": "string",

# "description": "City name, e.g. 'Hangzhou'"

}

},

"required": ["city"]

}

}

],

# "nextCursor": None

}

# âœ” ç¬¦åˆ MCP 2025-03-26 æ–‡æ¡£å¯¹ tools/list çš„æ ¼å¼è¦æ±‚ã€‚

#   æ ¸å¿ƒè·¯ç”±é€»è¾‘ï¼ˆFastAPIï¼‰

# âœ” /mcp [GET]

# @app.get("/mcp")

# Cherry Studio åœ¨æ¢æµ‹æ—¶ä¼šå‘ GET è¯·æ±‚

æˆ‘ä»¬è¿™é‡Œè¿”å›ä¸€ä¸ª initialize é£æ ¼çš„å“åº”

![Image](pdf_images\page300_img1.png)

## âœ” /mcp [POST]

# @app.post("/mcp")

# async def mcp_endpoint(request: Request):

æ•´ä¸ª MCP åè®®çš„æ ¸å¿ƒè·¯ç”±ï¼

# JSON-RPC æ–¹æ³•

# è¯´æ˜

initialize

# è¿”å›åè®®ç‰ˆæœ¬ã€èƒ½åŠ›åˆ—è¡¨

# notifications/initialized

æ— éœ€å“åº”ï¼ˆ204ï¼‰

# tools/list

# è¿”å›å·¥å…·æ¸…å•

# tools/call

# å¼€å§‹å¤©æ°”æŸ¥è¯¢ï¼ˆæµå¼ï¼‰

# æœªçŸ¥ method

è¿”å› -32601 é”™è¯¯

#  main() å¯åŠ¨é€»è¾‘

# def main():

# parser.add_argument("--api_key", required=True)

uvicorn.run(app, host=..., port=...)

# âœ” ä»å‘½ä»¤è¡Œä¼ å…¥ OpenWeather çš„ API Key å¹¶å¯åŠ¨æœåŠ¡ã€‚

# uv run ./server.py --api_key ä½ çš„key

3. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å¯ä¸æµ‹è¯•

# åœ¨åˆ›å»ºå®Œ server.py åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯æœåŠ¡å¹¶è¿›è¡Œæµ‹è¯•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒInspectorå¹¶ä¸æ”¯æŒæµå¼ä¼ 

è¾“çš„MCPæœåŠ¡å™¨æµ‹è¯•ï¼Œæˆ‘ä»¬åªèƒ½åŸºäºå¯¹HTTPæµå¼ä¼ è¾“çš„åè®®ç†è§£ï¼Œåˆ›å»ºä¸€ä¸ªæµ‹è¯•æµç¨‹ã€‚

# å¼€å¯HTTPæµå¼ä¼ è¾“æœåŠ¡å™¨

# # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-weather-http

# uv run ./src/mcp_weather_http/server.py --api_key YOUR_API_KEY

# æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ 4 ä¸ª curl å‘½ä»¤æ¥æ¨¡æ‹Ÿ MCP å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„æ ‡å‡†é€šä¿¡æµç¨‹ã€‚

# â‘  initialize è¯·æ±‚ï¼ˆèƒ½åŠ›åå•†ï¼‰

![Image](pdf_images\page301_img1.png)

![Image](pdf_images\page301_img2.png)

![Image](pdf_images\page301_img3.png)

## curl -X POST http://localhost:8000/mcp \

## -H "Content-Type: application/json" \

d '{

"jsonrpc": "2.0",

"id": 1,

"method": "initialize",

# "params": {

# "protocolVersion": "2024-11-05"

}

}'

# æœŸæœ›å“åº”ï¼šè¿”å›æœåŠ¡å™¨æ”¯æŒçš„åè®®ç‰ˆæœ¬ã€åŠŸèƒ½ï¼š

# â‘¡ notifications/initialized é€šçŸ¥ï¼ˆç¡®è®¤ä¸Šçº¿ï¼‰

curl -X POST http://localhost:8000/mcp \

H "Content-Type: application/json" \

d '{

"jsonrpc": "2.0",

"method": "notifications/initialized"

}'

# ğŸ“¥ æœŸæœ›å“åº”ï¼š 204 No Content ï¼ˆå› ä¸ºæ˜¯é€šçŸ¥ç±»å‹ï¼‰ï¼š

# â‘¢ tools/list è¯·æ±‚ï¼ˆè·å–å·¥å…·æ³¨å†Œè¡¨ï¼‰

![Image](pdf_images\page302_img1.png)

![Image](pdf_images\page302_img2.png)

## curl -X POST http://localhost:8000/mcp \

## -H "Content-Type: application/json" \

d '{

"jsonrpc": "2.0",

"id": 2,

"method": "tools/list",

# "params": {}

}'

# ğŸ“¥ æœŸæœ›å“åº”ï¼šè¿”å›å·¥å…·æ¸…å•ï¼Œ get_weather å·¥å…·çš„ç»“æ„ä½“å’Œ schemaï¼š

# â‘£ tools/call è¯·æ±‚ï¼ˆè°ƒç”¨å®é™…å·¥å…·ï¼Œæµå¼è¿”å›ï¼‰

# curl -N -X POST http://localhost:8000/mcp \

H "Content-Type: application/json" \

d '{

"jsonrpc": "2.0",

"id": 3,

"method": "tools/call",

# "params": {

"name": "get_weather",

# "arguments": {

# "city": "Hangzhou"

}

}

}'

![Image](pdf_images\page303_img1.png)

![Image](pdf_images\page303_img2.png)

![Image](pdf_images\page303_img3.png)

![Image](pdf_images\page303_img4.png)

## ğŸ“¥ æœŸæœ›å“åº”ï¼ˆé€è¡Œè¾“å‡ºï¼‰ï¼š

# è„šæœ¬å®Œæ•´ä»£ç ï¼š

4. HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨Cherry Studioè°ƒç”¨æµ‹è¯•

# åœ¨åŸºæœ¬æµ‹è¯•å®ŒHTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨åŸºæœ¬åŠŸèƒ½åï¼Œæ¥ä¸‹æ¥å³å¯æ¥å…¥MCPè¿›è¡Œæµ‹è¯•ã€‚éœ€è¦æ³¨æ„çš„

# æ˜¯ï¼Œç›®å‰Cherry Studioç‰ˆæœ¬æ›´æ–°è¿­ä»£è¾ƒå¿«ï¼Œéƒ¨åˆ†æƒ…å†µä¸‹å°šæ— æ³•ç¨³å®šæ”¯æŒHTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨çš„è°ƒ ç”¨ï¼Œå› æ­¤ä»¥ä¸‹æµç¨‹ä¸ä¸€å®šèƒ½é¡ºåˆ©å®Œæˆã€‚è‹¥ä»¥ä¸‹æµç¨‹æ— æ³•é¡ºåˆ©å®Œæˆï¼Œå¯ä»¥çœ‹ä¸‹ä¸€èŠ‚è‡ªå®šä¹‰MCP HTTPæµå¼ä¼ 

# è¾“å®¢æˆ·ç«¯è¿›è¡Œè°ƒç”¨æµ‹è¯•ã€‚

å·¥å…·åç§°ï¼šweather-http

![Image](pdf_images\page304_img1.png)

## URLï¼šhttp://localhost:8000/mcp

## è¯·æ±‚å¤´ï¼šContent-Type=application/json

# å…·ä½“æ¼”ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

5. è‡ªå®šä¹‰MCPå®¢æˆ·ç«¯Clientæ¥å…¥HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨

# æˆªæ­¢ç›®å‰ï¼Œä¸»æµçš„MCPå®¢æˆ·ç«¯éƒ½æ— æ³•å¾ˆå¥½çš„å®ŒæˆHTTPæµå¼MCPæœåŠ¡å™¨çš„æ¥å…¥ï¼Œå› æ­¤è¿™é‡Œä¸ºå¤§å®¶ä»‹ç»

å¦‚ä½•ä»é›¶ç¼–å†™MCPå®¢æˆ·ç«¯ï¼Œå¹¶æŒ‰ç…§æ ‡å‡†æµç¨‹æ¥å…¥HTTPæµå¼MCPæœåŠ¡å™¨ã€‚

![Image](pdf_images\page305_img1.png)

## 5.1 ç¼–å†™client.pyè„šæœ¬

# # å›åˆ°ä»£ç æ–‡ä»¶å¤¹

# cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-weather-http/src/mcp_weather_http

# åˆ›å»º client.py ï¼š

# ç„¶åå†™å…¥å¦‚ä¸‹ä»£ç ï¼š

# """mcp_http_client.py â€“ Async MCP client (Streamable HTTP)

=========================================================== â€¢ å®Œå…¨ç§»é™¤ stdio ä¼ è¾“ï¼Œæ”¹ç”¨ Streamable HTTP (POST + optional SSE)

æ”¯æŒ initialize â†’ notifications/initialized â†’ tools/list â†’ tools/call â€¢ è‡ªåŠ¨å¤„ç† line-delimited JSON stream (application/json æˆ– text/event-stream) â€¢ ä¿ç•™äº¤äº’å¼ chat_loopï¼Œå…¼å®¹ OpenAI Function Calling """

# from __future__ import annotations

# import asyncio

# import json

import logging

# import os

# from contextlib import AsyncExitStack

# from typing import Any, Dict, List, Optional

# import httpx

# from dotenv import load_dotenv

# from openai import OpenAI

################################################################################

# # é€šç”¨é…ç½®åŠ è½½

################################################################################

# class Configuration:

# def __init__(self) -> None:

# load_dotenv()

# self.api_key = os.getenv("LLM_API_KEY")

# self.base_url = os.getenv("BASE_URL")

# self.model = os.getenv("MODEL", "gpt-4o")

# if not self.api_key: raise ValueError("âŒ æœªæ‰¾åˆ° LLM_API_KEYï¼Œè¯·åœ¨ .env æ–‡ä»¶ä¸­é…ç½®")

# @staticmethod

def load_config(path: str) -> Dict[str, Any]:

## with open(path, "r", encoding="utf-8") as f:

## return json.load(f)

################################################################################

# # HTTP-based MCP Server wrapper

################################################################################

# class HTTPMCPServer:

# """ä¸å•ä¸ª MCP Streamable HTTP æœåŠ¡å™¨é€šä¿¡"""

# def __init__(self, name: str, endpoint: str) -> None:

# self.name = name

# self.endpoint = endpoint.rstrip("/") # e.g. http://localhost:8000/mcp

# self.session: Optional[httpx.AsyncClient] = None

# self.protocol_version: str = "2024-11-05"

# async def initialize(self) -> None:

# self.session = httpx.AsyncClient(timeout=httpx.Timeout(30.0))

# # 1) initialize

# init_req = {

"jsonrpc": "2.0",

"id": 0,

"method": "initialize",

# "params": {

"protocolVersion": self.protocol_version,

"capabilities": {},

"clientInfo": {"name": "HTTP-MCP-Demo", "version": "0.1"},

},

}

# r = await self._post_json(init_req)

# if "error" in r:

raise RuntimeError(f"Initialize error: {r['error']}")

# 2) send initialized notification (no response expected)

# await self._post_json({"jsonrpc": "2.0", "method":

# "notifications/initialized"})

# async def list_tools(self) -> List[Dict[str, Any]]:

# req = {"jsonrpc": "2.0", "id": 1, "method": "tools/list", "params": {}}

res = await self._post_json(req)

return res["result"]["tools"]

# async def call_tool_stream(self, tool_name: str, arguments: Dict[str, Any]) -

# > str:

# """è°ƒç”¨å·¥å…·å¹¶å°†æµå¼ç»“æœæ‹¼æ¥ä¸ºå®Œæ•´æ–‡æœ¬"""

# req = {

"jsonrpc": "2.0",

"id": 3,

"method": "tools/call",

"params": {"name": tool_name, "arguments": arguments},

}

assert self.session is not None

# async with self.session.stream(

# "POST", self.endpoint, json=req, headers={"Accept":

# "application/json"}

) as resp:

if resp.status_code != 200:

## raise RuntimeError(f"HTTP {resp.status_code}")

## collected_text: List[str] = []

# async for line in resp.aiter_lines():

# if not line:

# continue

# chunk = json.loads(line)

# if "stream" in chunk:

# continue # ä¸­é—´è¿›åº¦

# if "error" in chunk:

raise RuntimeError(chunk["error"]["message"])

# if "result" in chunk:

# # æ ¹æ®åè®®ï¼Œæ–‡æœ¬åœ¨ result.content[0].text

# for item in chunk["result"]["content"]:

if item["type"] == "text":

collected_text.append(item["text"])

# return "\n".join(collected_text)

# async def _post_json(self, payload: Dict[str, Any]) -> Dict[str, Any]:

assert self.session is not None

# r = await self.session.post(self.endpoint, json=payload, headers=

# {"Accept": "application/json"})

if r.status_code == 204 or not r.content:

# return {} # â† é€šçŸ¥æ— å“åº”ä½“

# r.raise_for_status()

# return r.json()

# async def close(self) -> None:

# if self.session:

# await self.session.aclose()

# self.session = None

################################################################################ # LLM å°è£…ï¼ˆOpenAI Function-Callingï¼‰

################################################################################

# class LLMClient:

# def __init__(self, api_key: str, base_url: Optional[str], model: str) ->

# None:

# self.client = OpenAI(api_key=api_key, base_url=base_url)

# self.model = model

def chat(self, messages: List[Dict[str, Any]], tools: Optional[List[Dict[str,

Any]]]):

return self.client.chat.completions.create(model=self.model,

# messages=messages, tools=tools)

################################################################################

# # å¤šæœåŠ¡å™¨ MCP + LLM Function Calling

################################################################################

# class MultiHTTPMCPClient:

# def __init__(self, servers_conf: Dict[str, Any], api_key: str, base_url:

# Optional[str], model: str) -> None:

# self.servers: Dict[str, HTTPMCPServer] = {

name: HTTPMCPServer(name, cfg["endpoint"]) for name, cfg in

servers_conf.items()

## }

## self.llm = LLMClient(api_key, base_url, model) self.all_tools: List[Dict[str, Any]] = [] # è½¬ä¸º OAI FC çš„ tools æ•°ç»„

# async def start(self):

# for srv in self.servers.values():

# await srv.initialize()

tools = await srv.list_tools()

# for t in tools: # é‡å‘½åä»¥åŒºåˆ†ä¸åŒæœåŠ¡å™¨

# full_name = f"{srv.name}_{t['name']}"

# self.all_tools.append({

"type": "function",

# "function": {

"name": full_name,

"description": t["description"],

"parameters": t["inputSchema"],

},

})

logging.info("å·²è¿æ¥æœåŠ¡å™¨å¹¶æ±‡æ€»å·¥å…·ï¼š%s", [t["function"]["name"] for t in

# self.all_tools])

# async def call_local_tool(self, full_name: str, args: Dict[str, Any]) -> str:

# srv_name, tool_name = full_name.split("_", 1)

srv = self.servers[srv_name]

# # å…¼å®¹ city/location

city = args.get("city") or args.get("location")

# if not city:

raise ValueError("Missing city/location")

# return await srv.call_tool_stream(tool_name, {"city": city})

# async def chat_loop(self): print("ğŸ¤– HTTP MCP + Function Calling å®¢æˆ·ç«¯å·²å¯åŠ¨ï¼Œè¾“å…¥ quit é€€å‡º")

# messages: List[Dict[str, Any]] = []

# while True:

# user = input("ä½ : ").strip()

if user.lower() == "quit":

# break

# messages.append({"role": "user", "content": user})

# # 1st LLM call

# resp = self.llm.chat(messages, self.all_tools)

choice = resp.choices[0]

if choice.finish_reason == "tool_calls":

tc = choice.message.tool_calls[0]

# tool_name = tc.function.name

# tool_args = json.loads(tc.function.arguments)

# print(f"[è°ƒç”¨å·¥å…·] {tool_name} â†’ {tool_args}")

# tool_resp = await self.call_local_tool(tool_name, tool_args)

# messages.append(choice.message.model_dump())

messages.append({"role": "tool", "content": tool_resp,

# "tool_call_id": tc.id})

# resp2 = self.llm.chat(messages, self.all_tools)

print("AI:", resp2.choices[0].message.content)

# messages.append(resp2.choices[0].message.model_dump())

else:

print("AI:", choice.message.content)

## messages.append(choice.message.model_dump())

# async def close(self):

# for s in self.servers.values():

# await s.close()

################################################################################

# # main entry

################################################################################

# async def main():

logging.basicConfig(level=logging.INFO, format="%(asctime)s - %(levelname)s -

# %(message)s")

# conf = Configuration()

# servers_conf =

conf.load_config("./src/mcp_weather_http/servers_config.json").get("mcpServers",

{})

client = MultiHTTPMCPClient(servers_conf, conf.api_key, conf.base_url,

# conf.model)

# try:

# await client.start()

# await client.chat_loop()

# finally:

# await client.close()

if __name__ == "__main__":

# asyncio.run(main())

# å…·ä½“ä»£ç è§£é‡Šå¦‚ä¸‹ï¼šæ¨¡å—ç»“æ„æ¦‚è§ˆ

# mcp_http_client.py

# â”œâ”€â”€ Configuration # è¯»å– API Key å’ŒæœåŠ¡å™¨é…ç½®

â”œâ”€â”€ HTTPMCPServer # å•ä¸ª HTTP-MCP æœåŠ¡å™¨çš„è¿æ¥é€»è¾‘ â”œâ”€â”€ LLMClient # OpenAI Function Calling åŒ…è£…å™¨

# â”œâ”€â”€ MultiHTTPMCPClient # å¤šæœåŠ¡å™¨åè°ƒ + èŠå¤©äº¤äº’å¾ªç¯

# â””â”€â”€ main() # å¯åŠ¨å…¥å£

#   Configuration ï¼šç¯å¢ƒå˜é‡å’Œ JSON é…ç½®åŠ è½½å™¨

# class Configuration:

# def __init__(self):

# load_dotenv()

# self.api_key = os.getenv("LLM_API_KEY")

# self.base_url = os.getenv("BASE_URL")

# self.model = os.getenv("MODEL", "gpt-4o")

# âœ” æ”¯æŒä» .env ä¸­åŠ è½½ API keyï¼Œå¹¶è¯»å– servers_config.json æ¥é…ç½® MCP æœåŠ¡å™¨ï¼š

## {

## "mcpServers": {

# "weather": {

# "endpoint": "http://localhost:8000/mcp"

}

}

}

#   HTTPMCPServer ï¼šä¸å•ä¸ª MCP æœåŠ¡å™¨äº¤äº’

è¿™æ˜¯æ¯ä¸ª MCP å·¥å…·æœåŠ¡å™¨çš„å°åŠ©æ‰‹ï¼Œæ”¯æŒå››ä¸ªæ ¸å¿ƒæ“ä½œï¼š

# âœ” åˆå§‹åŒ– handshakeï¼ˆåˆå§‹åŒ– â†’ åˆå§‹åŒ–é€šçŸ¥ï¼‰

# await self._post_json({

"method": "initialize",

"params": {"protocolVersion": "2024-11-05", ...}

})

# await self._post_json({

"method": "notifications/initialized"

})

# æœåŠ¡å™¨è¿”å›æ”¯æŒçš„åŠŸèƒ½åï¼Œå®¢æˆ·ç«¯è¡¨ç¤ºâ€œå‡†å¤‡å¥½äº†â€ã€‚

# âœ” è·å–å·¥å…·åˆ—è¡¨

# await self._post_json({

"method": "tools/list",

# "params": {}

})

# è¿”å›æ‰€æœ‰æ”¯æŒçš„å·¥å…·å®šä¹‰ï¼ŒåŒ…æ‹¬ nameã€descriptionã€inputSchemaã€‚

# âœ” å·¥å…·è°ƒç”¨ï¼ˆæµå¼è¯»å–ï¼‰

# async def call_tool_stream(...)

ä½¿ç”¨ httpx.stream(...) å¼€å§‹è°ƒç”¨ï¼Œé€è¡Œ aiter_lines() è¯»å–æœåŠ¡å™¨å“åº”ã€‚

# è·³è¿‡ "stream" å­—æ®µ

# æ•è· "result" â†’ æ‹¼æ¥æˆæ–‡æœ¬

# æŠ›å‡º "error" â†’ æŠ¥é”™æç¤º

# ä¾‹å¦‚å¤©æ°”æœåŠ¡ä¼šé€è¡Œè¿”å›ï¼š

{"stream": "æ­£åœ¨æŸ¥è¯¢"} {"result": {"content": [{"type":"text", "text":"â›… æ­å·"}]}}

# âœ” _post_json æ–¹æ³•

# è‡ªåŠ¨å¤„ç†ï¼š

204 No Content â†’ è¿”å›ç©º {} ï¼Œç”¨äºé€šçŸ¥ç±»æ–¹æ³•

## é 200 â†’ æŠ¥é”™æç¤º

## è¿”å› JSON å†…å®¹ä½“

  LLMClient ï¼šOpenAI å¯¹è¯æ¥å£ï¼ˆæ”¯æŒ tools å‚æ•°ï¼‰

# def chat(self, messages, tools):

# return self.client.chat.completions.create(...)

# ä¼ å…¥å†å²æ¶ˆæ¯ + toolsï¼Œè‡ªåŠ¨å¤„ç†å·¥å…·è°ƒç”¨çš„äº¤äº’ã€‚

#   MultiHTTPMCPClient ï¼šåè°ƒå¤šä¸ªæœåŠ¡å™¨ + äº¤äº’æµç¨‹

# âœ” start() åˆå§‹åŒ–é˜¶æ®µ

# await server.initialize()

tools = await server.list_tools()

# æ±‡æ€»æ‰€æœ‰ MCP å·¥å…·ï¼Œè½¬ä¸º OpenAI çš„ Function Calling æ ¼å¼

# å·¥å…·åæ”¹æˆ weather_get_weather è¿™æ ·çš„ç»„åˆ

# âœ” chat_loop() ï¼šäº¤äº’ä¸»å¾ªç¯

ä½ : è¯·å‘Šè¯‰æˆ‘æ­å·çš„å¤©æ°” ğŸ¤– AI â†’ æ¨ç† â†’ è¿”å› tool_call ğŸ” è°ƒç”¨ MCP å·¥å…· â†’ è·å–æµå¼å“åº” ğŸ“© æŠŠç»“æœé€å› LLM â†’ è¾“å‡ºæœ€ç»ˆç»“æœ

# æ”¯æŒå¤šè½®å¯¹è¯

# è‡ªåŠ¨è¯†åˆ«æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·

# è‡ªåŠ¨å¤„ç†å·¥å…·å‚æ•°è§£æå’Œè°ƒç”¨é€»è¾‘

# clientäº®ç‚¹æ€»ç»“ï¼š

# ç‰¹æ€§

# è¯´æ˜

# âœ… å®Œå…¨å¼‚æ­¥

# ä½¿ç”¨ asyncio + httpx.AsyncClient ä¿è¯æ€§èƒ½

# âœ… æ”¯æŒæµå¼å·¥å…·è°ƒç”¨

# ä¸æµå¼ HTTP å·¥å…·æ— ç¼é…åˆ

# âœ… æ”¯æŒå¤šæœåŠ¡å™¨

# å¯ä»¥ä¸€æ¬¡è¿å¤šä¸ª MCP æœåŠ¡ï¼Œæ‹¼æ¥ç»Ÿä¸€å·¥å…·åˆ—è¡¨

# âœ… æ”¯æŒ LLM Function Calling

# ä¸ gpt-4-turbo ã€ gpt-4o ç­‰æ¨¡å‹æ·±åº¦é›†æˆ

# âœ… æ”¯æŒå®¹é”™å’Œé”™è¯¯å¤„ç†

# è¿æ¥å¤±è´¥ã€è°ƒç”¨é”™è¯¯éƒ½æœ‰æ˜ç¡®æç¤º

![Image](pdf_images\page312_img1.png)

![Image](pdf_images\page312_img2.png)

![Image](pdf_images\page312_img3.png)

# 5.2 åˆ›å»º.envå’Œservers_config.jsonæ–‡ä»¶

# ç„¶ååœ¨srcæ–‡ä»¶å¤¹å†…åˆ›å»º.envæ–‡ä»¶ï¼Œå¹¶å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š

BASE_URL=â€œå¤§æ¨¡å‹è¯·æ±‚åœ°å€â€

MODEL=â€œæ¨¡å‹åç§°â€

LLM_API_KEY=â€œAPI-KEYâ€

# ç„¶ååˆ›å»º servers_config.json ï¼Œç”¨äºè®°å½•HTTPæµå¼ä¼ è¾“æœåŠ¡å™¨åœ°å€ï¼Œä¾‹å¦‚ï¼š

{

# "mcpServers": {

# "weather": {

"endpoint": "http://127.0.0.1:8000/mcp"

}

}

}

# 5.3 å€ŸåŠ©è‡ªå®šä¹‰clientæ¥å…¥æµå¼HTTP MCPæœåŠ¡å™¨

# å¼€å¯æµå¼HTTP MCPæœåŠ¡å™¨

# uv run ./src/mcp_weather_http/server.py --api_key YOUR_API_KRI

![Image](pdf_images\page313_img1.png)

![Image](pdf_images\page313_img2.png)

# è¿è¡Œclient.pyè„šæœ¬

# # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/MCP-sse-test/mcp-weather-http

# uv run ./src/mcp_weather_http/client.py

# å°è¯•è¿›è¡Œé—®ç­”

# ä½ å¥½ï¼Œå¥½ä¹…ä¸è§

# è¯·é—®åŒ—äº¬ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ

# è§‚å¯ŸHTTPæµå¼ä¼ è¾“æœåŠ¡å™¨ç«¯è¿è¡Œæ•ˆæœ

![Image](pdf_images\page315_img1.png)

![Image](pdf_images\page315_img2.png)

## æµå¼HTTP MCPæœåŠ¡å™¨å¼€å‘æŒ‡å—

# é•¿æœŸä»¥æ¥ï¼ŒMCPå·¥å…·çš„å¼‚åœ°é€šä¿¡ä¸»è¦æ˜¯ä»¥SSEä¼ è¾“æ–¹å¼ä¸ºä¸»ï¼Œè¿™ç§é€šä¿¡æ–¹æ³•æ—¢æ²¡æœ‰å¤šé€šé“å¹¶å‘åŒæ—¶

# ä¹Ÿä¸å¤Ÿç¨³å®šï¼Œå¾ˆéš¾çœŸæ­£çš„é€‚ç”¨äºä¼ä¸šçº§åº”ç”¨åœºæ™¯ã€‚å› æ­¤ï¼Œåœ¨2æœˆåˆï¼Œåœ¨MCPå®˜æ–¹GitHubé¡¹ç›®ä¸»é¡µä¸Šï¼Œå°±

# æœ‰å¼€å‘è€…æå‡ºäº†é‡‡ç”¨æ›´å…ˆè¿›çš„æµå¼HTTPä¼ è¾“æ–¹æ³•ä»£æ›¿SSEä¼ è¾“çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œç›¸æ¯”SSEä¼ è¾“ï¼ŒHTTPæµå¼ä¼  è¾“å¹¶å‘æ›´é«˜ã€é€šä¿¡æ›´åŠ ç¨³å®šï¼ŒåŒæ—¶ä¹Ÿæ›´å®¹æ˜“é›†æˆå’Œéƒ¨ç½²ï¼Œè¿™ä¹Ÿæ˜¯å½“ä»£æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å¼‚åœ°é€šä¿¡çš„æœ€ä½³è§£

# å†³æ–¹æ¡ˆã€‚

# ä½†æµå¼HTTP MCPæœåŠ¡å™¨åŠŸèƒ½å¤æ‚ï¼Œç›¸å…³SDKçš„ç ”å‘éš¾åº¦ä¹Ÿå¾ˆé«˜ï¼Œå› æ­¤åœ¨ä»Šå¹´çš„3æœˆï¼ŒMCPå®˜æ–¹é¦–å…ˆå‘å¸ƒ

äº†MCPçš„æµå¼HTTPé€šä¿¡åè®®ï¼Œå…¶ä¸­è¯¦ç»†è¯´æ˜äº†HTTPæµå¼ä¼ è¾“çš„åŸºæœ¬åè®®ã€‚

# https://github.com/modelcontextprotocol/modelcontextprotocol/blob/main/docs/specificati

# on/2025-03-26/basic/transports.mdx#streamable-http

# ç„¶ååœ¨5æœˆ9å·çš„1.8.0ç‰ˆæœ¬æ›´æ–°ä¸­ï¼Œæ­£å¼åœ¨SDKä¸­åŠ å…¥äº†HTTPæµå¼MCPæœåŠ¡å™¨çš„ç›¸å…³åŠŸèƒ½æ”¯æŒã€‚è‡ª æ­¤å¼€å‘è€…å°±å¯ä»¥é€šè¿‡MCP SDKï¼Œé«˜æ•ˆå¿«é€Ÿå¼€å‘æµå¼HTTP MCPæœåŠ¡å™¨ï¼Œå¹¶é¡ºåˆ©è¿›è¡Œå¤šé€šé“å¹¶å‘çš„ä¼ä¸šçº§

MCPå·¥å…·éƒ¨ç½²ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™å°†æ˜¯MCPæŠ€æœ¯è¿ˆå‘ä¼ä¸šçº§åº”ç”¨çš„è‡³å…³é‡è¦çš„ä¸€æ­¥ã€‚

![Image](pdf_images\page316_img1.png)

![Image](pdf_images\page316_img2.png)

# https://github.com/modelcontextprotocol/python-sdk/releases/tag/v1.8.0

# æœ¬æœŸå…¬å¼€è¯¾ï¼Œå°±ä¸ºå¤§å®¶ä»é›¶ä»‹ç»æµå¼HTTP MCPæœåŠ¡å™¨å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ä¸Šçº¿çš„å…¨æµç¨‹ï¼Œå¹¶æä¾›å®Œæ•´

MCPæœåŠ¡å™¨åŠŸèƒ½æµ‹è¯•å®¢æˆ·ç«¯è„šæœ¬ã€‚å…¬å¼€è¯¾å®Œæ•´è¯¾ä»¶æ‰«ç å³å¯é¢†å–ã€‚

# ä¸€ã€åŸºäºHTTPæµå¼ä¼ è¾“çš„MCPæœåŠ¡å™¨å¼€å‘æµç¨‹

# åˆ›å»ºé¡¹ç›®æ–‡ä»¶ï¼š

![Image](pdf_images\page317_img1.png)

![Image](pdf_images\page317_img2.png)

## # cd /root/autodl-tmp/MCP

## uv init mcp-weather-http

# cd mcp-weather-http

# # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

# uv venv

# # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ

# source .venv/bin/activate

uv add mcp httpx

# è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨src_layerçš„é£æ ¼è¿›è¡Œé¡¹ç›®æ–‡ä»¶ç¼–æ’ï¼Œå› æ­¤éœ€è¦åˆ é™¤main.pyï¼Œå¹¶åˆ›å»ºmcp_weather_httpç›®

# å½•ã€‚

# mkdir -p ./src/mcp_weather_http

# cd ./src/mcp_weather_http

# ç„¶ååˆ›å»ºåœ¨src/mcp_weather_httpä¸­åˆ›å»ºä¸‰ä¸ªä»£ç æ–‡ä»¶ï¼š

# å¹¶åœ¨ __init__.py ä¸­å†™å…¥

# from .server import main

# è€Œåœ¨ __main__.py ä¸­å†™å…¥ï¼š

# from mcp_weather_http import main

main()

## ç„¶ååœ¨ server.py ä¸­å†™å…¥å¦‚ä¸‹ä»£ç ï¼š

# import contextlib

import logging

# import os

# from collections.abc import AsyncIterator

# import anyio

# import click

# import httpx

# import mcp.types as types

# from mcp.server.lowlevel import Server

# from mcp.server.streamable_http_manager import StreamableHTTPSessionManager

# from starlette.applications import Starlette

from starlette.routing import Mount

# from starlette.types import Receive, Scope, Send

# ---------------------------------------------------------------------------

# # Weather helpers

# ---------------------------------------------------------------------------

# OPENWEATHER_URL = "https://api.openweathermap.org/data/2.5/weather"

# DEFAULT_UNITS = "metric" # use Celsius by default

# DEFAULT_LANG = "zh_cn" # Chinese descriptions

# async def fetch_weather(city: str, api_key: str) -> dict[str, str]:

"""Call OpenWeather API and return a simplified weather dict.

# Raises:

httpx.HTTPStatusError: if the response has a non-2xx status.

"""

params = {

"q": city,

"appid": api_key,

"units": DEFAULT_UNITS,

"lang": DEFAULT_LANG,

}

# async with httpx.AsyncClient(timeout=10) as client:

# r = await client.get(OPENWEATHER_URL, params=params)

# r.raise_for_status()

# data = r.json()

# # Extract a concise summary

weather_main = data["weather"][0]["main"]

description = data["weather"][0]["description"]

temp = data["main"]["temp"]

feels_like = data["main"]["feels_like"]

humidity = data["main"]["humidity"]

# return {

"city": city,

"weather": weather_main,

"description": description,

"temp": f"{temp}Â°C",

"feels_like": f"{feels_like}Â°C",

"humidity": f"{humidity}%",

}

# @click.command()

@click.option("--port", default=3000, help="Port to listen on for HTTP")

# @click.option(

"--api-key",

envvar="OPENWEATHER_API_KEY",

required=True,

help="OpenWeather API key (or set OPENWEATHER_API_KEY env var)",

)

# @click.option(

"--log-level",

default="INFO",

help="Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)",

)

# @click.option(

"--json-response",

is_flag=True,

default=False,

help="Enable JSON responses instead of SSE streams",

)

# def main(port: int, api_key: str, log_level: str, json_response: bool) -> int:

"""Run an MCP weather server using Streamable HTTP transport."""

# ---------------------- Configure logging ----------------------

# logging.basicConfig(

level=getattr(logging, log_level.upper()),

format="%(asctime)s - %(name)s - %(levelname)s - %(message)s",

)

# logger = logging.getLogger("weather-server")

# ---------------------- Create MCP Server ----------------------

# app = Server("mcp-streamable-http-weather")

# ---------------------- Tool implementation -------------------

# @app.call_tool()

# async def call_tool(name: str, arguments: dict) -> list[types.TextContent]:

"""Handle the 'get-weather' tool call."""

# ctx = app.request_context

# city = arguments.get("location")

# if not city:

raise ValueError("'location' is required in arguments")

# Send an initial log message so the client sees streaming early.

# await ctx.session.send_log_message(

level="info",

data=f"Fetching weather for {city}â€¦",

logger="weather",

related_request_id=ctx.request_id,

)

# try:

# weather = await fetch_weather(city, api_key)

# except Exception as err:

# Stream the error to the client and re-raise so MCP returns error.

await ctx.session.send_log_message(

## level="error",

## data=str(err),

logger="weather",

related_request_id=ctx.request_id,

)

# raise

# # Stream a success notification (optional)

# await ctx.session.send_log_message(

level="info",

data="Weather data fetched successfully!",

logger="weather",

related_request_id=ctx.request_id,

)

# # Compose human-readable summary for the final return value.

# summary = ( f"{weather['city']}ï¼š{weather['description']}ï¼Œæ¸©åº¦

# {weather['temp']}ï¼Œ"

# f"ä½“æ„Ÿ {weather['feels_like']}ï¼Œæ¹¿åº¦ {weather['humidity']}ã€‚"

)

# return [

types.TextContent(type="text", text=summary),

]

# ---------------------- Tool registry -------------------------

# @app.list_tools()

# async def list_tools() -> list[types.Tool]:

# """Expose available tools to the LLM."""

# return [

# types.Tool(

name="get-weather",

description="æŸ¥è¯¢æŒ‡å®šåŸå¸‚çš„å®æ—¶å¤©æ°”ï¼ˆOpenWeather æ•°æ®ï¼‰",

# inputSchema={

"type": "object",

"required": ["location"],

# "properties": {

# "location": {

"type": "string",

"description": "åŸå¸‚çš„è‹±æ–‡åç§°ï¼Œå¦‚ 'Beijing'",

}

},

},

)

]

# ---------------------- Session manager -----------------------

# session_manager = StreamableHTTPSessionManager(

app=app,

# event_store=None, # æ— çŠ¶æ€ï¼›ä¸ä¿å­˜å†å²äº‹ä»¶

json_response=json_response,

stateless=True,

)

## async def handle_streamable_http(scope: Scope, receive: Receive, send: Send)

## -> None: # noqa: D401,E501

# await session_manager.handle_request(scope, receive, send)

# ---------------------- Lifespan Management --------------------

# @contextlib.asynccontextmanager

# async def lifespan(app: Starlette) -> AsyncIterator[None]:

async with session_manager.run(): logger.info("Weather MCP server started! ğŸš€") try:

# yield

# finally:

logger.info("Weather MCP server shutting downâ€¦")

# ---------------------- ASGI app + Uvicorn ---------------------

# starlette_app = Starlette(

debug=False,

routes=[Mount("/mcp", app=handle_streamable_http)],

lifespan=lifespan,

)

# import uvicorn

# uvicorn.run(starlette_app, host="0.0.0.0", port=port)

# return 0

if __name__ == "__main__":

# main()

# ä»£ç è§£é‡Šå¦‚ä¸‹ï¼š

1. å¼•å…¥å„ç§åŠŸèƒ½æ¨¡å—

# import contextlib

import logging

# import os

# from collections.abc import AsyncIterator

# import anyio

# import click

# import httpx

# import mcp.types as types

# from mcp.server.lowlevel import Server

# from mcp.server.streamable_http_manager import StreamableHTTPSessionManager

# from starlette.applications import Starlette

from starlette.routing import Mount

# from starlette.types import Receive, Scope, Send

# ğŸ’¡è§£é‡Šï¼š

# è¿™äº›éƒ½æ˜¯â€œå·¥å…·ç®±â€ï¼Œä½ å¯ä»¥ç†è§£ä¸ºåœ¨å†™ä¸€ä¸ªå¤©æ°”å°ç¨‹åºä¹‹å‰ï¼Œå…ˆå¯¼å…¥ä¸€äº›ç°æˆçš„åŠŸèƒ½ç»„ä»¶ï¼š

httpx : ç”¨æ¥è”ç½‘æŸ¥å¤©æ°”ã€‚

## mcp : æä¾›äº†è®©å¤§æ¨¡å‹è°ƒç”¨å·¥å…·çš„èƒ½åŠ›ã€‚

## starlette : å¸®ä½ æ­å»º HTTP ç½‘ç»œæœåŠ¡ã€‚

# click : å¸®ä½ å†™å‘½ä»¤è¡Œå‚æ•°ï¼Œæ¯”å¦‚ --api-key=xxx ã€‚

# å…¶å®ƒæ¨¡å—åˆ™å¸®åŠ©ä½ å¤„ç†å¼‚æ­¥ä»»åŠ¡ã€æ‰“å°æ—¥å¿—ã€è¯»å–ç¯å¢ƒå˜é‡ç­‰ã€‚

2. æŸ¥è¯¢å¤©æ°”çš„å‡½æ•°

# async def fetch_weather(city: str, api_key: str) -> dict[str, str]:

# ğŸ’¡è§£é‡Šï¼š

# è¿™ä¸ªå‡½æ•°æ˜¯ä½ å¤©æ°”æœåŠ¡å™¨çš„æ ¸å¿ƒåŠŸèƒ½â€”â€”æ ¹æ®åŸå¸‚åå» OpenWeather ç½‘ç«™æŸ¥è¯¢å¤©æ°”ã€‚

# å®ƒç”¨ httpx.AsyncClient è¿™ä¸ªå·¥å…·è”ç½‘å‘è¯·æ±‚ï¼Œè¿”å›çš„ç»“æœåŒ…æ‹¬ï¼šå¤©æ°”æƒ…å†µã€æ°”æ¸©ã€æ¹¿åº¦ç­‰ç­‰ã€‚

3. å¯åŠ¨æœåŠ¡å™¨çš„ä¸»å‡½æ•° main()

# @click.command()

# @click.option("--port", default=3000, ...)

# @click.option("--api-key", envvar="OPENWEATHER_API_KEY", ...)

# def main(port, api_key, ...):

# ğŸ’¡è§£é‡Šï¼š

# è¿™æ˜¯ä½ è¿è¡ŒæœåŠ¡å™¨çš„â€œå…¥å£â€ï¼Œä½ ä»¥åè¿è¡Œæ—¶åªéœ€è¦ï¼š

# python weather_mcp_streamable_http_server.py --port 3000 --api-key xxxx

# click æ˜¯ä¸ªå¾ˆå¥½ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¸®ä½ æ¥æ”¶å‚æ•°ï¼›

# api_key å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼Œæ–¹ä¾¿åˆå®‰å…¨ã€‚

4. MCPå·¥å…·æ³¨å†Œï¼šè®©å¤§æ¨¡å‹èƒ½è°ƒç”¨ get-weather

# @app.call_tool()

# async def call_tool(name: str, arguments: dict):

# ğŸ’¡è§£é‡Šï¼š

# è¿™å°±æ˜¯ä½ æ³¨å†Œç»™å¤§è¯­è¨€æ¨¡å‹ç”¨çš„â€œå·¥å…·â€ï¼Œåå­—å« get-weather ã€‚

å½“æ¨¡å‹è¯´â€œæˆ‘éœ€è¦æŸ¥åŒ—äº¬çš„å¤©æ°”â€ï¼ŒMCPå°±ä¼šè§¦å‘è¿™ä¸ªå‡½æ•°ã€‚

# ä½ åœ¨é‡Œé¢è§£æå‡º "location" å­—æ®µï¼Œç„¶åè°ƒç”¨ä¸Šé¢é‚£ä¸ª fetch_weather() å‡½æ•°æ‹¿æ•°æ®ã€‚

# å®ƒè¿˜æœ‰ä¸€ä¸ª äº®ç‚¹åŠŸèƒ½ï¼šä¼šå®æ—¶å¾€å®¢æˆ·ç«¯æ¨é€æ¶ˆæ¯ï¼š

# await ctx.session.send_log_message(...)

# è¿™äº›å°±æ˜¯æ‰€è°“çš„ â€œæµå¼æ—¥å¿—é€šçŸ¥â€ï¼ˆæ¯”å¦‚â€œæ­£åœ¨æŸ¥è¯¢â€¦â€ã€â€œæˆåŠŸäº†ï¼â€ï¼‰ã€‚

5. MCPå‘Šè¯‰æ¨¡å‹æœ‰å“ªäº›å·¥å…·ï¼ˆå·¥å…·åˆ—è¡¨ï¼‰

# @app.list_tools()

async def list_tools() -> list[types.Tool]:

## ğŸ’¡è§£é‡Šï¼š

MCP ä¼šå®šæœŸé—®ä½ ï¼šâ€œä½ è¿™é‡Œéƒ½æœ‰å“ªäº›å·¥å…·å¯ä»¥ç”¨ï¼Ÿâ€

# ä½ å°±è¿”å›ä¸€ä¸ªå« get-weather çš„å·¥å…·æè¿°ï¼Œå‘Šè¯‰æ¨¡å‹ï¼š

# è¾“å…¥éœ€è¦ä¸€ä¸ª locationï¼Œæ˜¯åŸå¸‚åã€‚

6. æµå¼ä¼šè¯ç®¡ç†å™¨é…ç½®

# session_manager = StreamableHTTPSessionManager(

app=app,

event_store=None,

json_response=json_response,

stateless=True,

)

# ğŸ’¡è§£é‡Šï¼š

# è¿™ä¸€å¥åˆ›å»ºäº† MCP çš„â€œHTTP ä¼šè¯å¤„ç†ä¸­å¿ƒâ€ï¼Œè´Ÿè´£å¤„ç†æ‰€æœ‰ /mcp è·¯ç”±çš„è¯·æ±‚ï¼›

# stateless=True è¡¨ç¤ºä¸ä¿å­˜å†å²å¯¹è¯ï¼Œæ¯æ¬¡éƒ½æ˜¯æ–°è¯·æ±‚ï¼›

# json_response=False è¡¨ç¤ºç”¨æµå¼ SSEï¼ˆä½ ä¹Ÿå¯ä»¥æ”¹æˆä¸€æ¬¡æ€§ JSON å“åº”ï¼‰ã€‚

7. æ„å»º Starlette Web åº”ç”¨

# starlette_app = Starlette(

routes=[Mount("/mcp", app=handle_streamable_http)],

lifespan=lifespan,

)

# ğŸ’¡è§£é‡Šï¼š

# è¿™æ˜¯å°† MCP æœåŠ¡æŒ‚è½½åˆ°ä½ çš„ç½‘ç«™ /mcp è·¯å¾„ä¸Šï¼›

ç”¨æˆ·è®¿é—®è¿™ä¸ªè·¯å¾„æ—¶ï¼Œå°±ä¼šè¿›å…¥åˆšæ‰åˆ›å»ºçš„ MCP ä¼šè¯ç®¡ç†å™¨ã€‚

8. å¯åŠ¨æœåŠ¡å™¨

# import uvicorn

# uvicorn.run(starlette_app, host="0.0.0.0", port=port)

# ğŸ’¡è§£é‡Šï¼š

è¿™è¡Œä»£ç å¯åŠ¨ä½ çš„ MCP HTTP æœåŠ¡å™¨ï¼Œç›‘å¬æŒ‡å®šç«¯å£ï¼›

# å¦‚æœä½ ä¼ çš„æ˜¯ --port 3000 ï¼Œè®¿é—®è·¯å¾„å°±æ˜¯ï¼š

# http://localhost:3000/mcp

![Image](pdf_images\page324_img1.png)

# åŒæ—¶éœ€è¦å›åˆ°ä¸»ç›®å½•ï¼Œä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶ pyproject.toml ï¼š

# [build-system]

requires = ["setuptools>=61.0", "wheel"]

# build-backend = "setuptools.build_meta"

# [project]

name = "mcp-weather-http"

version = "1.1.0"

description = "è¾“å…¥OpenWeather-API-KEYï¼Œè·å–å¤©æ°”ä¿¡æ¯ã€‚"

readme = "README.md"

# requires-python = ">=3.10"

dependencies = [

"httpx>=0.28.1",

"mcp>=1.8.0",

]

# [project.scripts]

# mcp-weather-http = "mcp_weather_http:main"

# [tool.setuptools]

package-dir = {"" = "src"}

# [tool.setuptools.packages.find]

where = ["src"]

# è‡³æ­¤å³å®Œæˆäº†æ•´ä¸ªé¡¹ç›®çš„ä»£ç ç¼–å†™å·¥ä½œã€‚å®Œæ•´é¡¹ç›®ä»£ç å¯åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š

![Image](pdf_images\page325_img1.png)

![Image](pdf_images\page325_img2.png)

![Image](pdf_images\page325_img3.png)

![Image](pdf_images\page325_img4.png)

# äºŒã€HTTPæµå¼ä¼ è¾“MCPæœåŠ¡å™¨å¼€å¯ä¸æµ‹è¯•

# åœ¨åˆ›å»ºå®Œ server.py åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯æœåŠ¡å¹¶è¿›è¡Œæµ‹è¯•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¼€å¯æµå¼

# HTTP MCPæœåŠ¡å™¨ï¼Œç„¶åå†å¼€å¯Inspectorï¼š

# åœ¨stdioæ¨¡å¼ä¸‹æ˜¯å¼€å¯Inspectoræ—¶åŒæ­¥å¼€å¯MCP Server

å¼€å¯æµå¼HTTP MCPæœåŠ¡å™¨ï¼š

# # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/mcp-weather-http

# uv run ./src/mcp_weather_http/server.py --api-key YOUR_KEY

# å¼€å¯Inspector

# # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

# # cd /root/autodl-tmp/MCP/mcp-weather-http

# # source .venv/bin/activate

# npx -y @modelcontextprotocol/inspector uv run main.py --api-key YOUR_KEY

# è¿›è¡Œæµ‹è¯•

# åŒæ ·ï¼Œå¦‚æœæ˜¯ä½¿ç”¨AutoDLï¼Œåˆ™å…ˆéœ€è¦ä½¿ç”¨éš§é“å·¥å…·å°†ç«¯å£æ˜ å°„åˆ°æœ¬åœ°è¿›è¡Œè¿è¡Œï¼š

![Image](pdf_images\page326_img1.png)

![Image](pdf_images\page326_img2.png)

# ç„¶åæ‰“å¼€Inspectorï¼Œå¹¶é€‰æ‹©HTTPæµå¼æ¨¡å¼ï¼Œé€‰æ‹©é»˜è®¤è¿è¡Œåœ°å€ï¼š http://localhost:3000/mcp ï¼Œç„¶

# åç‚¹å‡»connectï¼š

# ç„¶åç‚¹å‡»List Toolsï¼š

![Image](pdf_images\page327_img1.png)

![Image](pdf_images\page327_img2.png)

# ç„¶åç‚¹å‡»get-weatherï¼š

# ç„¶åè¾“å…¥åœ°åè¿›è¡Œæµ‹è¯•ï¼š

![Image](pdf_images\page328_img1.png)

![Image](pdf_images\page328_img2.png)

# è‹¥èƒ½æ­£å¸¸è¿”å›ç»“æœï¼Œåˆ™è¯´æ˜æœåŠ¡å™¨è¿è¡Œæ­£å¸¸ã€‚

# å®Œæ•´æµ‹è¯•æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š

![Image](pdf_images\page329_img1.png)

# ä¸‰ã€æµå¼HTTP MCPæœåŠ¡å™¨å¼‚åœ°è°ƒç”¨

# æ¥ä¸‹æ¥å³å¯åœ¨å¼‚åœ°ç¯å¢ƒï¼ˆä¹Ÿå¯ä»¥æ˜¯æœ¬åœ°ï¼‰é€šè¿‡HTTPæ–¹å¼è°ƒç”¨MCPæœåŠ¡äº†ã€‚è¿™é‡Œä»¥æœ¬åœ°å®‰è£…çš„Cherry

# Studioä¸ºä¾‹ï¼Œè¿›è¡Œè°ƒç”¨æ¼”ç¤ºã€‚æ­¤å¤„éœ€è¦ä¿æŒè¿œç¨‹æµå¼HTTP MCPæœåŠ¡å™¨å¤„äºå¼€å¯çŠ¶æ€ï¼Œç„¶åæŒ‰ç…§å¦‚ä¸‹æµç¨‹

# è¿›è¡Œè°ƒç”¨ã€‚

# é¦–å…ˆç‚¹å‡»æ·»åŠ æœåŠ¡å™¨ï¼š

# ç„¶åè¾“å…¥æœåŠ¡å™¨åç§° mcp-weather-http ï¼Œå¹¶é€‰æ‹©æµå¼ä¼ è¾“ç±»å‹ï¼Œå¹¶é€‰æ‹©æœåŠ¡å™¨åœ°å€ï¼šhttp://localhost:

# 3000/mcp ï¼Œç„¶åç‚¹å‡»ä¿å­˜ï¼š

![Image](pdf_images\page330_img1.png)

![Image](pdf_images\page330_img2.png)

![Image](pdf_images\page330_img3.png)

è‹¥æ˜¾ç¤ºæœåŠ¡å™¨æ›´æ–°æˆåŠŸï¼Œåˆ™è¡¨ç¤ºå·²ç»è¿æ¥ä¸ŠMCPæœåŠ¡å™¨ï¼š

# æ­¤æ—¶åå°æ˜¾ç¤ºå¦‚ä¸‹ï¼š

ç„¶åå³å¯è¿›è¡Œå¯¹è¯æµ‹è¯•ï¼Œè¿™é‡Œå›åˆ°å¯¹è¯é¡µé¢ï¼Œé€‰æ‹©MCPæœåŠ¡å™¨ï¼Œ

![Image](pdf_images\page331_img1.png)

![Image](pdf_images\page331_img2.png)

# ç„¶åè¿›è¡Œå¤©æ°”æŸ¥è¯¢æµ‹è¯•ï¼š è¯·é—®åŒ—äº¬å’Œæ­å·ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ ï¼Œç„¶åå³å¯æŸ¥çœ‹å›ç­”ç»“æœï¼š

# å®Œæ•´è®¾ç½®ä¸è°ƒç”¨æµç¨‹æ¼”ç¤ºå¦‚ä¸‹ï¼š

![Image](pdf_images\page332_img1.png)

![Image](pdf_images\page332_img2.png)

# å››ã€æµå¼HTTP MCPæœåŠ¡å™¨å‘å¸ƒæµç¨‹

# æµ‹è¯•å®Œæˆåï¼Œå³å¯ä¸Šçº¿å‘å¸ƒã€‚è¿™é‡Œä»ç„¶è€ƒè™‘å‘å¸ƒåˆ°pypiå¹³å°ï¼Œå¹¶ä½¿ç”¨cherry studioè¿›è¡Œæœ¬åœ°è°ƒç”¨æµ‹

# è¯•ã€‚å®Œæ•´é¡¹ç›®ä»£ç å¯åœ¨ç½‘ç›˜ä¸­é¢†å–ï¼š

# æ‰“åŒ…ä¸Šä¼ ï¼š

![Image](pdf_images\page333_img1.png)

![Image](pdf_images\page333_img2.png)

## # å›åˆ°é¡¹ç›®ä¸»ç›®å½•

## # cd /root/autodl-tmp/MCP/mcp-weather-http

uv pip install build twine

# python -m build

# python -m twine upload dist/*

# æŸ¥çœ‹å‘å¸ƒçš„åº“ï¼šhttps://pypi.org/search/?q=mcp-weather-http&o=

# æœ¬åœ°å®‰è£…ï¼š

# pip install mcp-weather-http

![Image](pdf_images\page334_img1.png)

![Image](pdf_images\page334_img2.png)

![Image](pdf_images\page334_img3.png)

![Image](pdf_images\page334_img4.png)

å¼€å¯æœåŠ¡ï¼šuv run mcp-weather-http --api-key YOUR_API_KEY

# ç„¶åå³å¯æ‰“å¼€æµè§ˆå™¨è¾“å…¥ http://localhost:3000/mcp æµ‹è¯•è¿æ¥æƒ…å†µ

# æ³¨æ„ï¼Œè¿™é‡Œåœ¨æœåŠ¡å™¨ä¸Šå¼€å¯æœåŠ¡ç„¶åæœ¬åœ°è¿æ¥ä¹Ÿå¯ä»¥ï¼Œå’Œstdioä¸åŒï¼ŒHTTPæ¨¡å¼ä¸‹çš„MCPæœåŠ¡å™¨å¹¶

# ä¸éœ€è¦æœ¬åœ°è¿è¡Œã€‚

# ä½¿ç”¨Cherry studioè¿›è¡Œè¿æ¥

# ç„¶åå³å¯ä½¿ç”¨Cherry studioè¿æ¥æµå¼HTTPæ¨¡å¼ä¸‹çš„MCPæœåŠ¡å™¨ï¼Œè¿˜æ˜¯å’Œæ­¤å‰ä¸€æ ·çš„è¿æ¥æµç¨‹ï¼Œè¾“

# å…¥æœåŠ¡å™¨åç§° mcp-weather-http ï¼Œå¹¶é€‰æ‹©æµå¼ä¼ è¾“ç±»å‹ï¼Œå¹¶é€‰æ‹©æœåŠ¡å™¨åœ°å€ï¼šhttp://localhost:3000/

mcp ï¼Œç„¶åç‚¹å‡»ä¿å­˜ï¼š

![Image](pdf_images\page335_img1.png)

![Image](pdf_images\page335_img2.png)

![Image](pdf_images\page335_img3.png)

è‹¥æ˜¾ç¤ºæœåŠ¡å™¨æ›´æ–°æˆåŠŸï¼Œåˆ™è¡¨ç¤ºå·²ç»è¿æ¥ä¸ŠMCPæœåŠ¡å™¨ï¼š

# æ­¤æ—¶æœ¬åœ°ç¯å¢ƒåå°æ˜¾ç¤ºå†…å®¹å¦‚ä¸‹ï¼š

# æ¥ä¸‹æ¥å³å¯è¿›è¡Œå¯¹è¯æµ‹è¯•ï¼š

![Image](pdf_images\page336_img1.png)

è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†æµå¼HTTP MCPå·¥å…·çš„å‘å¸ƒã€ä¸‹è½½ä¸è°ƒç”¨æµ‹è¯•æµç¨‹ã€‚

![Image](pdf_images\page5_img1.png)

![Image](pdf_images\page6_img1.png)

![Image](pdf_images\page10_img1.png)

![Image](pdf_images\page11_img1.png)

![Image](pdf_images\page13_img1.png)

![Image](pdf_images\page13_img2.png)

![Image](pdf_images\page24_img1.png)

![Image](pdf_images\page71_img1.png)

![Image](pdf_images\page71_img2.png)

![Image](pdf_images\page90_img1.png)

![Image](pdf_images\page90_img2.png)

![Image](pdf_images\page90_img3.png)

![Image](pdf_images\page97_img1.png)

![Image](pdf_images\page97_img2.png)

![Image](pdf_images\page105_img1.png)

![Image](pdf_images\page105_img2.png)

![Image](pdf_images\page113_img1.png)

![Image](pdf_images\page129_img1.png)

![Image](pdf_images\page129_img2.png)

![Image](pdf_images\page130_img1.png)

![Image](pdf_images\page130_img2.png)

![Image](pdf_images\page131_img1.png)

![Image](pdf_images\page131_img2.png)

![Image](pdf_images\page140_img1.png)

![Image](pdf_images\page141_img1.png)

![Image](pdf_images\page144_img1.png)

![Image](pdf_images\page144_img2.png)

![Image](pdf_images\page145_img1.png)

![Image](pdf_images\page145_img2.png)

![Image](pdf_images\page146_img1.png)

![Image](pdf_images\page151_img1.png)

![Image](pdf_images\page153_img1.png)

![Image](pdf_images\page154_img1.png)

![Image](pdf_images\page155_img1.png)

![Image](pdf_images\page156_img1.png)

![Image](pdf_images\page157_img1.png)

![Image](pdf_images\page158_img1.png)

![Image](pdf_images\page159_img1.png)

![Image](pdf_images\page160_img1.png)

![Image](pdf_images\page161_img1.png)

![Image](pdf_images\page178_img1.png)

![Image](pdf_images\page179_img1.png)

![Image](pdf_images\page179_img2.png)

![Image](pdf_images\page246_img1.png)

![Image](pdf_images\page247_img1.png)

![Image](pdf_images\page314_img1.png)
